(self.webpackChunkexample_angular=self.webpackChunkexample_angular||[]).push([[68],{6068:(d_,Xa,Ui)=>{"use strict";Ui.r(Xa),Ui.d(Xa,{ExamplesModule:()=>$e});var En=Ui(6895),Bi=Ui(433),B=Ui(8256);function h(a){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(a)}function de(a,r,o){return(r=function Or(a){var r=function Xt(a,r){if("object"!==h(a)||null===a)return a;var o=a[Symbol.toPrimitive];if(void 0!==o){var u=o.call(a,r||"default");if("object"!==h(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(a)}(a,"string");return"symbol"===h(r)?r:String(r)}(r))in a?Object.defineProperty(a,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[r]=o,a}function ze(a){return a+.5|0}const Pe=(a,r,o)=>Math.max(Math.min(a,o),r);function Wi(a){return Pe(ze(2.55*a),0,255)}function hn(a){return Pe(ze(255*a),0,255)}function On(a){return Pe(ze(a/2.55)/100,0,1)}function xs(a){return Pe(ze(100*a),0,100)}const Ni={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},po=[..."0123456789ABCDEF"],vs=a=>po[15&a],ie=a=>po[(240&a)>>4]+po[15&a],Cn=a=>(240&a)>>4==(15&a);const ra=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function oa(a,r,o){const u=r*Math.min(o,1-o),m=(_,b=(_+a/30)%12)=>o-u*Math.max(Math.min(b-3,9-b,1),-1);return[m(0),m(8),m(4)]}function sa(a,r,o){const u=(m,_=(m+a/60)%6)=>o-o*r*Math.max(Math.min(_,4-_,1),0);return[u(5),u(3),u(1)]}function oc(a,r,o){const u=oa(a,1,.5);let m;for(r+o>1&&(m=1/(r+o),r*=m,o*=m),m=0;m<3;m++)u[m]*=1-r-o,u[m]+=r;return u}function fo(a){const o=a.r/255,u=a.g/255,m=a.b/255,_=Math.max(o,u,m),b=Math.min(o,u,m),T=(_+b)/2;let S,z,F;return _!==b&&(F=_-b,z=T>.5?F/(2-_-b):F/(_+b),S=function Ue(a,r,o,u,m){return a===m?(r-o)/u+(r<o?6:0):r===m?(o-a)/u+2:(a-r)/u+4}(o,u,m,F,_),S=60*S+.5),[0|S,z||0,T]}function Fr(a,r,o,u){return(Array.isArray(r)?a(r[0],r[1],r[2]):a(r,o,u)).map(hn)}function mo(a,r,o){return Fr(oa,a,r,o)}function Ur(a){return(a%360+360)%360}const Fo={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Nr={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let qn;const Fn=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,Un=a=>a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055,qe=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function rr(a,r,o){if(a){let u=fo(a);u[r]=Math.max(0,Math.min(u[r]+u[r]*o,0===r?360:1)),u=mo(u),a.r=u[0],a.g=u[1],a.b=u[2]}}function ws(a,r){return a&&Object.assign(r||{},a)}function gr(a){var r={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(r={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(r.a=hn(a[3]))):(r=ws(a,{r:0,g:0,b:0,a:1})).a=hn(r.a),r}function aa(a){return"r"===a.charAt(0)?function Ya(a){const r=Fn.exec(a);let u,m,_,o=255;if(r){if(r[7]!==u){const b=+r[7];o=r[8]?Wi(b):Pe(255*b,0,255)}return u=+r[1],m=+r[3],_=+r[5],u=255&(r[2]?Wi(u):Pe(u,0,255)),m=255&(r[4]?Wi(m):Pe(m,0,255)),_=255&(r[6]?Wi(_):Pe(_,0,255)),{r:u,g:m,b:_,a:o}}}(a):function bs(a){const r=ra.exec(a);let u,o=255;if(!r)return;r[5]!==u&&(o=r[6]?Wi(+r[5]):hn(+r[5]));const m=Ur(+r[2]),_=+r[3]/100,b=+r[4]/100;return u="hwb"===r[1]?function go(a,r,o){return Fr(oc,a,r,o)}(m,_,b):"hsv"===r[1]?function Hi(a,r,o){return Fr(sa,a,r,o)}(m,_,b):mo(m,_,b),{r:u[0],g:u[1],b:u[2],a:o}}(a)}class Wn{constructor(r){if(r instanceof Wn)return r;const o=typeof r;let u;"object"===o?u=gr(r):"string"===o&&(u=function Oo(a){var o,r=a.length;return"#"===a[0]&&(4===r||5===r?o={r:255&17*Ni[a[1]],g:255&17*Ni[a[2]],b:255&17*Ni[a[3]],a:5===r?17*Ni[a[4]]:255}:(7===r||9===r)&&(o={r:Ni[a[1]]<<4|Ni[a[2]],g:Ni[a[3]]<<4|Ni[a[4]],b:Ni[a[5]]<<4|Ni[a[6]],a:9===r?Ni[a[7]]<<4|Ni[a[8]]:255})),o}(r)||function Uo(a){qn||(qn=function mr(){const a={},r=Object.keys(Nr),o=Object.keys(Fo);let u,m,_,b,T;for(u=0;u<r.length;u++){for(b=T=r[u],m=0;m<o.length;m++)_=o[m],T=T.replace(_,Fo[_]);_=parseInt(Nr[b],16),a[T]=[_>>16&255,_>>8&255,255&_]}return a}(),qn.transparent=[0,0,0,0]);const r=qn[a.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:4===r.length?r[3]:255}}(r)||aa(r)),this._rgb=u,this._valid=!!u}get valid(){return this._valid}get rgb(){var r=ws(this._rgb);return r&&(r.a=On(r.a)),r}set rgb(r){this._rgb=gr(r)}rgbString(){return this._valid?function Oi(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${On(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}(this._rgb):void 0}hexString(){return this._valid?function en(a){var r=(a=>Cn(a.r)&&Cn(a.g)&&Cn(a.b)&&Cn(a.a))(a)?vs:ie;return a?"#"+r(a.r)+r(a.g)+r(a.b)+((a,r)=>a<255?r(a):"")(a.a,r):void 0}(this._rgb):void 0}hslString(){return this._valid?function fr(a){if(!a)return;const r=fo(a),o=r[0],u=xs(r[1]),m=xs(r[2]);return a.a<255?`hsla(${o}, ${u}%, ${m}%, ${On(a.a)})`:`hsl(${o}, ${u}%, ${m}%)`}(this._rgb):void 0}mix(r,o){if(r){const u=this.rgb,m=r.rgb;let _;const b=o===_?.5:o,T=2*b-1,S=u.a-m.a,z=((T*S==-1?T:(T+S)/(1+T*S))+1)/2;_=1-z,u.r=255&z*u.r+_*m.r+.5,u.g=255&z*u.g+_*m.g+.5,u.b=255&z*u.b+_*m.b+.5,u.a=b*u.a+(1-b)*m.a,this.rgb=u}return this}interpolate(r,o){return r&&(this._rgb=function nr(a,r,o){const u=qe(On(a.r)),m=qe(On(a.g)),_=qe(On(a.b));return{r:hn(Un(u+o*(qe(On(r.r))-u))),g:hn(Un(m+o*(qe(On(r.g))-m))),b:hn(Un(_+o*(qe(On(r.b))-_))),a:a.a+o*(r.a-a.a)}}(this._rgb,r._rgb,o)),this}clone(){return new Wn(this.rgb)}alpha(r){return this._rgb.a=hn(r),this}clearer(r){return this._rgb.a*=1-r,this}greyscale(){const r=this._rgb,o=ze(.3*r.r+.59*r.g+.11*r.b);return r.r=r.g=r.b=o,this}opaquer(r){return this._rgb.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return rr(this._rgb,2,r),this}darken(r){return rr(this._rgb,2,-r),this}saturate(r){return rr(this._rgb,1,r),this}desaturate(r){return rr(this._rgb,1,-r),this}rotate(r){return function pr(a,r){var o=fo(a);o[0]=Ur(o[0]+r),o=mo(o),a.r=o[0],a.g=o[1],a.b=o[2]}(this._rgb,r),this}}function Qi(){}const _r=(()=>{let a=0;return()=>a++})();function Je(a){return null===a||typeof a>"u"}function gi(a){if(Array.isArray&&Array.isArray(a))return!0;const r=Object.prototype.toString.call(a);return"[object"===r.slice(0,7)&&"Array]"===r.slice(-6)}function We(a){return null!==a&&"[object Object]"===Object.prototype.toString.call(a)}function vi(a){return("number"==typeof a||a instanceof Number)&&isFinite(+a)}function nn(a,r){return vi(a)?a:r}function Le(a,r){return typeof a>"u"?r:a}const Sn=(a,r)=>"string"==typeof a&&a.endsWith("%")?parseFloat(a)/100*r:+a;function _i(a,r,o){if(a&&"function"==typeof a.call)return a.apply(o,r)}function Qe(a,r,o,u){let m,_,b;if(gi(a))if(_=a.length,u)for(m=_-1;m>=0;m--)r.call(o,a[m],m);else for(m=0;m<_;m++)r.call(o,a[m],m);else if(We(a))for(b=Object.keys(a),_=b.length,m=0;m<_;m++)r.call(o,a[b[m]],b[m])}function yr(a,r){let o,u,m,_;if(!a||!r||a.length!==r.length)return!1;for(o=0,u=a.length;o<u;++o)if(m=a[o],_=r[o],m.datasetIndex!==_.datasetIndex||m.index!==_.index)return!1;return!0}function _o(a){if(gi(a))return a.map(_o);if(We(a)){const r=Object.create(null),o=Object.keys(a),u=o.length;let m=0;for(;m<u;++m)r[o[m]]=_o(a[o[m]]);return r}return a}function No(a){return-1===["__proto__","prototype","constructor"].indexOf(a)}function Es(a,r,o,u){if(!No(a))return;const m=r[a],_=o[a];We(m)&&We(_)?or(m,_,u):r[a]=_o(_)}function or(a,r,o){const u=gi(r)?r:[r],m=u.length;if(!We(a))return a;const _=(o=o||{}).merger||Es;let b;for(let T=0;T<m;++T){if(b=u[T],!We(b))continue;const S=Object.keys(b);for(let z=0,F=S.length;z<F;++z)_(S[z],a,b,o)}return a}function Vr(a,r){return or(a,r,{merger:Vo})}function Vo(a,r,o){if(!No(a))return;const u=r[a],m=o[a];We(u)&&We(m)?Vr(u,m):Object.prototype.hasOwnProperty.call(r,a)||(r[a]=_o(m))}const yo={"":a=>a,x:a=>a.x,y:a=>a.y};function Nn(a,r){return(yo[r]||(yo[r]=function Ka(a){const r=function Ja(a){const r=a.split("."),o=[];let u="";for(const m of r)u+=m,u.endsWith("\\")?u=u.slice(0,-1)+".":(o.push(u),u="");return o}(a);return o=>{for(const u of r){if(""===u)break;o=o&&o[u]}return o}}(r)))(a)}function jr(a){return a.charAt(0).toUpperCase()+a.slice(1)}const Di=a=>typeof a<"u",xn=a=>"function"==typeof a,ca=(a,r)=>{if(a.size!==r.size)return!1;for(const o of a)if(!r.has(o))return!1;return!0},J=Math.PI,U=2*J,j=U+J,Q=Number.POSITIVE_INFINITY,at=J/180,ct=J/2,xt=J/4,bt=2*J/3,mt=Math.log10,Tt=Math.sign;function jt(a,r,o){return Math.abs(a-r)<o}function se(a){const r=Math.round(a);a=jt(a,r,a/1e3)?r:a;const o=Math.pow(10,Math.floor(mt(a))),u=a/o;return(u<=1?1:u<=2?2:u<=5?5:10)*o}function _e(a){return!isNaN(parseFloat(a))&&isFinite(a)}function ye(a,r,o){let u,m,_;for(u=0,m=a.length;u<m;u++)_=a[u][o],isNaN(_)||(r.min=Math.min(r.min,_),r.max=Math.max(r.max,_))}function xe(a){return a*(J/180)}function Re(a){return a*(180/J)}function ti(a){if(!vi(a))return;let r=1,o=0;for(;Math.round(a*r)/r!==a;)r*=10,o++;return o}function Ee(a,r){const o=r.x-a.x,u=r.y-a.y,m=Math.sqrt(o*o+u*u);let _=Math.atan2(u,o);return _<-.5*J&&(_+=U),{angle:_,distance:m}}function ai(a,r){return Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2))}function fi(a,r){return(a-r+j)%U-J}function Xi(a){return(a%U+U)%U}function Vn(a,r,o,u){const m=Xi(a),_=Xi(r),b=Xi(o),T=Xi(_-m),S=Xi(b-m),z=Xi(m-_),F=Xi(m-b);return m===_||m===b||u&&_===b||T>S&&z<F}function zt(a,r,o){return Math.max(r,Math.min(o,a))}function bi(a,r,o,u=1e-6){return a>=Math.min(r,o)-u&&a<=Math.max(r,o)+u}function vr(a,r,o){o=o||(b=>a[b]<r);let _,u=a.length-1,m=0;for(;u-m>1;)_=m+u>>1,o(_)?m=_:u=_;return{lo:m,hi:u}}const br=(a,r,o,u)=>vr(a,o,u?m=>{const _=a[m][r];return _<o||_===o&&a[m+1][r]===o}:m=>a[m][r]<o),wr=(a,r,o)=>vr(a,o,u=>a[u][r]>=o),sc=["push","pop","shift","splice","unshift"];function ee(a,r){const o=a._chartjs;if(!o)return;const u=o.listeners,m=u.indexOf(r);-1!==m&&u.splice(m,1),!(u.length>0)&&(sc.forEach(_=>{delete a[_]}),delete a._chartjs)}function Ve(a){const r=new Set;let o,u;for(o=0,u=a.length;o<u;++o)r.add(a[o]);return r.size===u?a:Array.from(r)}const sr=typeof window>"u"?function(a){return a()}:window.requestAnimationFrame;function xo(a,r){let o=[],u=!1;return function(...m){o=m,u||(u=!0,sr.call(window,()=>{u=!1,a.apply(r,o)}))}}const Go=a=>"start"===a?"left":"end"===a?"right":"center",ji=(a,r,o)=>"start"===a?r:"end"===a?o:(r+o)/2;function un(a,r,o){const u=r.length;let m=0,_=u;if(a._sorted){const{iScale:b,_parsed:T}=a,S=b.axis,{min:z,max:F,minDefined:G,maxDefined:W}=b.getUserBounds();G&&(m=zt(Math.min(br(T,b.axis,z).lo,o?u:br(r,S,b.getPixelForValue(z)).lo),0,u-1)),_=W?zt(Math.max(br(T,b.axis,F,!0).hi+1,o?0:br(r,S,b.getPixelForValue(F),!0).hi+1),m,u)-m:u-m}return{start:m,count:_}}function yi(a){const{xScale:r,yScale:o,_scaleRanges:u}=a,m={xmin:r.min,xmax:r.max,ymin:o.min,ymax:o.max};if(!u)return a._scaleRanges=m,!0;const _=u.xmin!==r.min||u.xmax!==r.max||u.ymin!==o.min||u.ymax!==o.max;return Object.assign(u,m),_}const ha=a=>0===a||1===a,vn=(a,r,o)=>-Math.pow(2,10*(a-=1))*Math.sin((a-r)*U/o),Qa=(a,r,o)=>Math.pow(2,-10*a)*Math.sin((a-r)*U/o)+1,ar={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>1-Math.cos(a*ct),easeOutSine:a=>Math.sin(a*ct),easeInOutSine:a=>-.5*(Math.cos(J*a)-1),easeInExpo:a=>0===a?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>1===a?1:1-Math.pow(2,-10*a),easeInOutExpo:a=>ha(a)?a:a<.5?.5*Math.pow(2,10*(2*a-1)):.5*(2-Math.pow(2,-10*(2*a-1))),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>ha(a)?a:vn(a,.075,.3),easeOutElastic:a=>ha(a)?a:Qa(a,.075,.3),easeInOutElastic:a=>ha(a)?a:a<.5?.5*vn(2*a,.1125,.45):.5+.5*Qa(2*a-1,.1125,.45),easeInBack:a=>a*a*(2.70158*a-1.70158),easeOutBack:a=>(a-=1)*a*(2.70158*a+1.70158)+1,easeInOutBack(a){let r=1.70158;return(a/=.5)<1?a*a*((1+(r*=1.525))*a-r)*.5:.5*((a-=2)*a*((1+(r*=1.525))*a+r)+2)},easeInBounce:a=>1-ar.easeOutBounce(1-a),easeOutBounce:a=>a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,easeInOutBounce:a=>a<.5?.5*ar.easeInBounce(2*a):.5*ar.easeOutBounce(2*a-1)+.5};function tl(a){if(a&&"object"==typeof a){const r=a.toString();return"[object CanvasPattern]"===r||"[object CanvasGradient]"===r}return!1}function ua(a){return tl(a)?a:new Wn(a)}function Zo(a){return tl(a)?a:new Wn(a).saturate(.5).darken(.1).hexString()}const $o=["x","y","borderWidth","radius","tension"],As=["color","borderColor","backgroundColor"],Fi=new Map;function Zr(a,r,o){return function el(a,r){r=r||{};const o=a+JSON.stringify(r);let u=Fi.get(o);return u||(u=new Intl.NumberFormat(a,r),Fi.set(o,u)),u}(r,o).format(a)}const bn={values:a=>gi(a)?a:""+a,numeric(a,r,o){if(0===a)return"0";const u=this.chart.options.locale;let m,_=a;if(o.length>1){const z=Math.max(Math.abs(o[0].value),Math.abs(o[o.length-1].value));(z<1e-4||z>1e15)&&(m="scientific"),_=function wn(a,r){let o=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(o)>=1&&a!==Math.floor(a)&&(o=a-Math.floor(a)),o}(a,o)}const b=mt(Math.abs(_)),T=Math.max(Math.min(-1*Math.floor(b),20),0),S={notation:m,minimumFractionDigits:T,maximumFractionDigits:T};return Object.assign(S,this.options.ticks.format),Zr(a,u,S)},logarithmic(a,r,o){if(0===a)return"0";const u=o[r].significand||a/Math.pow(10,Math.floor(mt(a)));return[1,2,3,5,10,15].includes(u)||r>.8*o.length?bn.numeric.call(this,a,r,o):""}};var da={formatters:bn};const Ii=Object.create(null),qo=Object.create(null);function Wo(a,r){if(!r)return a;const o=r.split(".");for(let u=0,m=o.length;u<m;++u){const _=o[u];a=a[_]||(a[_]=Object.create(null))}return a}function Ho(a,r,o){return"string"==typeof r?or(Wo(a,r),o):or(Wo(a,""),r)}class on{constructor(r,o){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=u=>u.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(u,m)=>Zo(m.backgroundColor),this.hoverBorderColor=(u,m)=>Zo(m.borderColor),this.hoverColor=(u,m)=>Zo(m.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(o)}set(r,o){return Ho(this,r,o)}get(r){return Wo(this,r)}describe(r,o){return Ho(qo,r,o)}override(r,o){return Ho(Ii,r,o)}route(r,o,u,m){const _=Wo(this,r),b=Wo(this,u),T="_"+o;Object.defineProperties(_,{[T]:{value:_[o],writable:!0},[o]:{enumerable:!0,get(){const S=this[T],z=b[m];return We(S)?Object.assign({},z,S):Le(S,z)},set(S){this[T]=S}}})}apply(r){r.forEach(o=>o(this))}}var ki=new on({_scriptable:a=>!a.startsWith("on"),_indexable:a=>"events"!==a,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function ac(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>"onProgress"!==r&&"onComplete"!==r&&"fn"!==r}),a.set("animations",{colors:{type:"color",properties:As},numbers:{type:"number",properties:$o}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>0|r}}}})},function An(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function il(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,o)=>o.lineWidth,tickColor:(r,o)=>o.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:da.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&"callback"!==r&&"parser"!==r,_indexable:r=>"borderDash"!==r&&"tickBorderDash"!==r&&"dash"!==r}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:r=>"backdropPadding"!==r&&"callback"!==r,_indexable:r=>"backdropPadding"!==r})}]);function Hn(a,r,o,u,m){let _=r[m];return _||(_=r[m]=a.measureText(m).width,o.push(m)),_>u&&(u=_),u}function pa(a,r,o,u){let m=(u=u||{}).data=u.data||{},_=u.garbageCollect=u.garbageCollect||[];u.font!==r&&(m=u.data={},_=u.garbageCollect=[],u.font=r),a.save(),a.font=r;let b=0;const T=o.length;let S,z,F,G,W;for(S=0;S<T;S++)if(G=o[S],null!=G&&!0!==gi(G))b=Hn(a,m,_,b,G);else if(gi(G))for(z=0,F=G.length;z<F;z++)W=G[z],null!=W&&!gi(W)&&(b=Hn(a,m,_,b,W));a.restore();const nt=_.length/2;if(nt>o.length){for(S=0;S<nt;S++)delete m[_[S]];_.splice(0,nt)}return b}function Tr(a,r,o){const u=a.currentDevicePixelRatio,m=0!==o?Math.max(o/2,.5):0;return Math.round((r-m)*u)/u+m}function Ch(a,r){(r=r||a.getContext("2d")).save(),r.resetTransform(),r.clearRect(0,0,a.width,a.height),r.restore()}function fa(a,r,o,u){Xo(a,r,o,u,null)}function Xo(a,r,o,u,m){let _,b,T,S,z,F,G,W;const nt=r.pointStyle,gt=r.rotation,_t=r.radius;let yt=(gt||0)*at;if(nt&&"object"==typeof nt&&(_=nt.toString(),"[object HTMLImageElement]"===_||"[object HTMLCanvasElement]"===_))return a.save(),a.translate(o,u),a.rotate(yt),a.drawImage(nt,-nt.width/2,-nt.height/2,nt.width,nt.height),void a.restore();if(!(isNaN(_t)||_t<=0)){switch(a.beginPath(),nt){default:m?a.ellipse(o,u,m/2,_t,0,0,U):a.arc(o,u,_t,0,U),a.closePath();break;case"triangle":F=m?m/2:_t,a.moveTo(o+Math.sin(yt)*F,u-Math.cos(yt)*_t),yt+=bt,a.lineTo(o+Math.sin(yt)*F,u-Math.cos(yt)*_t),yt+=bt,a.lineTo(o+Math.sin(yt)*F,u-Math.cos(yt)*_t),a.closePath();break;case"rectRounded":z=.516*_t,S=_t-z,b=Math.cos(yt+xt)*S,G=Math.cos(yt+xt)*(m?m/2-z:S),T=Math.sin(yt+xt)*S,W=Math.sin(yt+xt)*(m?m/2-z:S),a.arc(o-G,u-T,z,yt-J,yt-ct),a.arc(o+W,u-b,z,yt-ct,yt),a.arc(o+G,u+T,z,yt,yt+ct),a.arc(o-W,u+b,z,yt+ct,yt+J),a.closePath();break;case"rect":if(!gt){S=Math.SQRT1_2*_t,F=m?m/2:S,a.rect(o-F,u-S,2*F,2*S);break}yt+=xt;case"rectRot":G=Math.cos(yt)*(m?m/2:_t),b=Math.cos(yt)*_t,T=Math.sin(yt)*_t,W=Math.sin(yt)*(m?m/2:_t),a.moveTo(o-G,u-T),a.lineTo(o+W,u-b),a.lineTo(o+G,u+T),a.lineTo(o-W,u+b),a.closePath();break;case"crossRot":yt+=xt;case"cross":G=Math.cos(yt)*(m?m/2:_t),b=Math.cos(yt)*_t,T=Math.sin(yt)*_t,W=Math.sin(yt)*(m?m/2:_t),a.moveTo(o-G,u-T),a.lineTo(o+G,u+T),a.moveTo(o+W,u-b),a.lineTo(o-W,u+b);break;case"star":G=Math.cos(yt)*(m?m/2:_t),b=Math.cos(yt)*_t,T=Math.sin(yt)*_t,W=Math.sin(yt)*(m?m/2:_t),a.moveTo(o-G,u-T),a.lineTo(o+G,u+T),a.moveTo(o+W,u-b),a.lineTo(o-W,u+b),yt+=xt,G=Math.cos(yt)*(m?m/2:_t),b=Math.cos(yt)*_t,T=Math.sin(yt)*_t,W=Math.sin(yt)*(m?m/2:_t),a.moveTo(o-G,u-T),a.lineTo(o+G,u+T),a.moveTo(o+W,u-b),a.lineTo(o-W,u+b);break;case"line":b=m?m/2:Math.cos(yt)*_t,T=Math.sin(yt)*_t,a.moveTo(o-b,u-T),a.lineTo(o+b,u+T);break;case"dash":a.moveTo(o,u),a.lineTo(o+Math.cos(yt)*(m?m/2:_t),u+Math.sin(yt)*_t);break;case!1:a.closePath()}a.fill(),r.borderWidth>0&&a.stroke()}}function ks(a,r,o){return o=o||.5,!r||a&&a.x>r.left-o&&a.x<r.right+o&&a.y>r.top-o&&a.y<r.bottom+o}function vo(a,r){a.save(),a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()}function $r(a){a.restore()}function bo(a,r,o,u,m){if(!r)return a.lineTo(o.x,o.y);if("middle"===m){const _=(r.x+o.x)/2;a.lineTo(_,r.y),a.lineTo(_,o.y)}else"after"===m!=!!u?a.lineTo(r.x,o.y):a.lineTo(o.x,r.y);a.lineTo(o.x,o.y)}function nl(a,r,o,u){if(!r)return a.lineTo(o.x,o.y);a.bezierCurveTo(u?r.cp1x:r.cp2x,u?r.cp1y:r.cp2y,u?o.cp2x:o.cp1x,u?o.cp2y:o.cp1y,o.x,o.y)}function In(a,r,o,u,m,_={}){const b=gi(r)?r:[r],T=_.strokeWidth>0&&""!==_.strokeColor;let S,z;for(a.save(),a.font=m.string,function Xn(a,r){r.translation&&a.translate(r.translation[0],r.translation[1]),Je(r.rotation)||a.rotate(r.rotation),r.color&&(a.fillStyle=r.color),r.textAlign&&(a.textAlign=r.textAlign),r.textBaseline&&(a.textBaseline=r.textBaseline)}(a,_),S=0;S<b.length;++S)z=b[S],_.backdrop&&Sh(a,_.backdrop),T&&(_.strokeColor&&(a.strokeStyle=_.strokeColor),Je(_.strokeWidth)||(a.lineWidth=_.strokeWidth),a.strokeText(z,o,u,_.maxWidth)),a.fillText(z,o,u,_.maxWidth),ma(a,o,u,z,_),u+=m.lineHeight;a.restore()}function ma(a,r,o,u,m){if(m.strikethrough||m.underline){const _=a.measureText(u),b=r-_.actualBoundingBoxLeft,T=r+_.actualBoundingBoxRight,z=o+_.actualBoundingBoxDescent,F=m.strikethrough?(o-_.actualBoundingBoxAscent+z)/2:z;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=m.decorationWidth||2,a.moveTo(b,F),a.lineTo(T,F),a.stroke()}}function Sh(a,r){const o=a.fillStyle;a.fillStyle=r.color,a.fillRect(r.left,r.top,r.width,r.height),a.fillStyle=o}function zs(a,r){const{x:o,y:u,w:m,h:_,radius:b}=r;a.arc(o+b.topLeft,u+b.topLeft,b.topLeft,-ct,J,!0),a.lineTo(o,u+_-b.bottomLeft),a.arc(o+b.bottomLeft,u+_-b.bottomLeft,b.bottomLeft,J,ct,!0),a.lineTo(o+m-b.bottomRight,u+_),a.arc(o+m-b.bottomRight,u+_-b.bottomRight,b.bottomRight,ct,0,!0),a.lineTo(o+m,u+b.topRight),a.arc(o+m-b.topRight,u+b.topRight,b.topRight,0,-ct,!0),a.lineTo(o+b.topLeft,u)}const rl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Ah=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function lc(a,r){const o=(""+a).match(rl);if(!o||"normal"===o[1])return 1.2*r;switch(a=+o[2],o[3]){case"px":return a;case"%":a/=100}return r*a}const cc=a=>+a||0;function wo(a,r){const o={},u=We(r),m=u?Object.keys(r):r,_=We(a)?u?b=>Le(a[b],a[r[b]]):b=>a[b]:()=>a;for(const b of m)o[b]=cc(_(b));return o}function hc(a){return wo(a,{top:"y",right:"x",bottom:"y",left:"x"})}function Er(a){return wo(a,["topLeft","topRight","bottomLeft","bottomRight"])}function tn(a){const r=hc(a);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function Gi(a,r){let o=Le((a=a||{}).size,(r=r||ki.font).size);"string"==typeof o&&(o=parseInt(o,10));let u=Le(a.style,r.style);u&&!(""+u).match(Ah)&&(console.warn('Invalid font style specified: "'+u+'"'),u=void 0);const m={family:Le(a.family,r.family),lineHeight:lc(Le(a.lineHeight,r.lineHeight),o),size:o,style:u,weight:Le(a.weight,r.weight),string:""};return m.string=function Is(a){return!a||Je(a.size)||Je(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}(m),m}function lr(a,r,o,u){let _,b,T,m=!0;for(_=0,b=a.length;_<b;++_)if(T=a[_],void 0!==T&&(void 0!==r&&"function"==typeof T&&(T=T(r),m=!1),void 0!==o&&gi(T)&&(T=T[o%T.length],m=!1),void 0!==T))return u&&!m&&(u.cacheable=!1),T}function Yn(a,r){return Object.assign(Object.create(a),r)}function ga(a,r=[""],o=a,u,m=(()=>a[0])){Di(u)||(u=cl("_fallback",a));const _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:o,_fallback:u,_getTarget:m,override:b=>ga([b,...a],r,o,u)};return new Proxy(_,{deleteProperty:(b,T)=>(delete b[T],delete b._keys,delete a[0][T],!0),get:(b,T)=>sl(b,T,()=>function kh(a,r,o,u){let m;for(const _ of r)if(m=cl(ol(_,a),o),Di(m))return Ds(a,m)?He(o,u,a,m):m}(T,r,a,b)),getOwnPropertyDescriptor:(b,T)=>Reflect.getOwnPropertyDescriptor(b._scopes[0],T),getPrototypeOf:()=>Reflect.getPrototypeOf(a[0]),has:(b,T)=>hl(b).includes(T),ownKeys:b=>hl(b),set(b,T,S){const z=b._storage||(b._storage=m());return b[T]=z[T]=S,delete b._keys,!0}})}function Mr(a,r,o,u){const m={_cacheable:!1,_proxy:a,_context:r,_subProxy:o,_stack:new Set,_descriptors:Ps(a,u),setContext:_=>Mr(a,_,o,u),override:_=>Mr(a.override(_),r,o,u)};return new Proxy(m,{deleteProperty:(_,b)=>(delete _[b],delete a[b],!0),get:(_,b,T)=>sl(_,b,()=>function al(a,r,o){const{_proxy:u,_context:m,_subProxy:_,_descriptors:b}=a;let T=u[r];return xn(T)&&b.isScriptable(r)&&(T=function uc(a,r,o,u){const{_proxy:m,_context:_,_subProxy:b,_stack:T}=o;if(T.has(a))throw new Error("Recursion detected: "+Array.from(T).join("->")+"->"+a);return T.add(a),r=r(_,b||u),T.delete(a),Ds(a,r)&&(r=He(m._scopes,m,a,r)),r}(r,T,a,o)),gi(T)&&T.length&&(T=function To(a,r,o,u){const{_proxy:m,_context:_,_subProxy:b,_descriptors:T}=o;if(Di(_.index)&&u(a))r=r[_.index%r.length];else if(We(r[0])){const S=r,z=m._scopes.filter(F=>F!==S);r=[];for(const F of S){const G=He(z,m,a,F);r.push(Mr(G,_,b&&b[a],T))}}return r}(r,T,a,b.isIndexable)),Ds(r,T)&&(T=Mr(T,m,_&&_[r],b)),T}(_,b,T)),getOwnPropertyDescriptor:(_,b)=>_._descriptors.allKeys?Reflect.has(a,b)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,b),getPrototypeOf:()=>Reflect.getPrototypeOf(a),has:(_,b)=>Reflect.has(a,b),ownKeys:()=>Reflect.ownKeys(a),set:(_,b,T)=>(a[b]=T,delete _[b],!0)})}function Ps(a,r={scriptable:!0,indexable:!0}){const{_scriptable:o=r.scriptable,_indexable:u=r.indexable,_allKeys:m=r.allKeys}=a;return{allKeys:m,scriptable:o,indexable:u,isScriptable:xn(o)?o:()=>o,isIndexable:xn(u)?u:()=>u}}const ol=(a,r)=>a?a+jr(r):r,Ds=(a,r)=>We(r)&&"adapters"!==a&&(null===Object.getPrototypeOf(r)||r.constructor===Object);function sl(a,r,o){if(Object.prototype.hasOwnProperty.call(a,r))return a[r];const u=o();return a[r]=u,u}function Eo(a,r,o){return xn(a)?a(r,o):a}const ll=(a,r)=>!0===a?r:"string"==typeof a?Nn(r,a):void 0;function dc(a,r,o,u,m){for(const _ of r){const b=ll(o,_);if(b){a.add(b);const T=Eo(b._fallback,o,m);if(Di(T)&&T!==o&&T!==u)return T}else if(!1===b&&Di(u)&&o!==u)return null}return!1}function He(a,r,o,u){const m=r._rootScopes,_=Eo(r._fallback,o,u),b=[...a,...m],T=new Set;T.add(u);let S=Ls(T,b,o,_||o,u);return!(null===S||Di(_)&&_!==o&&(S=Ls(T,b,_,S,u),null===S))&&ga(Array.from(T),[""],m,_,()=>function Ih(a,r,o){const u=a._getTarget();r in u||(u[r]={});const m=u[r];return gi(m)&&We(o)?o:m||{}}(r,o,u))}function Ls(a,r,o,u,m){for(;o;)o=dc(a,r,o,u,m);return o}function cl(a,r){for(const o of r){if(!o)continue;const u=o[a];if(Di(u))return u}}function hl(a){let r=a._keys;return r||(r=a._keys=function pc(a){const r=new Set;for(const o of a)for(const u of Object.keys(o).filter(m=>!m.startsWith("_")))r.add(u);return Array.from(r)}(a._scopes)),r}function fc(a,r,o,u){const{iScale:m}=a,{key:_="r"}=this._parsing,b=new Array(u);let T,S,z,F;for(T=0,S=u;T<S;++T)z=T+o,F=r[z],b[T]={r:m.parse(Nn(F,_),z)};return b}const id=Number.EPSILON||1e-14,qr=(a,r)=>r<a.length&&!a[r].skip&&a[r],ul=a=>"x"===a?"y":"x";function dl(a,r,o,u){const m=a.skip?r:a,_=r,b=o.skip?r:o,T=ai(_,m),S=ai(b,_);let z=T/(T+S),F=S/(T+S);z=isNaN(z)?0:z,F=isNaN(F)?0:F;const G=u*z,W=u*F;return{previous:{x:_.x-G*(b.x-m.x),y:_.y-G*(b.y-m.y)},next:{x:_.x+W*(b.x-m.x),y:_.y+W*(b.y-m.y)}}}function fl(a,r,o){return Math.max(Math.min(a,o),r)}function ya(a,r,o,u,m){let _,b,T,S;if(r.spanGaps&&(a=a.filter(z=>!z.skip)),"monotone"===r.cubicInterpolationMode)!function Ph(a,r="x"){const o=ul(r),u=a.length,m=Array(u).fill(0),_=Array(u);let b,T,S,z=qr(a,0);for(b=0;b<u;++b)if(T=S,S=z,z=qr(a,b+1),S){if(z){const F=z[r]-S[r];m[b]=0!==F?(z[o]-S[o])/F:0}_[b]=T?z?Tt(m[b-1])!==Tt(m[b])?0:(m[b-1]+m[b])/2:m[b-1]:m[b]}(function pl(a,r,o){const u=a.length;let m,_,b,T,S,z=qr(a,0);for(let F=0;F<u-1;++F)if(S=z,z=qr(a,F+1),S&&z){if(jt(r[F],0,id)){o[F]=o[F+1]=0;continue}m=o[F]/r[F],_=o[F+1]/r[F],T=Math.pow(m,2)+Math.pow(_,2),!(T<=9)&&(b=3/Math.sqrt(T),o[F]=m*b*r[F],o[F+1]=_*b*r[F])}})(a,m,_),function zh(a,r,o="x"){const u=ul(o),m=a.length;let _,b,T,S=qr(a,0);for(let z=0;z<m;++z){if(b=T,T=S,S=qr(a,z+1),!T)continue;const F=T[o],G=T[u];b&&(_=(F-b[o])/3,T[`cp1${o}`]=F-_,T[`cp1${u}`]=G-_*r[z]),S&&(_=(S[o]-F)/3,T[`cp2${o}`]=F+_,T[`cp2${u}`]=G+_*r[z])}}(a,_,r)}(a,m);else{let z=u?a[a.length-1]:a[0];for(_=0,b=a.length;_<b;++_)T=a[_],S=dl(z,T,a[Math.min(_+1,b-(u?0:1))%b],r.tension),T.cp1x=S.previous.x,T.cp1y=S.previous.y,T.cp2x=S.next.x,T.cp2y=S.next.y,z=T}r.capBezierPoints&&function _a(a,r){let o,u,m,_,b,T=ks(a[0],r);for(o=0,u=a.length;o<u;++o)b=_,_=T,T=o<u-1&&ks(a[o+1],r),_&&(m=a[o],b&&(m.cp1x=fl(m.cp1x,r.left,r.right),m.cp1y=fl(m.cp1y,r.top,r.bottom)),T&&(m.cp2x=fl(m.cp2x,r.left,r.right),m.cp2y=fl(m.cp2y,r.top,r.bottom)))}(a,o)}function mc(){return typeof window<"u"&&typeof document<"u"}function Yo(a){let r=a.parentNode;return r&&"[object ShadowRoot]"===r.toString()&&(r=r.host),r}function Rs(a,r,o){let u;return"string"==typeof a?(u=parseInt(a,10),-1!==a.indexOf("%")&&(u=u/100*r.parentNode[o])):u=a,u}const jn=a=>a.ownerDocument.defaultView.getComputedStyle(a,null),Dh=["top","right","bottom","left"];function Cr(a,r,o){const u={};o=o?"-"+o:"";for(let m=0;m<4;m++){const _=Dh[m];u[_]=parseFloat(a[r+"-"+_+o])||0}return u.width=u.left+u.right,u.height=u.top+u.bottom,u}function Jo(a,r){if("native"in a)return a;const{canvas:o,currentDevicePixelRatio:u}=r,m=jn(o),_="border-box"===m.boxSizing,b=Cr(m,"padding"),T=Cr(m,"border","width"),{x:S,y:z,box:F}=function ml(a,r){const o=a.touches,u=o&&o.length?o[0]:a,{offsetX:m,offsetY:_}=u;let T,S,b=!1;if(((a,r,o)=>(a>0||r>0)&&(!o||!o.shadowRoot))(m,_,a.target))T=m,S=_;else{const z=r.getBoundingClientRect();T=u.clientX-z.left,S=u.clientY-z.top,b=!0}return{x:T,y:S,box:b}}(a,o),G=b.left+(F&&T.left),W=b.top+(F&&T.top);let{width:nt,height:gt}=r;return _&&(nt-=b.width+T.width,gt-=b.height+T.height),{x:Math.round((S-G)/nt*o.width/u),y:Math.round((z-W)/gt*o.height/u)}}const xa=a=>Math.round(10*a)/10;function xc(a,r,o){const u=r||1,m=Math.floor(a.height*u),_=Math.floor(a.width*u);a.height=Math.floor(a.height),a.width=Math.floor(a.width);const b=a.canvas;return b.style&&(o||!b.style.height&&!b.style.width)&&(b.style.height=`${a.height}px`,b.style.width=`${a.width}px`),(a.currentDevicePixelRatio!==u||b.height!==m||b.width!==_)&&(a.currentDevicePixelRatio=u,b.height=m,b.width=_,a.ctx.setTransform(u,0,0,u,0,0),!0)}const vc=function(){let a=!1;try{const r={get passive(){return a=!0,!1}};window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}return a}();function Lh(a,r){const o=function gc(a,r){return jn(a).getPropertyValue(r)}(a,r),u=o&&o.match(/^(\d+)(\.\d+)?px$/);return u?+u[1]:void 0}function Wr(a,r,o,u){return{x:a.x+o*(r.x-a.x),y:a.y+o*(r.y-a.y)}}function nd(a,r,o,u){return{x:a.x+o*(r.x-a.x),y:"middle"===u?o<.5?a.y:r.y:"after"===u?o<1?a.y:r.y:o>0?r.y:a.y}}function Ko(a,r,o,u){const m={x:a.cp2x,y:a.cp2y},_={x:r.cp1x,y:r.cp1y},b=Wr(a,m,o),T=Wr(m,_,o),S=Wr(_,r,o),z=Wr(b,T,o),F=Wr(T,S,o);return Wr(z,F,o)}function Qo(a,r,o){return a?function(a,r){return{x:o=>a+a+r-o,setWidth(o){r=o},textAlign:o=>"center"===o?o:"right"===o?"left":"right",xPlus:(o,u)=>o-u,leftForLtr:(o,u)=>o-u}}(r,o):{x:a=>a,setWidth(a){},textAlign:a=>a,xPlus:(a,r)=>a+r,leftForLtr:(a,r)=>a}}function ts(a,r){let o,u;("ltr"===r||"rtl"===r)&&(o=a.canvas.style,u=[o.getPropertyValue("direction"),o.getPropertyPriority("direction")],o.setProperty("direction",r,"important"),a.prevTextDirection=u)}function Bh(a,r){void 0!==r&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",r[0],r[1]))}function wc(a){return"angle"===a?{between:Vn,compare:fi,normalize:Xi}:{between:bi,compare:(r,o)=>r-o,normalize:r=>r}}function Tc({start:a,end:r,count:o,loop:u,style:m}){return{start:a%o,end:r%o,loop:u&&(r-a+1)%o==0,style:m}}function gl(a,r,o){if(!o)return[a];const{property:u,start:m,end:_}=o,b=r.length,{compare:T,between:S,normalize:z}=wc(u),{start:F,end:G,loop:W,style:nt}=function Oh(a,r,o){const{property:u,start:m,end:_}=o,{between:b,normalize:T}=wc(u),S=r.length;let W,nt,{start:z,end:F,loop:G}=a;if(G){for(z+=S,F+=S,W=0,nt=S;W<nt&&b(T(r[z%S][u]),m,_);++W)z--,F--;z%=S,F%=S}return F<z&&(F+=S),{start:z,end:F,loop:G,style:a.style}}(a,r,o),gt=[];let Rt,Bt,te,_t=!1,yt=null;for(let fe=F,Ae=F;fe<=G;++fe)Bt=r[fe%b],!Bt.skip&&(Rt=z(Bt[u]),Rt!==te&&(_t=S(Rt,m,_),null===yt&&(_t||S(m,te,Rt)&&0!==T(m,te))&&(yt=0===T(Rt,m)?fe:Ae),null!==yt&&(!_t||0===T(_,Rt)||S(_,te,Rt))&&(gt.push(Tc({start:yt,end:fe,loop:W,count:b,style:nt})),yt=null),Ae=fe,te=Rt));return null!==yt&&gt.push(Tc({start:yt,end:G,loop:W,count:b,style:nt})),gt}function Fh(a,r){const o=[],u=a.segments;for(let m=0;m<u.length;m++){const _=gl(u[m],a.points,r);_.length&&o.push(..._)}return o}function _l(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function Mo(a,r){return r&&JSON.stringify(a)!==JSON.stringify(r)}class Bs{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,o,u,m){const b=o.duration;o.listeners[m].forEach(T=>T({chart:r,initial:o.initial,numSteps:b,currentStep:Math.min(u-o.start,b)}))}_refresh(){this._request||(this._running=!0,this._request=sr.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let o=0;this._charts.forEach((u,m)=>{if(!u.running||!u.items.length)return;const _=u.items;let S,b=_.length-1,T=!1;for(;b>=0;--b)S=_[b],S._active?(S._total>u.duration&&(u.duration=S._total),S.tick(r),T=!0):(_[b]=_[_.length-1],_.pop());T&&(m.draw(),this._notify(m,u,r,"progress")),_.length||(u.running=!1,this._notify(m,u,r,"complete"),u.initial=!1),o+=_.length}),this._lastDate=r,0===o&&(this._running=!1)}_getAnims(r){const o=this._charts;let u=o.get(r);return u||(u={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},o.set(r,u)),u}listen(r,o,u){this._getAnims(r).listeners[o].push(u)}add(r,o){!o||!o.length||this._getAnims(r).items.push(...o)}has(r){return this._getAnims(r).items.length>0}start(r){const o=this._charts.get(r);o&&(o.running=!0,o.start=Date.now(),o.duration=o.items.reduce((u,m)=>Math.max(u,m._duration),0),this._refresh())}running(r){if(!this._running)return!1;const o=this._charts.get(r);return!(!o||!o.running||!o.items.length)}stop(r){const o=this._charts.get(r);if(!o||!o.items.length)return;const u=o.items;let m=u.length-1;for(;m>=0;--m)u[m].cancel();o.items=[],this._notify(r,o,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var Gn=new Bs;const es="transparent",Os={boolean:(a,r,o)=>o>.5?r:a,color(a,r,o){const u=ua(a||es),m=u.valid&&ua(r||es);return m&&m.valid?m.mix(u,o).hexString():r},number:(a,r,o)=>a+(r-a)*o};class Hr{constructor(r,o,u,m){const _=o[u];m=lr([r.to,m,_,r.from]);const b=lr([r.from,_,m]);this._active=!0,this._fn=r.fn||Os[r.type||typeof b],this._easing=ar[r.easing]||ar.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=o,this._prop=u,this._from=b,this._to=m,this._promises=void 0}active(){return this._active}update(r,o,u){if(this._active){this._notify(!1);const m=this._target[this._prop],_=u-this._start,b=this._duration-_;this._start=u,this._duration=Math.floor(Math.max(b,r.duration)),this._total+=_,this._loop=!!r.loop,this._to=lr([r.to,o,m,r.from]),this._from=lr([r.from,m,o])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const o=r-this._start,u=this._duration,m=this._prop,_=this._from,b=this._loop,T=this._to;let S;if(this._active=_!==T&&(b||o<u),!this._active)return this._target[m]=T,void this._notify(!0);o<0?this._target[m]=_:(S=o/u%2,S=b&&S>1?2-S:S,S=this._easing(Math.min(1,Math.max(0,S))),this._target[m]=this._fn(_,T,S))}wait(){const r=this._promises||(this._promises=[]);return new Promise((o,u)=>{r.push({res:o,rej:u})})}_notify(r){const o=r?"res":"rej",u=this._promises||[];for(let m=0;m<u.length;m++)u[m][o]()}}class ba{constructor(r,o){this._chart=r,this._properties=new Map,this.configure(o)}configure(r){if(!We(r))return;const o=Object.keys(ki.animation),u=this._properties;Object.getOwnPropertyNames(r).forEach(m=>{const _=r[m];if(!We(_))return;const b={};for(const T of o)b[T]=_[T];(gi(_.properties)&&_.properties||[m]).forEach(T=>{(T===m||!u.has(T))&&u.set(T,b)})})}_animateOptions(r,o){const u=o.options,m=function yl(a,r){if(!r)return;let o=a.options;if(o)return o.$shared&&(a.options=o=Object.assign({},o,{$shared:!1,$animations:{}})),o;a.options=r}(r,u);if(!m)return[];const _=this._createAnimations(m,u);return u.$shared&&function Ye(a,r){const o=[],u=Object.keys(r);for(let m=0;m<u.length;m++){const _=a[u[m]];_&&_.active()&&o.push(_.wait())}return Promise.all(o)}(r.options.$animations,u).then(()=>{r.options=u},()=>{}),_}_createAnimations(r,o){const u=this._properties,m=[],_=r.$animations||(r.$animations={}),b=Object.keys(o),T=Date.now();let S;for(S=b.length-1;S>=0;--S){const z=b[S];if("$"===z.charAt(0))continue;if("options"===z){m.push(...this._animateOptions(r,o));continue}const F=o[z];let G=_[z];const W=u.get(z);if(G){if(W&&G.active()){G.update(W,F,T);continue}G.cancel()}W&&W.duration?(_[z]=G=new Hr(W,r,z,F),m.push(G)):r[z]=F}return m}update(r,o){if(0===this._properties.size)return void Object.assign(r,o);const u=this._createAnimations(r,o);return u.length?(Gn.add(this._chart,u),!0):void 0}}function Vh(a,r){const o=a&&a.options||{},u=o.reverse,m=void 0===o.min?r:0,_=void 0===o.max?r:0;return{start:u?_:m,end:u?m:_}}function xl(a,r){const o=[],u=a._getSortedDatasetMetas(r);let m,_;for(m=0,_=u.length;m<_;++m)o.push(u[m].index);return o}function Ac(a,r,o,u={}){const m=a.keys,_="single"===u.mode;let b,T,S,z;if(null!==r){for(b=0,T=m.length;b<T;++b){if(S=+m[b],S===o){if(u.all)continue;break}z=a.values[S],vi(z)&&(_||0===r||Tt(r)===Tt(z))&&(r+=z)}return r}}function Ic(a,r){const o=a&&a.options.stacked;return o||void 0===o&&void 0!==r.stack}function Us(a,r,o){const u=a[r]||(a[r]={});return u[o]||(u[o]={})}function Ta(a,r,o,u){for(const m of r.getMatchingVisibleMetas(u).reverse()){const _=a[m.index];if(o&&_>0||!o&&_<0)return m.index}return null}function Co(a,r){const{chart:o,_cachedMeta:u}=a,m=o._stacks||(o._stacks={}),{iScale:_,vScale:b,index:T}=u,S=_.axis,z=b.axis,F=function bl(a,r,o){return`${a.id}.${r.id}.${o.stack||o.type}`}(_,b,u),G=r.length;let W;for(let nt=0;nt<G;++nt){const gt=r[nt],{[S]:_t,[z]:yt}=gt;W=(gt._stacks||(gt._stacks={}))[z]=Us(m,F,_t),W[T]=yt,W._top=Ta(W,b,!0,u.type),W._bottom=Ta(W,b,!1,u.type),(W._visualValues||(W._visualValues={}))[T]=yt}}function Xr(a,r){const o=a.scales;return Object.keys(o).filter(u=>o[u].axis===r).shift()}function re(a,r){const o=a.controller.index,u=a.vScale&&a.vScale.axis;if(u){r=r||a._parsed;for(const m of r){const _=m._stacks;if(!_||void 0===_[u]||void 0===_[u][o])return;delete _[u][o],void 0!==_[u]._visualValues&&void 0!==_[u]._visualValues[o]&&delete _[u]._visualValues[o]}}}const kn=a=>"reset"===a||"none"===a,kc=(a,r)=>r?a:Object.assign({},a);class Tn{constructor(r,o){this.chart=r,this._ctx=r.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=Ic(r.vScale,r),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(r){this.index!==r&&re(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,o=this._cachedMeta,u=this.getDataset(),m=(G,W,nt,gt)=>"x"===G?W:"r"===G?gt:nt,_=o.xAxisID=Le(u.xAxisID,Xr(r,"x")),b=o.yAxisID=Le(u.yAxisID,Xr(r,"y")),T=o.rAxisID=Le(u.rAxisID,Xr(r,"r")),S=o.indexAxis,z=o.iAxisID=m(S,_,b,T),F=o.vAxisID=m(S,b,_,T);o.xScale=this.getScaleForId(_),o.yScale=this.getScaleForId(b),o.rScale=this.getScaleForId(T),o.iScale=this.getScaleForId(z),o.vScale=this.getScaleForId(F)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const o=this._cachedMeta;return r===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&ee(this._data,this),r._stacked&&re(r)}_dataCheck(){const r=this.getDataset(),o=r.data||(r.data=[]),u=this._data;if(We(o))this._data=function vl(a){const r=Object.keys(a),o=new Array(r.length);let u,m,_;for(u=0,m=r.length;u<m;++u)_=r[u],o[u]={x:_,y:a[_]};return o}(o);else if(u!==o){if(u){ee(u,this);const m=this._cachedMeta;re(m),m._parsed=[]}o&&Object.isExtensible(o)&&function Cs(a,r){a._chartjs?a._chartjs.listeners.push(r):(Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),sc.forEach(o=>{const u="_onData"+jr(o),m=a[o];Object.defineProperty(a,o,{configurable:!0,enumerable:!1,value(..._){const b=m.apply(this,_);return a._chartjs.listeners.forEach(T=>{"function"==typeof T[u]&&T[u](..._)}),b}})}))}(o,this),this._syncList=[],this._data=o}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const o=this._cachedMeta,u=this.getDataset();let m=!1;this._dataCheck();const _=o._stacked;o._stacked=Ic(o.vScale,o),o.stack!==u.stack&&(m=!0,re(o),o.stack=u.stack),this._resyncElements(r),(m||_!==o._stacked)&&Co(this,o._parsed)}configure(){const r=this.chart.config,o=r.datasetScopeKeys(this._type),u=r.getOptionScopes(this.getDataset(),o,!0);this.options=r.createResolver(u,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,o){const{_cachedMeta:u,_data:m}=this,{iScale:_,_stacked:b}=u,T=_.axis;let F,G,W,S=0===r&&o===m.length||u._sorted,z=r>0&&u._parsed[r-1];if(!1===this._parsing)u._parsed=m,u._sorted=!0,W=m;else{W=gi(m[r])?this.parseArrayData(u,m,r,o):We(m[r])?this.parseObjectData(u,m,r,o):this.parsePrimitiveData(u,m,r,o);const nt=()=>null===G[T]||z&&G[T]<z[T];for(F=0;F<o;++F)u._parsed[F+r]=G=W[F],S&&(nt()&&(S=!1),z=G);u._sorted=S}b&&Co(this,W)}parsePrimitiveData(r,o,u,m){const{iScale:_,vScale:b}=r,T=_.axis,S=b.axis,z=_.getLabels(),F=_===b,G=new Array(m);let W,nt,gt;for(W=0,nt=m;W<nt;++W)gt=W+u,G[W]={[T]:F||_.parse(z[gt],gt),[S]:b.parse(o[gt],gt)};return G}parseArrayData(r,o,u,m){const{xScale:_,yScale:b}=r,T=new Array(m);let S,z,F,G;for(S=0,z=m;S<z;++S)F=S+u,G=o[F],T[S]={x:_.parse(G[0],F),y:b.parse(G[1],F)};return T}parseObjectData(r,o,u,m){const{xScale:_,yScale:b}=r,{xAxisKey:T="x",yAxisKey:S="y"}=this._parsing,z=new Array(m);let F,G,W,nt;for(F=0,G=m;F<G;++F)W=F+u,nt=o[W],z[F]={x:_.parse(Nn(nt,T),W),y:b.parse(Nn(nt,S),W)};return z}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,o,u){const _=this._cachedMeta,b=o[r.axis];return Ac({keys:xl(this.chart,!0),values:o._stacks[r.axis]._visualValues},b,_.index,{mode:u})}updateRangeFromParsed(r,o,u,m){const _=u[o.axis];let b=null===_?NaN:_;const T=m&&u._stacks[o.axis];m&&T&&(m.values=T,b=Ac(m,_,this._cachedMeta.index)),r.min=Math.min(r.min,b),r.max=Math.max(r.max,b)}getMinMax(r,o){const u=this._cachedMeta,m=u._parsed,_=u._sorted&&r===u.iScale,b=m.length,T=this._getOtherScale(r),S=((a,r,o)=>a&&!r.hidden&&r._stacked&&{keys:xl(this.chart,!0),values:null})(o,u),z={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:F,max:G}=function Fs(a){const{min:r,max:o,minDefined:u,maxDefined:m}=a.getUserBounds();return{min:u?r:Number.NEGATIVE_INFINITY,max:m?o:Number.POSITIVE_INFINITY}}(T);let W,nt;function gt(){nt=m[W];const _t=nt[T.axis];return!vi(nt[r.axis])||F>_t||G<_t}for(W=0;W<b&&(gt()||(this.updateRangeFromParsed(z,r,nt,S),!_));++W);if(_)for(W=b-1;W>=0;--W)if(!gt()){this.updateRangeFromParsed(z,r,nt,S);break}return z}getAllParsedValues(r){const o=this._cachedMeta._parsed,u=[];let m,_,b;for(m=0,_=o.length;m<_;++m)b=o[m][r.axis],vi(b)&&u.push(b);return u}getMaxOverflow(){return!1}getLabelAndValue(r){const o=this._cachedMeta,u=o.iScale,m=o.vScale,_=this.getParsed(r);return{label:u?""+u.getLabelForValue(_[u.axis]):"",value:m?""+m.getLabelForValue(_[m.axis]):""}}_update(r){const o=this._cachedMeta;this.update(r||"default"),o._clip=function wa(a){let r,o,u,m;return We(a)?(r=a.top,o=a.right,u=a.bottom,m=a.left):r=o=u=m=a,{top:r,right:o,bottom:u,left:m,disabled:!1===a}}(Le(this.options.clip,function Sc(a,r,o){if(!1===o)return!1;const u=Vh(a,o),m=Vh(r,o);return{top:m.end,right:u.end,bottom:m.start,left:u.start}}(o.xScale,o.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,u=this._cachedMeta,m=u.data||[],_=this.chart.chartArea,b=[],T=this._drawStart||0,S=this._drawCount||m.length-T,z=this.options.drawActiveElementsOnTop;let F;for(u.dataset&&u.dataset.draw(r,_,T,S),F=T;F<T+S;++F){const G=m[F];G.hidden||(G.active&&z?b.push(G):G.draw(r,_))}for(F=0;F<b.length;++F)b[F].draw(r,_)}getStyle(r,o){const u=o?"active":"default";return void 0===r&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(u):this.resolveDataElementOptions(r||0,u)}getContext(r,o,u){const m=this.getDataset();let _;if(r>=0&&r<this._cachedMeta.data.length){const b=this._cachedMeta.data[r];_=b.$context||(b.$context=function Ma(a,r,o){return Yn(a,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:o,index:r,mode:"default",type:"data"})}(this.getContext(),r,b)),_.parsed=this.getParsed(r),_.raw=m.data[r],_.index=_.dataIndex=r}else _=this.$context||(this.$context=function Ea(a,r){return Yn(a,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),_.dataset=m,_.index=_.datasetIndex=this.index;return _.active=!!o,_.mode=u,_}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,o){return this._resolveElementOptions(this.dataElementType.id,o,r)}_resolveElementOptions(r,o="default",u){const m="active"===o,_=this._cachedDataOpts,b=r+"-"+o,T=_[b],S=this.enableOptionSharing&&Di(u);if(T)return kc(T,S);const z=this.chart.config,F=z.datasetElementScopeKeys(this._type,r),G=m?[`${r}Hover`,"hover",r,""]:[r,""],W=z.getOptionScopes(this.getDataset(),F),nt=Object.keys(ki.elements[r]),_t=z.resolveNamedOptions(W,nt,()=>this.getContext(u,m,o),G);return _t.$shared&&(_t.$shared=S,_[b]=Object.freeze(kc(_t,S))),_t}_resolveAnimations(r,o,u){const m=this.chart,_=this._cachedDataOpts,b=`animation-${o}`,T=_[b];if(T)return T;let S;if(!1!==m.options.animation){const F=this.chart.config,G=F.datasetAnimationScopeKeys(this._type,o),W=F.getOptionScopes(this.getDataset(),G);S=F.createResolver(W,this.getContext(r,u,o))}const z=new ba(m,S&&S.animations);return S&&S._cacheable&&(_[b]=Object.freeze(z)),z}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,o){return!o||kn(r)||this.chart._animationsDisabled}_getSharedOptions(r,o){const u=this.resolveDataElementOptions(r,o),m=this._sharedOptions,_=this.getSharedOptions(u),b=this.includeOptions(o,_)||_!==m;return this.updateSharedOptions(_,o,u),{sharedOptions:_,includeOptions:b}}updateElement(r,o,u,m){kn(m)?Object.assign(r,u):this._resolveAnimations(o,m).update(r,u)}updateSharedOptions(r,o,u){r&&!kn(o)&&this._resolveAnimations(void 0,o).update(r,u)}_setStyle(r,o,u,m){r.active=m;const _=this.getStyle(o,m);this._resolveAnimations(o,u,m).update(r,{options:!m&&this.getSharedOptions(_)||_})}removeHoverStyle(r,o,u){this._setStyle(r,u,"active",!1)}setHoverStyle(r,o,u){this._setStyle(r,u,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const o=this._data,u=this._cachedMeta.data;for(const[T,S,z]of this._syncList)this[T](S,z);this._syncList=[];const m=u.length,_=o.length,b=Math.min(_,m);b&&this.parse(0,b),_>m?this._insertElements(m,_-m,r):_<m&&this._removeElements(_,m-_)}_insertElements(r,o,u=!0){const m=this._cachedMeta,_=m.data,b=r+o;let T;const S=z=>{for(z.length+=o,T=z.length-1;T>=b;T--)z[T]=z[T-o]};for(S(_),T=r;T<b;++T)_[T]=new this.dataElementType;this._parsing&&S(m._parsed),this.parse(r,o),u&&this.updateElements(_,r,o,"reset")}updateElements(r,o,u,m){}_removeElements(r,o){const u=this._cachedMeta;if(this._parsing){const m=u._parsed.splice(r,o);u._stacked&&re(u,m)}u.data.splice(r,o)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[o,u,m]=r;this[o](u,m)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,o){o&&this._sync(["_removeElements",r,o]);const u=arguments.length-2;u&&this._sync(["_insertElements",r,u])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function jh(a){const r=a.iScale,o=function Ns(a,r){if(!a._cache.$bar){const o=a.getMatchingVisibleMetas(r);let u=[];for(let m=0,_=o.length;m<_;m++)u=u.concat(o[m].controller.getAllParsedValues(a));a._cache.$bar=Ve(u.sort((m,_)=>m-_))}return a._cache.$bar}(r,a.type);let m,_,b,T,u=r._length;const S=()=>{32767===b||-32768===b||(Di(T)&&(u=Math.min(u,Math.abs(b-T)||u)),T=b)};for(m=0,_=o.length;m<_;++m)b=r.getPixelForValue(o[m]),S();for(T=void 0,m=0,_=r.ticks.length;m<_;++m)b=r.getPixelForTick(m),S();return u}function Vs(a,r,o,u){return gi(a)?function Tl(a,r,o,u){const m=o.parse(a[0],u),_=o.parse(a[1],u),b=Math.min(m,_),T=Math.max(m,_);let S=b,z=T;Math.abs(b)>Math.abs(T)&&(S=T,z=b),r[o.axis]=z,r._custom={barStart:S,barEnd:z,start:m,end:_,min:b,max:T}}(a,r,o,u):r[o.axis]=o.parse(a,u),r}function js(a,r,o,u){const m=a.iScale,_=a.vScale,b=m.getLabels(),T=m===_,S=[];let z,F,G,W;for(z=o,F=o+u;z<F;++z)W=r[z],G={},G[m.axis]=T||m.parse(b[z],z),S.push(Vs(W,G,_,z));return S}function Yi(a){return a&&void 0!==a.barStart&&void 0!==a.barEnd}function Gh(a,r,o,u){let m=r.borderSkipped;const _={};if(!m)return void(a.borderSkipped=_);if(!0===m)return void(a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:b,end:T,reverse:S,top:z,bottom:F}=function rd(a){let r,o,u,m,_;return a.horizontal?(r=a.base>a.x,o="left",u="right"):(r=a.base<a.y,o="bottom",u="top"),r?(m="end",_="start"):(m="start",_="end"),{start:o,end:u,reverse:r,top:m,bottom:_}}(a);"middle"===m&&o&&(a.enableBorderRadius=!0,(o._top||0)===u?m=z:(o._bottom||0)===u?m=F:(_[Ca(F,b,T,S)]=!0,m=z)),_[Ca(m,b,T,S)]=!0,a.borderSkipped=_}function Ca(a,r,o,u){return u?(a=function Dc(a,r,o){return a===r?o:a===o?r:a}(a,r,o),a=Sa(a,o,r)):a=Sa(a,r,o),a}function Sa(a,r,o){return"start"===a?r:"end"===a?o:a}function Zh(a,{inflateAmount:r},o){a.inflateAmount="auto"===r?1===o?.33:0:r}de(Tn,"defaults",{}),de(Tn,"datasetElementType",null),de(Tn,"dataElementType",null);class Yr extends Tn{parsePrimitiveData(r,o,u,m){return js(r,o,u,m)}parseArrayData(r,o,u,m){return js(r,o,u,m)}parseObjectData(r,o,u,m){const{iScale:_,vScale:b}=r,{xAxisKey:T="x",yAxisKey:S="y"}=this._parsing,z="x"===_.axis?T:S,F="x"===b.axis?T:S,G=[];let W,nt,gt,_t;for(W=u,nt=u+m;W<nt;++W)_t=o[W],gt={},gt[_.axis]=_.parse(Nn(_t,z),W),G.push(Vs(Nn(_t,F),gt,b,W));return G}updateRangeFromParsed(r,o,u,m){super.updateRangeFromParsed(r,o,u,m);const _=u._custom;_&&o===this._cachedMeta.vScale&&(r.min=Math.min(r.min,_.min),r.max=Math.max(r.max,_.max))}getMaxOverflow(){return 0}getLabelAndValue(r){const o=this._cachedMeta,{iScale:u,vScale:m}=o,_=this.getParsed(r),b=_._custom,T=Yi(b)?"["+b.start+", "+b.end+"]":""+m.getLabelForValue(_[m.axis]);return{label:""+u.getLabelForValue(_[u.axis]),value:T}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(r){const o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,r)}updateElements(r,o,u,m){const _="reset"===m,{index:b,_cachedMeta:{vScale:T}}=this,S=T.getBasePixel(),z=T.isHorizontal(),F=this._getRuler(),{sharedOptions:G,includeOptions:W}=this._getSharedOptions(o,m);for(let nt=o;nt<o+u;nt++){const gt=this.getParsed(nt),_t=_||Je(gt[T.axis])?{base:S,head:S}:this._calculateBarValuePixels(nt),yt=this._calculateBarIndexPixels(nt,F),Rt=(gt._stacks||{})[T.axis],Bt={horizontal:z,base:_t.base,enableBorderRadius:!Rt||Yi(gt._custom)||b===Rt._top||b===Rt._bottom,x:z?_t.head:yt.center,y:z?yt.center:_t.head,height:z?yt.size:Math.abs(_t.size),width:z?Math.abs(_t.size):yt.size};W&&(Bt.options=G||this.resolveDataElementOptions(nt,r[nt].active?"active":m));const te=Bt.options||r[nt].options;Gh(Bt,te,Rt,b),Zh(Bt,te,F.ratio),this.updateElement(r[nt],nt,Bt,m)}}_getStacks(r,o){const{iScale:u}=this._cachedMeta,m=u.getMatchingVisibleMetas(this._type).filter(S=>S.controller.options.grouped),_=u.options.stacked,b=[],T=S=>{const z=S.controller.getParsed(o),F=z&&z[S.vScale.axis];if(Je(F)||isNaN(F))return!0};for(const S of m)if((void 0===o||!T(S))&&((!1===_||-1===b.indexOf(S.stack)||void 0===_&&void 0===S.stack)&&b.push(S.stack),S.index===r))break;return b.length||b.push(void 0),b}_getStackCount(r){return this._getStacks(void 0,r).length}_getStackIndex(r,o,u){const m=this._getStacks(r,u),_=void 0!==o?m.indexOf(o):-1;return-1===_?m.length-1:_}_getRuler(){const r=this.options,o=this._cachedMeta,u=o.iScale,m=[];let _,b;for(_=0,b=o.data.length;_<b;++_)m.push(u.getPixelForValue(this.getParsed(_)[u.axis],_));const T=r.barThickness;return{min:T||jh(o),pixels:m,start:u._startPixel,end:u._endPixel,stackCount:this._getStackCount(),scale:u,grouped:r.grouped,ratio:T?1:r.categoryPercentage*r.barPercentage}}_calculateBarValuePixels(r){const{_cachedMeta:{vScale:o,_stacked:u,index:m},options:{base:_,minBarLength:b}}=this,T=_||0,S=this.getParsed(r),z=S._custom,F=Yi(z);let gt,_t,G=S[o.axis],W=0,nt=u?this.applyStack(o,S,u):G;nt!==G&&(W=nt-G,nt=G),F&&(G=z.barStart,nt=z.barEnd-z.barStart,0!==G&&Tt(G)!==Tt(z.barEnd)&&(W=0),W+=G);const yt=Je(_)||F?W:_;let Rt=o.getPixelForValue(yt);if(gt=this.chart.getDataVisibility(r)?o.getPixelForValue(W+nt):Rt,_t=gt-Rt,Math.abs(_t)<b){_t=function El(a,r,o){return 0!==a?Tt(a):(r.isHorizontal()?1:-1)*(r.min>=o?1:-1)}(_t,o,T)*b,G===T&&(Rt-=_t/2);const Bt=o.getPixelForDecimal(0),te=o.getPixelForDecimal(1),Kt=Math.min(Bt,te),Yt=Math.max(Bt,te);Rt=Math.max(Math.min(Rt,Yt),Kt),gt=Rt+_t,u&&!F&&(S._stacks[o.axis]._visualValues[m]=o.getValueForPixel(gt)-o.getValueForPixel(Rt))}if(Rt===o.getPixelForValue(T)){const Bt=Tt(_t)*o.getLineWidthForValue(T)/2;Rt+=Bt,_t-=Bt}return{size:_t,base:Rt,head:gt,center:gt+_t/2}}_calculateBarIndexPixels(r,o){const u=o.scale,m=this.options,_=m.skipNull,b=Le(m.maxBarThickness,1/0);let T,S;if(o.grouped){const z=_?this._getStackCount(r):o.stackCount,F="flex"===m.barThickness?function Pc(a,r,o,u){const m=r.pixels,_=m[a];let b=a>0?m[a-1]:null,T=a<m.length-1?m[a+1]:null;const S=o.categoryPercentage;null===b&&(b=_-(null===T?r.end-r.start:T-_)),null===T&&(T=_+_-b);const z=_-(_-Math.min(b,T))/2*S;return{chunk:Math.abs(T-b)/2*S/u,ratio:o.barPercentage,start:z}}(r,o,m,z):function wl(a,r,o,u){const m=o.barThickness;let _,b;return Je(m)?(_=r.min*o.categoryPercentage,b=o.barPercentage):(_=m*u,b=1),{chunk:_/u,ratio:b,start:r.pixels[a]-_/2}}(r,o,m,z),G=this._getStackIndex(this.index,this._cachedMeta.stack,_?r:void 0);T=F.start+F.chunk*G+F.chunk/2,S=Math.min(b,F.chunk*F.ratio)}else T=u.getPixelForValue(this.getParsed(r)[u.axis],r),S=Math.min(b,o.min*o.ratio);return{base:T-S/2,head:T+S/2,center:T,size:S}}draw(){const r=this._cachedMeta,o=r.vScale,u=r.data,m=u.length;let _=0;for(;_<m;++_)null!==this.getParsed(_)[o.axis]&&u[_].draw(this._ctx)}}de(Yr,"id","bar"),de(Yr,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),de(Yr,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Gs extends Tn{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(r,o,u,m){const _=super.parsePrimitiveData(r,o,u,m);for(let b=0;b<_.length;b++)_[b]._custom=this.resolveDataElementOptions(b+u).radius;return _}parseArrayData(r,o,u,m){const _=super.parseArrayData(r,o,u,m);for(let b=0;b<_.length;b++)_[b]._custom=Le(o[u+b][2],this.resolveDataElementOptions(b+u).radius);return _}parseObjectData(r,o,u,m){const _=super.parseObjectData(r,o,u,m);for(let b=0;b<_.length;b++){const T=o[u+b];_[b]._custom=Le(T&&T.r&&+T.r,this.resolveDataElementOptions(b+u).radius)}return _}getMaxOverflow(){const r=this._cachedMeta.data;let o=0;for(let u=r.length-1;u>=0;--u)o=Math.max(o,r[u].size(this.resolveDataElementOptions(u))/2);return o>0&&o}getLabelAndValue(r){const o=this._cachedMeta,u=this.chart.data.labels||[],{xScale:m,yScale:_}=o,b=this.getParsed(r),T=m.getLabelForValue(b.x),S=_.getLabelForValue(b.y),z=b._custom;return{label:u[r]||"",value:"("+T+", "+S+(z?", "+z:"")+")"}}update(r){const o=this._cachedMeta.data;this.updateElements(o,0,o.length,r)}updateElements(r,o,u,m){const _="reset"===m,{iScale:b,vScale:T}=this._cachedMeta,{sharedOptions:S,includeOptions:z}=this._getSharedOptions(o,m),F=b.axis,G=T.axis;for(let W=o;W<o+u;W++){const nt=r[W],gt=!_&&this.getParsed(W),_t={},yt=_t[F]=_?b.getPixelForDecimal(.5):b.getPixelForValue(gt[F]),Rt=_t[G]=_?T.getBasePixel():T.getPixelForValue(gt[G]);_t.skip=isNaN(yt)||isNaN(Rt),z&&(_t.options=S||this.resolveDataElementOptions(W,nt.active?"active":m),_&&(_t.options.radius=0)),this.updateElement(nt,W,_t,m)}}resolveDataElementOptions(r,o){const u=this.getParsed(r);let m=super.resolveDataElementOptions(r,o);m.$shared&&(m=Object.assign({},m,{$shared:!1}));const _=m.radius;return"active"!==o&&(m.radius=0),m.radius+=Le(u&&u._custom,_),m}}de(Gs,"id","bubble"),de(Gs,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),de(Gs,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class Sr extends Tn{constructor(r,o){super(r,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(r,o){const u=this.getDataset().data,m=this._cachedMeta;if(!1===this._parsing)m._parsed=u;else{let b,T,_=S=>+u[S];if(We(u[r])){const{key:S="value"}=this._parsing;_=z=>+Nn(u[z],S)}for(b=r,T=r+o;b<T;++b)m._parsed[b]=_(b)}}_getRotation(){return xe(this.options.rotation-90)}_getCircumference(){return xe(this.options.circumference)}_getRotationExtents(){let r=U,o=-U;for(let u=0;u<this.chart.data.datasets.length;++u)if(this.chart.isDatasetVisible(u)&&this.chart.getDatasetMeta(u).type===this._type){const m=this.chart.getDatasetMeta(u).controller,_=m._getRotation(),b=m._getCircumference();r=Math.min(r,_),o=Math.max(o,_+b)}return{rotation:r,circumference:o-r}}update(r){const o=this.chart,{chartArea:u}=o,m=this._cachedMeta,_=m.data,b=this.getMaxBorderWidth()+this.getMaxOffset(_)+this.options.spacing,T=Math.max((Math.min(u.width,u.height)-b)/2,0),S=Math.min(((a,r)=>"string"==typeof a&&a.endsWith("%")?parseFloat(a)/100:+a/r)(this.options.cutout,T),1),z=this._getRingWeight(this.index),{circumference:F,rotation:G}=this._getRotationExtents(),{ratioX:W,ratioY:nt,offsetX:gt,offsetY:_t}=function $h(a,r,o){let u=1,m=1,_=0,b=0;if(r<U){const T=a,S=T+r,z=Math.cos(T),F=Math.sin(T),G=Math.cos(S),W=Math.sin(S),nt=(te,Kt,Yt)=>Vn(te,T,S,!0)?1:Math.max(Kt,Kt*o,Yt,Yt*o),gt=(te,Kt,Yt)=>Vn(te,T,S,!0)?-1:Math.min(Kt,Kt*o,Yt,Yt*o),_t=nt(0,z,G),yt=nt(ct,F,W),Rt=gt(J,z,G),Bt=gt(J+ct,F,W);u=(_t-Rt)/2,m=(yt-Bt)/2,_=-(_t+Rt)/2,b=-(yt+Bt)/2}return{ratioX:u,ratioY:m,offsetX:_,offsetY:b}}(G,F,S),Bt=Math.max(Math.min((u.width-b)/W,(u.height-b)/nt)/2,0),te=Sn(this.options.radius,Bt),Yt=(te-Math.max(te*S,0))/this._getVisibleDatasetWeightTotal();this.offsetX=gt*te,this.offsetY=_t*te,m.total=this.calculateTotal(),this.outerRadius=te-Yt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Yt*z,0),this.updateElements(_,0,_.length,r)}_circumference(r,o){const u=this.options,m=this._cachedMeta,_=this._getCircumference();return o&&u.animation.animateRotate||!this.chart.getDataVisibility(r)||null===m._parsed[r]||m.data[r].hidden?0:this.calculateCircumference(m._parsed[r]*_/U)}updateElements(r,o,u,m){const _="reset"===m,b=this.chart,T=b.chartArea,F=(T.left+T.right)/2,G=(T.top+T.bottom)/2,W=_&&b.options.animation.animateScale,nt=W?0:this.innerRadius,gt=W?0:this.outerRadius,{sharedOptions:_t,includeOptions:yt}=this._getSharedOptions(o,m);let Bt,Rt=this._getRotation();for(Bt=0;Bt<o;++Bt)Rt+=this._circumference(Bt,_);for(Bt=o;Bt<o+u;++Bt){const te=this._circumference(Bt,_),Kt=r[Bt],Yt={x:F+this.offsetX,y:G+this.offsetY,startAngle:Rt,endAngle:Rt+te,circumference:te,outerRadius:gt,innerRadius:nt};yt&&(Yt.options=_t||this.resolveDataElementOptions(Bt,Kt.active?"active":m)),Rt+=te,this.updateElement(Kt,Bt,Yt,m)}}calculateTotal(){const r=this._cachedMeta,o=r.data;let m,u=0;for(m=0;m<o.length;m++){const _=r._parsed[m];null!==_&&!isNaN(_)&&this.chart.getDataVisibility(m)&&!o[m].hidden&&(u+=Math.abs(_))}return u}calculateCircumference(r){const o=this._cachedMeta.total;return o>0&&!isNaN(r)?U*(Math.abs(r)/o):0}getLabelAndValue(r){const u=this.chart,m=u.data.labels||[],_=Zr(this._cachedMeta._parsed[r],u.options.locale);return{label:m[r]||"",value:_}}getMaxBorderWidth(r){let o=0;const u=this.chart;let m,_,b,T,S;if(!r)for(m=0,_=u.data.datasets.length;m<_;++m)if(u.isDatasetVisible(m)){b=u.getDatasetMeta(m),r=b.data,T=b.controller;break}if(!r)return 0;for(m=0,_=r.length;m<_;++m)S=T.resolveDataElementOptions(m),"inner"!==S.borderAlign&&(o=Math.max(o,S.borderWidth||0,S.hoverBorderWidth||0));return o}getMaxOffset(r){let o=0;for(let u=0,m=r.length;u<m;++u){const _=this.resolveDataElementOptions(u);o=Math.max(o,_.offset||0,_.hoverOffset||0)}return o}_getRingWeightOffset(r){let o=0;for(let u=0;u<r;++u)this.chart.isDatasetVisible(u)&&(o+=this._getRingWeight(u));return o}_getRingWeight(r){return Math.max(Le(this.chart.data.datasets[r].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}de(Sr,"id","doughnut"),de(Sr,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),de(Sr,"descriptors",{_scriptable:a=>"spacing"!==a,_indexable:a=>"spacing"!==a}),de(Sr,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const r=a.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:o,color:u}}=a.legend.options;return r.labels.map((m,_)=>{const T=a.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:u,lineWidth:T.borderWidth,pointStyle:o,hidden:!a.getDataVisibility(_),index:_}})}return[]}},onClick(a,r,o){o.chart.toggleDataVisibility(r.index),o.chart.update()}}}});class Aa extends Tn{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(r){const o=this._cachedMeta,{dataset:u,data:m=[],_dataset:_}=o,b=this.chart._animationsDisabled;let{start:T,count:S}=un(o,m,b);this._drawStart=T,this._drawCount=S,yi(o)&&(T=0,S=m.length),u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!_._decimated,u.points=m;const z=this.resolveDatasetElementOptions(r);this.options.showLine||(z.borderWidth=0),z.segment=this.options.segment,this.updateElement(u,void 0,{animated:!b,options:z},r),this.updateElements(m,T,S,r)}updateElements(r,o,u,m){const _="reset"===m,{iScale:b,vScale:T,_stacked:S,_dataset:z}=this._cachedMeta,{sharedOptions:F,includeOptions:G}=this._getSharedOptions(o,m),W=b.axis,nt=T.axis,{spanGaps:gt,segment:_t}=this.options,yt=_e(gt)?gt:Number.POSITIVE_INFINITY,Rt=this.chart._animationsDisabled||_||"none"===m,Bt=o+u,te=r.length;let Kt=o>0&&this.getParsed(o-1);for(let Yt=0;Yt<te;++Yt){const ue=r[Yt],ce=Rt?ue:{};if(Yt<o||Yt>=Bt){ce.skip=!0;continue}const fe=this.getParsed(Yt),Ae=Je(fe[nt]),Ie=ce[W]=b.getPixelForValue(fe[W],Yt),ke=ce[nt]=_||Ae?T.getBasePixel():T.getPixelForValue(S?this.applyStack(T,fe,S):fe[nt],Yt);ce.skip=isNaN(Ie)||isNaN(ke)||Ae,ce.stop=Yt>0&&Math.abs(fe[W]-Kt[W])>yt,_t&&(ce.parsed=fe,ce.raw=z.data[Yt]),G&&(ce.options=F||this.resolveDataElementOptions(Yt,ue.active?"active":m)),Rt||this.updateElement(ue,Yt,ce,m),Kt=fe}}getMaxOverflow(){const r=this._cachedMeta,o=r.dataset,u=o.options&&o.options.borderWidth||0,m=r.data||[];if(!m.length)return u;const _=m[0].size(this.resolveDataElementOptions(0)),b=m[m.length-1].size(this.resolveDataElementOptions(m.length-1));return Math.max(u,_,b)/2}draw(){const r=this._cachedMeta;r.dataset.updateControlPoints(this.chart.chartArea,r.iScale.axis),super.draw()}}de(Aa,"id","line"),de(Aa,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),de(Aa,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class is extends Tn{constructor(r,o){super(r,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(r){const u=this.chart,m=u.data.labels||[],_=Zr(this._cachedMeta._parsed[r].r,u.options.locale);return{label:m[r]||"",value:_}}parseObjectData(r,o,u,m){return fc.bind(this)(r,o,u,m)}update(r){const o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,r)}getMinMax(){const o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return this._cachedMeta.data.forEach((u,m)=>{const _=this.getParsed(m).r;!isNaN(_)&&this.chart.getDataVisibility(m)&&(_<o.min&&(o.min=_),_>o.max&&(o.max=_))}),o}_updateRadius(){const r=this.chart,o=r.chartArea,u=r.options,m=Math.min(o.right-o.left,o.bottom-o.top),_=Math.max(m/2,0),T=(_-Math.max(u.cutoutPercentage?_/100*u.cutoutPercentage:1,0))/r.getVisibleDatasetCount();this.outerRadius=_-T*this.index,this.innerRadius=this.outerRadius-T}updateElements(r,o,u,m){const _="reset"===m,b=this.chart,S=b.options.animation,z=this._cachedMeta.rScale,F=z.xCenter,G=z.yCenter,W=z.getIndexAngle(0)-.5*J;let gt,nt=W;const _t=360/this.countVisibleElements();for(gt=0;gt<o;++gt)nt+=this._computeAngle(gt,m,_t);for(gt=o;gt<o+u;gt++){const yt=r[gt];let Rt=nt,Bt=nt+this._computeAngle(gt,m,_t),te=b.getDataVisibility(gt)?z.getDistanceFromCenterForValue(this.getParsed(gt).r):0;nt=Bt,_&&(S.animateScale&&(te=0),S.animateRotate&&(Rt=Bt=W));const Kt={x:F,y:G,innerRadius:0,outerRadius:te,startAngle:Rt,endAngle:Bt,options:this.resolveDataElementOptions(gt,yt.active?"active":m)};this.updateElement(yt,gt,Kt,m)}}countVisibleElements(){let o=0;return this._cachedMeta.data.forEach((u,m)=>{!isNaN(this.getParsed(m).r)&&this.chart.getDataVisibility(m)&&o++}),o}_computeAngle(r,o,u){return this.chart.getDataVisibility(r)?xe(this.resolveDataElementOptions(r,o).angle||u):0}}de(is,"id","polarArea"),de(is,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),de(is,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){const r=a.data;if(r.labels.length&&r.datasets.length){const{labels:{pointStyle:o,color:u}}=a.legend.options;return r.labels.map((m,_)=>{const T=a.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:u,lineWidth:T.borderWidth,pointStyle:o,hidden:!a.getDataVisibility(_),index:_}})}return[]}},onClick(a,r,o){o.chart.toggleDataVisibility(r.index),o.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Ia extends Sr{}de(Ia,"id","pie"),de(Ia,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Jr extends Tn{getLabelAndValue(r){const o=this._cachedMeta.vScale,u=this.getParsed(r);return{label:o.getLabels()[r],value:""+o.getLabelForValue(u[o.axis])}}parseObjectData(r,o,u,m){return fc.bind(this)(r,o,u,m)}update(r){const o=this._cachedMeta,u=o.dataset,m=o.data||[],_=o.iScale.getLabels();if(u.points=m,"resize"!==r){const b=this.resolveDatasetElementOptions(r);this.options.showLine||(b.borderWidth=0),this.updateElement(u,void 0,{_loop:!0,_fullLoop:_.length===m.length,options:b},r)}this.updateElements(m,0,m.length,r)}updateElements(r,o,u,m){const _=this._cachedMeta.rScale,b="reset"===m;for(let T=o;T<o+u;T++){const S=r[T],z=this.resolveDataElementOptions(T,S.active?"active":m),F=_.getPointPositionForValue(T,this.getParsed(T).r),G=b?_.xCenter:F.x,W=b?_.yCenter:F.y,nt={x:G,y:W,angle:F.angle,skip:isNaN(G)||isNaN(W),options:z};this.updateElement(S,T,nt,m)}}}de(Jr,"id","radar"),de(Jr,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),de(Jr,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class ns extends Tn{getLabelAndValue(r){const o=this._cachedMeta,u=this.chart.data.labels||[],{xScale:m,yScale:_}=o,b=this.getParsed(r),T=m.getLabelForValue(b.x),S=_.getLabelForValue(b.y);return{label:u[r]||"",value:"("+T+", "+S+")"}}update(r){const o=this._cachedMeta,{data:u=[]}=o,m=this.chart._animationsDisabled;let{start:_,count:b}=un(o,u,m);if(this._drawStart=_,this._drawCount=b,yi(o)&&(_=0,b=u.length),this.options.showLine){const{dataset:T,_dataset:S}=o;T._chart=this.chart,T._datasetIndex=this.index,T._decimated=!!S._decimated,T.points=u;const z=this.resolveDatasetElementOptions(r);z.segment=this.options.segment,this.updateElement(T,void 0,{animated:!m,options:z},r)}this.updateElements(u,_,b,r)}addElements(){const{showLine:r}=this.options;!this.datasetElementType&&r&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(r,o,u,m){const _="reset"===m,{iScale:b,vScale:T,_stacked:S,_dataset:z}=this._cachedMeta,F=this.resolveDataElementOptions(o,m),G=this.getSharedOptions(F),W=this.includeOptions(m,G),nt=b.axis,gt=T.axis,{spanGaps:_t,segment:yt}=this.options,Rt=_e(_t)?_t:Number.POSITIVE_INFINITY,Bt=this.chart._animationsDisabled||_||"none"===m;let te=o>0&&this.getParsed(o-1);for(let Kt=o;Kt<o+u;++Kt){const Yt=r[Kt],ue=this.getParsed(Kt),ce=Bt?Yt:{},fe=Je(ue[gt]),Ae=ce[nt]=b.getPixelForValue(ue[nt],Kt),Ie=ce[gt]=_||fe?T.getBasePixel():T.getPixelForValue(S?this.applyStack(T,ue,S):ue[gt],Kt);ce.skip=isNaN(Ae)||isNaN(Ie)||fe,ce.stop=Kt>0&&Math.abs(ue[nt]-te[nt])>Rt,yt&&(ce.parsed=ue,ce.raw=z.data[Kt]),W&&(ce.options=G||this.resolveDataElementOptions(Kt,Yt.active?"active":m)),Bt||this.updateElement(Yt,Kt,ce,m),te=ue}this.updateSharedOptions(G,m,F)}getMaxOverflow(){const r=this._cachedMeta,o=r.data||[];if(!this.options.showLine){let T=0;for(let S=o.length-1;S>=0;--S)T=Math.max(T,o[S].size(this.resolveDataElementOptions(S))/2);return T>0&&T}const u=r.dataset,m=u.options&&u.options.borderWidth||0;if(!o.length)return m;const _=o[0].size(this.resolveDataElementOptions(0)),b=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(m,_,b)/2}}de(ns,"id","scatter"),de(ns,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),de(ns,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var ka=Object.freeze({__proto__:null,BarController:Yr,BubbleController:Gs,DoughnutController:Sr,LineController:Aa,PolarAreaController:is,PieController:Ia,RadarController:Jr,ScatterController:ns});function So(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ml{static override(r){Object.assign(Ml.prototype,r)}constructor(r){this.options=r||{}}init(){}formats(){return So()}parse(){return So()}format(){return So()}add(){return So()}diff(){return So()}startOf(){return So()}endOf(){return So()}}var Lc__date=Ml;function qh(a,r,o,u){const{controller:m,data:_,_sorted:b}=a,T=m._cachedMeta.iScale;if(T&&r===T.axis&&"r"!==r&&b&&_.length){const S=T._reversePixels?wr:br;if(!u)return S(_,r,o);if(m._sharedOptions){const z=_[0],F="function"==typeof z.getRange&&z.getRange(r);if(F){const G=S(_,r,o-F),W=S(_,r,o+F);return{lo:G.lo,hi:W.hi}}}}return{lo:0,hi:_.length-1}}function Ao(a,r,o,u,m){const _=a.getSortedVisibleDatasetMetas(),b=o[r];for(let T=0,S=_.length;T<S;++T){const{index:z,data:F}=_[T],{lo:G,hi:W}=qh(_[T],r,b,m);for(let nt=G;nt<=W;++nt){const gt=F[nt];gt.skip||u(gt,z,nt)}}}function Rc(a,r,o,u,m){const _=[];return!m&&!a.isPointInArea(r)||Ao(a,o,r,function(T,S,z){!m&&!ks(T,a.chartArea,0)||T.inRange(r.x,r.y,u)&&_.push({element:T,datasetIndex:S,index:z})},!0),_}function Cl(a,r,o,u,m,_){return _||a.isPointInArea(r)?"r"!==o||u?function od(a,r,o,u,m,_){let b=[];const T=function dn(a){const r=-1!==a.indexOf("x"),o=-1!==a.indexOf("y");return function(u,m){const _=r?Math.abs(u.x-m.x):0,b=o?Math.abs(u.y-m.y):0;return Math.sqrt(Math.pow(_,2)+Math.pow(b,2))}}(o);let S=Number.POSITIVE_INFINITY;return Ao(a,o,r,function z(F,G,W){const nt=F.inRange(r.x,r.y,m);if(u&&!nt)return;const gt=F.getCenterPoint(m);if(!_&&!a.isPointInArea(gt)&&!nt)return;const yt=T(r,gt);yt<S?(b=[{element:F,datasetIndex:G,index:W}],S=yt):yt===S&&b.push({element:F,datasetIndex:G,index:W})}),b}(a,r,o,u,m,_):function Wh(a,r,o,u){let m=[];return Ao(a,o,r,function _(b,T,S){const{startAngle:z,endAngle:F}=b.getProps(["startAngle","endAngle"],u),{angle:G}=Ee(b,{x:r.x,y:r.y});Vn(G,z,F)&&m.push({element:b,datasetIndex:T,index:S})}),m}(a,r,o,m):[]}function Ar(a,r,o,u,m){const _=[],b="x"===o?"inXRange":"inYRange";let T=!1;return Ao(a,o,r,(S,z,F)=>{S[b](r[o],m)&&(_.push({element:S,datasetIndex:z,index:F}),T=T||S.inRange(r.x,r.y,m))}),u&&!T?[]:_}var Hh={evaluateInteractionItems:Ao,modes:{index(a,r,o,u){const m=Jo(r,a),_=o.axis||"x",b=o.includeInvisible||!1,T=o.intersect?Rc(a,m,_,u,b):Cl(a,m,_,!1,u,b),S=[];return T.length?(a.getSortedVisibleDatasetMetas().forEach(z=>{const F=T[0].index,G=z.data[F];G&&!G.skip&&S.push({element:G,datasetIndex:z.index,index:F})}),S):[]},dataset(a,r,o,u){const m=Jo(r,a),_=o.axis||"xy",b=o.includeInvisible||!1;let T=o.intersect?Rc(a,m,_,u,b):Cl(a,m,_,!1,u,b);if(T.length>0){const S=T[0].datasetIndex,z=a.getDatasetMeta(S).data;T=[];for(let F=0;F<z.length;++F)T.push({element:z[F],datasetIndex:S,index:F})}return T},point:(a,r,o,u)=>Rc(a,Jo(r,a),o.axis||"xy",u,o.includeInvisible||!1),nearest:(a,r,o,u)=>Cl(a,Jo(r,a),o.axis||"xy",o.intersect,u,o.includeInvisible||!1),x:(a,r,o,u)=>Ar(a,Jo(r,a),"x",o.intersect,u),y:(a,r,o,u)=>Ar(a,Jo(r,a),"y",o.intersect,u)}};const rs=["left","top","right","bottom"];function zn(a,r){return a.filter(o=>o.pos===r)}function za(a,r){return a.filter(o=>-1===rs.indexOf(o.pos)&&o.box.axis===r)}function le(a,r){return a.sort((o,u)=>{const m=r?u:o,_=r?o:u;return m.weight===_.weight?m.index-_.index:m.weight-_.weight})}function Zs(a,r,o,u){return Math.max(a[o],r[o])+Math.max(a[u],r[u])}function Bc(a,r){a.top=Math.max(a.top,r.top),a.left=Math.max(a.left,r.left),a.bottom=Math.max(a.bottom,r.bottom),a.right=Math.max(a.right,r.right)}function Oc(a,r,o,u){const{pos:m,box:_}=o,b=a.maxPadding;if(!We(m)){o.size&&(a[m]-=o.size);const G=u[o.stack]||{size:0,count:1};G.size=Math.max(G.size,o.horizontal?_.height:_.width),o.size=G.size/G.count,a[m]+=o.size}_.getPadding&&Bc(b,_.getPadding());const T=Math.max(0,r.outerWidth-Zs(b,a,"left","right")),S=Math.max(0,r.outerHeight-Zs(b,a,"top","bottom")),z=T!==a.w,F=S!==a.h;return a.w=T,a.h=S,o.horizontal?{same:z,other:F}:{same:F,other:z}}function Fc(a,r){const o=r.maxPadding;return function u(m){const _={left:0,top:0,right:0,bottom:0};return m.forEach(b=>{_[b]=Math.max(r[b],o[b])}),_}(a?["left","right"]:["top","bottom"])}function os(a,r,o,u){const m=[];let _,b,T,S,z,F;for(_=0,b=a.length,z=0;_<b;++_){T=a[_],S=T.box,S.update(T.width||r.w,T.height||r.h,Fc(T.horizontal,r));const{same:G,other:W}=Oc(r,o,T,u);z|=G&&m.length,F=F||W,S.fullSize||m.push(T)}return z&&os(m,r,o,u)||F}function Io(a,r,o,u,m){a.top=o,a.left=r,a.right=r+u,a.bottom=o+m,a.width=u,a.height=m}function Ra(a,r,o,u){const m=o.padding;let{x:_,y:b}=r;for(const T of a){const S=T.box,z=u[T.stack]||{count:1,placed:0,weight:1},F=T.stackWeight/z.weight||1;if(T.horizontal){const G=r.w*F,W=z.size||S.height;Di(z.start)&&(b=z.start),S.fullSize?Io(S,m.left,b,o.outerWidth-m.right-m.left,W):Io(S,r.left+z.placed,b,G,W),z.start=b,z.placed+=G,b=S.bottom}else{const G=r.h*F,W=z.size||S.width;Di(z.start)&&(_=z.start),S.fullSize?Io(S,_,m.top,W,o.outerHeight-m.bottom-m.top):Io(S,_,r.top+z.placed,W,G),z.start=_,z.placed+=G,_=S.right}}r.x=_,r.y=b}var Zi={addBox(a,r){a.boxes||(a.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(o){r.draw(o)}}]},a.boxes.push(r)},removeBox(a,r){const o=a.boxes?a.boxes.indexOf(r):-1;-1!==o&&a.boxes.splice(o,1)},configure(a,r,o){r.fullSize=o.fullSize,r.position=o.position,r.weight=o.weight},update(a,r,o,u){if(!a)return;const m=tn(a.options.layout.padding),_=Math.max(r-m.width,0),b=Math.max(o-m.height,0),T=function La(a){const r=function Xh(a){const r=[];let o,u,m,_,b,T;for(o=0,u=(a||[]).length;o<u;++o)m=a[o],({position:_,options:{stack:b,stackWeight:T=1}}=m),r.push({index:o,box:m,pos:_,horizontal:m.isHorizontal(),weight:m.weight,stack:b&&_+b,stackWeight:T});return r}(a),o=le(r.filter(z=>z.box.fullSize),!0),u=le(zn(r,"left"),!0),m=le(zn(r,"right")),_=le(zn(r,"top"),!0),b=le(zn(r,"bottom")),T=za(r,"x"),S=za(r,"y");return{fullSize:o,leftAndTop:u.concat(_),rightAndBottom:m.concat(S).concat(b).concat(T),chartArea:zn(r,"chartArea"),vertical:u.concat(m).concat(S),horizontal:_.concat(b).concat(T)}}(a.boxes),S=T.vertical,z=T.horizontal;Qe(a.boxes,_t=>{"function"==typeof _t.beforeLayout&&_t.beforeLayout()});const F=S.reduce((_t,yt)=>yt.box.options&&!1===yt.box.options.display?_t:_t+1,0)||1,G=Object.freeze({outerWidth:r,outerHeight:o,padding:m,availableWidth:_,availableHeight:b,vBoxMaxWidth:_/2/F,hBoxMaxHeight:b/2}),W=Object.assign({},m);Bc(W,tn(u));const nt=Object.assign({maxPadding:W,w:_,h:b,x:m.left,y:m.top},m),gt=function Da(a,r){const o=function Pa(a){const r={};for(const o of a){const{stack:u,pos:m,stackWeight:_}=o;if(!u||!rs.includes(m))continue;const b=r[u]||(r[u]={count:0,placed:0,weight:0,size:0});b.count++,b.weight+=_}return r}(a),{vBoxMaxWidth:u,hBoxMaxHeight:m}=r;let _,b,T;for(_=0,b=a.length;_<b;++_){T=a[_];const{fullSize:S}=T.box,z=o[T.stack],F=z&&T.stackWeight/z.weight;T.horizontal?(T.width=F?F*u:S&&r.availableWidth,T.height=m):(T.width=u,T.height=F?F*m:S&&r.availableHeight)}return o}(S.concat(z),G);os(T.fullSize,nt,G,gt),os(S,nt,G,gt),os(z,nt,G,gt)&&os(S,nt,G,gt),function Yh(a){const r=a.maxPadding;function o(u){const m=Math.max(r[u]-a[u],0);return a[u]+=m,m}a.y+=o("top"),a.x+=o("left"),o("right"),o("bottom")}(nt),Ra(T.leftAndTop,nt,G,gt),nt.x+=nt.w,nt.y+=nt.h,Ra(T.rightAndBottom,nt,G,gt),a.chartArea={left:nt.left,top:nt.top,right:nt.left+nt.w,bottom:nt.top+nt.h,height:nt.h,width:nt.w},Qe(T.chartArea,_t=>{const yt=_t.box;Object.assign(yt,a.chartArea),yt.update(nt.w,nt.h,{left:0,top:0,right:0,bottom:0})})}};class Ba{acquireContext(r,o){}releaseContext(r){return!1}addEventListener(r,o,u){}removeEventListener(r,o,u){}getDevicePixelRatio(){return 1}getMaximumSize(r,o,u,m){return o=Math.max(0,o||r.width),u=u||r.height,{width:o,height:Math.max(0,m?Math.floor(o/m):u)}}isAttached(r){return!0}updateConfig(r){}}class Jh extends Ba{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const Oa="$chartjs",Uc={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Nc=a=>null===a||""===a,Vc=!!vc&&{passive:!0};function Qh(a,r,o){a.canvas.removeEventListener(r,o,Vc)}function Fa(a,r){for(const o of a)if(o===r||o.contains(r))return!0}function eu(a,r,o){const u=a.canvas,m=new MutationObserver(_=>{let b=!1;for(const T of _)b=b||Fa(T.addedNodes,u),b=b&&!Fa(T.removedNodes,u);b&&o()});return m.observe(document,{childList:!0,subtree:!0}),m}function Sl(a,r,o){const u=a.canvas,m=new MutationObserver(_=>{let b=!1;for(const T of _)b=b||Fa(T.removedNodes,u),b=b&&!Fa(T.addedNodes,u);b&&o()});return m.observe(document,{childList:!0,subtree:!0}),m}const Kr=new Map;let d=0;function n(){const a=window.devicePixelRatio;a!==d&&(d=a,Kr.forEach((r,o)=>{o.currentDevicePixelRatio!==a&&r()}))}function y(a,r,o){const u=a.canvas,m=u&&Yo(u);if(!m)return;const _=xo((T,S)=>{const z=m.clientWidth;o(T,S),z<m.clientWidth&&o()},window),b=new ResizeObserver(T=>{const S=T[0],z=S.contentRect.width,F=S.contentRect.height;0===z&&0===F||_(z,F)});return b.observe(m),function l(a,r){Kr.size||window.addEventListener("resize",n),Kr.set(a,r)}(a,_),b}function v(a,r,o){o&&o.disconnect(),"resize"===r&&function f(a){Kr.delete(a),Kr.size||window.removeEventListener("resize",n)}(a)}function M(a,r,o){const u=a.canvas,m=xo(_=>{null!==a.ctx&&o(function tu(a,r){const o=Uc[a.type]||a.type,{x:u,y:m}=Jo(a,r);return{type:o,chart:r,native:a,x:void 0!==u?u:null,y:void 0!==m?m:null}}(_,a))},a);return function jc(a,r,o){a.addEventListener(r,o,Vc)}(u,r,m),m}class C extends Ba{acquireContext(r,o){const u=r&&r.getContext&&r.getContext("2d");return u&&u.canvas===r?(function Kh(a,r){const o=a.style,u=a.getAttribute("height"),m=a.getAttribute("width");if(a[Oa]={initial:{height:u,width:m,style:{display:o.display,height:o.height,width:o.width}}},o.display=o.display||"block",o.boxSizing=o.boxSizing||"border-box",Nc(m)){const _=Lh(a,"width");void 0!==_&&(a.width=_)}if(Nc(u))if(""===a.style.height)a.height=a.width/(r||2);else{const _=Lh(a,"height");void 0!==_&&(a.height=_)}}(r,o),u):null}releaseContext(r){const o=r.canvas;if(!o[Oa])return!1;const u=o[Oa].initial;["height","width"].forEach(_=>{const b=u[_];Je(b)?o.removeAttribute(_):o.setAttribute(_,b)});const m=u.style||{};return Object.keys(m).forEach(_=>{o.style[_]=m[_]}),o.width=o.width,delete o[Oa],!0}addEventListener(r,o,u){this.removeEventListener(r,o),(r.$proxies||(r.$proxies={}))[o]=({attach:eu,detach:Sl,resize:y}[o]||M)(r,o,u)}removeEventListener(r,o){const u=r.$proxies||(r.$proxies={}),m=u[o];m&&(({attach:v,detach:v,resize:v}[o]||Qh)(r,o,m),u[o]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,o,u,m){return function va(a,r,o,u){const m=jn(a),_=Cr(m,"margin"),b=Rs(m.maxWidth,a,"clientWidth")||Q,T=Rs(m.maxHeight,a,"clientHeight")||Q,S=function yc(a,r,o){let u,m;if(void 0===r||void 0===o){const _=Yo(a);if(_){const b=_.getBoundingClientRect(),T=jn(_),S=Cr(T,"border","width"),z=Cr(T,"padding");r=b.width-z.width-S.width,o=b.height-z.height-S.height,u=Rs(T.maxWidth,_,"clientWidth"),m=Rs(T.maxHeight,_,"clientHeight")}else r=a.clientWidth,o=a.clientHeight}return{width:r,height:o,maxWidth:u||Q,maxHeight:m||Q}}(a,r,o);let{width:z,height:F}=S;if("content-box"===m.boxSizing){const W=Cr(m,"border","width"),nt=Cr(m,"padding");z-=nt.width+W.width,F-=nt.height+W.height}return z=Math.max(0,z-_.width),F=Math.max(0,u?z/u:F-_.height),z=xa(Math.min(z,b,S.maxWidth)),F=xa(Math.min(F,T,S.maxHeight)),z&&!F&&(F=xa(z/2)),(void 0!==r||void 0!==o)&&u&&S.height&&F>S.height&&(F=S.height,z=xa(Math.floor(F*u))),{width:z,height:F}}(r,o,u,m)}isAttached(r){const o=Yo(r);return!(!o||!o.isConnected)}}class D{constructor(){de(this,"active",!1)}tooltipPosition(r){const{x:o,y:u}=this.getProps(["x","y"],r);return{x:o,y:u}}hasValue(){return _e(this.x)&&_e(this.y)}getProps(r,o){const u=this.$animations;if(!o||!u)return this;const m={};return r.forEach(_=>{m[_]=u[_]&&u[_].active()?u[_]._to:this[_]}),m}}function Y(a,r,o,u,m){const _=Le(u,0),b=Math.min(Le(m,a.length),a.length);let S,z,F,T=0;for(o=Math.ceil(o),m&&(S=m-u,o=S/Math.floor(S/o)),F=_;F<0;)T++,F=Math.round(_+T*o);for(z=Math.max(_,0);z<b;z++)z===F&&(r.push(a[z]),T++,F=Math.round(_+T*o))}de(D,"defaults",{}),de(D,"defaultRoutes",void 0);const rt=(a,r,o)=>"top"===r||"left"===r?a[r]+o:a[r]-o,it=(a,r)=>Math.min(r||a,a);function ot(a,r){const o=[],u=a.length/r,m=a.length;let _=0;for(;_<m;_+=u)o.push(a[Math.floor(_)]);return o}function pt(a,r,o){const u=a.ticks.length,m=Math.min(r,u-1),_=a._startPixel,b=a._endPixel,T=1e-6;let z,S=a.getPixelForTick(m);if(!(o&&(z=1===u?Math.max(S-_,b-S):0===r?(a.getPixelForTick(1)-S)/2:(S-a.getPixelForTick(m-1))/2,S+=m<r?z:-z,S<_-T||S>b+T)))return S}function ft(a){return a.drawTicks?a.tickLength:0}function wt(a,r){if(!a.display)return 0;const o=Gi(a.font,r),u=tn(a.padding);return(gi(a.text)?a.text.length:1)*o.lineHeight+u.height}function Jt(a,r,o){let u=Go(a);return(o&&"right"!==r||!o&&"right"===r)&&(u=(a=>"left"===a?"right":"right"===a?"left":a)(u)),u}class Ft extends D{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,o){return r}getUserBounds(){let{_userMin:r,_userMax:o,_suggestedMin:u,_suggestedMax:m}=this;return r=nn(r,Number.POSITIVE_INFINITY),o=nn(o,Number.NEGATIVE_INFINITY),u=nn(u,Number.POSITIVE_INFINITY),m=nn(m,Number.NEGATIVE_INFINITY),{min:nn(r,u),max:nn(o,m),minDefined:vi(r),maxDefined:vi(o)}}getMinMax(r){let b,{min:o,max:u,minDefined:m,maxDefined:_}=this.getUserBounds();if(m&&_)return{min:o,max:u};const T=this.getMatchingVisibleMetas();for(let S=0,z=T.length;S<z;++S)b=T[S].controller.getMinMax(this,r),m||(o=Math.min(o,b.min)),_||(u=Math.max(u,b.max));return o=_&&o>u?u:o,u=m&&o>u?o:u,{min:nn(o,nn(u,o)),max:nn(u,nn(o,u))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){_i(this.options.beforeUpdate,[this])}update(r,o,u){const{beginAtZero:m,grace:_,ticks:b}=this.options,T=b.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=o,this._margins=u=Object.assign({left:0,right:0,top:0,bottom:0},u),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+u.left+u.right:this.height+u.top+u.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function ni(a,r,o){const{min:u,max:m}=a,_=Sn(r,(m-u)/2),b=(T,S)=>o&&0===T?0:T+S;return{min:b(u,-Math.abs(_)),max:b(m,_)}}(this,_,m),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const S=T<this.ticks.length;this._convertTicksToLabels(S?ot(this.ticks,T):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),b.display&&(b.autoSkip||"auto"===b.source)&&(this.ticks=function L(a,r){const o=a.options.ticks,u=function N(a){const r=a.options.offset,o=a._tickSize();return Math.floor(Math.min(a._length/o+(r?0:1),a._maxLength/o))}(a),m=Math.min(o.maxTicksLimit||u,u),_=o.major.enabled?function X(a){const r=[];let o,u;for(o=0,u=a.length;o<u;o++)a[o].major&&r.push(o);return r}(r):[],b=_.length,T=_[0],S=_[b-1],z=[];if(b>m)return function H(a,r,o,u){let b,m=0,_=o[0];for(u=Math.ceil(u),b=0;b<a.length;b++)b===_&&(r.push(a[b]),m++,_=o[m*u])}(r,z,_,b/m),z;const F=function $(a,r,o){const u=function K(a){const r=a.length;let o,u;if(r<2)return!1;for(u=a[0],o=1;o<r;++o)if(a[o]-a[o-1]!==u)return!1;return u}(a),m=r.length/o;if(!u)return Math.max(m,1);const _=function Wt(a){const r=[],o=Math.sqrt(a);let u;for(u=1;u<o;u++)a%u==0&&(r.push(u),r.push(a/u));return o===(0|o)&&r.push(o),r.sort((m,_)=>m-_).pop(),r}(u);for(let b=0,T=_.length-1;b<T;b++){const S=_[b];if(S>m)return S}return Math.max(m,1)}(_,r,m);if(b>0){let G,W;const nt=b>1?Math.round((S-T)/(b-1)):null;for(Y(r,z,F,Je(nt)?0:T-nt,T),G=0,W=b-1;G<W;G++)Y(r,z,F,_[G],_[G+1]);return Y(r,z,F,S,Je(nt)?r.length:S+nt),z}return Y(r,z,F),z}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),S&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let o,u,r=this.options.reverse;this.isHorizontal()?(o=this.left,u=this.right):(o=this.top,u=this.bottom,r=!r),this._startPixel=o,this._endPixel=u,this._reversePixels=r,this._length=u-o,this._alignToPixels=this.options.alignToPixels}afterUpdate(){_i(this.options.afterUpdate,[this])}beforeSetDimensions(){_i(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){_i(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),_i(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){_i(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const o=this.options.ticks;let u,m,_;for(u=0,m=r.length;u<m;u++)_=r[u],_.label=_i(o.callback,[_.value,u,r],this)}afterTickToLabelConversion(){_i(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){_i(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,o=r.ticks,u=it(this.ticks.length,r.ticks.maxTicksLimit),m=o.minRotation||0,_=o.maxRotation;let T,S,z,b=m;if(!this._isVisible()||!o.display||m>=_||u<=1||!this.isHorizontal())return void(this.labelRotation=m);const F=this._getLabelSizes(),G=F.widest.width,W=F.highest.height,nt=zt(this.chart.width-G,0,this.maxWidth);T=r.offset?this.maxWidth/u:nt/(u-1),G+6>T&&(T=nt/(u-(r.offset?.5:1)),S=this.maxHeight-ft(r.grid)-o.padding-wt(r.title,this.chart.options.font),z=Math.sqrt(G*G+W*W),b=Re(Math.min(Math.asin(zt((F.highest.height+6)/T,-1,1)),Math.asin(zt(S/z,-1,1))-Math.asin(zt(W/z,-1,1)))),b=Math.max(m,Math.min(_,b))),this.labelRotation=b}afterCalculateLabelRotation(){_i(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){_i(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:o,options:{ticks:u,title:m,grid:_}}=this,b=this._isVisible(),T=this.isHorizontal();if(b){const S=wt(m,o.options.font);if(T?(r.width=this.maxWidth,r.height=ft(_)+S):(r.height=this.maxHeight,r.width=ft(_)+S),u.display&&this.ticks.length){const{first:z,last:F,widest:G,highest:W}=this._getLabelSizes(),nt=2*u.padding,gt=xe(this.labelRotation),_t=Math.cos(gt),yt=Math.sin(gt);T?r.height=Math.min(this.maxHeight,r.height+(u.mirror?0:yt*G.width+_t*W.height)+nt):r.width=Math.min(this.maxWidth,r.width+(u.mirror?0:_t*G.width+yt*W.height)+nt),this._calculatePadding(z,F,yt,_t)}}this._handleMargins(),T?(this.width=this._length=o.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=o.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,o,u,m){const{ticks:{align:_,padding:b},position:T}=this.options,S=0!==this.labelRotation,z="top"!==T&&"x"===this.axis;if(this.isHorizontal()){const F=this.getPixelForTick(0)-this.left,G=this.right-this.getPixelForTick(this.ticks.length-1);let W=0,nt=0;S?z?(W=m*r.width,nt=u*o.height):(W=u*r.height,nt=m*o.width):"start"===_?nt=o.width:"end"===_?W=r.width:"inner"!==_&&(W=r.width/2,nt=o.width/2),this.paddingLeft=Math.max((W-F+b)*this.width/(this.width-F),0),this.paddingRight=Math.max((nt-G+b)*this.width/(this.width-G),0)}else{let F=o.height/2,G=r.height/2;"start"===_?(F=0,G=r.height):"end"===_&&(F=o.height,G=0),this.paddingTop=F+b,this.paddingBottom=G+b}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){_i(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:o}=this.options;return"top"===o||"bottom"===o||"x"===r}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){let o,u;for(this.beforeTickToLabelConversion(),this.generateTickLabels(r),o=0,u=r.length;o<u;o++)Je(r[o].label)&&(r.splice(o,1),u--,o--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const o=this.options.ticks.sampleSize;let u=this.ticks;o<u.length&&(u=ot(u,o)),this._labelSizes=r=this._computeLabelSizes(u,u.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,o,u){const{ctx:m,_longestTextCache:_}=this,b=[],T=[],S=Math.floor(o/it(o,u));let G,W,nt,gt,_t,yt,Rt,Bt,te,Kt,Yt,z=0,F=0;for(G=0;G<o;G+=S){if(gt=r[G].label,_t=this._resolveTickFontOptions(G),m.font=yt=_t.string,Rt=_[yt]=_[yt]||{data:{},gc:[]},Bt=_t.lineHeight,te=Kt=0,Je(gt)||gi(gt)){if(gi(gt))for(W=0,nt=gt.length;W<nt;++W)Yt=gt[W],!Je(Yt)&&!gi(Yt)&&(te=Hn(m,Rt.data,Rt.gc,te,Yt),Kt+=Bt)}else te=Hn(m,Rt.data,Rt.gc,te,gt),Kt=Bt;b.push(te),T.push(Kt),z=Math.max(te,z),F=Math.max(Kt,F)}!function ut(a,r){Qe(a,o=>{const u=o.gc,m=u.length/2;let _;if(m>r){for(_=0;_<m;++_)delete o.data[u[_]];u.splice(0,m)}})}(_,o);const ue=b.indexOf(z),ce=T.indexOf(F),fe=Ae=>({width:b[Ae]||0,height:T[Ae]||0});return{first:fe(0),last:fe(o-1),widest:fe(ue),highest:fe(ce),widths:b,heights:T}}getLabelForValue(r){return r}getPixelForValue(r,o){return NaN}getValueForPixel(r){}getPixelForTick(r){const o=this.ticks;return r<0||r>o.length-1?null:this.getPixelForValue(o[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const o=this._startPixel+r*this._length;return function Gr(a){return zt(a,-32768,32767)}(this._alignToPixels?Tr(this.chart,o,0):o)}getDecimalForPixel(r){const o=(r-this._startPixel)/this._length;return this._reversePixels?1-o:o}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:o}=this;return r<0&&o<0?o:r>0&&o>0?r:0}getContext(r){const o=this.ticks||[];if(r>=0&&r<o.length){const u=o[r];return u.$context||(u.$context=function It(a,r,o){return Yn(a,{tick:o,index:r,type:"tick"})}(this.getContext(),r,u))}return this.$context||(this.$context=function Ct(a,r){return Yn(a,{scale:r,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,o=xe(this.labelRotation),u=Math.abs(Math.cos(o)),m=Math.abs(Math.sin(o)),_=this._getLabelSizes(),b=r.autoSkipPadding||0,T=_?_.widest.width+b:0,S=_?_.highest.height+b:0;return this.isHorizontal()?S*u>T*m?T/u:S/m:S*m<T*u?S/u:T/m}_isVisible(){const r=this.options.display;return"auto"!==r?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const o=this.axis,u=this.chart,m=this.options,{grid:_,position:b,border:T}=m,S=_.offset,z=this.isHorizontal(),G=this.ticks.length+(S?1:0),W=ft(_),nt=[],gt=T.setContext(this.getContext()),_t=gt.display?gt.width:0,yt=_t/2,Rt=function(Ki){return Tr(u,Ki,_t)};let Bt,te,Kt,Yt,ue,ce,fe,Ae,Ie,ke,ci,ln;if("top"===b)Bt=Rt(this.bottom),ce=this.bottom-W,Ae=Bt-yt,ke=Rt(r.top)+yt,ln=r.bottom;else if("bottom"===b)Bt=Rt(this.top),ke=r.top,ln=Rt(r.bottom)-yt,ce=Bt+yt,Ae=this.top+W;else if("left"===b)Bt=Rt(this.right),ue=this.right-W,fe=Bt-yt,Ie=Rt(r.left)+yt,ci=r.right;else if("right"===b)Bt=Rt(this.left),Ie=r.left,ci=Rt(r.right)-yt,ue=Bt+yt,fe=this.left+W;else if("x"===o){if("center"===b)Bt=Rt((r.top+r.bottom)/2+.5);else if(We(b)){const Ki=Object.keys(b)[0];Bt=Rt(this.chart.scales[Ki].getPixelForValue(b[Ki]))}ke=r.top,ln=r.bottom,ce=Bt+yt,Ae=ce+W}else if("y"===o){if("center"===b)Bt=Rt((r.left+r.right)/2);else if(We(b)){const Ki=Object.keys(b)[0];Bt=Rt(this.chart.scales[Ki].getPixelForValue(b[Ki]))}ue=Bt-yt,fe=ue-W,Ie=r.left,ci=r.right}const er=Le(m.ticks.maxTicksLimit,G),pi=Math.max(1,Math.ceil(G/er));for(te=0;te<G;te+=pi){const Ki=this.getContext(te),cn=_.setContext(Ki),ys=T.setContext(Ki),ir=cn.lineWidth,td=cn.color,Am=ys.dash||[],ed=ys.dashOffset,mp=cn.tickWidth,gp=cn.tickColor,_p=cn.tickBorderDash||[],yp=cn.tickBorderDashOffset;Kt=pt(this,te,S),void 0!==Kt&&(Yt=Tr(u,Kt,ir),z?ue=fe=Ie=ci=Yt:ce=Ae=ke=ln=Yt,nt.push({tx1:ue,ty1:ce,tx2:fe,ty2:Ae,x1:Ie,y1:ke,x2:ci,y2:ln,width:ir,color:td,borderDash:Am,borderDashOffset:ed,tickWidth:mp,tickColor:gp,tickBorderDash:_p,tickBorderDashOffset:yp}))}return this._ticksLength=G,this._borderValue=Bt,nt}_computeLabelItems(r){const o=this.axis,u=this.options,{position:m,ticks:_}=u,b=this.isHorizontal(),T=this.ticks,{align:S,crossAlign:z,padding:F,mirror:G}=_,W=ft(u.grid),nt=W+F,gt=G?-F:nt,_t=-xe(this.labelRotation),yt=[];let Rt,Bt,te,Kt,Yt,ue,ce,fe,Ae,Ie,ke,ci,ln="middle";if("top"===m)ue=this.bottom-gt,ce=this._getXAxisLabelAlignment();else if("bottom"===m)ue=this.top+gt,ce=this._getXAxisLabelAlignment();else if("left"===m){const pi=this._getYAxisLabelAlignment(W);ce=pi.textAlign,Yt=pi.x}else if("right"===m){const pi=this._getYAxisLabelAlignment(W);ce=pi.textAlign,Yt=pi.x}else if("x"===o){if("center"===m)ue=(r.top+r.bottom)/2+nt;else if(We(m)){const pi=Object.keys(m)[0];ue=this.chart.scales[pi].getPixelForValue(m[pi])+nt}ce=this._getXAxisLabelAlignment()}else if("y"===o){if("center"===m)Yt=(r.left+r.right)/2-nt;else if(We(m)){const pi=Object.keys(m)[0];Yt=this.chart.scales[pi].getPixelForValue(m[pi])}ce=this._getYAxisLabelAlignment(W).textAlign}"y"===o&&("start"===S?ln="top":"end"===S&&(ln="bottom"));const er=this._getLabelSizes();for(Rt=0,Bt=T.length;Rt<Bt;++Rt){te=T[Rt],Kt=te.label;const pi=_.setContext(this.getContext(Rt));fe=this.getPixelForTick(Rt)+_.labelOffset,Ae=this._resolveTickFontOptions(Rt),Ie=Ae.lineHeight,ke=gi(Kt)?Kt.length:1;const Ki=ke/2,cn=pi.color,ys=pi.textStrokeColor,ir=pi.textStrokeWidth;let Am,td=ce;if(b?(Yt=fe,"inner"===ce&&(td=Rt===Bt-1?this.options.reverse?"left":"right":0===Rt?this.options.reverse?"right":"left":"center"),ci="top"===m?"near"===z||0!==_t?-ke*Ie+Ie/2:"center"===z?-er.highest.height/2-Ki*Ie+Ie:Ie/2-er.highest.height:"near"===z||0!==_t?Ie/2:"center"===z?er.highest.height/2-Ki*Ie:er.highest.height-ke*Ie,G&&(ci*=-1),0!==_t&&!pi.showLabelBackdrop&&(Yt+=Ie/2*Math.sin(_t))):(ue=fe,ci=(1-ke)*Ie/2),pi.showLabelBackdrop){const ed=tn(pi.backdropPadding),mp=er.heights[Rt],gp=er.widths[Rt];let _p=ci-ed.top,yp=0-ed.left;switch(ln){case"middle":_p-=mp/2;break;case"bottom":_p-=mp}switch(ce){case"center":yp-=gp/2;break;case"right":yp-=gp}Am={left:yp,top:_p,width:gp+ed.width,height:mp+ed.height,color:pi.backdropColor}}yt.push({label:Kt,font:Ae,textOffset:ci,options:{rotation:_t,color:cn,strokeColor:ys,strokeWidth:ir,textAlign:td,textBaseline:ln,translation:[Yt,ue],backdrop:Am}})}return yt}_getXAxisLabelAlignment(){const{position:r,ticks:o}=this.options;if(-xe(this.labelRotation))return"top"===r?"left":"right";let m="center";return"start"===o.align?m="left":"end"===o.align?m="right":"inner"===o.align&&(m="inner"),m}_getYAxisLabelAlignment(r){const{position:o,ticks:{crossAlign:u,mirror:m,padding:_}}=this.options,T=r+_,S=this._getLabelSizes().widest.width;let z,F;return"left"===o?m?(F=this.right+_,"near"===u?z="left":"center"===u?(z="center",F+=S/2):(z="right",F+=S)):(F=this.right-T,"near"===u?z="right":"center"===u?(z="center",F-=S/2):(z="left",F=this.left)):"right"===o?m?(F=this.left+_,"near"===u?z="right":"center"===u?(z="center",F-=S/2):(z="left",F-=S)):(F=this.left+T,"near"===u?z="left":"center"===u?(z="center",F+=S/2):(z="right",F=this.right)):z="right",{textAlign:z,x:F}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,o=this.options.position;return"left"===o||"right"===o?{top:0,left:this.left,bottom:r.height,right:this.right}:"top"===o||"bottom"===o?{top:this.top,left:0,bottom:this.bottom,right:r.width}:void 0}drawBackground(){const{ctx:r,options:{backgroundColor:o},left:u,top:m,width:_,height:b}=this;o&&(r.save(),r.fillStyle=o,r.fillRect(u,m,_,b),r.restore())}getLineWidthForValue(r){const o=this.options.grid;if(!this._isVisible()||!o.display)return 0;const m=this.ticks.findIndex(_=>_.value===r);return m>=0?o.setContext(this.getContext(m)).lineWidth:0}drawGrid(r){const o=this.options.grid,u=this.ctx,m=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let _,b;const T=(S,z,F)=>{!F.width||!F.color||(u.save(),u.lineWidth=F.width,u.strokeStyle=F.color,u.setLineDash(F.borderDash||[]),u.lineDashOffset=F.borderDashOffset,u.beginPath(),u.moveTo(S.x,S.y),u.lineTo(z.x,z.y),u.stroke(),u.restore())};if(o.display)for(_=0,b=m.length;_<b;++_){const S=m[_];o.drawOnChartArea&&T({x:S.x1,y:S.y1},{x:S.x2,y:S.y2},S),o.drawTicks&&T({x:S.tx1,y:S.ty1},{x:S.tx2,y:S.ty2},{color:S.tickColor,width:S.tickWidth,borderDash:S.tickBorderDash,borderDashOffset:S.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:o,options:{border:u,grid:m}}=this,_=u.setContext(this.getContext()),b=u.display?_.width:0;if(!b)return;const T=m.setContext(this.getContext(0)).lineWidth,S=this._borderValue;let z,F,G,W;this.isHorizontal()?(z=Tr(r,this.left,b)-b/2,F=Tr(r,this.right,T)+T/2,G=W=S):(G=Tr(r,this.top,b)-b/2,W=Tr(r,this.bottom,T)+T/2,z=F=S),o.save(),o.lineWidth=_.width,o.strokeStyle=_.color,o.beginPath(),o.moveTo(z,G),o.lineTo(F,W),o.stroke(),o.restore()}drawLabels(r){if(!this.options.ticks.display)return;const u=this.ctx,m=this._computeLabelArea();m&&vo(u,m);const _=this.getLabelItems(r);for(const b of _)In(u,b.label,0,b.textOffset,b.font,b.options);m&&$r(u)}drawTitle(){const{ctx:r,options:{position:o,title:u,reverse:m}}=this;if(!u.display)return;const _=Gi(u.font),b=tn(u.padding),T=u.align;let S=_.lineHeight/2;"bottom"===o||"center"===o||We(o)?(S+=b.bottom,gi(u.text)&&(S+=_.lineHeight*(u.text.length-1))):S+=b.top;const{titleX:z,titleY:F,maxWidth:G,rotation:W}=function Et(a,r,o,u){const{top:m,left:_,bottom:b,right:T,chart:S}=a,{chartArea:z,scales:F}=S;let W,nt,gt,G=0;const _t=b-m,yt=T-_;if(a.isHorizontal()){if(nt=ji(u,_,T),We(o)){const Rt=Object.keys(o)[0];gt=F[Rt].getPixelForValue(o[Rt])+_t-r}else gt="center"===o?(z.bottom+z.top)/2+_t-r:rt(a,o,r);W=T-_}else{if(We(o)){const Rt=Object.keys(o)[0];nt=F[Rt].getPixelForValue(o[Rt])-yt+r}else nt="center"===o?(z.left+z.right)/2-yt+r:rt(a,o,r);gt=ji(u,b,m),G="left"===o?-ct:ct}return{titleX:nt,titleY:gt,maxWidth:W,rotation:G}}(this,S,o,T);In(r,u.text,0,0,_,{color:u.color,maxWidth:G,rotation:W,textAlign:Jt(T,o,m),textBaseline:"middle",translation:[z,F]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,o=r.ticks&&r.ticks.z||0,u=Le(r.grid&&r.grid.z,-1),m=Le(r.border&&r.border.z,0);return this._isVisible()&&this.draw===Ft.prototype.draw?[{z:u,draw:_=>{this.drawBackground(),this.drawGrid(_),this.drawTitle()}},{z:m,draw:()=>{this.drawBorder()}},{z:o,draw:_=>{this.drawLabels(_)}}]:[{z:o,draw:_=>{this.draw(_)}}]}getMatchingVisibleMetas(r){const o=this.chart.getSortedVisibleDatasetMetas(),u=this.axis+"AxisID",m=[];let _,b;for(_=0,b=o.length;_<b;++_){const T=o[_];T[u]===this.id&&(!r||T.type===r)&&m.push(T)}return m}_resolveTickFontOptions(r){return Gi(this.options.ticks.setContext(this.getContext(r)).font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class Dt{constructor(r,o,u){this.type=r,this.scope=o,this.override=u,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const o=Object.getPrototypeOf(r);let u;(function vt(a){return"id"in a&&"defaults"in a})(o)&&(u=this.register(o));const m=this.items,_=r.id,b=this.scope+"."+_;if(!_)throw new Error("class does not have id: "+r);return _ in m||(m[_]=r,function Zt(a,r,o){const u=or(Object.create(null),[o?ki.get(o):{},ki.get(r),a.defaults]);ki.set(r,u),a.defaultRoutes&&function At(a,r){Object.keys(r).forEach(o=>{const u=o.split("."),m=u.pop(),_=[a].concat(u).join("."),b=r[o].split("."),T=b.pop(),S=b.join(".");ki.route(_,m,S,T)})}(r,a.defaultRoutes),a.descriptors&&ki.describe(r,a.descriptors)}(r,b,u),this.override&&ki.override(r.id,r.overrides)),b}get(r){return this.items[r]}unregister(r){const o=this.items,u=r.id,m=this.scope;u in o&&delete o[u],m&&u in ki[m]&&(delete ki[m][u],this.override&&delete Ii[u])}}class kt{constructor(){this.controllers=new Dt(Tn,"datasets",!0),this.elements=new Dt(D,"elements"),this.plugins=new Dt(Object,"plugins"),this.scales=new Dt(Ft,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,o,u){[...o].forEach(m=>{const _=u||this._getRegistryForType(m);u||_.isForType(m)||_===this.plugins&&m.id?this._exec(r,_,m):Qe(m,b=>{const T=u||this._getRegistryForType(b);this._exec(r,T,b)})})}_exec(r,o,u){const m=jr(r);_i(u["before"+m],[],u),o[r](u),_i(u["after"+m],[],u)}_getRegistryForType(r){for(let o=0;o<this._typedRegistries.length;o++){const u=this._typedRegistries[o];if(u.isForType(r))return u}return this.plugins}_get(r,o,u){const m=o.get(r);if(void 0===m)throw new Error('"'+r+'" is not a registered '+u+".");return m}}var Ut=new kt;class $t{constructor(){this._init=[]}notify(r,o,u,m){"beforeInit"===o&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));const _=m?this._descriptors(r).filter(m):this._descriptors(r),b=this._notify(_,r,o,u);return"afterDestroy"===o&&(this._notify(_,r,"stop"),this._notify(this._init,r,"uninstall")),b}_notify(r,o,u,m){m=m||{};for(const _ of r){const b=_.plugin;if(!1===_i(b[u],[o,m,_.options],b)&&m.cancelable)return!1}return!0}invalidate(){Je(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const o=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),o}_createDescriptors(r,o){const u=r&&r.config,m=Le(u.options&&u.options.plugins,{}),_=function me(a){const r={},o=[],u=Object.keys(Ut.plugins.items);for(let _=0;_<u.length;_++)o.push(Ut.getPlugin(u[_]));const m=a.plugins||[];for(let _=0;_<m.length;_++){const b=m[_];-1===o.indexOf(b)&&(o.push(b),r[b.id]=!0)}return{plugins:o,localIds:r}}(u);return!1!==m||o?function he(a,{plugins:r,localIds:o},u,m){const _=[],b=a.getContext();for(const T of r){const S=T.id,z=Oe(u[S],m);null!==z&&_.push({plugin:T,options:ae(a.config,{plugin:T,local:o[S]},z,b)})}return _}(r,_,m,o):[]}_notifyStateChanges(r){const o=this._oldCache||[],u=this._cache,m=(_,b)=>_.filter(T=>!b.some(S=>T.plugin.id===S.plugin.id));this._notify(m(o,u),r,"stop"),this._notify(m(u,o),r,"start")}}function Oe(a,r){return r||!1!==a?!0===a?{}:a:null}function ae(a,{plugin:r,local:o},u,m){const _=a.pluginScopeKeys(r),b=a.getOptionScopes(u,_);return o&&r.defaults&&b.push(r.defaults),a.createResolver(b,m,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ge(a,r){return((r.datasets||{})[a]||{}).indexAxis||r.indexAxis||(ki.datasets[a]||{}).indexAxis||"x"}function oi(a,r){if("x"===a||"y"===a||"r"===a||(a=r.axis||function ri(a){return"top"===a||"bottom"===a?"x":"left"===a||"right"===a?"y":void 0}(r.position)||a.length>1&&oi(a[0].toLowerCase(),r)))return a;throw new Error(`Cannot determine type of '${name}' axis. Please provide 'axis' or 'position' option.`)}function mi(a){const r=a.options||(a.options={});r.plugins=Le(r.plugins,{}),r.scales=function wi(a,r){const o=Ii[a.type]||{scales:{}},u=r.scales||{},m=ge(a.type,r),_=Object.create(null);return Object.keys(u).forEach(b=>{const T=u[b];if(!We(T))return console.error(`Invalid scale configuration for scale: ${b}`);if(T._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${b}`);const S=oi(b,T),z=function be(a,r){return a===r?"_index_":"_value_"}(S,m),F=o.scales||{};_[b]=Vr(Object.create(null),[{axis:S},T,F[S],F[z]])}),a.data.datasets.forEach(b=>{const T=b.type||a.type,S=b.indexAxis||ge(T,r),F=(Ii[T]||{}).scales||{};Object.keys(F).forEach(G=>{const W=function je(a,r){let o=a;return"_index_"===a?o=r:"_value_"===a&&(o="x"===r?"y":"x"),o}(G,S),nt=b[W+"AxisID"]||W;_[nt]=_[nt]||Object.create(null),Vr(_[nt],[{axis:W},u[nt],F[G]])})}),Object.keys(_).forEach(b=>{const T=_[b];Vr(T,[ki.scales[T.type],ki.scale])}),_}(a,r)}function Vi(a){return(a=a||{}).datasets=a.datasets||[],a.labels=a.labels||[],a}const Jn=new Map,Ir=new Set;function xi(a,r){let o=Jn.get(a);return o||(o=r(),Jn.set(a,o),Ir.add(o)),o}const si=(a,r,o)=>{const u=Nn(r,o);void 0!==u&&a.add(u)};class ei{constructor(r){this._config=function Pn(a){return(a=a||{}).data=Vi(a.data),mi(a),a}(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=Vi(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),mi(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return xi(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,o){return xi(`${r}.transition.${o}`,()=>[[`datasets.${r}.transitions.${o}`,`transitions.${o}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,o){return xi(`${r}-${o}`,()=>[[`datasets.${r}.elements.${o}`,`datasets.${r}`,`elements.${o}`,""]])}pluginScopeKeys(r){const o=r.id;return xi(`${this.type}-plugin-${o}`,()=>[[`plugins.${o}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,o){const u=this._scopeCache;let m=u.get(r);return(!m||o)&&(m=new Map,u.set(r,m)),m}getOptionScopes(r,o,u){const{options:m,type:_}=this,b=this._cachedScopes(r,u),T=b.get(o);if(T)return T;const S=new Set;o.forEach(F=>{r&&(S.add(r),F.forEach(G=>si(S,r,G))),F.forEach(G=>si(S,m,G)),F.forEach(G=>si(S,Ii[_]||{},G)),F.forEach(G=>si(S,ki,G)),F.forEach(G=>si(S,qo,G))});const z=Array.from(S);return 0===z.length&&z.push(Object.create(null)),Ir.has(o)&&b.set(o,z),z}chartOptionScopes(){const{options:r,type:o}=this;return[r,Ii[o]||{},ki.datasets[o]||{},{type:o},ki,qo]}resolveNamedOptions(r,o,u,m=[""]){const _={$shared:!0},{resolver:b,subPrefixes:T}=Li(this._resolverCache,r,m);let S=b;(function Ei(a,r){const{isScriptable:o,isIndexable:u}=Ps(a);for(const m of r){const _=o(m),b=u(m),T=(b||_)&&a[m];if(_&&(xn(T)||pn(T))||b&&gi(T))return!0}return!1})(b,o)&&(_.$shared=!1,S=Mr(b,u=xn(u)?u():u,this.createResolver(r,u,T)));for(const z of o)_[z]=S[z];return _}createResolver(r,o,u=[""],m){const{resolver:_}=Li(this._resolverCache,r,u);return We(o)?Mr(_,o,void 0,m):_}}function Li(a,r,o){let u=a.get(r);u||(u=new Map,a.set(r,u));const m=o.join();let _=u.get(m);return _||(_={resolver:ga(r,o),subPrefixes:o.filter(T=>!T.toLowerCase().includes("hover"))},u.set(m,_)),_}const pn=a=>We(a)&&Object.getOwnPropertyNames(a).reduce((r,o)=>r||xn(a[o]),!1),mn=["top","bottom","left","right","chartArea"];function Qr(a,r){return"top"===a||"bottom"===a||-1===mn.indexOf(a)&&"x"===r}function ss(a,r){return function(o,u){return o[a]===u[a]?o[r]-u[r]:o[a]-u[a]}}function Dn(a){const r=a.chart,o=r.options.animation;r.notifyPlugins("afterRender"),_i(o&&o.onComplete,[a],r)}function Kn(a){const r=a.chart,o=r.options.animation;_i(o&&o.onProgress,[a],r)}function kr(a){return mc()&&"string"==typeof a?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}const cr={},to=a=>{const r=kr(a);return Object.values(cr).filter(o=>o.canvas===r).pop()};function $s(a,r,o){const u=Object.keys(a);for(const m of u){const _=+m;if(_>=r){const b=a[m];delete a[m],(o>0||_>r)&&(a[_+o]=b)}}}class eo{static register(...r){Ut.add(...r),ad()}static unregister(...r){Ut.remove(...r),ad()}constructor(r,o){const u=this.config=new ei(o),m=kr(r),_=to(m);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas with ID '"+_.canvas.id+"' can be reused.");const b=u.createResolver(u.chartOptionScopes(),this.getContext());this.platform=new(u.platform||function I(a){return!mc()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?Jh:C}(m)),this.platform.updateConfig(u);const T=this.platform.acquireContext(m,b.aspectRatio),S=T&&T.canvas,z=S&&S.height,F=S&&S.width;this.id=_r(),this.ctx=T,this.canvas=S,this.width=F,this.height=z,this._options=b,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new $t,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function Ne(a,r){let o;return function(...u){return r?(clearTimeout(o),o=setTimeout(a,r,u)):a.apply(this,u),r}}(G=>this.update(G),b.resizeDelay||0),this._dataChanges=[],cr[this.id]=this,T&&S?(Gn.listen(this,"complete",Dn),Gn.listen(this,"progress",Kn),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:r,maintainAspectRatio:o},width:u,height:m,_aspectRatio:_}=this;return Je(r)?o&&_?_:m?u/m:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}get registry(){return Ut}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():xc(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ch(this.canvas,this.ctx),this}stop(){return Gn.stop(this),this}resize(r,o){Gn.running(this)?this._resizeBeforeDraw={width:r,height:o}:this._resize(r,o)}_resize(r,o){const u=this.options,b=this.platform.getMaximumSize(this.canvas,r,o,u.maintainAspectRatio&&this.aspectRatio),T=u.devicePixelRatio||this.platform.getDevicePixelRatio(),S=this.width?"resize":"attach";this.width=b.width,this.height=b.height,this._aspectRatio=this.aspectRatio,xc(this,T,!0)&&(this.notifyPlugins("resize",{size:b}),_i(u.onResize,[this,b],this),this.attached&&this._doResize(S)&&this.render())}ensureScalesHaveIDs(){Qe(this.options.scales||{},(u,m)=>{u.id=m})}buildOrUpdateScales(){const r=this.options,o=r.scales,u=this.scales,m=Object.keys(u).reduce((b,T)=>(b[T]=!1,b),{});let _=[];o&&(_=_.concat(Object.keys(o).map(b=>{const T=o[b],S=oi(b,T),z="r"===S,F="x"===S;return{options:T,dposition:z?"chartArea":F?"bottom":"left",dtype:z?"radialLinear":F?"category":"linear"}}))),Qe(_,b=>{const T=b.options,S=T.id,z=oi(S,T),F=Le(T.type,b.dtype);(void 0===T.position||Qr(T.position,z)!==Qr(b.dposition))&&(T.position=b.dposition),m[S]=!0;let G=null;S in u&&u[S].type===F?G=u[S]:(G=new(Ut.getScale(F))({id:S,type:F,ctx:this.ctx,chart:this}),u[G.id]=G),G.init(T,r)}),Qe(m,(b,T)=>{b||delete u[T]}),Qe(u,b=>{Zi.configure(this,b,b.options),Zi.addBox(this,b)})}_updateMetasets(){const r=this._metasets,o=this.data.datasets.length,u=r.length;if(r.sort((m,_)=>m.index-_.index),u>o){for(let m=o;m<u;++m)this._destroyDatasetMeta(m);r.splice(o,u-o)}this._sortedMetasets=r.slice(0).sort(ss("order","index"))}_removeUnreferencedMetasets(){const{_metasets:r,data:{datasets:o}}=this;r.length>o.length&&delete this._stacks,r.forEach((u,m)=>{0===o.filter(_=>_===u._dataset).length&&this._destroyDatasetMeta(m)})}buildOrUpdateControllers(){const r=[],o=this.data.datasets;let u,m;for(this._removeUnreferencedMetasets(),u=0,m=o.length;u<m;u++){const _=o[u];let b=this.getDatasetMeta(u);const T=_.type||this.config.type;if(b.type&&b.type!==T&&(this._destroyDatasetMeta(u),b=this.getDatasetMeta(u)),b.type=T,b.indexAxis=_.indexAxis||ge(T,this.options),b.order=_.order||0,b.index=u,b.label=""+_.label,b.visible=this.isDatasetVisible(u),b.controller)b.controller.updateIndex(u),b.controller.linkScales();else{const S=Ut.getController(T),{datasetElementType:z,dataElementType:F}=ki.datasets[T];Object.assign(S,{dataElementType:Ut.getElement(F),datasetElementType:z&&Ut.getElement(z)}),b.controller=new S(this,u),r.push(b.controller)}}return this._updateMetasets(),r}_resetElements(){Qe(this.data.datasets,(r,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){const o=this.config;o.update();const u=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),m=this._animationsDisabled=!u.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0}))return;const _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let b=0;for(let z=0,F=this.data.datasets.length;z<F;z++){const{controller:G}=this.getDatasetMeta(z),W=!m&&-1===_.indexOf(G);G.buildOrUpdateElements(W),b=Math.max(+G.getMaxOverflow(),b)}b=this._minPadding=u.layout.autoPadding?b:0,this._updateLayout(b),m||Qe(_,z=>{z.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(ss("z","_idx"));const{_active:T,_lastEvent:S}=this;S?this._eventHandler(S,!0):T.length&&this._updateHoverStyles(T,T,!0),this.render()}_updateScales(){Qe(this.scales,r=>{Zi.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const r=this.options,o=new Set(Object.keys(this._listeners)),u=new Set(r.events);(!ca(o,u)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:r}=this,o=this._getUniformDataChanges()||[];for(const{method:u,start:m,count:_}of o)$s(r,m,"_removeElements"===u?-_:_)}_getUniformDataChanges(){const r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];const o=this.data.datasets.length,u=_=>new Set(r.filter(b=>b[0]===_).map((b,T)=>T+","+b.splice(1).join(","))),m=u(0);for(let _=1;_<o;_++)if(!ca(m,u(_)))return;return Array.from(m).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(r){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Zi.update(this,this.width,this.height,r);const o=this.chartArea,u=o.width<=0||o.height<=0;this._layers=[],Qe(this.boxes,m=>{u&&"chartArea"===m.position||(m.configure&&m.configure(),this._layers.push(...m._layers()))},this),this._layers.forEach((m,_)=>{m._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})){for(let o=0,u=this.data.datasets.length;o<u;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,u=this.data.datasets.length;o<u;++o)this._updateDataset(o,xn(r)?r({datasetIndex:o}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,o){const u=this.getDatasetMeta(r),m={meta:u,index:r,mode:o,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",m)&&(u.controller._update(o),m.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",m))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Gn.has(this)?this.attached&&!Gn.running(this)&&Gn.start(this):(this.draw(),Dn({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){const{width:u,height:m}=this._resizeBeforeDraw;this._resize(u,m),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const o=this._layers;for(r=0;r<o.length&&o[r].z<=0;++r)o[r].draw(this.chartArea);for(this._drawDatasets();r<o.length;++r)o[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){const o=this._sortedMetasets,u=[];let m,_;for(m=0,_=o.length;m<_;++m){const b=o[m];(!r||b.visible)&&u.push(b)}return u}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const r=this.getSortedVisibleDatasetMetas();for(let o=r.length-1;o>=0;--o)this._drawDataset(r[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){const o=this.ctx,u=r._clip,m=!u.disabled,_=function sd(a){const{xScale:r,yScale:o}=a;if(r&&o)return{left:r.left,right:r.right,top:o.top,bottom:o.bottom}}(r)||this.chartArea,b={meta:r,index:r.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",b)&&(m&&vo(o,{left:!1===u.left?0:_.left-u.left,right:!1===u.right?this.width:_.right+u.right,top:!1===u.top?0:_.top-u.top,bottom:!1===u.bottom?this.height:_.bottom+u.bottom}),r.controller.draw(),m&&$r(o),b.cancelable=!1,this.notifyPlugins("afterDatasetDraw",b))}isPointInArea(r){return ks(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,o,u,m){const _=Hh.modes[o];return"function"==typeof _?_(this,r,u,m):[]}getDatasetMeta(r){const o=this.data.datasets[r],u=this._metasets;let m=u.filter(_=>_&&_._dataset===o).pop();return m||(m={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:r,_dataset:o,_parsed:[],_sorted:!1},u.push(m)),m}getContext(){return this.$context||(this.$context=Yn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){const o=this.data.datasets[r];if(!o)return!1;const u=this.getDatasetMeta(r);return"boolean"==typeof u.hidden?!u.hidden:!o.hidden}setDatasetVisibility(r,o){this.getDatasetMeta(r).hidden=!o}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,o,u){const m=u?"show":"hide",_=this.getDatasetMeta(r),b=_.controller._resolveAnimations(void 0,m);Di(o)?(_.data[o].hidden=!u,this.update()):(this.setDatasetVisibility(r,u),b.update(_,{visible:u}),this.update(T=>T.datasetIndex===r?m:void 0))}hide(r,o){this._updateVisibility(r,o,!1)}show(r,o){this._updateVisibility(r,o,!0)}_destroyDatasetMeta(r){const o=this._metasets[r];o&&o.controller&&o.controller._destroy(),delete this._metasets[r]}_stop(){let r,o;for(this.stop(),Gn.remove(this),r=0,o=this.data.datasets.length;r<o;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:r,ctx:o}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),Ch(r,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete cr[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const r=this._listeners,o=this.platform,u=(_,b)=>{o.addEventListener(this,_,b),r[_]=b},m=(_,b,T)=>{_.offsetX=b,_.offsetY=T,this._eventHandler(_)};Qe(this.options.events,_=>u(_,m))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const r=this._responsiveListeners,o=this.platform,u=(S,z)=>{o.addEventListener(this,S,z),r[S]=z},m=(S,z)=>{r[S]&&(o.removeEventListener(this,S,z),delete r[S])},_=(S,z)=>{this.canvas&&this.resize(S,z)};let b;const T=()=>{m("attach",T),this.attached=!0,this.resize(),u("resize",_),u("detach",b)};b=()=>{this.attached=!1,m("resize",_),this._stop(),this._resize(0,0),u("attach",T)},o.isAttached(this.canvas)?T():b()}unbindEvents(){Qe(this._listeners,(r,o)=>{this.platform.removeEventListener(this,o,r)}),this._listeners={},Qe(this._responsiveListeners,(r,o)=>{this.platform.removeEventListener(this,o,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,o,u){const m=u?"set":"remove";let _,b,T,S;for("dataset"===o&&(_=this.getDatasetMeta(r[0].datasetIndex),_.controller["_"+m+"DatasetHoverStyle"]()),T=0,S=r.length;T<S;++T){b=r[T];const z=b&&this.getDatasetMeta(b.datasetIndex).controller;z&&z[m+"HoverStyle"](b.element,b.datasetIndex,b.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){const o=this._active||[],u=r.map(({datasetIndex:_,index:b})=>{const T=this.getDatasetMeta(_);if(!T)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:T.data[b],index:b}});!yr(u,o)&&(this._active=u,this._lastEvent=null,this._updateHoverStyles(u,o))}notifyPlugins(r,o,u){return this._plugins.notify(this,r,o,u)}isPluginEnabled(r){return 1===this._plugins._cache.filter(o=>o.plugin.id===r).length}_updateHoverStyles(r,o,u){const m=this.options.hover,_=(S,z)=>S.filter(F=>!z.some(G=>F.datasetIndex===G.datasetIndex&&F.index===G.index)),b=_(o,r),T=u?r:_(r,o);b.length&&this.updateHoverStyle(b,m.mode,!1),T.length&&m.mode&&this.updateHoverStyle(T,m.mode,!0)}_eventHandler(r,o){const u={event:r,replay:o,cancelable:!0,inChartArea:this.isPointInArea(r)},m=b=>(b.options.events||this.options.events).includes(r.native.type);if(!1===this.notifyPlugins("beforeEvent",u,m))return;const _=this._handleEvent(r,o,u.inChartArea);return u.cancelable=!1,this.notifyPlugins("afterEvent",u,m),(_||u.changed)&&this.render(),this}_handleEvent(r,o,u){const{_active:m=[],options:_}=this,T=this._getActiveElements(r,m,u,o),S=function jo(a){return"mouseup"===a.type||"click"===a.type||"contextmenu"===a.type}(r),z=function xp(a,r,o,u){return o&&"mouseout"!==a.type?u?r:a:null}(r,this._lastEvent,u,S);u&&(this._lastEvent=null,_i(_.onHover,[r,T,this],this),S&&_i(_.onClick,[r,T,this],this));const F=!yr(T,m);return(F||o)&&(this._active=T,this._updateHoverStyles(T,m,o)),this._lastEvent=z,F}_getActiveElements(r,o,u,m){if("mouseout"===r.type)return[];if(!u)return o;const _=this.options.hover;return this.getElementsAtEventForMode(r,_.mode,_,m)}}function ad(){return Qe(eo.instances,a=>a._plugins.invalidate())}function Ua(a,r,o,u){return{x:o+a*Math.cos(r),y:u+a*Math.sin(r)}}function Gc(a,r,o,u,m,_){const{x:b,y:T,startAngle:S,pixelMargin:z,innerRadius:F}=r,G=Math.max(r.outerRadius+u+o-z,0),W=F>0?F+u+o+z:0;let nt=0;const gt=m-S;if(u){const cn=((F>0?F-u:0)+(G>0?G-u:0))/2;nt=(gt-(0!==cn?gt*cn/(cn+u):gt))/2}const yt=(gt-Math.max(.001,gt*G-o/J)/G)/2,Rt=S+yt+nt,Bt=m-yt-nt,{outerStart:te,outerEnd:Kt,innerStart:Yt,innerEnd:ue}=function wp(a,r,o,u){const m=function bp(a){return wo(a,["outerStart","outerEnd","innerStart","innerEnd"])}(a.options.borderRadius),_=(o-r)/2,b=Math.min(_,u*r/2),T=S=>{const z=(o-Math.min(_,S))*u/2;return zt(S,0,Math.min(_,z))};return{outerStart:T(m.outerStart),outerEnd:T(m.outerEnd),innerStart:zt(m.innerStart,0,b),innerEnd:zt(m.innerEnd,0,b)}}(r,W,G,Bt-Rt),ce=G-te,fe=G-Kt,Ae=Rt+te/ce,Ie=Bt-Kt/fe,ke=W+Yt,ci=W+ue,ln=Rt+Yt/ke,er=Bt-ue/ci;if(a.beginPath(),_){const pi=(Ae+Ie)/2;if(a.arc(b,T,G,Ae,pi),a.arc(b,T,G,pi,Ie),Kt>0){const ir=Ua(fe,Ie,b,T);a.arc(ir.x,ir.y,Kt,Ie,Bt+ct)}const Ki=Ua(ci,Bt,b,T);if(a.lineTo(Ki.x,Ki.y),ue>0){const ir=Ua(ci,er,b,T);a.arc(ir.x,ir.y,ue,Bt+ct,er+Math.PI)}const cn=(Bt-ue/W+(Rt+Yt/W))/2;if(a.arc(b,T,W,Bt-ue/W,cn,!0),a.arc(b,T,W,cn,Rt+Yt/W,!0),Yt>0){const ir=Ua(ke,ln,b,T);a.arc(ir.x,ir.y,Yt,ln+Math.PI,Rt-ct)}const ys=Ua(ce,Rt,b,T);if(a.lineTo(ys.x,ys.y),te>0){const ir=Ua(ce,Ae,b,T);a.arc(ir.x,ir.y,te,Rt-ct,Ae)}}else{a.moveTo(b,T);const pi=Math.cos(Ae)*G+b,Ki=Math.sin(Ae)*G+T;a.lineTo(pi,Ki);const cn=Math.cos(Ie)*G+b,ys=Math.sin(Ie)*G+T;a.lineTo(cn,ys)}a.closePath()}de(eo,"defaults",ki),de(eo,"instances",cr),de(eo,"overrides",Ii),de(eo,"registry",Ut),de(eo,"version","4.2.1"),de(eo,"getChart",to);class iu extends D{constructor(r){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,r&&Object.assign(this,r)}inRange(r,o,u){const m=this.getProps(["x","y"],u),{angle:_,distance:b}=Ee(m,{x:r,y:o}),{startAngle:T,endAngle:S,innerRadius:z,outerRadius:F,circumference:G}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],u),W=this.options.spacing/2,gt=Le(G,S-T)>=U||Vn(_,T,S),_t=bi(b,z+W,F+W);return gt&&_t}getCenterPoint(r){const{x:o,y:u,startAngle:m,endAngle:_,innerRadius:b,outerRadius:T}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],r),{offset:S,spacing:z}=this.options,F=(m+_)/2,G=(b+T+z+S)/2;return{x:o+Math.cos(F)*G,y:u+Math.sin(F)*G}}tooltipPosition(r){return this.getCenterPoint(r)}draw(r){const{options:o,circumference:u}=this,m=(o.offset||0)/4,_=(o.spacing||0)/2,b=o.circular;if(this.pixelMargin="inner"===o.borderAlign?.33:0,this.fullCircles=u>U?Math.floor(u/U):0,0===u||this.innerRadius<0||this.outerRadius<0)return;r.save();const T=(this.startAngle+this.endAngle)/2;r.translate(Math.cos(T)*m,Math.sin(T)*m);const z=m*(1-Math.sin(Math.min(J,u||0)));r.fillStyle=o.backgroundColor,r.strokeStyle=o.borderColor,function Tp(a,r,o,u,m){const{fullCircles:_,startAngle:b,circumference:T}=r;let S=r.endAngle;if(_){Gc(a,r,o,u,S,m);for(let z=0;z<_;++z)a.fill();isNaN(T)||(S=b+(T%U||U))}Gc(a,r,o,u,S,m),a.fill()}(r,this,z,_,b),function Ep(a,r,o,u,m){const{fullCircles:_,startAngle:b,circumference:T,options:S}=r,{borderWidth:z,borderJoinStyle:F}=S,G="inner"===S.borderAlign;if(!z)return;G?(a.lineWidth=2*z,a.lineJoin=F||"round"):(a.lineWidth=z,a.lineJoin=F||"bevel");let W=r.endAngle;if(_){Gc(a,r,o,u,W,m);for(let nt=0;nt<_;++nt)a.stroke();isNaN(T)||(W=b+(T%U||U))}G&&function vp(a,r,o){const{startAngle:u,pixelMargin:m,x:_,y:b,outerRadius:T,innerRadius:S}=r;let z=m/T;a.beginPath(),a.arc(_,b,T,u-z,o+z),S>m?(z=m/S,a.arc(_,b,S,o+z,u-z,!0)):a.arc(_,b,m,o+ct,u-ct),a.closePath(),a.clip()}(a,r,W),_||(Gc(a,r,o,u,W,m),a.stroke())}(r,this,z,_,b),r.restore()}}function Mp(a,r,o=r){a.lineCap=Le(o.borderCapStyle,r.borderCapStyle),a.setLineDash(Le(o.borderDash,r.borderDash)),a.lineDashOffset=Le(o.borderDashOffset,r.borderDashOffset),a.lineJoin=Le(o.borderJoinStyle,r.borderJoinStyle),a.lineWidth=Le(o.borderWidth,r.borderWidth),a.strokeStyle=Le(o.borderColor,r.borderColor)}function Na(a,r,o){a.lineTo(o.x,o.y)}function nu(a,r,o={}){const u=a.length,{start:m=0,end:_=u-1}=o,{start:b,end:T}=r,S=Math.max(m,b),z=Math.min(_,T);return{count:u,start:S,loop:r.loop,ilen:z<S&&!(m<b&&_<b||m>T&&_>T)?u+z-S:z-S}}function ld(a,r,o,u){const{points:m,options:_}=r,{count:b,start:T,loop:S,ilen:z}=nu(m,o,u),F=function Im(a){return a.stepped?bo:a.tension||"monotone"===a.cubicInterpolationMode?nl:Na}(_);let nt,gt,_t,{move:G=!0,reverse:W}=u||{};for(nt=0;nt<=z;++nt)gt=m[(T+(W?z-nt:nt))%b],!gt.skip&&(G?(a.moveTo(gt.x,gt.y),G=!1):F(a,_t,gt,W,_.stepped),_t=gt);return S&&(gt=m[(T+(W?z:0))%b],F(a,_t,gt,W,_.stepped)),!!S}function Cp(a,r,o,u){const m=r.points,{count:_,start:b,ilen:T}=nu(m,o,u),{move:S=!0,reverse:z}=u||{};let W,nt,gt,_t,yt,Rt,F=0,G=0;const Bt=Kt=>(b+(z?T-Kt:Kt))%_,te=()=>{_t!==yt&&(a.lineTo(F,yt),a.lineTo(F,_t),a.lineTo(F,Rt))};for(S&&(nt=m[Bt(0)],a.moveTo(nt.x,nt.y)),W=0;W<=T;++W){if(nt=m[Bt(W)],nt.skip)continue;const Kt=nt.x,Yt=nt.y,ue=0|Kt;ue===gt?(Yt<_t?_t=Yt:Yt>yt&&(yt=Yt),F=(G*F+Kt)/++G):(te(),a.lineTo(Kt,Yt),gt=ue,G=0,_t=yt=Yt),Rt=Yt}te()}function cd(a){const r=a.options;return a._decimated||a._loop||r.tension||"monotone"===r.cubicInterpolationMode||r.stepped||r.borderDash&&r.borderDash.length?ld:Cp}de(iu,"id","arc"),de(iu,"defaults",{borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),de(iu,"defaultRoutes",{backgroundColor:"backgroundColor"});const ou="function"==typeof Path2D;class io extends D{constructor(r){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,r&&Object.assign(this,r)}updateControlPoints(r,o){const u=this.options;!u.tension&&"monotone"!==u.cubicInterpolationMode||u.stepped||this._pointsUpdated||(ya(this._points,u,r,u.spanGaps?this._loop:this._fullLoop,o),this._pointsUpdated=!0)}set points(r){this._points=r,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function Uh(a,r){const o=a.points,u=a.options.spanGaps,m=o.length;if(!m)return[];const _=!!a._loop,{start:b,end:T}=function Ec(a,r,o,u){let m=0,_=r-1;if(o&&!u)for(;m<r&&!a[m].skip;)m++;for(;m<r&&a[m].skip;)m++;for(m%=r,o&&(_+=m);_>m&&a[_%r].skip;)_--;return _%=r,{start:m,end:_}}(o,m,_,u);return function Cc(a,r,o,u){return u&&u.setContext&&o?function Nh(a,r,o,u){const m=a._chart.getContext(),_=_l(a.options),{_datasetIndex:b,options:{spanGaps:T}}=a,S=o.length,z=[];let F=_,G=r[0].start,W=G;function nt(gt,_t,yt,Rt){const Bt=T?-1:1;if(gt!==_t){for(gt+=S;o[gt%S].skip;)gt-=Bt;for(;o[_t%S].skip;)_t+=Bt;gt%S!=_t%S&&(z.push({start:gt%S,end:_t%S,loop:yt,style:Rt}),F=Rt,G=_t%S)}}for(const gt of r){G=T?G:gt.start;let yt,_t=o[G%S];for(W=G+1;W<=gt.end;W++){const Rt=o[W%S];yt=_l(u.setContext(Yn(m,{type:"segment",p0:_t,p1:Rt,p0DataIndex:(W-1)%S,p1DataIndex:W%S,datasetIndex:b}))),Mo(yt,F)&&nt(G,W-1,gt.loop,F),_t=Rt,F=yt}G<W-1&&nt(G,W-1,gt.loop,F)}return z}(a,r,o,u):r}(a,!0===u?[{start:b,end:T,loop:_}]:function Mc(a,r,o,u){const m=a.length,_=[];let S,b=r,T=a[r];for(S=r+1;S<=o;++S){const z=a[S%m];z.skip||z.stop?T.skip||(_.push({start:r%m,end:(S-1)%m,loop:u=!1}),r=b=z.stop?S:null):(b=S,T.skip&&(r=S)),T=z}return null!==b&&_.push({start:r%m,end:b%m,loop:u}),_}(o,b,T<b?T+m:T,!!a._fullLoop&&0===b&&T===m-1),o,r)}(this,this.options.segment))}first(){const r=this.segments;return r.length&&this.points[r[0].start]}last(){const r=this.segments,u=r.length;return u&&this.points[r[u-1].end]}interpolate(r,o){const u=this.options,m=r[o],_=this.points,b=Fh(this,{property:o,start:m,end:m});if(!b.length)return;const T=[],S=function ru(a){return a.stepped?nd:a.tension||"monotone"===a.cubicInterpolationMode?Ko:Wr}(u);let z,F;for(z=0,F=b.length;z<F;++z){const{start:G,end:W}=b[z],nt=_[G],gt=_[W];if(nt===gt){T.push(nt);continue}const yt=S(nt,gt,Math.abs((m-nt[o])/(gt[o]-nt[o])),u.stepped);yt[o]=r[o],T.push(yt)}return 1===T.length?T[0]:T}pathSegment(r,o,u){return cd(this)(r,this,o,u)}path(r,o,u){const m=this.segments,_=cd(this);let b=this._loop;o=o||0,u=u||this.points.length-o;for(const T of m)b&=_(r,this,T,{start:o,end:o+u-1});return!!b}draw(r,o,u,m){(this.points||[]).length&&(this.options||{}).borderWidth&&(r.save(),function as(a,r,o,u){ou&&!r.options.segment?function Sp(a,r,o,u){let m=r._path;m||(m=r._path=new Path2D,r.path(m,o,u)&&m.closePath()),Mp(a,r.options),a.stroke(m)}(a,r,o,u):function hd(a,r,o,u){const{segments:m,options:_}=r,b=cd(r);for(const T of m)Mp(a,_,T.style),a.beginPath(),b(a,r,T,{start:o,end:o+u-1})&&a.closePath(),a.stroke()}(a,r,o,u)}(r,this,u,m),r.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function ud(a,r,o,u){const m=a.options,{[o]:_}=a.getProps([o],u);return Math.abs(r-_)<m.radius+m.hitRadius}de(io,"id","line"),de(io,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),de(io,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),de(io,"descriptors",{_scriptable:!0,_indexable:a=>"borderDash"!==a&&"fill"!==a});class Zc extends D{constructor(r){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,r&&Object.assign(this,r)}inRange(r,o,u){const m=this.options,{x:_,y:b}=this.getProps(["x","y"],u);return Math.pow(r-_,2)+Math.pow(o-b,2)<Math.pow(m.hitRadius+m.radius,2)}inXRange(r,o){return ud(this,r,"x",o)}inYRange(r,o){return ud(this,r,"y",o)}getCenterPoint(r){const{x:o,y:u}=this.getProps(["x","y"],r);return{x:o,y:u}}size(r){let o=(r=r||this.options||{}).radius||0;return o=Math.max(o,o&&r.hoverRadius||0),2*(o+(o&&r.borderWidth||0))}draw(r,o){const u=this.options;this.skip||u.radius<.1||!ks(this,o,this.size(u)/2)||(r.strokeStyle=u.borderColor,r.lineWidth=u.borderWidth,r.fillStyle=u.backgroundColor,fa(r,u,this.x,this.y))}getRange(){const r=this.options||{};return r.radius+r.hitRadius}}function Ap(a,r){const{x:o,y:u,base:m,width:_,height:b}=a.getProps(["x","y","base","width","height"],r);let T,S,z,F,G;return a.horizontal?(G=b/2,T=Math.min(o,m),S=Math.max(o,m),z=u-G,F=u+G):(G=_/2,T=o-G,S=o+G,z=Math.min(u,m),F=Math.max(u,m)),{left:T,top:z,right:S,bottom:F}}function qs(a,r,o,u){return a?0:zt(r,o,u)}function Ws(a,r,o,u){const m=null===r,_=null===o,T=a&&!(m&&_)&&Ap(a,u);return T&&(m||bi(r,T.left,T.right))&&(_||bi(o,T.top,T.bottom))}function no(a,r){a.rect(r.x,r.y,r.w,r.h)}function ko(a,r,o={}){const u=a.x!==o.x?-r:0,m=a.y!==o.y?-r:0;return{x:a.x+u,y:a.y+m,w:a.w+((a.x+a.w!==o.x+o.w?r:0)-u),h:a.h+((a.y+a.h!==o.y+o.h?r:0)-m),radius:a.radius}}de(Zc,"id","point"),de(Zc,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),de(Zc,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class ro extends D{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){const{inflateAmount:o,options:{borderColor:u,backgroundColor:m}}=this,{inner:_,outer:b}=function $c(a){const r=Ap(a),o=r.right-r.left,u=r.bottom-r.top,m=function km(a,r,o){const m=a.borderSkipped,_=hc(a.options.borderWidth);return{t:qs(m.top,_.top,0,o),r:qs(m.right,_.right,0,r),b:qs(m.bottom,_.bottom,0,o),l:qs(m.left,_.left,0,r)}}(a,o/2,u/2),_=function dd(a,r,o){const{enableBorderRadius:u}=a.getProps(["enableBorderRadius"]),m=a.options.borderRadius,_=Er(m),b=Math.min(r,o),T=a.borderSkipped,S=u||We(m);return{topLeft:qs(!S||T.top||T.left,_.topLeft,0,b),topRight:qs(!S||T.top||T.right,_.topRight,0,b),bottomLeft:qs(!S||T.bottom||T.left,_.bottomLeft,0,b),bottomRight:qs(!S||T.bottom||T.right,_.bottomRight,0,b)}}(a,o/2,u/2);return{outer:{x:r.left,y:r.top,w:o,h:u,radius:_},inner:{x:r.left+m.l,y:r.top+m.t,w:o-m.l-m.r,h:u-m.t-m.b,radius:{topLeft:Math.max(0,_.topLeft-Math.max(m.t,m.l)),topRight:Math.max(0,_.topRight-Math.max(m.t,m.r)),bottomLeft:Math.max(0,_.bottomLeft-Math.max(m.b,m.l)),bottomRight:Math.max(0,_.bottomRight-Math.max(m.b,m.r))}}}}(this),T=function ls(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}(b.radius)?zs:no;r.save(),(b.w!==_.w||b.h!==_.h)&&(r.beginPath(),T(r,ko(b,o,_)),r.clip(),T(r,ko(_,-o,b)),r.fillStyle=u,r.fill("evenodd")),r.beginPath(),T(r,ko(_,o)),r.fillStyle=m,r.fill(),r.restore()}inRange(r,o,u){return Ws(this,r,o,u)}inXRange(r,o){return Ws(this,r,null,o)}inYRange(r,o){return Ws(this,null,r,o)}getCenterPoint(r){const{x:o,y:u,base:m,horizontal:_}=this.getProps(["x","y","base","horizontal"],r);return{x:_?(o+m)/2:o,y:_?u:(u+m)/2}}getRange(r){return"x"===r?this.width/2:this.height/2}}de(ro,"id","bar"),de(ro,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),de(ro,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Va=Object.freeze({__proto__:null,ArcElement:iu,LineElement:io,PointElement:Zc,BarElement:ro});const pd=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Ip=pd.map(a=>a.replace("rgb(","rgba(").replace(")",", 0.5)"));function kp(a){return pd[a%pd.length]}function zp(a){return Ip[a%Ip.length]}function Dp(a){let r;for(r in a)if(a[r].borderColor||a[r].backgroundColor)return!0;return!1}var Ce={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(a,r,o){if(!o.enabled)return;const{data:{datasets:u},options:m}=a.config,{elements:_}=m;if(!o.forceOverride&&(Dp(u)||function $i(a){return a&&(a.borderColor||a.backgroundColor)}(m)||_&&Dp(_)))return;const b=function zm(a){let r=0;return(o,u)=>{const m=a.getDatasetMeta(u).controller;m instanceof Sr?r=function su(a,r){return a.backgroundColor=a.data.map(()=>kp(r++)),r}(o,r):m instanceof is?r=function oo(a,r){return a.backgroundColor=a.data.map(()=>zp(r++)),r}(o,r):m&&(r=function Pp(a,r){return a.borderColor=kp(r),a.backgroundColor=zp(r),++r}(o,r))}}(a);u.forEach(b)}};function Zn(a){if(a._decimated){const r=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{configurable:!0,enumerable:!0,writable:!0,value:r})}}function fd(a){a.data.datasets.forEach(r=>{Zn(r)})}var so={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,r,o)=>{if(!o.enabled)return void fd(a);const u=a.width;a.data.datasets.forEach((m,_)=>{const{_data:b,indexAxis:T}=m,S=a.getDatasetMeta(_),z=b||m.data;if("y"===lr([T,a.options.indexAxis])||!S.controller.supportsDecimation)return;const F=a.scales[S.xAxisID];if("linear"!==F.type&&"time"!==F.type||a.options.parsing)return;let gt,{start:G,count:W}=function Lp(a,r){const o=r.length;let m,u=0;const{iScale:_}=a,{min:b,max:T,minDefined:S,maxDefined:z}=_.getUserBounds();return S&&(u=zt(br(r,_.axis,b).lo,0,o-1)),m=z?zt(br(r,_.axis,T).hi+1,u,o)-u:o-u,{start:u,count:m}}(S,z);if(W<=(o.threshold||4*u))Zn(m);else{switch(Je(b)&&(m._data=z,delete m.data,Object.defineProperty(m,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(_t){this._data=_t}})),o.algorithm){case"lttb":gt=function Hs(a,r,o,u,m){const _=m.samples||u;if(_>=o)return a.slice(r,r+o);const b=[],T=(o-2)/(_-2);let S=0;const z=r+o-1;let G,W,nt,gt,_t,F=r;for(b[S++]=a[F],G=0;G<_-2;G++){let Bt,yt=0,Rt=0;const te=Math.floor((G+1)*T)+1+r,Kt=Math.min(Math.floor((G+2)*T)+1,o)+r,Yt=Kt-te;for(Bt=te;Bt<Kt;Bt++)yt+=a[Bt].x,Rt+=a[Bt].y;yt/=Yt,Rt/=Yt;const ue=Math.floor(G*T)+1+r,ce=Math.min(Math.floor((G+1)*T)+1,o)+r,{x:fe,y:Ae}=a[F];for(nt=gt=-1,Bt=ue;Bt<ce;Bt++)gt=.5*Math.abs((fe-yt)*(a[Bt].y-Ae)-(fe-a[Bt].x)*(Rt-Ae)),gt>nt&&(nt=gt,W=a[Bt],_t=Bt);b[S++]=W,F=_t}return b[S++]=a[z],b}(z,G,W,u,o);break;case"min-max":gt=function au(a,r,o,u){let b,T,S,z,F,G,W,nt,gt,_t,m=0,_=0;const yt=[],Bt=a[r].x,Kt=a[r+o-1].x-Bt;for(b=r;b<r+o;++b){T=a[b],S=(T.x-Bt)/Kt*u,z=T.y;const Yt=0|S;if(Yt===F)z<gt?(gt=z,G=b):z>_t&&(_t=z,W=b),m=(_*m+T.x)/++_;else{const ue=b-1;if(!Je(G)&&!Je(W)){const ce=Math.min(G,W),fe=Math.max(G,W);ce!==nt&&ce!==ue&&yt.push({...a[ce],x:m}),fe!==nt&&fe!==ue&&yt.push({...a[fe],x:m})}b>0&&ue!==nt&&yt.push(a[ue]),yt.push(T),F=Yt,_=0,gt=_t=z,G=W=nt=b}}return yt}(z,G,W,u);break;default:throw new Error(`Unsupported decimation algorithm '${o.algorithm}'`)}m._decimated=gt}})},destroy(a){fd(a)}};function cs(a,r,o,u){if(u)return;let m=r[a],_=o[a];return"angle"===a&&(m=Xi(m),_=Xi(_)),{property:a,start:m,end:_}}function hs(a,r,o){for(;r>a;r--){const u=o[r];if(!isNaN(u.x)&&!isNaN(u.y))break}return r}function lu(a,r,o,u){return a&&r?u(a[o],r[o]):a?a[o]:r?r[o]:0}function Wc(a,r){let o=[],u=!1;return gi(a)?(u=!0,o=a):o=function qc(a,r){const{x:o=null,y:u=null}=a||{},m=r.points,_=[];return r.segments.forEach(({start:b,end:T})=>{T=hs(b,T,m);const S=m[b],z=m[T];null!==u?(_.push({x:S.x,y:u}),_.push({x:z.x,y:u})):null!==o&&(_.push({x:o,y:S.y}),_.push({x:o,y:z.y}))}),_}(a,r),o.length?new io({points:o,options:{tension:0},_loop:u,_fullLoop:u}):null}function gd(a){return a&&!1!==a.fill}function Rp(a,r,o){let m=a[r].fill;const _=[r];let b;if(!o)return m;for(;!1!==m&&-1===_.indexOf(m);){if(!vi(m))return m;if(b=a[m],!b)return!1;if(b.visible)return m;_.push(m),m=b.fill}return!1}function Pm(a,r,o){const u=function Al(a){const r=a.options,o=r.fill;let u=Le(o&&o.target,o);return void 0===u&&(u=!!r.backgroundColor),!1!==u&&null!==u&&(!0===u?"origin":u)}(a);if(We(u))return!isNaN(u.value)&&u;let m=parseFloat(u);return vi(m)&&Math.floor(m)===m?function _d(a,r,o,u){return("-"===a||"+"===a)&&(o=r+o),!(o===r||o<0||o>=u)&&o}(u[0],r,m,o):["origin","start","end","stack","shape"].indexOf(u)>=0&&u}function Op(a,r,o){const u=[];for(let m=0;m<o.length;m++){const _=o[m],{first:b,last:T,point:S}=Xc(_,r,"x");if(!(!S||b&&T))if(b)u.unshift(S);else if(a.push(S),!T)break}a.push(...u)}function Xc(a,r,o){const u=a.interpolate(r,o);if(!u)return{};const m=u[o],_=a.segments,b=a.points;let T=!1,S=!1;for(let z=0;z<_.length;z++){const F=_[z],G=b[F.start][o],W=b[F.end][o];if(bi(m,G,W)){T=m===G,S=m===W;break}}return{first:T,last:S,point:u}}class Il{constructor(r){this.x=r.x,this.y=r.y,this.radius=r.radius}pathSegment(r,o,u){const{x:m,y:_,radius:b}=this;return r.arc(m,_,b,(o=o||{start:0,end:U}).end,o.start,!0),!u.bounds}interpolate(r){const{x:o,y:u,radius:m}=this,_=r.angle;return{x:o+Math.cos(_)*m,y:u+Math.sin(_)*m,angle:_}}}function Ri(a,r,o){const u=function hr(a){const{chart:r,fill:o,line:u}=a;if(vi(o))return function Yc(a,r){const o=a.getDatasetMeta(r);return o&&a.isDatasetVisible(r)?o.dataset:null}(r,o);if("stack"===o)return function us(a){const{scale:r,index:o,line:u}=a,m=[],_=u.segments,b=u.points,T=function yd(a,r){const o=[],u=a.getMatchingVisibleMetas("line");for(let m=0;m<u.length;m++){const _=u[m];if(_.index===r)break;_.hidden||o.unshift(_.dataset)}return o}(r,o);T.push(Wc({x:null,y:r.bottom},u));for(let S=0;S<_.length;S++){const z=_[S];for(let F=z.start;F<=z.end;F++)Op(m,b[F],T)}return new io({points:m,options:{}})}(a);if("shape"===o)return!0;const m=function Ln(a){return(a.scale||{}).getPointPositionForValue?function xd(a){const{scale:r,fill:o}=a,u=r.options,m=r.getLabels().length,_=u.reverse?r.max:r.min,b=function Hc(a,r,o){let u;return u="start"===a?o:"end"===a?r.options.reverse?r.min:r.max:We(a)?a.value:r.getBaseValue(),u}(o,r,_),T=[];if(u.grid.circular){const S=r.getPointPositionForValue(0,_);return new Il({x:S.x,y:S.y,radius:r.getDistanceFromCenterForValue(b)})}for(let S=0;S<m;++S)T.push(r.getPointPositionForValue(S,b));return T}(a):function zr(a){const{scale:r={},fill:o}=a,u=function Bp(a,r){let o=null;return"start"===a?o=r.bottom:"end"===a?o=r.top:We(a)?o=r.getPixelForValue(a.value):r.getBasePixel&&(o=r.getBasePixel()),o}(o,r);if(vi(u)){const m=r.isHorizontal();return{x:m?u:null,y:m?null:u}}return null}(a)}(a);return m instanceof Il?m:Wc(m,u)}(r),{line:m,scale:_,axis:b}=r,T=m.options,S=T.fill,z=T.backgroundColor,{above:F=z,below:G=z}=S||{};u&&m.points.length&&(vo(a,o),function Fp(a,r){const{line:o,target:u,above:m,below:_,area:b,scale:T}=r,S=o._loop?"angle":r.axis;a.save(),"x"===S&&_!==m&&(kl(a,u,b.top),Pr(a,{line:o,target:u,color:m,scale:T,property:S}),a.restore(),a.save(),kl(a,u,b.bottom)),Pr(a,{line:o,target:u,color:_,scale:T,property:S}),a.restore()}(a,{line:m,target:u,above:F,below:G,area:o,scale:_,axis:b}),$r(a))}function kl(a,r,o){const{segments:u,points:m}=r;let _=!0,b=!1;a.beginPath();for(const T of u){const{start:S,end:z}=T,F=m[S],G=m[hs(S,z,m)];_?(a.moveTo(F.x,F.y),_=!1):(a.lineTo(F.x,o),a.lineTo(F.x,F.y)),b=!!r.pathSegment(a,T,{move:b}),b?a.closePath():a.lineTo(G.x,o)}a.lineTo(r.first().x,o),a.closePath(),a.clip()}function Pr(a,r){const{line:o,target:u,property:m,color:_,scale:b}=r,T=function md(a,r,o){const u=a.segments,m=a.points,_=r.points,b=[];for(const T of u){let{start:S,end:z}=T;z=hs(S,z,m);const F=cs(o,m[S],m[z],T.loop);if(!r.segments){b.push({source:T,target:F,start:m[S],end:m[z]});continue}const G=Fh(r,F);for(const W of G){const nt=cs(o,_[W.start],_[W.end],W.loop),gt=gl(T,m,nt);for(const _t of gt)b.push({source:_t,target:W,start:{[o]:lu(F,nt,"start",Math.max)},end:{[o]:lu(F,nt,"end",Math.min)}})}}return b}(o,u,m);for(const{source:S,target:z,start:F,end:G}of T){const{style:{backgroundColor:W=_}={}}=S,nt=!0!==u;a.save(),a.fillStyle=W,Dm(a,b,nt&&cs(m,F,G)),a.beginPath();const gt=!!o.pathSegment(a,S);let _t;if(nt){gt?a.closePath():Up(a,u,G,m);const yt=!!u.pathSegment(a,z,{move:gt,reverse:!0});_t=gt&&yt,_t||Up(a,u,F,m)}a.closePath(),a.fill(_t?"evenodd":"nonzero"),a.restore()}}function Dm(a,r,o){const{top:u,bottom:m}=r.chart.chartArea,{property:_,start:b,end:T}=o||{};"x"===_&&(a.beginPath(),a.rect(b,u,T-b,m-u),a.clip())}function Up(a,r,o,u){const m=r.interpolate(o,u);m&&a.lineTo(m.x,m.y)}var Np={id:"filler",afterDatasetsUpdate(a,r,o){const u=(a.data.datasets||[]).length,m=[];let _,b,T,S;for(b=0;b<u;++b)_=a.getDatasetMeta(b),T=_.dataset,S=null,T&&T.options&&T instanceof io&&(S={visible:a.isDatasetVisible(b),index:b,fill:Pm(T,b,u),chart:a,axis:_.controller.options.indexAxis,scale:_.vScale,line:T}),_.$filler=S,m.push(S);for(b=0;b<u;++b)S=m[b],S&&!1!==S.fill&&(S.fill=Rp(m,b,o.propagate))},beforeDraw(a,r,o){const u="beforeDraw"===o.drawTime,m=a.getSortedVisibleDatasetMetas(),_=a.chartArea;for(let b=m.length-1;b>=0;--b){const T=m[b].$filler;T&&(T.line.updateControlPoints(_,T.axis),u&&T.fill&&Ri(a.ctx,T,_))}},beforeDatasetsDraw(a,r,o){if("beforeDatasetsDraw"!==o.drawTime)return;const u=a.getSortedVisibleDatasetMetas();for(let m=u.length-1;m>=0;--m){const _=u[m].$filler;gd(_)&&Ri(a.ctx,_,a.chartArea)}},beforeDatasetDraw(a,r,o){const u=r.meta.$filler;!gd(u)||"beforeDatasetDraw"!==o.drawTime||Ri(a.ctx,u,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const vd=(a,r)=>{let{boxHeight:o=r,boxWidth:u=r}=a;return a.usePointStyle&&(o=Math.min(o,r),u=a.pointStyleWidth||Math.min(u,r)),{boxWidth:u,boxHeight:o,itemHeight:Math.max(r,o)}};class bd extends D{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,o,u){this.maxWidth=r,this.maxHeight=o,this._margins=u,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let o=_i(r.generateLabels,[this.chart],this)||[];r.filter&&(o=o.filter(u=>r.filter(u,this.chart.data))),r.sort&&(o=o.sort((u,m)=>r.sort(u,m,this.chart.data))),this.options.reverse&&o.reverse(),this.legendItems=o}fit(){const{options:r,ctx:o}=this;if(!r.display)return void(this.width=this.height=0);const u=r.labels,m=Gi(u.font),_=m.size,b=this._computeTitleHeight(),{boxWidth:T,itemHeight:S}=vd(u,_);let z,F;o.font=m.string,this.isHorizontal()?(z=this.maxWidth,F=this._fitRows(b,_,T,S)+10):(F=this.maxHeight,z=this._fitCols(b,m,T,S)+10),this.width=Math.min(z,r.maxWidth||this.maxWidth),this.height=Math.min(F,r.maxHeight||this.maxHeight)}_fitRows(r,o,u,m){const{ctx:_,maxWidth:b,options:{labels:{padding:T}}}=this,S=this.legendHitBoxes=[],z=this.lineWidths=[0],F=m+T;let G=r;_.textAlign="left",_.textBaseline="middle";let W=-1,nt=-F;return this.legendItems.forEach((gt,_t)=>{const yt=u+o/2+_.measureText(gt.text).width;(0===_t||z[z.length-1]+yt+2*T>b)&&(G+=F,z[z.length-(_t>0?0:1)]=0,nt+=F,W++),S[_t]={left:0,top:nt,row:W,width:yt,height:m},z[z.length-1]+=yt+T}),G}_fitCols(r,o,u,m){const{ctx:_,maxHeight:b,options:{labels:{padding:T}}}=this,S=this.legendHitBoxes=[],z=this.columnSizes=[],F=b-r;let G=T,W=0,nt=0,gt=0,_t=0;return this.legendItems.forEach((yt,Rt)=>{const{itemWidth:Bt,itemHeight:te}=function Vp(a,r,o,u,m){const _=function jp(a,r,o,u){let m=a.text;return m&&"string"!=typeof m&&(m=m.reduce((_,b)=>_.length>b.length?_:b)),r+o.size/2+u.measureText(m).width}(u,a,r,o),b=function Gp(a,r,o){let u=a;return"string"!=typeof r.text&&(u=Zp(r,o)),u}(m,u,r.lineHeight);return{itemWidth:_,itemHeight:b}}(u,o,_,yt,m);Rt>0&&nt+te+2*T>F&&(G+=W+T,z.push({width:W,height:nt}),gt+=W+T,_t++,W=nt=0),S[Rt]={left:gt,top:nt,col:_t,width:Bt,height:te},W=Math.max(W,Bt),nt+=te+T}),G+=W,z.push({width:W,height:nt}),G}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:o,options:{align:u,labels:{padding:m},rtl:_}}=this,b=Qo(_,this.left,this.width);if(this.isHorizontal()){let T=0,S=ji(u,this.left+m,this.right-this.lineWidths[T]);for(const z of o)T!==z.row&&(T=z.row,S=ji(u,this.left+m,this.right-this.lineWidths[T])),z.top+=this.top+r+m,z.left=b.leftForLtr(b.x(S),z.width),S+=z.width+m}else{let T=0,S=ji(u,this.top+r+m,this.bottom-this.columnSizes[T].height);for(const z of o)z.col!==T&&(T=z.col,S=ji(u,this.top+r+m,this.bottom-this.columnSizes[T].height)),z.top=S,z.left+=this.left+m,z.left=b.leftForLtr(b.x(z.left),z.width),S+=z.height+m}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const r=this.ctx;vo(r,this),this._draw(),$r(r)}}_draw(){const{options:r,columnSizes:o,lineWidths:u,ctx:m}=this,{align:_,labels:b}=r,T=ki.color,S=Qo(r.rtl,this.left,this.width),z=Gi(b.font),{padding:F}=b,G=z.size,W=G/2;let nt;this.drawTitle(),m.textAlign=S.textAlign("left"),m.textBaseline="middle",m.lineWidth=.5,m.font=z.string;const{boxWidth:gt,boxHeight:_t,itemHeight:yt}=vd(b,G),te=this.isHorizontal(),Kt=this._computeTitleHeight();nt=te?{x:ji(_,this.left+F,this.right-u[0]),y:this.top+F+Kt,line:0}:{x:this.left+F,y:ji(_,this.top+Kt+F,this.bottom-o[0].height),line:0},ts(this.ctx,r.textDirection);const Yt=yt+F;this.legendItems.forEach((ue,ce)=>{m.strokeStyle=ue.fontColor,m.fillStyle=ue.fontColor;const fe=m.measureText(ue.text).width,Ae=S.textAlign(ue.textAlign||(ue.textAlign=b.textAlign)),Ie=gt+W+fe;let ke=nt.x,ci=nt.y;S.setWidth(this.width),te?ce>0&&ke+Ie+F>this.right&&(ci=nt.y+=Yt,nt.line++,ke=nt.x=ji(_,this.left+F,this.right-u[nt.line])):ce>0&&ci+Yt>this.bottom&&(ke=nt.x=ke+o[nt.line].width+F,nt.line++,ci=nt.y=ji(_,this.top+Kt+F,this.bottom-o[nt.line].height)),function(ue,ce,fe){if(isNaN(gt)||gt<=0||isNaN(_t)||_t<0)return;m.save();const Ae=Le(fe.lineWidth,1);if(m.fillStyle=Le(fe.fillStyle,T),m.lineCap=Le(fe.lineCap,"butt"),m.lineDashOffset=Le(fe.lineDashOffset,0),m.lineJoin=Le(fe.lineJoin,"miter"),m.lineWidth=Ae,m.strokeStyle=Le(fe.strokeStyle,T),m.setLineDash(Le(fe.lineDash,[])),b.usePointStyle){const Ie={radius:_t*Math.SQRT2/2,pointStyle:fe.pointStyle,rotation:fe.rotation,borderWidth:Ae},ke=S.xPlus(ue,gt/2);Xo(m,Ie,ke,ce+W,b.pointStyleWidth&&gt)}else{const Ie=ce+Math.max((G-_t)/2,0),ke=S.leftForLtr(ue,gt),ci=Er(fe.borderRadius);m.beginPath(),Object.values(ci).some(ln=>0!==ln)?zs(m,{x:ke,y:Ie,w:gt,h:_t,radius:ci}):m.rect(ke,Ie,gt,_t),m.fill(),0!==Ae&&m.stroke()}m.restore()}(S.x(ke),ci,ue),ke=((a,r,o,u)=>a===(u?"left":"right")?o:"center"===a?(r+o)/2:r)(Ae,ke+gt+W,te?ke+Ie:this.right,r.rtl),function(ue,ce,fe){In(m,fe.text,ue,ce+yt/2,z,{strikethrough:fe.hidden,textAlign:S.textAlign(fe.textAlign)})}(S.x(ke),ci,ue),te?nt.x+=Ie+F:nt.y+="string"!=typeof ue.text?Zp(ue,z.lineHeight):Yt}),Bh(this.ctx,r.textDirection)}drawTitle(){const r=this.options,o=r.title,u=Gi(o.font),m=tn(o.padding);if(!o.display)return;const _=Qo(r.rtl,this.left,this.width),b=this.ctx,T=o.position,z=m.top+u.size/2;let F,G=this.left,W=this.width;if(this.isHorizontal())W=Math.max(...this.lineWidths),F=this.top+z,G=ji(r.align,G,this.right-W);else{const gt=this.columnSizes.reduce((_t,yt)=>Math.max(_t,yt.height),0);F=z+ji(r.align,this.top,this.bottom-gt-r.labels.padding-this._computeTitleHeight())}const nt=ji(T,G,G+W);b.textAlign=_.textAlign(Go(T)),b.textBaseline="middle",b.strokeStyle=o.color,b.fillStyle=o.color,b.font=u.string,In(b,o.text,nt,F,u)}_computeTitleHeight(){const r=this.options.title,o=Gi(r.font),u=tn(r.padding);return r.display?o.lineHeight+u.height:0}_getLegendItemAt(r,o){let u,m,_;if(bi(r,this.left,this.right)&&bi(o,this.top,this.bottom))for(_=this.legendHitBoxes,u=0;u<_.length;++u)if(m=_[u],bi(r,m.left,m.left+m.width)&&bi(o,m.top,m.top+m.height))return this.legendItems[u];return null}handleEvent(r){const o=this.options;if(!function Lm(a,r){return!(("mousemove"!==a&&"mouseout"!==a||!r.onHover&&!r.onLeave)&&(!r.onClick||"click"!==a&&"mouseup"!==a))}(r.type,o))return;const u=this._getLegendItemAt(r.x,r.y);if("mousemove"===r.type||"mouseout"===r.type){const m=this._hoveredItem,_=((a,r)=>null!==a&&null!==r&&a.datasetIndex===r.datasetIndex&&a.index===r.index)(m,u);m&&!_&&_i(o.onLeave,[r,m,this],this),this._hoveredItem=u,u&&!_&&_i(o.onHover,[r,u,this],this)}else u&&_i(o.onClick,[r,u,this],this)}}function Zp(a,r){return r*(a.text?a.text.length+.5:0)}var $p={id:"legend",_element:bd,start(a,r,o){const u=a.legend=new bd({ctx:a.ctx,options:o,chart:a});Zi.configure(a,u,o),Zi.addBox(a,u)},stop(a){Zi.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,r,o){const u=a.legend;Zi.configure(a,u,o),u.options=o},afterUpdate(a){const r=a.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(a,r){r.replay||a.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,r,o){const u=r.datasetIndex,m=o.chart;m.isDatasetVisible(u)?(m.hide(u),r.hidden=!0):(m.show(u),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){const r=a.data.datasets,{labels:{usePointStyle:o,pointStyle:u,textAlign:m,color:_,useBorderRadius:b,borderRadius:T}}=a.legend.options;return a._getSortedDatasetMetas().map(S=>{const z=S.controller.getStyle(o?0:void 0),F=tn(z.borderWidth);return{text:r[S.index].label,fillStyle:z.backgroundColor,fontColor:_,hidden:!S.visible,lineCap:z.borderCapStyle,lineDash:z.borderDash,lineDashOffset:z.borderDashOffset,lineJoin:z.borderJoinStyle,lineWidth:(F.width+F.height)/4,strokeStyle:z.borderColor,pointStyle:u||z.pointStyle,rotation:z.rotation,textAlign:m||z.textAlign,borderRadius:b&&(T||z.borderRadius),datasetIndex:S.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}};class cu extends D{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,o){const u=this.options;if(this.left=0,this.top=0,!u.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=r,this.height=this.bottom=o;const m=gi(u.text)?u.text.length:1;this._padding=tn(u.padding);const _=m*Gi(u.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=_:this.width=_}isHorizontal(){const r=this.options.position;return"top"===r||"bottom"===r}_drawArgs(r){const{top:o,left:u,bottom:m,right:_,options:b}=this,T=b.align;let z,F,G,S=0;return this.isHorizontal()?(F=ji(T,u,_),G=o+r,z=_-u):("left"===b.position?(F=u+r,G=ji(T,m,o),S=-.5*J):(F=_-r,G=ji(T,o,m),S=.5*J),z=m-o),{titleX:F,titleY:G,maxWidth:z,rotation:S}}draw(){const r=this.ctx,o=this.options;if(!o.display)return;const u=Gi(o.font),_=u.lineHeight/2+this._padding.top,{titleX:b,titleY:T,maxWidth:S,rotation:z}=this._drawArgs(_);In(r,o.text,0,0,u,{color:o.color,maxWidth:S,rotation:z,textAlign:Go(o.align),textBaseline:"middle",translation:[b,T]})}}var wd={id:"title",_element:cu,start(a,r,o){!function Jc(a,r){const o=new cu({ctx:a.ctx,options:r,chart:a});Zi.configure(a,o,r),Zi.addBox(a,o),a.titleBlock=o}(a,o)},stop(a){Zi.removeBox(a,a.titleBlock),delete a.titleBlock},beforeUpdate(a,r,o){const u=a.titleBlock;Zi.configure(a,u,o),u.options=o},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const zl=new WeakMap;var Td={id:"subtitle",start(a,r,o){const u=new cu({ctx:a.ctx,options:o,chart:a});Zi.configure(a,u,o),Zi.addBox(a,u),zl.set(a,u)},stop(a){Zi.removeBox(a,zl.get(a)),zl.delete(a)},beforeUpdate(a,r,o){const u=zl.get(a);Zi.configure(a,u,o),u.options=o},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const rn={average(a){if(!a.length)return!1;let r,o,u=0,m=0,_=0;for(r=0,o=a.length;r<o;++r){const b=a[r].element;if(b&&b.hasValue()){const T=b.tooltipPosition();u+=T.x,m+=T.y,++_}}return{x:u/_,y:m/_}},nearest(a,r){if(!a.length)return!1;let _,b,T,o=r.x,u=r.y,m=Number.POSITIVE_INFINITY;for(_=0,b=a.length;_<b;++_){const S=a[_].element;if(S&&S.hasValue()){const F=ai(r,S.getCenterPoint());F<m&&(m=F,T=S)}}if(T){const S=T.tooltipPosition();o=S.x,u=S.y}return{x:o,y:u}}};function sn(a,r){return r&&(gi(r)?Array.prototype.push.apply(a,r):a.push(r)),a}function $n(a){return("string"==typeof a||a instanceof String)&&a.indexOf("\n")>-1?a.split("\n"):a}function Kc(a,r){const{element:o,datasetIndex:u,index:m}=r,_=a.getDatasetMeta(u).controller,{label:b,value:T}=_.getLabelAndValue(m);return{chart:a,label:b,parsed:_.getParsed(m),raw:a.data.datasets[u].data[m],formattedValue:T,dataset:_.getDataset(),dataIndex:m,datasetIndex:u,element:o}}function ur(a,r){const o=a.chart.ctx,{body:u,footer:m,title:_}=a,{boxWidth:b,boxHeight:T}=r,S=Gi(r.bodyFont),z=Gi(r.titleFont),F=Gi(r.footerFont),G=_.length,W=m.length,nt=u.length,gt=tn(r.padding);let _t=gt.height,yt=0,Rt=u.reduce((Kt,Yt)=>Kt+Yt.before.length+Yt.lines.length+Yt.after.length,0);Rt+=a.beforeBody.length+a.afterBody.length,G&&(_t+=G*z.lineHeight+(G-1)*r.titleSpacing+r.titleMarginBottom),Rt&&(_t+=nt*(r.displayColors?Math.max(T,S.lineHeight):S.lineHeight)+(Rt-nt)*S.lineHeight+(Rt-1)*r.bodySpacing),W&&(_t+=r.footerMarginTop+W*F.lineHeight+(W-1)*r.footerSpacing);let Bt=0;const te=function(Kt){yt=Math.max(yt,o.measureText(Kt).width+Bt)};return o.save(),o.font=z.string,Qe(a.title,te),o.font=S.string,Qe(a.beforeBody.concat(a.afterBody),te),Bt=r.displayColors?b+2+r.boxPadding:0,Qe(u,Kt=>{Qe(Kt.before,te),Qe(Kt.lines,te),Qe(Kt.after,te)}),Bt=0,o.font=F.string,Qe(a.footer,te),o.restore(),yt+=gt.width,{width:yt,height:_t}}function hu(a,r,o,u){const{x:m,width:_}=o,{width:b,chartArea:{left:T,right:S}}=a;let z="center";return"center"===u?z=m<=(T+S)/2?"left":"right":m<=_/2?z="left":m>=b-_/2&&(z="right"),function Rm(a,r,o,u){const{x:m,width:_}=u,b=o.caretSize+o.caretPadding;if("left"===a&&m+_+b>r.width||"right"===a&&m-_-b<0)return!0}(z,a,r,o)&&(z="center"),z}function Ed(a,r,o){const u=o.yAlign||r.yAlign||function Dr(a,r){const{y:o,height:u}=r;return o<u/2?"top":o>a.height-u/2?"bottom":"center"}(a,o);return{xAlign:o.xAlign||r.xAlign||hu(a,r,o,u),yAlign:u}}function ao(a,r,o,u){const{caretSize:m,caretPadding:_,cornerRadius:b}=a,{xAlign:T,yAlign:S}=o,z=m+_,{topLeft:F,topRight:G,bottomLeft:W,bottomRight:nt}=Er(b);let gt=function Bm(a,r){let{x:o,width:u}=a;return"right"===r?o-=u:"center"===r&&(o-=u/2),o}(r,T);const _t=function Md(a,r,o){let{y:u,height:m}=a;return"top"===r?u+=o:u-="bottom"===r?m+o:m/2,u}(r,S,z);return"center"===S?"left"===T?gt+=z:"right"===T&&(gt-=z):"left"===T?gt-=Math.max(F,W)+m:"right"===T&&(gt+=Math.max(G,nt)+m),{x:zt(gt,0,u.width-r.width),y:zt(_t,0,u.height-r.height)}}function zo(a,r,o){const u=tn(o.padding);return"center"===r?a.x+a.width/2:"right"===r?a.x+a.width-u.right:a.x+u.left}function Cd(a){return sn([],$n(a))}function Wp(a,r){const o=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return o?a.override(o):a}const Qc={beforeTitle:Qi,title(a){if(a.length>0){const r=a[0],o=r.chart.data.labels,u=o?o.length:0;if(this&&this.options&&"dataset"===this.options.mode)return r.dataset.label||"";if(r.label)return r.label;if(u>0&&r.dataIndex<u)return o[r.dataIndex]}return""},afterTitle:Qi,beforeBody:Qi,beforeLabel:Qi,label(a){if(this&&this.options&&"dataset"===this.options.mode)return a.label+": "+a.formattedValue||a.formattedValue;let r=a.dataset.label||"";r&&(r+=": ");const o=a.formattedValue;return Je(o)||(r+=o),r},labelColor(a){const o=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:o.borderColor,backgroundColor:o.backgroundColor,borderWidth:o.borderWidth,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){const o=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:o.pointStyle,rotation:o.rotation}},afterLabel:Qi,afterBody:Qi,beforeFooter:Qi,footer:Qi,afterFooter:Qi};function Rn(a,r,o,u){const m=a[r].call(o,u);return typeof m>"u"?Qc[r].call(o,u):m}class Xs extends D{constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const o=this.chart,u=this.options.setContext(this.getContext()),m=u.enabled&&o.options.animation&&u.animations,_=new ba(this.chart,m);return m._cacheable&&(this._cachedAnimations=Object.freeze(_)),_}getContext(){return this.$context||(this.$context=function qp(a,r,o){return Yn(a,{tooltip:r,tooltipItems:o,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,o){const{callbacks:u}=o,m=Rn(u,"beforeTitle",this,r),_=Rn(u,"title",this,r),b=Rn(u,"afterTitle",this,r);let T=[];return T=sn(T,$n(m)),T=sn(T,$n(_)),T=sn(T,$n(b)),T}getBeforeBody(r,o){return Cd(Rn(o.callbacks,"beforeBody",this,r))}getBody(r,o){const{callbacks:u}=o,m=[];return Qe(r,_=>{const b={before:[],lines:[],after:[]},T=Wp(u,_);sn(b.before,$n(Rn(T,"beforeLabel",this,_))),sn(b.lines,Rn(T,"label",this,_)),sn(b.after,$n(Rn(T,"afterLabel",this,_))),m.push(b)}),m}getAfterBody(r,o){return Cd(Rn(o.callbacks,"afterBody",this,r))}getFooter(r,o){const{callbacks:u}=o,m=Rn(u,"beforeFooter",this,r),_=Rn(u,"footer",this,r),b=Rn(u,"afterFooter",this,r);let T=[];return T=sn(T,$n(m)),T=sn(T,$n(_)),T=sn(T,$n(b)),T}_createItems(r){const o=this._active,u=this.chart.data,m=[],_=[],b=[];let S,z,T=[];for(S=0,z=o.length;S<z;++S)T.push(Kc(this.chart,o[S]));return r.filter&&(T=T.filter((F,G,W)=>r.filter(F,G,W,u))),r.itemSort&&(T=T.sort((F,G)=>r.itemSort(F,G,u))),Qe(T,F=>{const G=Wp(r.callbacks,F);m.push(Rn(G,"labelColor",this,F)),_.push(Rn(G,"labelPointStyle",this,F)),b.push(Rn(G,"labelTextColor",this,F))}),this.labelColors=m,this.labelPointStyles=_,this.labelTextColors=b,this.dataPoints=T,T}update(r,o){const u=this.options.setContext(this.getContext()),m=this._active;let _,b=[];if(m.length){const T=rn[u.position].call(this,m,this._eventPosition);b=this._createItems(u),this.title=this.getTitle(b,u),this.beforeBody=this.getBeforeBody(b,u),this.body=this.getBody(b,u),this.afterBody=this.getAfterBody(b,u),this.footer=this.getFooter(b,u);const S=this._size=ur(this,u),z=Object.assign({},T,S),F=Ed(this.chart,u,z),G=ao(u,z,F,this.chart);this.xAlign=F.xAlign,this.yAlign=F.yAlign,_={opacity:1,x:G.x,y:G.y,width:S.width,height:S.height,caretX:T.x,caretY:T.y}}else 0!==this.opacity&&(_={opacity:0});this._tooltipItems=b,this.$context=void 0,_&&this._resolveAnimations().update(this,_),r&&u.external&&u.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(r,o,u,m){const _=this.getCaretPosition(r,u,m);o.lineTo(_.x1,_.y1),o.lineTo(_.x2,_.y2),o.lineTo(_.x3,_.y3)}getCaretPosition(r,o,u){const{xAlign:m,yAlign:_}=this,{caretSize:b,cornerRadius:T}=u,{topLeft:S,topRight:z,bottomLeft:F,bottomRight:G}=Er(T),{x:W,y:nt}=r,{width:gt,height:_t}=o;let yt,Rt,Bt,te,Kt,Yt;return"center"===_?(Kt=nt+_t/2,"left"===m?(yt=W,Rt=yt-b,te=Kt+b,Yt=Kt-b):(yt=W+gt,Rt=yt+b,te=Kt-b,Yt=Kt+b),Bt=yt):(Rt="left"===m?W+Math.max(S,F)+b:"right"===m?W+gt-Math.max(z,G)-b:this.caretX,"top"===_?(te=nt,Kt=te-b,yt=Rt-b,Bt=Rt+b):(te=nt+_t,Kt=te+b,yt=Rt+b,Bt=Rt-b),Yt=te),{x1:yt,x2:Rt,x3:Bt,y1:te,y2:Kt,y3:Yt}}drawTitle(r,o,u){const m=this.title,_=m.length;let b,T,S;if(_){const z=Qo(u.rtl,this.x,this.width);for(r.x=zo(this,u.titleAlign,u),o.textAlign=z.textAlign(u.titleAlign),o.textBaseline="middle",b=Gi(u.titleFont),T=u.titleSpacing,o.fillStyle=u.titleColor,o.font=b.string,S=0;S<_;++S)o.fillText(m[S],z.x(r.x),r.y+b.lineHeight/2),r.y+=b.lineHeight+T,S+1===_&&(r.y+=u.titleMarginBottom-T)}}_drawColorBox(r,o,u,m,_){const b=this.labelColors[u],T=this.labelPointStyles[u],{boxHeight:S,boxWidth:z,boxPadding:F}=_,G=Gi(_.bodyFont),W=zo(this,"left",_),nt=m.x(W),_t=o.y+(S<G.lineHeight?(G.lineHeight-S)/2:0);if(_.usePointStyle){const yt={radius:Math.min(z,S)/2,pointStyle:T.pointStyle,rotation:T.rotation,borderWidth:1},Rt=m.leftForLtr(nt,z)+z/2,Bt=_t+S/2;r.strokeStyle=_.multiKeyBackground,r.fillStyle=_.multiKeyBackground,fa(r,yt,Rt,Bt),r.strokeStyle=b.borderColor,r.fillStyle=b.backgroundColor,fa(r,yt,Rt,Bt)}else{r.lineWidth=We(b.borderWidth)?Math.max(...Object.values(b.borderWidth)):b.borderWidth||1,r.strokeStyle=b.borderColor,r.setLineDash(b.borderDash||[]),r.lineDashOffset=b.borderDashOffset||0;const yt=m.leftForLtr(nt,z-F),Rt=m.leftForLtr(m.xPlus(nt,1),z-F-2),Bt=Er(b.borderRadius);Object.values(Bt).some(te=>0!==te)?(r.beginPath(),r.fillStyle=_.multiKeyBackground,zs(r,{x:yt,y:_t,w:z,h:S,radius:Bt}),r.fill(),r.stroke(),r.fillStyle=b.backgroundColor,r.beginPath(),zs(r,{x:Rt,y:_t+1,w:z-2,h:S-2,radius:Bt}),r.fill()):(r.fillStyle=_.multiKeyBackground,r.fillRect(yt,_t,z,S),r.strokeRect(yt,_t,z,S),r.fillStyle=b.backgroundColor,r.fillRect(Rt,_t+1,z-2,S-2))}r.fillStyle=this.labelTextColors[u]}drawBody(r,o,u){const{body:m}=this,{bodySpacing:_,bodyAlign:b,displayColors:T,boxHeight:S,boxWidth:z,boxPadding:F}=u,G=Gi(u.bodyFont);let W=G.lineHeight,nt=0;const gt=Qo(u.rtl,this.x,this.width),_t=function(fe){o.fillText(fe,gt.x(r.x+nt),r.y+W/2),r.y+=W+_},yt=gt.textAlign(b);let Rt,Bt,te,Kt,Yt,ue,ce;for(o.textAlign=b,o.textBaseline="middle",o.font=G.string,r.x=zo(this,yt,u),o.fillStyle=u.bodyColor,Qe(this.beforeBody,_t),nt=T&&"right"!==yt?"center"===b?z/2+F:z+2+F:0,Kt=0,ue=m.length;Kt<ue;++Kt){for(Rt=m[Kt],Bt=this.labelTextColors[Kt],o.fillStyle=Bt,Qe(Rt.before,_t),te=Rt.lines,T&&te.length&&(this._drawColorBox(o,r,Kt,gt,u),W=Math.max(G.lineHeight,S)),Yt=0,ce=te.length;Yt<ce;++Yt)_t(te[Yt]),W=G.lineHeight;Qe(Rt.after,_t)}nt=0,W=G.lineHeight,Qe(this.afterBody,_t),r.y-=_}drawFooter(r,o,u){const m=this.footer,_=m.length;let b,T;if(_){const S=Qo(u.rtl,this.x,this.width);for(r.x=zo(this,u.footerAlign,u),r.y+=u.footerMarginTop,o.textAlign=S.textAlign(u.footerAlign),o.textBaseline="middle",b=Gi(u.footerFont),o.fillStyle=u.footerColor,o.font=b.string,T=0;T<_;++T)o.fillText(m[T],S.x(r.x),r.y+b.lineHeight/2),r.y+=b.lineHeight+u.footerSpacing}}drawBackground(r,o,u,m){const{xAlign:_,yAlign:b}=this,{x:T,y:S}=r,{width:z,height:F}=u,{topLeft:G,topRight:W,bottomLeft:nt,bottomRight:gt}=Er(m.cornerRadius);o.fillStyle=m.backgroundColor,o.strokeStyle=m.borderColor,o.lineWidth=m.borderWidth,o.beginPath(),o.moveTo(T+G,S),"top"===b&&this.drawCaret(r,o,u,m),o.lineTo(T+z-W,S),o.quadraticCurveTo(T+z,S,T+z,S+W),"center"===b&&"right"===_&&this.drawCaret(r,o,u,m),o.lineTo(T+z,S+F-gt),o.quadraticCurveTo(T+z,S+F,T+z-gt,S+F),"bottom"===b&&this.drawCaret(r,o,u,m),o.lineTo(T+nt,S+F),o.quadraticCurveTo(T,S+F,T,S+F-nt),"center"===b&&"left"===_&&this.drawCaret(r,o,u,m),o.lineTo(T,S+G),o.quadraticCurveTo(T,S,T+G,S),o.closePath(),o.fill(),m.borderWidth>0&&o.stroke()}_updateAnimationTarget(r){const o=this.chart,u=this.$animations,m=u&&u.x,_=u&&u.y;if(m||_){const b=rn[r.position].call(this,this._active,this._eventPosition);if(!b)return;const T=this._size=ur(this,r),S=Object.assign({},b,this._size),z=Ed(o,r,S),F=ao(r,S,z,o);(m._to!==F.x||_._to!==F.y)&&(this.xAlign=z.xAlign,this.yAlign=z.yAlign,this.width=T.width,this.height=T.height,this.caretX=b.x,this.caretY=b.y,this._resolveAnimations().update(this,F))}}_willRender(){return!!this.opacity}draw(r){const o=this.options.setContext(this.getContext());let u=this.opacity;if(!u)return;this._updateAnimationTarget(o);const m={width:this.width,height:this.height},_={x:this.x,y:this.y};u=Math.abs(u)<.001?0:u;const b=tn(o.padding);o.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(r.save(),r.globalAlpha=u,this.drawBackground(_,r,m,o),ts(r,o.textDirection),_.y+=b.top,this.drawTitle(_,r,o),this.drawBody(_,r,o),this.drawFooter(_,r,o),Bh(r,o.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,o){const u=this._active,m=r.map(({datasetIndex:T,index:S})=>{const z=this.chart.getDatasetMeta(T);if(!z)throw new Error("Cannot find a dataset at index "+T);return{datasetIndex:T,element:z.data[S],index:S}}),_=!yr(u,m),b=this._positionChanged(m,o);(_||b)&&(this._active=m,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,o,u=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const m=this.options,_=this._active||[],b=this._getActiveElements(r,_,o,u),T=this._positionChanged(b,r),S=o||!yr(b,_)||T;return S&&(this._active=b,(m.enabled||m.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,o))),S}_getActiveElements(r,o,u,m){const _=this.options;if("mouseout"===r.type)return[];if(!m)return o;const b=this.chart.getElementsAtEventForMode(r,_.mode,_,u);return _.reverse&&b.reverse(),b}_positionChanged(r,o){const{caretX:u,caretY:m,options:_}=this,b=rn[_.position].call(this,r,o);return!1!==b&&(u!==b.x||m!==b.y)}}de(Xs,"positioners",rn);var Pl={id:"tooltip",_element:Xs,positioners:rn,afterInit(a,r,o){o&&(a.tooltip=new Xs({chart:a,options:o}))},beforeUpdate(a,r,o){a.tooltip&&a.tooltip.initialize(o)},reset(a,r,o){a.tooltip&&a.tooltip.initialize(o)},afterDraw(a){const r=a.tooltip;if(r&&r._willRender()){const o={tooltip:r};if(!1===a.notifyPlugins("beforeTooltipDraw",{...o,cancelable:!0}))return;r.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",o)}},afterEvent(a,r){a.tooltip&&a.tooltip.handleEvent(r.event,r.replay,r.inChartArea)&&(r.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,r)=>r.bodyFont.size,boxWidth:(a,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Qc},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>"filter"!==a&&"itemSort"!==a&&"external"!==a,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},th=Object.freeze({__proto__:null,Colors:Ce,Decimation:so,Filler:Np,Legend:$p,SubTitle:Td,Title:wd,Tooltip:Pl});function du(a){const r=this.getLabels();return a>=0&&a<r.length?r[a]:a}class pu extends Ft{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){const o=this._addedLabels;if(o.length){const u=this.getLabels();for(const{index:m,label:_}of o)u[m]===_&&u.splice(m,1);this._addedLabels=[]}super.init(r)}parse(r,o){if(Je(r))return null;const u=this.getLabels();return((a,r)=>null===a?null:zt(Math.round(a),0,r))(o=isFinite(o)&&u[o]===r?o:function Hp(a,r,o,u){const m=a.indexOf(r);return-1===m?((a,r,o,u)=>("string"==typeof r?(o=a.push(r)-1,u.unshift({index:o,label:r})):isNaN(r)&&(o=null),o))(a,r,o,u):m!==a.lastIndexOf(r)?o:m}(u,r,Le(o,r),this._addedLabels),u.length-1)}determineDataLimits(){const{minDefined:r,maxDefined:o}=this.getUserBounds();let{min:u,max:m}=this.getMinMax(!0);"ticks"===this.options.bounds&&(r||(u=0),o||(m=this.getLabels().length-1)),this.min=u,this.max=m}buildTicks(){const r=this.min,o=this.max,u=this.options.offset,m=[];let _=this.getLabels();_=0===r&&o===_.length-1?_:_.slice(r,o+1),this._valueRange=Math.max(_.length-(u?0:1),1),this._startValue=this.min-(u?.5:0);for(let b=r;b<=o;b++)m.push({value:b});return m}getLabelForValue(r){return du.call(this,r)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return"number"!=typeof r&&(r=this.parse(r)),null===r?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){const o=this.ticks;return r<0||r>o.length-1?null:this.getPixelForValue(o[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}}function Sd(a,r,{horizontal:o,minRotation:u}){const m=xe(u),_=(o?Math.sin(m):Math.cos(m))||.001;return Math.min(r/_,.75*r*(""+a).length)}de(pu,"id","category"),de(pu,"defaults",{ticks:{callback:du}});class Ll extends Ft{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,o){return Je(r)||("number"==typeof r||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:o,maxDefined:u}=this.getUserBounds();let{min:m,max:_}=this;const b=S=>m=o?m:S,T=S=>_=u?_:S;if(r){const S=Tt(m),z=Tt(_);S<0&&z<0?T(0):S>0&&z>0&&b(0)}if(m===_){let S=0===_?1:Math.abs(.05*_);T(_+S),r||b(m-S)}this.min=m,this.max=_}getTickLimit(){const r=this.options.ticks;let m,{maxTicksLimit:o,stepSize:u}=r;return u?(m=Math.ceil(this.max/u)-Math.floor(this.min/u)+1,m>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${u} would result generating up to ${m} ticks. Limiting to 1000.`),m=1e3)):(m=this.computeTickLimit(),o=o||11),o&&(m=Math.min(o,m)),m}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,o=r.ticks;let u=this.getTickLimit();u=Math.max(2,u);const b=function Dl(a,r){const o=[],{bounds:m,step:_,min:b,max:T,precision:S,count:z,maxTicks:F,maxDigits:G,includeBounds:W}=a,nt=_||1,gt=F-1,{min:_t,max:yt}=r,Rt=!Je(b),Bt=!Je(T),te=!Je(z),Kt=(yt-_t)/(G+1);let ue,ce,fe,Ae,Yt=se((yt-_t)/gt/nt)*nt;if(Yt<1e-14&&!Rt&&!Bt)return[{value:_t},{value:yt}];Ae=Math.ceil(yt/Yt)-Math.floor(_t/Yt),Ae>gt&&(Yt=se(Ae*Yt/gt/nt)*nt),Je(S)||(ue=Math.pow(10,S),Yt=Math.ceil(Yt*ue)/ue),"ticks"===m?(ce=Math.floor(_t/Yt)*Yt,fe=Math.ceil(yt/Yt)*Yt):(ce=_t,fe=yt),Rt&&Bt&&_&&function ve(a,r){const o=Math.round(a);return o-r<=a&&o+r>=a}((T-b)/_,Yt/1e3)?(Ae=Math.round(Math.min((T-b)/Yt,F)),Yt=(T-b)/Ae,ce=b,fe=T):te?(ce=Rt?b:ce,fe=Bt?T:fe,Ae=z-1,Yt=(fe-ce)/Ae):(Ae=(fe-ce)/Yt,Ae=jt(Ae,Math.round(Ae),Yt/1e3)?Math.round(Ae):Math.ceil(Ae));const Ie=Math.max(ti(Yt),ti(ce));ue=Math.pow(10,Je(S)?Ie:S),ce=Math.round(ce*ue)/ue,fe=Math.round(fe*ue)/ue;let ke=0;for(Rt&&(W&&ce!==b?(o.push({value:b}),ce<b&&ke++,jt(Math.round((ce+ke*Yt)*ue)/ue,b,Sd(b,Kt,a))&&ke++):ce<b&&ke++);ke<Ae;++ke)o.push({value:Math.round((ce+ke*Yt)*ue)/ue});return Bt&&W&&fe!==T?o.length&&jt(o[o.length-1].value,T,Sd(T,Kt,a))?o[o.length-1].value=T:o.push({value:T}):(!Bt||fe===T)&&o.push({value:fe}),o}({maxTicks:u,bounds:r.bounds,min:r.min,max:r.max,precision:o.precision,step:o.stepSize,count:o.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:o.minRotation||0,includeBounds:!1!==o.includeBounds},this._range||this);return"ticks"===r.bounds&&ye(b,this,"value"),r.reverse?(b.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),b}configure(){const r=this.ticks;let o=this.min,u=this.max;if(super.configure(),this.options.offset&&r.length){const m=(u-o)/Math.max(r.length-1,1)/2;o-=m,u+=m}this._startValue=o,this._endValue=u,this._valueRange=u-o}getLabelForValue(r){return Zr(r,this.chart.options.locale,this.options.ticks.format)}}class fu extends Ll{determineDataLimits(){const{min:r,max:o}=this.getMinMax(!0);this.min=vi(r)?r:0,this.max=vi(o)?o:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),o=r?this.width:this.height,u=xe(this.options.ticks.minRotation),m=(r?Math.sin(u):Math.cos(u))||.001,_=this._resolveTickFontOptions(0);return Math.ceil(o/Math.min(40,_.lineHeight/m))}getPixelForValue(r){return null===r?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}de(fu,"id","linear"),de(fu,"defaults",{ticks:{callback:da.formatters.numeric}});const ih=a=>Math.floor(mt(a)),Ga=(a,r)=>Math.pow(10,ih(a)+r);function Rl(a){return a/Math.pow(10,ih(a))==1}function Ad(a,r,o){const u=Math.pow(10,o),m=Math.floor(a/u);return Math.ceil(r/u)-m}class Lr extends Ft{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,o){const u=Ll.prototype.parse.apply(this,[r,o]);if(0!==u)return vi(u)&&u>0?u:null;this._zero=!0}determineDataLimits(){const{min:r,max:o}=this.getMinMax(!0);this.min=vi(r)?Math.max(0,r):null,this.max=vi(o)?Math.max(0,o):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!vi(this._userMin)&&(this.min=r===Ga(this.min,0)?Ga(this.min,-1):Ga(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:r,maxDefined:o}=this.getUserBounds();let u=this.min,m=this.max;const _=T=>u=r?u:T,b=T=>m=o?m:T;u===m&&(u<=0?(_(1),b(10)):(_(Ga(u,-1)),b(Ga(m,1)))),u<=0&&_(Ga(m,-1)),m<=0&&b(Ga(u,1)),this.min=u,this.max=m}buildTicks(){const r=this.options,u=function Id(a,{min:r,max:o}){r=nn(a.min,r);const u=[],m=ih(r);let _=function Ke(a,r){let u=ih(r-a);for(;Ad(a,r,u)>10;)u++;for(;Ad(a,r,u)<10;)u--;return Math.min(u,ih(a))}(r,o),b=_<0?Math.pow(10,Math.abs(_)):1;const T=Math.pow(10,_),S=m>_?Math.pow(10,m):0,z=Math.round((r-S)*b)/b,F=Math.floor((r-S)/T/10)*T*10;let G=Math.floor((z-F)/Math.pow(10,_)),W=nn(a.min,Math.round((S+F+G*Math.pow(10,_))*b)/b);for(;W<o;)u.push({value:W,major:Rl(W),significand:G}),G>=10?G=G<15?15:20:G++,G>=20&&(_++,G=2,b=_>=0?1:b),W=Math.round((S+F+G*Math.pow(10,_))*b)/b;const nt=nn(a.max,W);return u.push({value:nt,major:Rl(nt),significand:G}),u}({min:this._userMin,max:this._userMax},this);return"ticks"===r.bounds&&ye(u,this,"value"),r.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}getLabelForValue(r){return void 0===r?"0":Zr(r,this.chart.options.locale,this.options.ticks.format)}configure(){const r=this.min;super.configure(),this._startValue=mt(r),this._valueRange=mt(this.max)-mt(r)}getPixelForValue(r){return(void 0===r||0===r)&&(r=this.min),null===r||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(mt(r)-this._startValue)/this._valueRange)}getValueForPixel(r){const o=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+o*this._valueRange)}}function Rr(a){const r=a.ticks;if(r.display&&a.display){const o=tn(r.backdropPadding);return Le(r.font&&r.font.size,ki.font.size)+o.height}return 0}function lo(a,r,o){return o=gi(o)?o:[o],{w:pa(a,r.string,o),h:o.length*r.lineHeight}}function Qn(a,r,o,u,m){return a===u||a===m?{start:r-o/2,end:r+o/2}:a<u||a>m?{start:r-o,end:r}:{start:r,end:r+o}}function Xp(a,r,o,u,m){const _=Math.abs(Math.sin(o)),b=Math.abs(Math.cos(o));let T=0,S=0;u.start<r.l?(T=(r.l-u.start)/_,a.l=Math.min(a.l,r.l-T)):u.end>r.r&&(T=(u.end-r.r)/_,a.r=Math.max(a.r,r.r+T)),m.start<r.t?(S=(r.t-m.start)/b,a.t=Math.min(a.t,r.t-S)):m.end>r.b&&(S=(m.end-r.b)/b,a.b=Math.max(a.b,r.b+S))}function Yp(a){return 0===a||180===a?"center":a<180?"left":"right"}function Bl(a,r,o){return"right"===o?a-=r:"center"===o&&(a-=r/2),a}function kd(a,r,o){return 90===o||270===o?a-=r/2:(o>270||o<90)&&(a-=r),a}function mu(a,r,o,u){const{ctx:m}=a;if(o)m.arc(a.xCenter,a.yCenter,r,0,U);else{let _=a.getPointPosition(0,r);m.moveTo(_.x,_.y);for(let b=1;b<u;b++)_=a.getPointPosition(b,r),m.lineTo(_.x,_.y)}}de(Lr,"id","logarithmic"),de(Lr,"defaults",{ticks:{callback:da.formatters.logarithmic,major:{enabled:!0}}});class Ol extends Ll{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const r=this._padding=tn(Rr(this.options)/2),o=this.width=this.maxWidth-r.width,u=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+o/2+r.left),this.yCenter=Math.floor(this.top+u/2+r.top),this.drawingArea=Math.floor(Math.min(o,u)/2)}determineDataLimits(){const{min:r,max:o}=this.getMinMax(!1);this.min=vi(r)&&!isNaN(r)?r:0,this.max=vi(o)&&!isNaN(o)?o:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Rr(this.options))}generateTickLabels(r){Ll.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((o,u)=>{const m=_i(this.options.pointLabels.callback,[o,u],this);return m||0===m?m:""}).filter((o,u)=>this.chart.getDataVisibility(u))}fit(){const r=this.options;r.display&&r.pointLabels.display?function gn(a){const r={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},o=Object.assign({},r),u=[],m=[],_=a._pointLabels.length,b=a.options.pointLabels,T=b.centerPointLabels?J/_:0;for(let S=0;S<_;S++){const z=b.setContext(a.getPointLabelContext(S));m[S]=z.padding;const F=a.getPointPosition(S,a.drawingArea+m[S],T),G=Gi(z.font),W=lo(a.ctx,G,a._pointLabels[S]);u[S]=W;const nt=Xi(a.getIndexAngle(S)+T),gt=Math.round(Re(nt));Xp(o,r,nt,Qn(gt,F.x,W.w,0,180),Qn(gt,F.y,W.h,90,270))}a.setCenterPoint(r.l-o.l,o.r-r.r,r.t-o.t,o.b-r.b),a._pointLabelItems=function _n(a,r,o){const u=[],m=a._pointLabels.length,_=a.options,b=Rr(_)/2,T=a.drawingArea,S=_.pointLabels.centerPointLabels?J/m:0;for(let z=0;z<m;z++){const F=a.getPointPosition(z,T+b+o[z],S),G=Math.round(Re(Xi(F.angle+ct))),W=r[z],nt=kd(F.y,W.h,G),gt=Yp(G),_t=Bl(F.x,W.w,gt);u.push({x:F.x,y:nt,textAlign:gt,left:_t,top:nt,right:_t+W.w,bottom:nt+W.h})}return u}(a,u,m)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,o,u,m){this.xCenter+=Math.floor((r-o)/2),this.yCenter+=Math.floor((u-m)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,o,u,m))}getIndexAngle(r){return Xi(r*(U/(this._pointLabels.length||1))+xe(this.options.startAngle||0))}getDistanceFromCenterForValue(r){if(Je(r))return NaN;const o=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*o:(r-this.min)*o}getValueForDistanceFromCenter(r){if(Je(r))return NaN;const o=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-o:this.min+o}getPointLabelContext(r){const o=this._pointLabels||[];if(r>=0&&r<o.length){const u=o[r];return function zd(a,r,o){return Yn(a,{label:o,index:r,type:"pointLabel"})}(this.getContext(),r,u)}}getPointPosition(r,o,u=0){const m=this.getIndexAngle(r)-ct+u;return{x:Math.cos(m)*o+this.xCenter,y:Math.sin(m)*o+this.yCenter,angle:m}}getPointPositionForValue(r,o){return this.getPointPosition(r,this.getDistanceFromCenterForValue(o))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){const{left:o,top:u,right:m,bottom:_}=this._pointLabelItems[r];return{left:o,top:u,right:m,bottom:_}}drawBackground(){const{backgroundColor:r,grid:{circular:o}}=this.options;if(r){const u=this.ctx;u.save(),u.beginPath(),mu(this,this.getDistanceFromCenterForValue(this._endValue),o,this._pointLabels.length),u.closePath(),u.fillStyle=r,u.fill(),u.restore()}}drawGrid(){const r=this.ctx,o=this.options,{angleLines:u,grid:m,border:_}=o,b=this._pointLabels.length;let T,S,z;if(o.pointLabels.display&&function Jp(a,r){const{ctx:o,options:{pointLabels:u}}=a;for(let m=r-1;m>=0;m--){const _=u.setContext(a.getPointLabelContext(m)),b=Gi(_.font),{x:T,y:S,textAlign:z,left:F,top:G,right:W,bottom:nt}=a._pointLabelItems[m],{backdropColor:gt}=_;if(!Je(gt)){const _t=Er(_.borderRadius),yt=tn(_.backdropPadding);o.fillStyle=gt;const Rt=F-yt.left,Bt=G-yt.top,te=W-F+yt.width,Kt=nt-G+yt.height;Object.values(_t).some(Yt=>0!==Yt)?(o.beginPath(),zs(o,{x:Rt,y:Bt,w:te,h:Kt,radius:_t}),o.fill()):o.fillRect(Rt,Bt,te,Kt)}In(o,a._pointLabels[m],T,S+b.lineHeight/2,b,{color:_.color,textAlign:z,textBaseline:"middle"})}}(this,b),m.display&&this.ticks.forEach((F,G)=>{if(0!==G){S=this.getDistanceFromCenterForValue(F.value);const W=this.getContext(G),nt=m.setContext(W),gt=_.setContext(W);!function Om(a,r,o,u,m){const _=a.ctx,b=r.circular,{color:T,lineWidth:S}=r;!b&&!u||!T||!S||o<0||(_.save(),_.strokeStyle=T,_.lineWidth=S,_.setLineDash(m.dash),_.lineDashOffset=m.dashOffset,_.beginPath(),mu(a,o,b,u),_.closePath(),_.stroke(),_.restore())}(this,nt,S,b,gt)}}),u.display){for(r.save(),T=b-1;T>=0;T--){const F=u.setContext(this.getPointLabelContext(T)),{color:G,lineWidth:W}=F;!W||!G||(r.lineWidth=W,r.strokeStyle=G,r.setLineDash(F.borderDash),r.lineDashOffset=F.borderDashOffset,S=this.getDistanceFromCenterForValue(o.ticks.reverse?this.min:this.max),z=this.getPointPosition(T,S),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(z.x,z.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){const r=this.ctx,o=this.options,u=o.ticks;if(!u.display)return;const m=this.getIndexAngle(0);let _,b;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(m),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((T,S)=>{if(0===S&&!o.reverse)return;const z=u.setContext(this.getContext(S)),F=Gi(z.font);if(_=this.getDistanceFromCenterForValue(this.ticks[S].value),z.showLabelBackdrop){r.font=F.string,b=r.measureText(T.label).width,r.fillStyle=z.backdropColor;const G=tn(z.backdropPadding);r.fillRect(-b/2-G.left,-_-F.size/2-G.top,b+G.width,F.size+G.height)}In(r,T.label,0,-_,F,{color:z.color})}),r.restore()}drawTitle(){}}de(Ol,"id","radialLinear"),de(Ol,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:da.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:a=>a,padding:5,centerPointLabels:!1}}),de(Ol,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),de(Ol,"descriptors",{angleLines:{_fallback:"grid"}});const gu={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ji=Object.keys(gu);function Za(a,r){return a-r}function nh(a,r){if(Je(r))return null;const o=a._adapter,{parser:u,round:m,isoWeekday:_}=a._parseOpts;let b=r;return"function"==typeof u&&(b=u(b)),vi(b)||(b="string"==typeof u?o.parse(b,u):o.parse(b)),null===b?null:(m&&(b="week"!==m||!_e(_)&&!0!==_?o.startOf(b,m):o.startOf(b,"isoWeek",_)),+b)}function rh(a,r,o,u){const m=Ji.length;for(let _=Ji.indexOf(a);_<m-1;++_){const b=gu[Ji[_]];if(b.common&&Math.ceil((o-r)/((b.steps?b.steps:Number.MAX_SAFE_INTEGER)*b.size))<=u)return Ji[_]}return Ji[m-1]}function Qp(a,r,o){if(o){if(o.length){const{lo:u,hi:m}=vr(o,r);a[o[u]>=r?o[u]:o[m]]=!0}}else a[r]=!0}function ef(a,r,o){const u=[],m={},_=r.length;let b,T;for(b=0;b<_;++b)T=r[b],m[T]=b,u.push({value:T,major:!1});return 0!==_&&o?function tf(a,r,o,u){const m=a._adapter,_=+m.startOf(r[0].value,u),b=r[r.length-1].value;let T,S;for(T=_;T<=b;T=+m.add(T,1,u))S=o[T],S>=0&&(r[S].major=!0);return r}(a,u,m,o):u}class $a extends Ft{constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,o={}){const u=r.time||(r.time={}),m=this._adapter=new Lc__date(r.adapters.date);m.init(o),Vr(u.displayFormats,m.formats()),this._parseOpts={parser:u.parser,round:u.round,isoWeekday:u.isoWeekday},super.init(r),this._normalized=o.normalized}parse(r,o){return void 0===r?null:nh(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,o=this._adapter,u=r.time.unit||"day";let{min:m,max:_,minDefined:b,maxDefined:T}=this.getUserBounds();function S(z){!b&&!isNaN(z.min)&&(m=Math.min(m,z.min)),!T&&!isNaN(z.max)&&(_=Math.max(_,z.max))}(!b||!T)&&(S(this._getLabelBounds()),("ticks"!==r.bounds||"labels"!==r.ticks.source)&&S(this.getMinMax(!1))),m=vi(m)&&!isNaN(m)?m:+o.startOf(Date.now(),u),_=vi(_)&&!isNaN(_)?_:+o.endOf(Date.now(),u)+1,this.min=Math.min(m,_-1),this.max=Math.max(m+1,_)}_getLabelBounds(){const r=this.getLabelTimestamps();let o=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return r.length&&(o=r[0],u=r[r.length-1]),{min:o,max:u}}buildTicks(){const r=this.options,o=r.time,u=r.ticks,m="labels"===u.source?this.getLabelTimestamps():this._generate();"ticks"===r.bounds&&m.length&&(this.min=this._userMin||m[0],this.max=this._userMax||m[m.length-1]);const _=this.min,T=function Ms(a,r,o){let u=0,m=a.length;for(;u<m&&a[u]<r;)u++;for(;m>u&&a[m-1]>o;)m--;return u>0||m<a.length?a.slice(u,m):a}(m,_,this.max);return this._unit=o.unit||(u.autoSkip?rh(o.minUnit,this.min,this.max,this._getLabelCapacity(_)):function Pd(a,r,o,u,m){for(let _=Ji.length-1;_>=Ji.indexOf(o);_--){const b=Ji[_];if(gu[b].common&&a._adapter.diff(m,u,b)>=r-1)return b}return Ji[o?Ji.indexOf(o):0]}(this,T.length,o.minUnit,this.min,this.max)),this._majorUnit=u.major.enabled&&"year"!==this._unit?function Kp(a){for(let r=Ji.indexOf(a)+1,o=Ji.length;r<o;++r)if(gu[Ji[r]].common)return Ji[r]}(this._unit):void 0,this.initOffsets(m),r.reverse&&T.reverse(),ef(this,T,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(r=>+r.value))}initOffsets(r=[]){let m,_,o=0,u=0;this.options.offset&&r.length&&(m=this.getDecimalForValue(r[0]),o=1===r.length?1-m:(this.getDecimalForValue(r[1])-m)/2,_=this.getDecimalForValue(r[r.length-1]),u=1===r.length?_:(_-this.getDecimalForValue(r[r.length-2]))/2);const b=r.length<3?.5:.25;o=zt(o,0,b),u=zt(u,0,b),this._offsets={start:o,end:u,factor:1/(o+1+u)}}_generate(){const r=this._adapter,o=this.min,u=this.max,m=this.options,_=m.time,b=_.unit||rh(_.minUnit,o,u,this._getLabelCapacity(o)),T=Le(m.ticks.stepSize,1),S="week"===b&&_.isoWeekday,z=_e(S)||!0===S,F={};let W,nt,G=o;if(z&&(G=+r.startOf(G,"isoWeek",S)),G=+r.startOf(G,z?"day":b),r.diff(u,o,b)>1e5*T)throw new Error(o+" and "+u+" are too far apart with stepSize of "+T+" "+b);const gt="data"===m.ticks.source&&this.getDataTimestamps();for(W=G,nt=0;W<u;W=+r.add(W,T,b),nt++)Qp(F,W,gt);return(W===u||"ticks"===m.bounds||1===nt)&&Qp(F,W,gt),Object.keys(F).sort((_t,yt)=>_t-yt).map(_t=>+_t)}getLabelForValue(r){const u=this.options.time;return this._adapter.format(r,u.tooltipFormat?u.tooltipFormat:u.displayFormats.datetime)}format(r,o){return this._adapter.format(r,o||this.options.time.displayFormats[this._unit])}_tickFormatFunction(r,o,u,m){const _=this.options,b=_.ticks.callback;if(b)return _i(b,[r,o,u],this);const T=_.time.displayFormats,S=this._unit,z=this._majorUnit,G=z&&T[z],W=u[o];return this._adapter.format(r,m||(z&&G&&W&&W.major?G:S&&T[S]))}generateTickLabels(r){let o,u,m;for(o=0,u=r.length;o<u;++o)m=r[o],m.label=this._tickFormatFunction(m.value,o,r)}getDecimalForValue(r){return null===r?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const o=this._offsets,u=this.getDecimalForValue(r);return this.getPixelForDecimal((o.start+u)*o.factor)}getValueForPixel(r){const o=this._offsets,u=this.getDecimalForPixel(r)/o.factor-o.end;return this.min+u*(this.max-this.min)}_getLabelSize(r){const o=this.options.ticks,u=this.ctx.measureText(r).width,m=xe(this.isHorizontal()?o.maxRotation:o.minRotation),_=Math.cos(m),b=Math.sin(m),T=this._resolveTickFontOptions(0).size;return{w:u*_+T*b,h:u*b+T*_}}_getLabelCapacity(r){const o=this.options.time,u=o.displayFormats,m=u[o.unit]||u.millisecond,_=this._tickFormatFunction(r,0,ef(this,[r],this._majorUnit),m),b=this._getLabelSize(_),T=Math.floor(this.isHorizontal()?this.width/b.w:this.height/b.h)-1;return T>0?T:1}getDataTimestamps(){let o,u,r=this._cache.data||[];if(r.length)return r;const m=this.getMatchingVisibleMetas();if(this._normalized&&m.length)return this._cache.data=m[0].controller.getAllParsedValues(this);for(o=0,u=m.length;o<u;++o)r=r.concat(m[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let o,u;if(r.length)return r;const m=this.getLabels();for(o=0,u=m.length;o<u;++o)r.push(nh(this,m[o]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return Ve(r.sort(Za))}}function _u(a,r,o){let _,b,T,S,u=0,m=a.length-1;o?(r>=a[u].pos&&r<=a[m].pos&&({lo:u,hi:m}=br(a,"pos",r)),({pos:_,time:T}=a[u]),({pos:b,time:S}=a[m])):(r>=a[u].time&&r<=a[m].time&&({lo:u,hi:m}=br(a,"time",r)),({time:_,pos:T}=a[u]),({time:b,pos:S}=a[m]));const z=b-_;return z?T+(S-T)*(r-_)/z:T}de($a,"id","time"),de($a,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class oh extends $a{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),o=this._table=this.buildLookupTable(r);this._minPos=_u(o,this.min),this._tableRange=_u(o,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:o,max:u}=this,m=[],_=[];let b,T,S,z,F;for(b=0,T=r.length;b<T;++b)z=r[b],z>=o&&z<=u&&m.push(z);if(m.length<2)return[{time:o,pos:0},{time:u,pos:1}];for(b=0,T=m.length;b<T;++b)F=m[b+1],S=m[b-1],z=m[b],Math.round((F+S)/2)!==z&&_.push({time:z,pos:b/(T-1)});return _}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const o=this.getDataTimestamps(),u=this.getLabelTimestamps();return r=o.length&&u.length?this.normalize(o.concat(u)):o.length?o:u,r=this._cache.all=r,r}getDecimalForValue(r){return(_u(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const o=this._offsets,u=this.getDecimalForPixel(r)/o.factor-o.end;return _u(this._table,u*this._tableRange+this._minPos,!0)}}de(oh,"id","timeseries"),de(oh,"defaults",$a.defaults);const rf=[ka,Va,th,Object.freeze({__proto__:null,CategoryScale:pu,LinearScale:fu,LogarithmicScale:Lr,RadialLinearScale:Ol,TimeScale:$a,TimeSeriesScale:oh})];var qa=Ui(4671),of=Ui(4482),Fm=Ui(5403);function yu(a,r){return a===r}const xu=function Um(a,r){return a===r||a!=a&&r!=r},vu=function lf(a,r){for(var o=a.length;o--;)if(xu(a[o][0],r))return o;return-1};var Nm=Array.prototype.splice;function Ys(a){var r=-1,o=null==a?0:a.length;for(this.clear();++r<o;){var u=a[r];this.set(u[0],u[1])}}Ys.prototype.clear=function sf(){this.__data__=[],this.size=0},Ys.prototype.delete=function Vm(a){var r=this.__data__,o=vu(r,a);return!(o<0||(o==r.length-1?r.pop():Nm.call(r,o,1),--this.size,0))},Ys.prototype.get=function uf(a){var r=this.__data__,o=vu(r,a);return o<0?void 0:r[o][1]},Ys.prototype.has=function Dd(a){return vu(this.__data__,a)>-1},Ys.prototype.set=function tr(a,r){var o=this.__data__,u=vu(o,a);return u<0?(++this.size,o.push([a,r])):o[u][1]=r,this};const bu=Ys,ff="object"==typeof global&&global&&global.Object===Object&&global;var Wm="object"==typeof self&&self&&self.Object===Object&&self;const Nl=ff||Wm||Function("return this")();var Xm=Nl.Symbol,mf=Object.prototype,jl=mf.hasOwnProperty,Ym=mf.toString,zi=Xm?Xm.toStringTag:void 0;var Mu=Object.prototype.toString;var Cu=Xm?Xm.toStringTag:void 0;const Su=function Ld(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Cu&&Cu in Object(a)?function Tu(a){var r=jl.call(a,zi),o=a[zi];try{a[zi]=void 0;var u=!0}catch{}var m=Ym.call(a);return u&&(r?a[zi]=o:delete a[zi]),m}(a):function ah(a){return Mu.call(a)}(a)},co=function xf(a){var r=typeof a;return null!=a&&("object"==r||"function"==r)},Gl=function Od(a){if(!co(a))return!1;var r=Su(a);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r};var a,Qm=Nl["__core-js_shared__"],vf=(a=/[^.]+$/.exec(Qm&&Qm.keys&&Qm.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";var Au=Function.prototype.toString;var rg=/^\[object .+?Constructor\]$/,ag=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const cg=function lg(a){return!(!co(a)||function tg(a){return!!vf&&vf in a}(a))&&(Gl(a)?ag:rg).test(function ng(a){if(null!=a){try{return Au.call(a)}catch{}try{return a+""}catch{}}return""}(a))},Nd=function ku(a,r){var o=function Ud(a,r){return a?.[r]}(a,r);return cg(o)?o:void 0},$l=Nd(Nl,"Map"),ql=Nd(Object,"create");var Af=Object.prototype.hasOwnProperty;var pg=Object.prototype.hasOwnProperty;function ho(a){var r=-1,o=null==a?0:a.length;for(this.clear();++r<o;){var u=a[r];this.set(u[0],u[1])}}ho.prototype.clear=function hh(){this.__data__=ql?ql(null):{},this.size=0},ho.prototype.delete=function ug(a){var r=this.has(a)&&delete this.__data__[a];return this.size-=r?1:0,r},ho.prototype.get=function If(a){var r=this.__data__;if(ql){var o=r[a];return"__lodash_hash_undefined__"===o?void 0:o}return Af.call(r,a)?r[a]:void 0},ho.prototype.has=function zf(a){var r=this.__data__;return ql?void 0!==r[a]:pg.call(r,a)},ho.prototype.set=function Bn(a,r){var o=this.__data__;return this.size+=this.has(a)?0:1,o[a]=ql&&void 0===r?"__lodash_hash_undefined__":r,this};const Wl=ho,Pu=function gg(a,r){var o=a.__data__;return function fg(a){var r=typeof a;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==a:null===a}(r)?o["string"==typeof r?"string":"hash"]:o.map};function Hl(a){var r=-1,o=null==a?0:a.length;for(this.clear();++r<o;){var u=a[r];this.set(u[0],u[1])}}Hl.prototype.clear=function Df(){this.size=0,this.__data__={hash:new Wl,map:new($l||bu),string:new Wl}},Hl.prototype.delete=function _g(a){var r=Pu(this,a).delete(a);return this.size-=r?1:0,r},Hl.prototype.get=function Du(a){return Pu(this,a).get(a)},Hl.prototype.has=function Rf(a){return Pu(this,a).has(a)},Hl.prototype.set=function Of(a,r){var o=Pu(this,a),u=o.size;return o.set(a,r),this.size+=o.size==u?0:1,this};const bg=Hl;function Xl(a){var r=this.__data__=new bu(a);this.size=r.size}Xl.prototype.clear=function Gm(){this.__data__=new bu,this.size=0},Xl.prototype.delete=function Ul(a){var r=this.__data__,o=r.delete(a);return this.size=r.size,o},Xl.prototype.get=function pf(a){return this.__data__.get(a)},Xl.prototype.has=function sh(a){return this.__data__.has(a)},Xl.prototype.set=function Tg(a,r){var o=this.__data__;if(o instanceof bu){var u=o.__data__;if(!$l||u.length<199)return u.push([a,r]),this.size=++o.size,this;o=this.__data__=new bg(u)}return o.set(a,r),this.size=o.size,this};const yn=Xl;var Po=function(){try{var a=Nd(Object,"defineProperty");return a({},"",{}),a}catch{}}();const Yl=Po,Js=function Lu(a,r,o){"__proto__"==r&&Yl?Yl(a,r,{configurable:!0,enumerable:!0,value:o,writable:!0}):a[r]=o},Vd=function Eg(a,r,o){(void 0!==o&&!xu(a[r],o)||void 0===o&&!(r in a))&&Js(a,r,o)};var Mg=function dh(a){return function(r,o,u){for(var m=-1,_=Object(r),b=u(r),T=b.length;T--;){var S=b[a?T:++m];if(!1===o(_[S],S,_))break}return r}}();const ph=Mg;var jd="object"==typeof exports&&exports&&!exports.nodeType&&exports,Gd=jd&&"object"==typeof module&&module&&!module.nodeType&&module,Ru=Gd&&Gd.exports===jd?Nl.Buffer:void 0,Zd=Ru?Ru.allocUnsafe:void 0;const $d=Nl.Uint8Array,Ig=function Ag(a,r){var o=r?function Cg(a){var r=new a.constructor(a.byteLength);return new $d(r).set(new $d(a)),r}(a.buffer):a.buffer;return new a.constructor(o,a.byteOffset,a.length)};var Nf=Object.create,Pg=function(){function a(){}return function(r){if(!co(r))return{};if(Nf)return Nf(r);a.prototype=r;var o=new a;return a.prototype=void 0,o}}();const Dg=Pg;var Vf=function Bu(a,r){return function(o){return a(r(o))}}(Object.getPrototypeOf,Object);const jf=Vf;var Lg=Object.prototype;const Ou=function Rg(a){var r=a&&a.constructor;return a===("function"==typeof r&&r.prototype||Lg)},fs=function dr(a){return null!=a&&"object"==typeof a},mh=function Wd(a){return fs(a)&&"[object Arguments]"==Su(a)};var Zf=Object.prototype,$f=Zf.hasOwnProperty,qf=Zf.propertyIsEnumerable,Bg=mh(function(){return arguments}())?mh:function(a){return fs(a)&&$f.call(a,"callee")&&!qf.call(a,"callee")};const Fu=Bg,gh=Array.isArray,Hd=function Og(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=9007199254740991},Uu=function ms(a){return null!=a&&Hd(a.length)&&!Gl(a)};var Kf="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xd=Kf&&"object"==typeof module&&module&&!module.nodeType&&module,Ql=Xd&&Xd.exports===Kf?Nl.Buffer:void 0;const Nu=(Ql?Ql.isBuffer:void 0)||function Jf(){return!1};var Yd=Function.prototype.toString,ju=Object.prototype.hasOwnProperty,Gu=Yd.call(Object);var Ci={};Ci["[object Float32Array]"]=Ci["[object Float64Array]"]=Ci["[object Int8Array]"]=Ci["[object Int16Array]"]=Ci["[object Int32Array]"]=Ci["[object Uint8Array]"]=Ci["[object Uint8ClampedArray]"]=Ci["[object Uint16Array]"]=Ci["[object Uint32Array]"]=!0,Ci["[object Arguments]"]=Ci["[object Array]"]=Ci["[object ArrayBuffer]"]=Ci["[object Boolean]"]=Ci["[object DataView]"]=Ci["[object Date]"]=Ci["[object Error]"]=Ci["[object Function]"]=Ci["[object Map]"]=Ci["[object Number]"]=Ci["[object Object]"]=Ci["[object RegExp]"]=Ci["[object Set]"]=Ci["[object String]"]=Ci["[object WeakMap]"]=!1;var vh="object"==typeof exports&&exports&&!exports.nodeType&&exports,bh=vh&&"object"==typeof module&&module&&!module.nodeType&&module,qu=bh&&bh.exports===vh&&ff.process,Kg=function(){try{return bh&&bh.require&&bh.require("util").types||qu&&qu.binding&&qu.binding("util")}catch{}}(),lm=Kg&&Kg.isTypedArray;const hm=lm?function Jg(a){return function(r){return a(r)}}(lm):function $u(a){return fs(a)&&Hd(a.length)&&!!Ci[Su(a)]},ep=function um(a,r){if(("constructor"!==r||"function"!=typeof a[r])&&"__proto__"!=r)return a[r]};var Wu=Object.prototype.hasOwnProperty;const Xu=function Hu(a,r,o){var u=a[r];(!Wu.call(a,r)||!xu(u,o)||void 0===o&&!(r in a))&&Js(a,r,o)};var rp=/^(?:0|[1-9]\d*)$/;const wh=function dm(a,r){var o=typeof a;return!!(r=r??9007199254740991)&&("number"==o||"symbol"!=o&&rp.test(a))&&a>-1&&a%1==0&&a<r};var n_=Object.prototype.hasOwnProperty;const o_=function r_(a,r){var o=gh(a),u=!o&&Fu(a),m=!o&&!u&&Nu(a),_=!o&&!u&&!m&&hm(a),b=o||u||m||_,T=b?function np(a,r){for(var o=-1,u=Array(a);++o<a;)u[o]=r(o);return u}(a.length,String):[],S=T.length;for(var z in a)(r||n_.call(a,z))&&(!b||!("length"==z||m&&("offset"==z||"parent"==z)||_&&("buffer"==z||"byteLength"==z||"byteOffset"==z)||wh(z,S)))&&T.push(z);return T};var a_=Object.prototype.hasOwnProperty;const pm=function l_(a){if(!co(a))return function op(a){var r=[];if(null!=a)for(var o in Object(a))r.push(o);return r}(a);var r=Ou(a),o=[];for(var u in a)"constructor"==u&&(r||!a_.call(a,u))||o.push(u);return o},sp=function c_(a){return Uu(a)?o_(a,!0):pm(a)},Do=function Br(a){return function t_(a,r,o,u){var m=!o;o||(o={});for(var _=-1,b=r.length;++_<b;){var T=r[_],S=u?u(o[T],a[T],T,o,a):void 0;void 0===S&&(S=a[T]),m?Js(o,T,S):Xu(o,T,S)}return o}(a,sp(a))},Lo=function ea(a,r,o,u,m,_,b){var T=ep(a,o),S=ep(r,o),z=b.get(S);if(z)Vd(a,o,z);else{var F=_?_(T,S,o+"",a,r,b):void 0,G=void 0===F;if(G){var W=gh(S),nt=!W&&Nu(S),gt=!W&&!nt&&hm(S);F=S,W||nt||gt?gh(T)?F=T:function Xf(a){return fs(a)&&Uu(a)}(T)?F=function kg(a,r){var o=-1,u=a.length;for(r||(r=Array(u));++o<u;)r[o]=a[o];return r}(T):nt?(G=!1,F=function Uf(a,r){if(r)return a.slice();var o=a.length,u=Zd?Zd(o):new a.constructor(o);return a.copy(u),u}(S,!0)):gt?(G=!1,F=Ig(S,!0)):F=[]:function Ug(a){if(!fs(a)||"[object Object]"!=Su(a))return!1;var r=jf(a);if(null===r)return!0;var o=ju.call(r,"constructor")&&r.constructor;return"function"==typeof o&&o instanceof o&&Yd.call(o)==Gu}(S)||Fu(S)?(F=T,Fu(T)?F=Do(T):(!co(T)||Gl(T))&&(F=function qd(a){return"function"!=typeof a.constructor||Ou(a)?{}:Dg(jf(a))}(S))):G=!1}G&&(b.set(S,F),m(F,S,u,_,b),b.delete(S)),Vd(a,o,F)}},Yu=function gs(a,r,o,u,m){a!==r&&ph(r,function(_,b){if(m||(m=new yn),co(_))Lo(a,r,b,o,gs,u,m);else{var T=u?u(ep(a,b),_,b+"",a,r,m):void 0;void 0===T&&(T=_),Vd(a,b,T)}},sp)},ap=function fm(a){return a},lp=function mm(a,r,o){switch(o.length){case 0:return a.call(r);case 1:return a.call(r,o[0]);case 2:return a.call(r,o[0],o[1]);case 3:return a.call(r,o[0],o[1],o[2])}return a.apply(r,o)};var gm=Math.max;const vm=function xm(a){return function(){return a}};var bm=Yl?function(a,r){return Yl(a,"toString",{configurable:!0,enumerable:!1,value:vm(r),writable:!0})}:ap,Em=Date.now,nc=function Ju(a){var r=0,o=0;return function(){var u=Em(),m=16-(u-o);if(o=u,m>0){if(++r>=800)return arguments[0]}else r=0;return a.apply(void 0,arguments)}}(bm);const cp=nc,Ro=function hp(a,r){return cp(function _m(a,r,o){return r=gm(void 0===r?a.length-1:r,0),function(){for(var u=arguments,m=-1,_=gm(u.length-r,0),b=Array(_);++m<_;)b[m]=u[r+m];m=-1;for(var T=Array(r+1);++m<r;)T[m]=u[m];return T[r]=o(b),lp(a,this,T)}}(a,r,ap),a+"")};var Mm=function uo(a){return Ro(function(r,o){var u=-1,m=o.length,_=m>1?o[m-1]:void 0,b=m>2?o[2]:void 0;for(_=a.length>3&&"function"==typeof _?(m--,_):void 0,b&&function up(a,r,o){if(!co(o))return!1;var u=typeof r;return!!("number"==u?Uu(o)&&wh(r,o.length):"string"==u&&r in o)&&xu(o[r],a)}(o[0],o[1],b)&&(_=m<3?void 0:_,m=1),r=Object(r);++u<m;){var T=o[u];T&&a(r,T,u,_)}return r})}(function(a,r,o){Yu(a,r,o)});const pp=Mm;var Eh=Ui(1135);let Ku=(()=>{class a{constructor(){this.colorschemesOptions=new Eh.X(void 0)}setColorschemesOptions(o){this.pColorschemesOptions=o,this.colorschemesOptions.next(o)}getColorschemesOptions(){return this.pColorschemesOptions}}return a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=B.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Mh=(()=>{class a{constructor(o,u,m){this.zone=u,this.themeService=m,this.type="bar",this.plugins=[],this.chartClick=new B.vpe,this.chartHover=new B.vpe,this.subs=[],this.themeOverrides={},this.ctx=o.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(function Fl(a,r=qa.y){return a=a??yu,(0,of.e)((o,u)=>{let m,_=!0;o.subscribe((0,Fm.x)(u,b=>{const T=r(b);(_||!a(m,T))&&(_=!1,m=T,u.next(b))}))})}()).subscribe(_=>this.themeChanged(_)))}ngOnChanges(o){const u=["type"],m=Object.getOwnPropertyNames(o);if(m.some(_=>u.includes(_))||m.every(_=>o[_].isFirstChange()))this.render();else{const _=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,_.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,_.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,_.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(o=>o.unsubscribe())}render(){return this.chart&&this.chart.destroy(),this.zone.runOutsideAngular(()=>this.chart=new eo(this.ctx,this.getChartConfiguration()))}update(o){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(o))}hideDataset(o,u){this.chart&&(this.chart.getDatasetMeta(o).hidden=u,this.update())}isDatasetHidden(o){return this.chart?.getDatasetMeta(o)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(o){this.themeOverrides=o,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return pp({onHover:(o,u)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:o,active:u}))},onClick:(o,u)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:o,active:u}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions(),plugins:this.plugins}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}}return a.\u0275fac=function(o){return new(o||a)(B.Y36(B.SBq),B.Y36(B.R0b),B.Y36(Ku))},a.\u0275dir=B.lG2({type:a,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[B.TTD]}),a})();const Cm=[[255,99,132],[54,162,235],[255,206,86],[231,233,237],[75,192,192],[151,187,205],[220,220,220],[247,70,74],[70,191,189],[253,180,92],[148,159,177],[77,83,96]],h_={plugins:{colors:{enabled:!1}},datasets:{line:{backgroundColor:a=>_s(Bo(a.datasetIndex),.4),borderColor:a=>_s(Bo(a.datasetIndex),1),pointBackgroundColor:a=>_s(Bo(a.datasetIndex),1),pointBorderColor:"#fff"},bar:{backgroundColor:a=>_s(Bo(a.datasetIndex),.6),borderColor:a=>_s(Bo(a.datasetIndex),1)},get radar(){return this.line},doughnut:{backgroundColor:a=>_s(Bo(a.dataIndex),.6),borderColor:"#fff"},get pie(){return this.doughnut},polarArea:{backgroundColor:a=>_s(Bo(a.dataIndex),.6),borderColor:a=>_s(Bo(a.dataIndex),1)},get bubble(){return this.doughnut},get scatter(){return this.doughnut},get area(){return this.polarArea}}};function _s(a,r){return"rgba("+a.concat(r).join(",")+")"}function Qu(a,r){return Math.floor(Math.random()*(r-a+1))+a}function Bo(a=0){return Cm[a]||function u_(){return[Qu(0,255),Qu(0,255),Qu(0,255)]}()}let fp=(()=>{class a{constructor(){this.generateColors=!0}}return a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=B.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();eo.register(...rf);let Sm=(()=>{class a{constructor(o){o?.plugins&&eo.register(...o?.plugins);const u=pp(o?.generateColors?h_:{},o?.defaults||{});ki.set(u)}static forRoot(o){return{ngModule:a,providers:[{provide:fp,useValue:o}]}}}return a.\u0275fac=function(o){return new(o||a)(B.LFG(fp,8))},a.\u0275mod=B.oAB({type:a}),a.\u0275inj=B.cJS({}),a})();var e=Ui(7459);class t{constructor(){this.tittle="Contador App",this.base=5,this.total=10}increase(r){this.total+=r}decrease(r){this.total-=r}}t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=B.Xpm({type:t,selectors:[["app-counter"]],decls:18,vars:5,consts:[[1,"container","text-center"],[1,"row","align-items-center"],[1,"col"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Counter"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1)(5,"div",2)(6,"h2"),B._uU(7),B.qZA(),B.TgZ(8,"h4"),B._uU(9," Base: "),B.TgZ(10,"strong"),B._uU(11),B.qZA()(),B.TgZ(12,"button",3),B.NdJ("click",function(){return o.decrease(o.base)}),B._uU(13),B.qZA(),B.TgZ(14,"span"),B._uU(15),B.qZA(),B.TgZ(16,"button",3),B.NdJ("click",function(){return o.increase(o.base)}),B._uU(17),B.qZA()()()()),2&r&&(B.xp6(7),B.Oqu(o.tittle),B.xp6(4),B.hij(" ",o.base," "),B.xp6(2),B.hij(" - ",o.base," "),B.xp6(2),B.hij(" ",o.total," "),B.xp6(2),B.hij(" + ",o.base," "))},encapsulation:2});class i{constructor(){this._heroes=[{heroeName:"Iron Man",realName:"Tony Stark"},{heroeName:"Doctor Strange",realName:"Stephen Strange"}]}get heroes(){return[...this._heroes]}insertHeroe(r){this._heroes.push(r)}}i.\u0275fac=function(r){return new(r||i)},i.\u0275prov=B.Yz7({token:i,factory:i.\u0275fac});class s{constructor(r){this.heroeService=r,this.new={heroeName:"",realName:""}}insert(){0===this.new.heroeName.trim().length||0===this.new.realName.trim().length||(this.heroeService.insertHeroe(this.new),this.new={heroeName:"",realName:""})}}function c(a,r){if(1&a&&(B.TgZ(0,"tr")(1,"th",3),B._uU(2),B.qZA(),B.TgZ(3,"td"),B._uU(4),B.qZA(),B.TgZ(5,"td"),B._uU(6),B.qZA()()),2&a){const o=r.$implicit,u=r.index;B.xp6(2),B.Oqu(u+1),B.xp6(2),B.Oqu(o.heroeName),B.xp6(2),B.Oqu(o.realName)}}s.\u0275fac=function(r){return new(r||s)(B.Y36(i))},s.\u0275cmp=B.Xpm({type:s,selectors:[["app-heroe-detail"]],decls:7,vars:2,consts:[[3,"ngSubmit"],[1,"mb-3"],["type","text","name","nombre","placeholder","Heroe Name",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","poder","placeholder","Real Name",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary"]],template:function(r,o){1&r&&(B.TgZ(0,"form",0),B.NdJ("ngSubmit",function(){return o.insert()}),B.TgZ(1,"div",1)(2,"input",2),B.NdJ("ngModelChange",function(m){return o.new.heroeName=m}),B.qZA()(),B.TgZ(3,"div",1)(4,"input",3),B.NdJ("ngModelChange",function(m){return o.new.realName=m}),B.qZA()(),B.TgZ(5,"button",4),B._uU(6,"Submit"),B.qZA()()),2&r&&(B.xp6(2),B.Q6J("ngModel",o.new.heroeName),B.xp6(2),B.Q6J("ngModel",o.new.realName))},dependencies:[Bi._Y,Bi.Fj,Bi.JJ,Bi.JL,Bi.On,Bi.F],encapsulation:2});class p{get heroes(){return this.heroeService.heroes}constructor(r){this.heroeService=r}}p.\u0275fac=function(r){return new(r||p)(B.Y36(i))},p.\u0275cmp=B.Xpm({type:p,selectors:[["app-heroe-list"]],decls:11,vars:1,consts:[[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"]],template:function(r,o){1&r&&(B.TgZ(0,"table",0)(1,"thead")(2,"tr")(3,"th",1),B._uU(4,"#"),B.qZA(),B.TgZ(5,"th",1),B._uU(6,"Heroe Name"),B.qZA(),B.TgZ(7,"th",1),B._uU(8,"Real Name"),B.qZA()()(),B.TgZ(9,"tbody"),B.YNc(10,c,7,3,"tr",2),B.qZA()()),2&r&&(B.xp6(10),B.Q6J("ngForOf",o.heroes))},dependencies:[En.sg],encapsulation:2});class g{}g.\u0275fac=function(r){return new(r||g)},g.\u0275cmp=B.Xpm({type:g,selectors:[["app-heroe-main"]],decls:10,vars:0,consts:[[1,"container","text-center"],[1,"row","align-items-center"],[1,"col"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Heroes"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1)(5,"div",2),B._UZ(6,"app-heroe-list"),B.qZA()(),B.TgZ(7,"div",1)(8,"div",2),B._UZ(9,"app-heroe-detail"),B.qZA()()())},dependencies:[s,p],encapsulation:2});var x=Ui(529);class w{constructor(r){this.http=r,this.apiKey="CtbSNZMFPFlbWl1x5KQjtqPOHnE1ema5",this.apiUrl="https://api.giphy.com/v1/gifs",this.results=[],this.results=JSON.parse(localStorage.getItem("GifsServiceResults"))||[]}searchGifs(r=""){r=r.trim().toLocaleLowerCase();const o=(new x.LE).set("api_key",this.apiKey).set("limit","12").set("q",r);this.http.get(`${this.apiUrl}/search`,{params:o}).subscribe(u=>{this.results=u.data,localStorage.setItem("GifsServiceResults",JSON.stringify(this.results))})}}w.\u0275fac=function(r){return new(r||w)(B.LFG(x.eN))},w.\u0275prov=B.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"});const E=["txtSearch"];class A{constructor(r){this.gifsService=r}search(){const r=this.txtSearch.nativeElement.value;0!==r.trim().length&&(this.gifsService.searchGifs(r),this.txtSearch.nativeElement.value="")}}function k(a,r){if(1&a&&(B.TgZ(0,"div",2)(1,"div",3),B._UZ(2,"img",4),B.qZA()()),2&a){const o=r.$implicit;B.xp6(2),B.Q6J("src",o.images.downsized_medium.url,B.LSH)("alt",o.title)}}A.\u0275fac=function(r){return new(r||A)(B.Y36(w))},A.\u0275cmp=B.Xpm({type:A,selectors:[["app-gif-search"]],viewQuery:function(r,o){if(1&r&&B.Gf(E,5),2&r){let u;B.iGM(u=B.CRH())&&(o.txtSearch=u.first)}},decls:4,vars:0,consts:[["type","text","placeholder","...",1,"form-control",3,"keyup.enter"],["txtSearch",""]],template:function(r,o){1&r&&(B.TgZ(0,"h5"),B._uU(1,"Search:"),B.qZA(),B.TgZ(2,"input",0,1),B.NdJ("keyup.enter",function(){return o.search()}),B.qZA())},encapsulation:2});class P{get results(){return this.gifsService.results}constructor(r){this.gifsService=r}}P.\u0275fac=function(r){return new(r||P)(B.Y36(w))},P.\u0275cmp=B.Xpm({type:P,selectors:[["app-gif-results"]],decls:2,vars:1,consts:[[1,"row","row-cols-1","row-cols-md-4","g-4"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card"],[1,"card-img-top","mx-auto",3,"src","alt"]],template:function(r,o){1&r&&(B.TgZ(0,"div",0),B.YNc(1,k,3,2,"div",1),B.qZA()),2&r&&(B.xp6(1),B.Q6J("ngForOf",o.results))},dependencies:[En.sg],encapsulation:2});class R{}R.\u0275fac=function(r){return new(r||R)},R.\u0275cmp=B.Xpm({type:R,selectors:[["app-gif-main"]],decls:11,vars:0,consts:[[1,"container","text-center"],[1,"row","align-items-center"],[1,"col"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Gifs"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1)(5,"div",2),B._UZ(6,"app-gif-search"),B.qZA()(),B._UZ(7,"br"),B.TgZ(8,"div",1)(9,"div",2),B._UZ(10,"app-gif-results"),B.qZA()()())},dependencies:[A,P],encapsulation:2});class O{}O.\u0275fac=function(r){return new(r||O)},O.\u0275cmp=B.Xpm({type:O,selectors:[["app-country-main"]],decls:15,vars:0,consts:[[1,"container","text-center"],[1,"row","align-items-center"],[1,"col"],[1,"nav","nav-pills","nav-justified"],[1,"nav-item"],["routerLink","/examples/countries/countrybycapital","routerLinkActive","active","href","#",1,"nav-link"],["routerLink","/examples/countries/countrybyname","routerLinkActive","active","href","#",1,"nav-link"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Countries"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1)(5,"div",2)(6,"ul",3)(7,"li",4)(8,"a",5),B._uU(9,"By Capital"),B.qZA()(),B.TgZ(10,"li",4)(11,"a",6),B._uU(12,"By Name"),B.qZA()()()()(),B._UZ(13,"br")(14,"router-outlet"),B.qZA())},dependencies:[e.lC,e.rH,e.Od],encapsulation:2});var V=Ui(8505);class q{get httpParams(){return(new x.LE).set("fields","name,capital,alpha2Code,flag,population")}constructor(r){this.http=r,this.apiUrl="https://restcountries.com/v2"}searchByName(r){return this.http.get(`${this.apiUrl}/name/${r}`,{params:this.httpParams})}searchByCapital(r){return this.http.get(`${this.apiUrl}/capital/${r}`,{params:this.httpParams})}getCountryByAlpha(r){return this.http.get(`${this.apiUrl}/alpha/${r}`).pipe((0,V.b)(console.log))}}q.\u0275fac=function(r){return new(r||q)(B.LFG(x.eN))},q.\u0275prov=B.Yz7({token:q,factory:q.\u0275fac,providedIn:"root"});class et{constructor(){this.onEnter=new B.vpe,this.placeholder="",this.seachText=""}search(){this.onEnter.emit(this.seachText)}}et.\u0275fac=function(r){return new(r||et)},et.\u0275cmp=B.Xpm({type:et,selectors:[["app-country-search"]],inputs:{placeholder:"placeholder"},outputs:{onEnter:"onEnter"},decls:2,vars:2,consts:[["autocomplete","off",3,"ngSubmit"],["type","text","name","seachText",1,"form-control",3,"ngModel","placeholder","ngModelChange"]],template:function(r,o){1&r&&(B.TgZ(0,"form",0),B.NdJ("ngSubmit",function(){return o.search()}),B.TgZ(1,"input",1),B.NdJ("ngModelChange",function(m){return o.seachText=m}),B.qZA()()),2&r&&(B.xp6(1),B.Q6J("ngModel",o.seachText)("placeholder",o.placeholder))},dependencies:[Bi._Y,Bi.Fj,Bi.JJ,Bi.JL,Bi.On,Bi.F],encapsulation:2});const lt=function(a){return["/examples/countries/countrydetail",a]};function tt(a,r){if(1&a&&(B.TgZ(0,"tr")(1,"td"),B._uU(2),B.qZA(),B.TgZ(3,"td"),B._UZ(4,"img",2),B.qZA(),B.TgZ(5,"td"),B._uU(6),B.qZA(),B.TgZ(7,"td"),B._uU(8),B.ALo(9,"number"),B.qZA(),B.TgZ(10,"td")(11,"a",3),B._uU(12,"Details..."),B.qZA()()()),2&a){const o=r.$implicit,u=r.index;B.xp6(2),B.Oqu(u+1),B.xp6(2),B.Q6J("src",o.flag,B.LSH),B.xp6(2),B.AsE("",o.capital,", ",o.name,""),B.xp6(2),B.Oqu(B.lcZ(9,6,o.population)),B.xp6(3),B.Q6J("routerLink",B.VKq(8,lt,o.alpha2Code))}}class st{constructor(){this.countries=[]}}function dt(a,r){if(1&a&&(B.TgZ(0,"div",5),B._uU(1),B.qZA()),2&a){const o=B.oxw();B.xp6(1),B.hij(" Nothing was found for the term ",o.searchText,". ")}}function ht(a,r){if(1&a&&(B.TgZ(0,"div",6)(1,"div",1),B._UZ(2,"app-country-table",7),B.qZA()()),2&a){const o=B.oxw();B.xp6(2),B.Q6J("countries",o.countries)}}st.\u0275fac=function(r){return new(r||st)},st.\u0275cmp=B.Xpm({type:st,selectors:[["app-country-table"]],inputs:{countries:"countries"},decls:14,vars:1,consts:[[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"small-flag",3,"src"],[3,"routerLink"]],template:function(r,o){1&r&&(B.TgZ(0,"table",0)(1,"thead")(2,"tr")(3,"th"),B._uU(4,"#"),B.qZA(),B.TgZ(5,"th"),B._uU(6,"Bandera"),B.qZA(),B.TgZ(7,"th"),B._uU(8,"Nombre"),B.qZA(),B.TgZ(9,"th"),B._uU(10,"Poblaci\xf3n"),B.qZA(),B._UZ(11,"th"),B.qZA()(),B.TgZ(12,"tbody"),B.YNc(13,tt,13,10,"tr",1),B.qZA()()),2&r&&(B.xp6(13),B.Q6J("ngForOf",o.countries))},dependencies:[En.sg,e.rH,En.JJ],styles:[".small-flag[_ngcontent-%COMP%]{width:50px}"]});class St{constructor(r){this.countryServices=r,this.error=!1,this.searchText="",this.countries=[]}search(r){this.error=!1,this.searchText=r,this.countryServices.searchByCapital(r).subscribe({next:o=>{this.error=!1,this.countries=o},error:o=>{this.error=!0,this.countries=[]}})}}function Mt(a,r){if(1&a&&(B.TgZ(0,"div",5),B._uU(1),B.qZA()),2&a){const o=B.oxw();B.xp6(1),B.hij(" Nothing was found for the term ",o.searchText,". ")}}function Ot(a,r){if(1&a&&(B.TgZ(0,"div",6)(1,"div",1),B._UZ(2,"app-country-table",7),B.qZA()()),2&a){const o=B.oxw();B.xp6(2),B.Q6J("countries",o.countries)}}St.\u0275fac=function(r){return new(r||St)(B.Y36(q))},St.\u0275cmp=B.Xpm({type:St,selectors:[["app-country-by-capital"]],decls:13,vars:2,consts:[[1,"row","align-items-center"],[1,"col"],["placeholder","Country by Capital...",3,"onEnter"],["class","alert alert-danger",4,"ngIf"],["class","row",4,"ngIf"],[1,"alert","alert-danger"],[1,"row"],[3,"countries"]],template:function(r,o){1&r&&(B.TgZ(0,"div",0)(1,"div",1)(2,"h5"),B._uU(3,"Country by Capital"),B.qZA()()(),B._UZ(4,"br"),B.TgZ(5,"div",0)(6,"div",1)(7,"app-country-search",2),B.NdJ("onEnter",function(m){return o.search(m)}),B.qZA()()(),B._UZ(8,"br"),B.TgZ(9,"div",0)(10,"div",1),B.YNc(11,dt,2,1,"div",3),B.YNc(12,ht,3,1,"div",4),B.qZA()()),2&r&&(B.xp6(11),B.Q6J("ngIf",o.error),B.xp6(1),B.Q6J("ngIf",o.countries.length>0))},dependencies:[En.O5,et,st],encapsulation:2});class qt{constructor(r){this.countryServices=r,this.error=!1,this.searchText="",this.countries=[]}search(r){this.error=!1,this.searchText=r,this.countryServices.searchByName(r).subscribe({next:o=>{this.error=!1,this.countries=o},error:o=>{this.error=!0,this.countries=[]}})}}qt.\u0275fac=function(r){return new(r||qt)(B.Y36(q))},qt.\u0275cmp=B.Xpm({type:qt,selectors:[["app-country-by-name"]],decls:13,vars:2,consts:[[1,"row","align-items-center"],[1,"col"],["placeholder","Country by Name...",3,"onEnter"],["class","alert alert-danger",4,"ngIf"],["class","row",4,"ngIf"],[1,"alert","alert-danger"],[1,"row"],[3,"countries"]],template:function(r,o){1&r&&(B.TgZ(0,"div",0)(1,"div",1)(2,"h5"),B._uU(3,"Country by Name"),B.qZA()()(),B._UZ(4,"br"),B.TgZ(5,"div",0)(6,"div",1)(7,"app-country-search",2),B.NdJ("onEnter",function(m){return o.search(m)}),B.qZA()()(),B._UZ(8,"br"),B.TgZ(9,"div",0)(10,"div",1),B.YNc(11,Mt,2,1,"div",3),B.YNc(12,Ot,3,1,"div",4),B.qZA()()),2&r&&(B.xp6(11),B.Q6J("ngIf",o.error),B.xp6(1),B.Q6J("ngIf",o.countries.length>0))},dependencies:[En.O5,et,st],encapsulation:2});var Pt=Ui(3900);function Nt(a,r){1&a&&(B.TgZ(0,"div",2),B._uU(1,"Loading..."),B.qZA())}function Vt(a,r){if(1&a&&(B.TgZ(0,"div",3)(1,"div",4)(2,"h1"),B._uU(3," Country: "),B.TgZ(4,"small"),B._uU(5),B.qZA()()()(),B.TgZ(6,"div",3)(7,"div",5)(8,"h3"),B._uU(9,"Flag"),B.qZA(),B._UZ(10,"img",6),B.qZA(),B.TgZ(11,"div",7)(12,"h3"),B._uU(13,"Data"),B.qZA(),B.TgZ(14,"ul",8)(15,"li",9)(16,"strong"),B._uU(17,"Capital"),B.qZA(),B._uU(18),B.qZA(),B.TgZ(19,"li",9)(20,"strong"),B._uU(21,"Population"),B.qZA(),B._uU(22),B.ALo(23,"number"),B.qZA(),B.TgZ(24,"li",9)(25,"strong"),B._uU(26,"Area"),B.qZA(),B._uU(27),B.ALo(28,"number"),B.qZA()()()()),2&a){const o=B.oxw();B.xp6(5),B.Oqu(o.country.name),B.xp6(5),B.Q6J("src",o.country.flag,B.LSH),B.xp6(8),B.hij(" ",o.country.capital," "),B.xp6(4),B.hij(" ",B.lcZ(23,5,o.country.population)," "),B.xp6(5),B.hij(" ",B.lcZ(28,7,o.country.area)," km2 ")}}class Gt{constructor(r,o){this.activatedRoute=r,this.countriesService=o}ngOnInit(){this.activatedRoute.params.pipe((0,Pt.w)(({id:r})=>this.countriesService.getCountryByAlpha(r))).subscribe(r=>this.country=r)}}Gt.\u0275fac=function(r){return new(r||Gt)(B.Y36(e.gz),B.Y36(q))},Gt.\u0275cmp=B.Xpm({type:Gt,selectors:[["app-country-detail"]],decls:3,vars:2,consts:[["class","alert alert-info",4,"ngIf","ngIfElse"],["divCountry",""],[1,"alert","alert-info"],[1,"row"],[1,"col-12"],[1,"col-4"],[1,"img-thumbnail",3,"src"],[1,"col"],[1,"list-group"],[1,"list-group-item"]],template:function(r,o){if(1&r&&(B.YNc(0,Nt,2,0,"div",0),B.YNc(1,Vt,29,9,"ng-template",null,1,B.W1O)),2&r){const u=B.MAs(2);B.Q6J("ngIf",!o.country)("ngIfElse",u)}},dependencies:[En.O5,En.JJ],encapsulation:2});var Ht=Ui(9646),Lt=Ui(9841);class Qt{constructor(r){this.http=r,this._apiUrl="https://restcountries.com/v3.1",this._regions=["Africa","Americas","Asia","Europe","Oceania"]}get regions(){return[...this._regions]}getCountriesByRegion(r){return this.http.get(`${this._apiUrl}/region/${r}?fields=cioc,name`)}getCountryByCode(r){return this.http.get(`${this._apiUrl}/alpha/${r}?fields=cioc,name`)}getCountryBordersByCode(r){return r?this.http.get(`${this._apiUrl}/alpha/${r}?fields=cioc,name,borders`):(0,Ht.of)(null)}getCountriesByCodes(r){if(!r||0==r.length)return(0,Ht.of)([]);const o=[];return r.forEach(u=>{o.push(this.getCountryByCode(u))}),(0,Lt.a)(o)}}function Te(a,r){if(1&a&&(B.TgZ(0,"option",11),B.ALo(1,"lowercase"),B._uU(2),B.qZA()),2&a){const o=r.$implicit;B.Q6J("value",B.lcZ(1,2,o)),B.xp6(2),B.hij(" ",o," ")}}function oe(a,r){if(1&a&&(B.TgZ(0,"option",11),B._uU(1),B.qZA()),2&a){const o=r.$implicit;B.Q6J("value",o.cioc),B.xp6(1),B.hij(" ",o.name.common," ")}}function pe(a,r){if(1&a&&(B.TgZ(0,"div",12)(1,"div",3)(2,"label",4),B._uU(3,"Country:"),B.qZA(),B.TgZ(4,"select",13)(5,"option",6),B._uU(6,"-- Select country --"),B.qZA(),B.YNc(7,oe,2,2,"option",7),B.qZA()()()),2&a){const o=B.oxw();B.xp6(7),B.Q6J("ngForOf",o.countries)}}function ne(a,r){if(1&a&&(B.TgZ(0,"option",11),B._uU(1),B.qZA()),2&a){const o=r.$implicit;B.Q6J("value",o.cioc),B.xp6(1),B.hij(" ",o.name.common," ")}}function Me(a,r){if(1&a&&(B.TgZ(0,"div",12)(1,"div",3)(2,"label",4),B._uU(3,"Borders:"),B.qZA(),B.TgZ(4,"select",14)(5,"option",6),B._uU(6,"-- Select border --"),B.qZA(),B.YNc(7,ne,2,2,"option",7),B.qZA()()()),2&a){const o=B.oxw();B.xp6(7),B.Q6J("ngForOf",o.borders)}}function Ge(a,r){1&a&&(B.TgZ(0,"div",2)(1,"div",3)(2,"div",15),B._uU(3,"Loading..."),B.qZA()()())}Qt.\u0275fac=function(r){return new(r||Qt)(B.LFG(x.eN))},Qt.\u0275prov=B.Yz7({token:Qt,factory:Qt.\u0275fac,providedIn:"root"});class Be{get regions(){return[...this.countriesService.regions]}constructor(r,o){this.fb=r,this.countriesService=o,this.myForm=this.fb.group({region:[""],country:[""],border:[""]}),this.countries=[],this.borders=[],this.loading=!1}ngOnInit(){this.myForm.get("region")?.valueChanges.pipe((0,V.b)(r=>{this.myForm.get("country")?.reset(""),this.loading=!0}),(0,Pt.w)(r=>this.countriesService.getCountriesByRegion(r))).subscribe(r=>{this.countries=r,this.loading=!1}),this.myForm.get("country")?.valueChanges.pipe((0,V.b)(()=>{this.myForm.get("border")?.reset(""),this.loading=!0}),(0,Pt.w)(r=>this.countriesService.getCountryBordersByCode(r)),(0,Pt.w)(r=>this.countriesService.getCountriesByCodes(r?.borders))).subscribe(r=>{this.borders=r,this.loading=!1})}submit(){console.log(this.myForm.value)}}Be.\u0275fac=function(r){return new(r||Be)(B.Y36(Bi.qu),B.Y36(Qt))},Be.\u0275cmp=B.Xpm({type:Be,selectors:[["app-selectors-main"]],decls:25,vars:8,consts:[[1,"container"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col"],[1,"form-label"],["formControlName","region",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","row mb-3",4,"ngIf"],["class","row",4,"ngIf"],["type","submit",1,"btn","btn-primary","float-end"],[3,"value"],[1,"row","mb-3"],["formControlName","country",1,"form-control"],["formControlName","border",1,"form-control"],[1,"alert","alert-primary"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Selectors"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"form",1),B.NdJ("ngSubmit",function(){return o.submit()}),B.TgZ(5,"div",2)(6,"div",3)(7,"label",4),B._uU(8,"Regions:"),B.qZA(),B.TgZ(9,"select",5)(10,"option",6),B._uU(11,"-- Select region --"),B.qZA(),B.YNc(12,Te,3,4,"option",7),B.qZA()()(),B.YNc(13,pe,8,1,"div",8),B.YNc(14,Me,8,1,"div",8),B.YNc(15,Ge,4,0,"div",9),B.TgZ(16,"div",2)(17,"div",3)(18,"button",10),B._uU(19,"Submit"),B.qZA()()()(),B.TgZ(20,"h3"),B._uU(21,"Form"),B.qZA(),B.TgZ(22,"pre"),B._uU(23),B.ALo(24,"json"),B.qZA()()),2&r&&(B.xp6(4),B.Q6J("formGroup",o.myForm),B.xp6(8),B.Q6J("ngForOf",o.regions),B.xp6(1),B.Q6J("ngIf",0!==o.countries.length),B.xp6(1),B.Q6J("ngIf",o.borders.length>0),B.xp6(1),B.Q6J("ngIf",o.loading),B.xp6(8),B.Oqu(B.lcZ(24,6,o.myForm.value)))},dependencies:[En.sg,En.O5,Bi._Y,Bi.YN,Bi.Kr,Bi.EJ,Bi.JJ,Bi.JL,Bi.sg,Bi.u,En.i8,En.Ts],encapsulation:2});class De{constructor(){this.barChartData={labels:["2005","2006","2007","2008","2009","2010","2011","2012"],datasets:[{data:[0,0,0,0,0,0,0,0],label:"Series A"},{data:[0,0,0,0,0,0,0,0],label:"Series B"}]},this.barChartOptions={responsive:!0},this.barChartType="bar",this.randomize()}chartClicked({event:r,active:o}){console.log(r,o)}chartHovered({event:r,active:o}){console.log(r,o)}randomize(){for(let r=0;r<this.barChartData.datasets.length;r++)this.barChartData.datasets[r].data=[Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random()),Math.round(100*Math.random())];this.chart?.update()}}De.\u0275fac=function(r){return new(r||De)},De.\u0275cmp=B.Xpm({type:De,selectors:[["app-chart-bar"]],viewQuery:function(r,o){if(1&r&&B.Gf(Mh,5),2&r){let u;B.iGM(u=B.CRH())&&(o.chart=u.first)}},decls:4,vars:3,consts:[[2,"display","block"],["baseChart","",1,"chart",3,"data","options","type","chartHover","chartClick"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(r,o){1&r&&(B.TgZ(0,"div",0)(1,"canvas",1),B.NdJ("chartHover",function(m){return o.chartHovered(m)})("chartClick",function(m){return o.chartClicked(m)}),B.qZA(),B.TgZ(2,"button",2),B.NdJ("click",function(){return o.randomize()}),B._uU(3," Randomize "),B.qZA()()),2&r&&(B.xp6(1),B.Q6J("data",o.barChartData)("options",o.barChartOptions)("type",o.barChartType))},dependencies:[Mh],encapsulation:2});class we{constructor(){this.lineChartData={datasets:[{data:[0,0,0,0,0,0,0],label:"Series A",backgroundColor:"rgba(148,159,177,0.2)",borderColor:"rgba(148,159,177,1)",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(148,159,177,0.8)",fill:"origin"},{data:[0,0,0,0,0,0,0],label:"Series B",backgroundColor:"rgba(77,83,96,0.2)",borderColor:"rgba(77,83,96,1)",pointBackgroundColor:"rgba(77,83,96,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(77,83,96,1)",fill:"origin"},{data:[0,0,0,0,0,0,0],label:"Series C",backgroundColor:"rgba(255,0,0,0.2)",borderColor:"rgba(255,0,0,1)",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(148,159,177,0.8)",fill:"origin"}],labels:["January","February","March","April","May","June","July"]},this.lineChartOptions={elements:{line:{tension:.5}}},this.lineChartType="line",this.randomize()}chartClicked({event:r,active:o}){console.log(r,o)}chartHovered({event:r,active:o}){console.log(r,o)}randomize(){for(let r=0;r<this.lineChartData.datasets.length;r++)for(let o=0;o<this.lineChartData.datasets[r].data.length;o++)this.lineChartData.datasets[r].data[o]=Math.floor(1e3*Math.random()+1);this.chart?.update()}}we.\u0275fac=function(r){return new(r||we)},we.\u0275cmp=B.Xpm({type:we,selectors:[["app-chart-line"]],viewQuery:function(r,o){if(1&r&&B.Gf(Mh,5),2&r){let u;B.iGM(u=B.CRH())&&(o.chart=u.first)}},decls:4,vars:3,consts:[[2,"display","block"],["baseChart","",1,"chart",3,"data","options","type","chartHover","chartClick"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(r,o){1&r&&(B.TgZ(0,"div",0)(1,"canvas",1),B.NdJ("chartHover",function(m){return o.chartHovered(m)})("chartClick",function(m){return o.chartClicked(m)}),B.qZA(),B.TgZ(2,"button",2),B.NdJ("click",function(){return o.randomize()}),B._uU(3," Randomize "),B.qZA()()),2&r&&(B.xp6(1),B.Q6J("data",o.lineChartData)("options",o.lineChartOptions)("type",o.lineChartType))},dependencies:[Mh],encapsulation:2});class ii{}ii.\u0275fac=function(r){return new(r||ii)},ii.\u0275cmp=B.Xpm({type:ii,selectors:[["app-charts-main"]],decls:20,vars:0,consts:[[1,"row"],[1,"col-md-6"],["href","https://valor-software.com/ng2-charts","target","_blank"],["href","https://valor-software.com/ng2-charts/#BarChart","target","_blank"],["href","https://valor-software.com/ng2-charts/#LineChart","target","_blank"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Charts"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1),B._UZ(5,"app-chart-bar"),B.qZA(),B.TgZ(6,"div",1),B._UZ(7,"app-chart-line"),B.qZA(),B.TgZ(8,"div",1),B._UZ(9,"br"),B.TgZ(10,"h4"),B._uU(11,"References"),B.qZA(),B.TgZ(12,"a",2),B._uU(13,"https://valor-software.com/ng2-charts"),B.qZA(),B._UZ(14,"br"),B.TgZ(15,"a",3),B._uU(16,"https://valor-software.com/ng2-charts/#BarChart"),B.qZA(),B._UZ(17,"br"),B.TgZ(18,"a",4),B._uU(19,"https://valor-software.com/ng2-charts/#LineChart"),B.qZA()()())},dependencies:[De,we],encapsulation:2});var Se=Ui(2340),Fe=Ui(9898),hi=Ui(7579);const Mi=["mapa"];class li{constructor(){this.lngLat=[0,0]}ngAfterViewInit(){const r=new Fe.Map({container:this.divMapa.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:this.lngLat,zoom:15,interactive:!1});(new Fe.Marker).setLngLat(this.lngLat).addTo(r)}}li.\u0275fac=function(r){return new(r||li)},li.\u0275cmp=B.Xpm({type:li,selectors:[["app-map-small"]],viewQuery:function(r,o){if(1&r&&B.Gf(Mi,5),2&r){let u;B.iGM(u=B.CRH())&&(o.divMapa=u.first)}},inputs:{lngLat:"lngLat"},decls:2,vars:0,consts:[["mapa",""]],template:function(r,o){1&r&&B._UZ(0,"div",null,0)},styles:["div[_ngcontent-%COMP%]{width:100%;height:150px;margin:0}"]});class ui{constructor(){this.initialPlace=[0,0],this.goPlace=new hi.x}ngOnInit(){var r=new Fe.Map({container:"mapa",style:"mapbox://styles/mapbox/streets-v11",center:this.initialPlace,zoom:15});this.goPlace.subscribe(o=>{r.flyTo({center:o})})}}function Si(a,r){if(1&a){const o=B.EpF();B.TgZ(0,"div",6)(1,"div",7),B._UZ(2,"app-map-small",8),B.TgZ(3,"div",9)(4,"p",10),B._uU(5),B.qZA(),B.TgZ(6,"a",11),B.NdJ("click",function(m){const b=B.CHM(o).$implicit,T=B.oxw();return B.KtG(T.go(m,b.lngLat))}),B._uU(7,"Go"),B.qZA()()()()}if(2&a){const o=r.$implicit;B.xp6(2),B.Q6J("lngLat",o.lngLat),B.xp6(3),B.Oqu(o.title)}}ui.\u0275fac=function(r){return new(r||ui)},ui.\u0275cmp=B.Xpm({type:ui,selectors:[["app-map-full"]],inputs:{initialPlace:"initialPlace",goPlace:"goPlace"},decls:1,vars:0,consts:[["id","mapa"]],template:function(r,o){1&r&&B._UZ(0,"div",0)},styles:["#mapa[_ngcontent-%COMP%]{height:350px;width:100%}"]});class Ai{constructor(){this.initialPlace=[-84.079629850278,9.932810948514314],this.goPlace=new hi.x,this.places=[{title:"Katana, Canad\xe1",lngLat:[-75.92722289474008,45.280015511264466]},{title:"Acapulco, M\xe9xico",lngLat:[-99.91287720907991,16.828940930185748]},{title:"Buenos Aires, Argentina",lngLat:[-58.430166677283445,-34.57150108832866]}]}ngOnInit(){Fe.accessToken=Se.N.mapboxToken}go(r,o){r.preventDefault(),this.goPlace.next(o)}}Ai.\u0275fac=function(r){return new(r||Ai)},Ai.\u0275cmp=B.Xpm({type:Ai,selectors:[["app-maps-main"]],decls:15,vars:3,consts:[[1,"row"],[1,"col"],["class","col-4 mb-2",4,"ngFor","ngForOf"],[1,"col-12"],[3,"initialPlace","goPlace"],["href","https://docs.mapbox.com/mapbox-gl-js/guides/install","target","_blank"],[1,"col-4","mb-2"],[1,"card"],[1,"card-img-top",3,"lngLat"],[1,"card-body"],[1,"card-text"],["href","#",1,"btn","btn-primary",3,"click"]],template:function(r,o){1&r&&(B.TgZ(0,"h2"),B._uU(1,"Examples / Maps"),B.qZA(),B._UZ(2,"hr"),B.TgZ(3,"div",0)(4,"div",1)(5,"div",0),B.YNc(6,Si,8,2,"div",2),B.qZA()(),B.TgZ(7,"div",3),B._UZ(8,"app-map-full",4),B.qZA(),B.TgZ(9,"div",3),B._UZ(10,"br"),B.TgZ(11,"h4"),B._uU(12,"References"),B.qZA(),B.TgZ(13,"a",5),B._uU(14,"https://docs.mapbox.com/mapbox-gl-js/guides/install"),B.qZA()()()),2&r&&(B.xp6(6),B.Q6J("ngForOf",o.places),B.xp6(2),B.Q6J("initialPlace",o.initialPlace)("goPlace",o.goPlace))},dependencies:[En.sg,li,ui],styles:[".mapboxgl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:#0000000d}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E\")}}@keyframes mapboxgl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:#ffffff80;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:#0000000d}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:#000000bf;text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:#0000000d}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:\"\";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid transparent;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid transparent;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:rgba(0,0,0,.7);color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}\n"],encapsulation:2});const di=[{path:"",component:Ui(7556).c,children:[{path:"counter",component:t},{path:"heroes",component:g},{path:"gifs",component:R},{path:"countries",component:O,children:[{path:"countrybycapital",component:St},{path:"countrybyname",component:qt},{path:"countrydetail/:id",component:Gt}]},{path:"selectors",component:Be},{path:"charts",component:ii},{path:"maps",component:Ai}]}];class Pi{}Pi.\u0275fac=function(r){return new(r||Pi)},Pi.\u0275mod=B.oAB({type:Pi}),Pi.\u0275inj=B.cJS({imports:[e.Bz.forChild(di),e.Bz]});var qi=Ui(4466);class $e{}$e.\u0275fac=function(r){return new(r||$e)},$e.\u0275mod=B.oAB({type:$e}),$e.\u0275inj=B.cJS({providers:[i,w,q,qi.m],imports:[En.ez,Bi.u5,Bi.UX,Sm,Pi]})},9898:function(d_){d_.exports=function(){"use strict";var Xa,Ui,En;function Bi(h,Xt){if(Xa)if(Ui){var Or="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Xa+")(sharedChunk); ("+Ui+")(sharedChunk); self.onerror = null;",de={};Xa(de),En=Xt(de),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(En.workerUrl=window.URL.createObjectURL(new Blob([Or],{type:"text/javascript"})))}else Ui=Xt;else Xa=Xt}return Bi(0,function(h){var Xt=typeof self<"u"?self:{},Or="2.13.0";let de;const ze={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==de){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{de=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch{de=e}}return de},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Pe={supported:!1,testSupport:function(e){!hn&&Mn&&(On?xs(e):Wi=e)}};let Wi,Mn,hn=!1,On=!1;function xs(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Mn),e.isContextLost())return;Pe.supported=!0}catch{}e.deleteTexture(t),hn=!0}Xt.document&&(Mn=Xt.document.createElement("img"),Mn.onload=function(){Wi&&xs(Wi),Wi=null,On=!0},Mn.onerror=function(){hn=!0,Wi=null},Mn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ni="01";var po=vs;function vs(e,t,i,s){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=s}vs.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,s=0;s<8;s++){var c=this.sampleCurveX(i)-e;if(Math.abs(c)<t)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=c/p}var g=0,x=1;for(i=e,s=0;s<20&&(c=this.sampleCurveX(i),!(Math.abs(c-e)<t));s++)e>c?g=i:x=i,i=.5*(x-g)+g;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var ie=Cn;function Cn(e,t){this.x=e,this.y=t}Cn.prototype={clone:function(){return new Cn(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),s=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=s,this},_rotateAround:function(e,t){var i=Math.cos(e),s=Math.sin(e),c=t.y+s*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-s*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Cn.convert=function(e){return e instanceof Cn?e:Array.isArray(e)?new Cn(e[0],e[1]):e};const na=Math.PI/180,Oo=180/Math.PI;function Xe(e){return e*na}function en(e){return e*Oo}const ra=[[0,0],[1,0],[1,1],[0,1]];function oa(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function sa(e,t,i,s){const c=new po(e,t,i,s);return function(p){return c.solve(p)}}const oc=sa(.25,.1,.25,1);function Ue(e,t,i){return Math.min(i,Math.max(t,e))}function fo(e,t,i){return(i=Ue((i-e)/(t-e),0,1))*i*(3-2*i)}function Fr(e,t,i){const s=i-t,c=((e-t)%s+s)%s+t;return c===t?i:c}function mo(e,t,i){if(!e.length)return i(null,[]);let s=e.length;const c=new Array(e.length);let p=null;e.forEach((g,x)=>{t(g,(w,E)=>{w&&(p=w),c[x]=E,0==--s&&i(p,c)})})}function go(e){const t=[];for(const i in e)t.push(e[i]);return t}function Hi(e,...t){for(const i of t)for(const s in i)e[s]=i[s];return e}let Ur=1;function bs(){return Ur++}function pr(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function fr(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Fo(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Nr(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function mr(e,t){return-1!==e.indexOf(t,e.length-t.length)}function qn(e,t,i){const s={};for(const c in e)s[c]=t.call(i||this,e[c],c,e);return s}function Uo(e,t,i){const s={};for(const c in e)t.call(i||this,e[c],c,e)&&(s[c]=e[c]);return s}function Fn(e){return Array.isArray(e)?e.map(Fn):"object"==typeof e&&e?qn(e,Fn):e}const Ya={};function Oi(e){Ya[e]||(typeof console<"u"&&console.warn(e),Ya[e]=!0)}function Un(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function qe(e){let t=0;for(let i,s,c=0,p=e.length,g=p-1;c<p;g=c++)i=e[c],s=e[g],t+=(s.x-i.x)*(i.y+s.y);return t}function nr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function rr(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,c,p)=>{const g=c||p;return t[s]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let ws=null;function gr(e){if(null==ws){const t=e.navigator?e.navigator.userAgent:null;ws=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ws}function aa(e){try{const t=Xt[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Wn(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const la="mapbox-tiles";let Qi,_r,Je=500,gi=50;function We(){try{return Xt.caches}catch{}}function vi(){We()&&!Qi&&(Qi=Xt.caches.open(la))}function nn(e){const t=e.indexOf("?");if(t<0)return e;const s=function(c){const p=c.indexOf("?");return p>0?c.slice(p+1).split("&"):[]}(e).filter(c=>{const p=c.split("=");return"language"===p[0]||"worldview"===p[0]});return s.length?`${e.slice(0,t)}?${s.join("&")}`:e.slice(0,t)}let Le=1/0;const Ts={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ts);class Sn extends Error{constructor(t,i,s){401===i&&yo(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _i=nr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Xt.location.protocol?Xt.parent:Xt).location.href,Qe=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(_i())&&!/^\w+:/.test(i))){if(Xt.fetch&&Xt.Request&&Xt.AbortController&&Xt.Request.prototype.hasOwnProperty("signal"))return function(s,c){const p=new Xt.AbortController,g=new Xt.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:_i(),signal:p.signal});let x=!1,w=!1;const E=(A=g.url).indexOf("sku=")>0&&yo(A);var A;"json"===s.type&&g.headers.set("Accept","application/json");const k=(R,O,V)=>{if(w)return;if(R&&"SecurityError"!==R.message&&Oi(R),O&&V)return P(O);const q=Date.now();Xt.fetch(g).then(et=>{if(et.ok){const lt=E?et.clone():null;return P(et,lt,q)}return c(new Sn(et.statusText,et.status,s.url))}).catch(et=>{"AbortError"!==et.name&&c(new Error(`${et.message} ${s.url}`))})},P=(R,O,V)=>{("arrayBuffer"===s.type?R.arrayBuffer():"json"===s.type?R.json():R.text()).then(q=>{w||(O&&V&&function(et,lt,tt){if(vi(),!Qi)return;const st={status:lt.status,statusText:lt.statusText,headers:new Xt.Headers};lt.headers.forEach((St,Mt)=>st.headers.set(Mt,St));const dt=rr(lt.headers.get("Cache-Control")||"");if(dt["no-store"])return;dt["max-age"]&&st.headers.set("Expires",new Date(tt+1e3*dt["max-age"]).toUTCString());const ht=st.headers.get("Expires");ht&&(new Date(ht).getTime()-tt<42e4||function(St,Mt){if(void 0===_r)try{new Response(new ReadableStream),_r=!0}catch{_r=!1}_r?Mt(St.body):St.blob().then(Mt)}(lt,St=>{const Mt=new Xt.Response(St,st);vi(),Qi&&Qi.then(Ot=>Ot.put(nn(et.url),Mt)).catch(Ot=>Oi(Ot.message))}))}(g,O,V),x=!0,c(null,q,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(q=>{w||c(new Error(q.message))})};return E?function(R,O){if(vi(),!Qi)return O(null);const V=nn(R.url);Qi.then(q=>{q.match(V).then(et=>{const lt=function(tt){if(!tt)return!1;const st=new Date(tt.headers.get("Expires")||0),dt=rr(tt.headers.get("Cache-Control")||"");return st>Date.now()&&!dt["no-cache"]}(et);q.delete(V),lt&&q.put(V,et.clone()),O(null,et,lt)}).catch(O)}).catch(O)}(g,k):k(null,null),{cancel:()=>{w=!0,x||p.abort()}}}(e,t);if(nr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(s,c){const p=new Xt.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(p.responseType="arraybuffer");for(const g in s.headers)p.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===s.credentials,p.onerror=()=>{c(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let g=p.response;if("json"===s.type)try{g=JSON.parse(p.response)}catch(x){return c(x)}c(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else c(new Sn(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(e,t)},yr=function(e,t){return Qe(Hi(e,{type:"arrayBuffer"}),t)};function _o(e){const t=Xt.document.createElement("a");return t.href=e,t.protocol===Xt.document.location.protocol&&t.host===Xt.document.location.host}const No="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Es,or;Es=[],or=0;const Vr=function(e,t){if(Pe.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),or>=ze.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Es.push(p),p}or++;let i=!1;const s=()=>{if(!i)for(i=!0,or--;Es.length&&or<ze.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Es.shift(),{requestParameters:g,callback:x,cancelled:w}=p;w||(p.cancel=Vr(g,x).cancel)}},c=yr(e,(p,g,x,w)=>{s(),p?t(p):g&&(Xt.createImageBitmap?function(E,A){const k=new Xt.Blob([new Uint8Array(E)],{type:"image/png"});Xt.createImageBitmap(k).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,A)=>t(E,A,x,w)):function(E,A){const k=new Xt.Image,P=Xt.URL;k.onload=()=>{A(null,k),P.revokeObjectURL(k.src),k.onload=null,Xt.requestAnimationFrame(()=>{k.src=No})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Xt.Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?P.createObjectURL(R):No}(g,(E,A)=>t(E,A,x,w)))});return{cancel:()=>{c.cancel(),s()}}},Vo="NO_ACCESS_TOKEN";function xr(e){return 0===e.indexOf("mapbox:")}function yo(e){return ze.API_URL_REGEX.test(e)}function Ja(e){return ze.API_CDN_URL_REGEX.test(e)}function Ka(e){return ze.API_STYLE_REGEX.test(e)&&!Nn(e)}function Nn(e){return ze.API_SPRITE_REGEX.test(e)}const jr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Di(e){const t=e.match(jr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function xn(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function ca(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(Xt.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class jo{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=ca(ze.ACCESS_TOKEN);let s="";return s=i&&i.u?Xt.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,p)=>String.fromCharCode(Number("0x"+p)))):ze.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const t=aa("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const c=Xt.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const p=Xt.localStorage.getItem(s);p&&(this.anonId=p)}catch{Oi("Unable to read from LocalStorage")}}saveEventData(){const t=aa("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{Xt.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Xt.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Oi("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,s,c){if(!ze.EVENTS_URL)return;const p=Di(ze.EVENTS_URL);p.params.push(`access_token=${c||ze.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString()},x=i?Hi(g,i):g,w={url:xn(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};var A;this.pendingRequest=(A=E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(c)},Qe(Hi(w,{method:"POST"}),A))}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const J=new class extends jo{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){ze.EVENTS_URL&&ze.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>xr(i)||yo(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ca(ze.ACCESS_TOKEN),i=t?t.u:ze.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Fo(this.anonId)||(this.anonId=pr(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(c),x=(c-this.eventData.lastSuccess)/864e5;s=s||x>=1||x<-1||p.getDate()!==g.getDate()}else s=!0;s?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Or,skuId:Ni,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},e):this.processRequests()}},U=J.postTurnstileEvent.bind(J),j=new class extends jo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,s){this.skuToken=t,this.errorCb=s,ze.EVENTS_URL&&(i||ze.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(Vo)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Fo(this.anonId)||(this.anonId=pr()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Or,skuId:Ni,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e))}},Q=j.postMapLoadEvent.bind(j),at=new class extends jo{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){ze.EVENTS_URL&&(e||ze.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:i}=this.queue.shift(),s=function(c){const p=Xt.performance.getEntriesByType("resource"),g=Xt.performance.getEntriesByType("mark"),x=function(P){const R={};if(P)for(const O in P)if("other"!==O)for(const V of P[O]){const q=`${O}ResolveRangeMin`,et=`${O}ResolveRangeMax`,lt=`${O}RequestCount`,tt=`${O}RequestCachedCount`;R[q]=Math.min(R[q]||1/0,V.startTime),R[et]=Math.max(R[et]||-1/0,V.responseEnd);const st=dt=>{void 0===R[dt]&&(R[dt]=0),++R[dt]};void 0!==V.transferSize&&0===V.transferSize&&st(tt),st(lt)}return R}(function(P,R){const O={};if(P)for(const V of P){const q=R(V);void 0===O[q]&&(O[q]=[]),O[q].push(V)}return O}(p,se)),w=Xt.devicePixelRatio,E=Xt.navigator.connection||Xt.navigator.mozConnection||Xt.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},k=(P,R,O)=>{null!=O&&P.push({name:R,value:O.toString()})};for(const P in x)k(A.counters,P,x[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(k(A.counters,"interactionRangeMin",c.interactionRange[0]),k(A.counters,"interactionRangeMax",c.interactionRange[1])),g)for(const P of Object.keys(Tt)){const R=Tt[P],O=g.find(V=>V.name===R);O&&k(A.counters,R,O.startTime)}return k(A.counters,"visibilityHidden",c.visibilityHidden),k(A.attributes,"style",function(P){if(P)for(const R of P){const O=R.name.split("?")[0];if(Ka(O)){const V=O.split("/").slice(-2);if(2===V.length)return`mapbox://styles/${V[0]}/${V[1]}`}}}(p)),k(A.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),k(A.attributes,"fogEnabled",c.fogEnabled?"true":"false"),k(A.attributes,"projection",c.projection),k(A.attributes,"zoom",c.zoom),k(A.metadata,"devicePixelRatio",w),k(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),k(A.metadata,"navigatorUserAgent",Xt.navigator.userAgent),k(A.metadata,"screenWidth",Xt.screen.width),k(A.metadata,"screenHeight",Xt.screen.height),k(A.metadata,"windowWidth",Xt.innerWidth),k(A.metadata,"windowHeight",Xt.innerHeight),k(A.metadata,"mapWidth",c.width/w),k(A.metadata,"mapHeight",c.height/w),k(A.metadata,"webglRenderer",c.renderer),k(A.metadata,"webglVendor",c.vendor),k(A.metadata,"sdkVersion",Or),k(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const c of s.metadata);for(const c of s.counters);for(const c of s.attributes);this.postEvent(t,s,()=>{},e)}},ct=at.postPerformanceEvent.bind(at),xt=new class extends jo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,s){if(!ze.API_URL||!ze.SESSION_PATH)return;const c=Di(ze.API_URL+ze.SESSION_PATH);c.params.push(`sku=${t||""}`),c.params.push(`access_token=${s||ze.ACCESS_TOKEN||""}`);const p={url:xn(c),headers:{"Content-Type":"text/plain"}};var x;this.pendingRequest=(x=g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(s)},Qe(Hi(p,{method:"GET"}),x))}getSessionAPI(e,t,i,s){this.skuToken=t,this.errorCb=s,ze.SESSION_PATH&&ze.API_URL&&(i||ze.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(Vo)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e)}},bt=xt.getSessionAPI.bind(xt),mt=new Set,Tt={create:"create",load:"load",fullLoad:"fullLoad"},jt={mark(e){Xt.performance.mark(e)},measure(e,t,i){Xt.performance.measure(e,t,i)}};function se(e){const t=e.name.split("?")[0];return Ja(t)&&t.includes("mapbox-gl.js")?"javascript":Ja(t)&&t.includes("mapbox-gl.css")?"css":ze.API_FONTS_REGEX.test(t)?"fontRange":Nn(t)?"sprite":Ka(t)?"style":ze.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const Wt=Xt.performance;function _e(e){const t=e?e.url.toString():void 0;return Wt.getEntriesByName(t)}let ve,ye,xe,Re;const ti={now:()=>void 0!==xe?xe:Xt.performance.now(),setNow(e){xe=e},restoreNow(){xe=void 0},frame(e){const t=Xt.requestAnimationFrame(e);return{cancel:()=>Xt.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:s}=e;Re||(Re=Xt.document.createElement("canvas"));const c=Re.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Re.width||s>Re.height)&&(Re.width=i,Re.height=s),c.clearRect(-t,-t,i+2*t,s+2*t),c.drawImage(e,0,0,i,s),c.getImageData(-t,-t,i+2*t,s+2*t)},resolveURL:e=>(ve||(ve=Xt.document.createElement("a")),ve.href=e,ve.href),get devicePixelRatio(){return Xt.devicePixelRatio},get prefersReducedMotion(){return!!Xt.matchMedia&&(null==ye&&(ye=Xt.matchMedia("(prefers-reduced-motion: reduce)")),ye.matches)}};function Ee(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function ai(e,t,i){if(i&&i[e]){const s=i[e].indexOf(t);-1!==s&&i[e].splice(s,1)}}class fi{constructor(t,i={}){Hi(this,i),this.type=t}}class Xi extends fi{constructor(t,i={}){super("error",Hi({error:t},i))}}class Vn{on(t,i){return this._listeners=this._listeners||{},Ee(t,i,this._listeners),this}off(t,i){return ai(t,i,this._listeners),ai(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ee(t,i,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,i){"string"==typeof t&&(t=new fi(t,i||{}));const s=t.type;if(this.listens(s)){t.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const x of c)x.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const x of p)ai(s,x,this._oneTimeListeners),x.call(this,t);const g=this._eventedParent;g&&(Hi(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Xi&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var zt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Gr(e,...t){for(const i of t)for(const s in i)e[s]=i[s];return e}function bi(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function vr(e){if(Array.isArray(e))return e.map(vr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=vr(e[i]);return t}return bi(e)}class br extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var wr=br;class Ms{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[s,c]of i)this.bindings[s]=c}concat(t){return new Ms(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var sc=Ms;const Cs={kind:"null"},ee={kind:"number"},Ve={kind:"string"},Ze={kind:"boolean"},sr={kind:"color"},xo={kind:"object"},Ne={kind:"value"},Go={kind:"collator"},ji={kind:"formatted"},Ss={kind:"resolvedImage"};function un(e,t){return{kind:"array",itemType:e,N:t}}function yi(e){if("array"===e.kind){const t=yi(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const ha=[Cs,ee,Ve,Ze,sr,ji,xo,un(Ne),Ss];function vn(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!vn(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const i of ha)if(!vn(i,t))return null}return`Expected ${yi(e)} but found ${yi(t)} instead.`}function Qa(e,t){return t.some(i=>i.kind===e.kind)}function ar(e,t){return t.some(i=>"null"===i?null===e:"array"===i?Array.isArray(e):"object"===i?e&&!Array.isArray(e)&&"object"==typeof e:i===typeof e)}var tl,ua={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Zo(e){return(e=Math.round(e))<0?0:e>255?255:e}function $o(e){return Zo("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function As(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function ac(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{tl={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in ua)return ua[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var s=i.indexOf("("),c=i.indexOf(")");if(-1!==s&&c+1===i.length){var p=i.substr(0,s),g=i.substr(s+1,c-(s+1)).split(","),x=1;switch(p){case"rgba":if(4!==g.length)return null;x=As(g.pop());case"rgb":return 3!==g.length?null:[$o(g[0]),$o(g[1]),$o(g[2]),x];case"hsla":if(4!==g.length)return null;x=As(g.pop());case"hsl":if(3!==g.length)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=As(g[1]),A=As(g[2]),k=A<=.5?A*(E+1):A+E-A*E,P=2*A-k;return[Zo(255*ac(P,k,w+1/3)),Zo(255*ac(P,k,w)),Zo(255*ac(P,k,w-1/3)),x];default:return null}}return null}}catch{}class An{constructor(t,i,s,c=1){this.r=t,this.g=i,this.b=s,this.a=c}static parse(t){if(!t)return;if(t instanceof An)return t;if("string"!=typeof t)return;const i=tl(t);return i?new An(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,s,c]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(s)},${c})`}toArray(){const{r:t,g:i,b:s,a:c}=this;return 0===c?[0,0,0,0]:[255*t/c,255*i/c,255*s/c,c]}toArray01(){const{r:t,g:i,b:s,a:c}=this;return 0===c?[0,0,0,0]:[t/c,i/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:s,a:c}=this;return[t,i,s,c]}}An.black=new An(0,0,0,1),An.white=new An(1,1,1,1),An.transparent=new An(0,0,0,0),An.red=new An(1,0,0,1),An.blue=new An(0,0,1,1);var Fi=An;class el{constructor(t,i,s){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zr{constructor(t,i,s,c,p){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=s,this.fontStack=c,this.textColor=p}}class bn{constructor(t){this.sections=t}static fromString(t){return new bn([new Zr(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof bn?t:bn.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(s)}return t}}class wn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new wn({name:t,available:!1}):null}serialize(){return["image",this.name]}}function da(e,t,i,s){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[e,t,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[e,t,i,s]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function il(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Fi||e instanceof el||e instanceof bn||e instanceof wn)return!0;if(Array.isArray(e)){for(const t of e)if(!il(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!il(e[t]))return!1;return!0}return!1}function Ii(e){if(null===e)return Cs;if("string"==typeof e)return Ve;if("boolean"==typeof e)return Ze;if("number"==typeof e)return ee;if(e instanceof Fi)return sr;if(e instanceof el)return Go;if(e instanceof bn)return ji;if(e instanceof wn)return Ss;if(Array.isArray(e)){const t=e.length;let i;for(const s of e){const c=Ii(s);if(i){if(i===c)continue;i=Ne;break}i=c}return un(i||Ne,t)}return xo}function qo(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Fi||e instanceof bn||e instanceof wn?e.toString():JSON.stringify(e)}class Wo{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(2!==t.length)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!il(t[1]))return i.error("invalid value");const s=t[1];let c=Ii(s);const p=i.expectedType;return"array"!==c.kind||0!==c.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(c=p),new Wo(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof bn?this.value.serialize():this.value}}var Ho=Wo,on=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const ki={string:Ve,number:ee,boolean:Ze,object:xo};class Is{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let s,c=1;const p=t[0];if("array"===p){let x,w;if(t.length>2){const E=t[1];if("string"!=typeof E||!(E in ki)||"object"===E)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=ki[E],c++}else x=Ne;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=t[2],c++}s=un(x,w)}else s=ki[p];const g=[];for(;c<t.length;c++){const x=i.parse(t[c],c,Ne);if(!x)return null;g.push(x)}return new Is(s,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(t);if(!vn(this.type,Ii(s)))return s;if(i===this.args.length-1)throw new on(`Expected value to be of type ${yi(this.type)}, but found ${yi(Ii(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const c=t.N;("number"==typeof c||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(s=>s.serialize()))}}var Hn=Is;class pa{constructor(t){this.type=ji,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const c=[];let p=!1;for(let g=1;g<=t.length-1;++g){const x=t[g];if(p&&"object"==typeof x&&!Array.isArray(x)){p=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,ee),!w))return null;let E=null;if(x["text-font"]&&(E=i.parse(x["text-font"],1,un(Ve)),!E))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,sr),!A))return null;const k=c[c.length-1];k.scale=w,k.font=E,k.textColor=A}else{const w=i.parse(t[g],1,Ne);if(!w)return null;const E=w.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:w,scale:null,font:null,textColor:null})}}return new pa(c)}evaluate(t){return new bn(this.sections.map(i=>{const s=i.content.evaluate(t);return Ii(s)===Ss?new Zr("",s,null,null,null):new Zr(qo(s),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),t.push(s)}return t}}class Tr{constructor(t){this.type=Ss,this.input=t}static parse(t,i){if(2!==t.length)return i.error("Expected two arguments.");const s=i.parse(t[1],1,Ve);return s?new Tr(s):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),s=wn.fromString(i);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(i)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ch={"to-boolean":Ze,"to-color":sr,"to-number":ee,"to-string":Ve};class fa{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[0];if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return i.error("Expected one argument.");const c=Ch[s],p=[];for(let g=1;g<t.length;g++){const x=i.parse(t[g],g,Ne);if(!x)return null;p.push(x)}return new fa(c,p)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let i,s;for(const c of this.args){if(i=c.evaluate(t),s=null,i instanceof Fi)return i;if("string"==typeof i){const p=t.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:da(i[0],i[1],i[2],i[3]),!s))return new Fi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new on(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(t),null===i)return 0;const c=Number(i);if(!isNaN(c))return c}throw new on(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?bn.fromString(qo(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?wn.fromString(qo(this.args[0].evaluate(t))):qo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new pa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Tr(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Xo=fa;const ks=["Unknown","Point","LineString","Polygon"];var vo=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ks[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(s*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Fi.parse(e)),t}};class $r{constructor(t,i,s,c){this.name=t,this.type=i,this._evaluate=s,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const s=t[0],c=$r.definitions[s];if(!c)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=g.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,A]of x){w=new uc(i.registry,i.path,null,i.scope);const k=[];let P=!1;for(let R=1;R<t.length;R++){const O=t[R],V=Array.isArray(E)?E[R-1]:E.type,q=w.parse(O,1+k.length,V);if(!q){P=!0;break}k.push(q)}if(!P)if(Array.isArray(E)&&E.length!==k.length)w.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let R=0;R<k.length;R++){const O=Array.isArray(E)?E[R]:E.type,V=k[R];w.concat(R+1).checkSubtype(O,V.type)}if(0===w.errors.length)return new $r(s,p,A,k)}}if(1===x.length)i.errors.push(...w.errors);else{const E=(x.length?x:g).map(([k])=>{return P=k,Array.isArray(P)?`(${P.map(yi).join(", ")})`:`(${yi(P.type)}...)`;var P}).join(" | "),A=[];for(let k=1;k<t.length;k++){const P=i.parse(t[k],1+A.length);if(!P)return null;A.push(yi(P.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(t,i){$r.definitions=i;for(const s in i)t[s]=$r}}var bo=$r;class nl{constructor(t,i,s){this.type=Go,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(2!==t.length)return i.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const c=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Ze);if(!c)return null;const p=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Ze);if(!p)return null;let g=null;return s.locale&&(g=i.parse(s.locale,1,Ve),!g)?null:new nl(c,p,g)}evaluate(t){return new el(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const In=8192;function Xn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ma(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Sh(e,t){const i=(180+e[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*In),Math.round(s*c*In)]}function zs(e,t,i){const s=e[0]-t[0],c=e[1]-t[1],p=e[0]-i[0],g=e[1]-i[1];return s*g-p*c==0&&s*p<=0&&c*g<=0}function rl(e,t){let i=!1;for(let g=0,x=t.length;g<x;g++){const w=t[g];for(let E=0,A=w.length;E<A-1;E++){if(zs(e,w[E],w[E+1]))return!1;(c=w[E])[1]>(s=e)[1]!=(p=w[E+1])[1]>s[1]&&s[0]<(p[0]-c[0])*(s[1]-c[1])/(p[1]-c[1])+c[0]&&(i=!i)}}var s,c,p;return i}function Ah(e,t){for(let i=0;i<t.length;i++)if(rl(e,t[i]))return!0;return!1}function lc(e,t,i,s){const c=s[0]-i[0],p=s[1]-i[1],g=(e[0]-i[0])*p-c*(e[1]-i[1]),x=(t[0]-i[0])*p-c*(t[1]-i[1]);return g>0&&x<0||g<0&&x>0}function cc(e,t,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((x=[(g=E[A+1])[0]-(p=E[A])[0],g[1]-p[1]])[0]*(w=[(c=t)[0]-(s=e)[0],c[1]-s[1]])[1]-x[1]*w[0]!=0&&lc(s,c,p,g)&&lc(p,g,s,c))return!0;var s,c,p,g,x,w;return!1}function wo(e,t){for(let i=0;i<e.length;++i)if(!rl(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(cc(e[i],e[i+1],t))return!1;return!0}function hc(e,t){for(let i=0;i<t.length;i++)if(wo(e,t[i]))return!0;return!1}function Er(e,t,i){const s=[];for(let c=0;c<e.length;c++){const p=[];for(let g=0;g<e[c].length;g++){const x=Sh(e[c][g],i);Xn(t,x),p.push(x)}s.push(p)}return s}function tn(e,t,i){const s=[];for(let c=0;c<e.length;c++){const p=Er(e[c],t,i);s.push(p)}return s}function Gi(e,t,i,s){if(e[0]<i[0]||e[0]>i[2]){const c=.5*s;let p=e[0]-i[0]>c?-s:i[0]-e[0]>c?s:0;0===p&&(p=e[0]-i[2]>c?-s:i[2]-e[0]>c?s:0),e[0]+=p}Xn(t,e)}function lr(e,t,i,s){const c=Math.pow(2,s.z)*In,p=[s.x*In,s.y*In],g=[];if(!e)return g;for(const x of e)for(const w of x){const E=[w.x+p[0],w.y+p[1]];Gi(E,t,i,c),g.push(E)}return g}function ni(e,t,i,s){const c=Math.pow(2,s.z)*In,p=[s.x*In,s.y*In],g=[];if(!e)return g;for(const w of e){const E=[];for(const A of w){const k=[A.x+p[0],A.y+p[1]];Xn(t,k),E.push(k)}g.push(E)}if(t[2]-t[0]<=c/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of g)for(const E of w)Gi(E,t,i,c)}var x;return g}class Yn{constructor(t,i){this.type=Ze,this.geojson=t,this.geometries=i}static parse(t,i){if(2!==t.length)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(il(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let c=0;c<s.features.length;++c){const p=s.features[c].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Yn(s,s.features[c].geometry)}else if("Feature"===s.type){const c=s.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new Yn(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Yn(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(i,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const x=Er(s.coordinates,p,g),w=lr(i.geometry(),c,p,g);if(!ma(c,p))return!1;for(const E of w)if(!rl(E,x))return!1}if("MultiPolygon"===s.type){const x=tn(s.coordinates,p,g),w=lr(i.geometry(),c,p,g);if(!ma(c,p))return!1;for(const E of w)if(!Ah(E,x))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(i,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const x=Er(s.coordinates,p,g),w=ni(i.geometry(),c,p,g);if(!ma(c,p))return!1;for(const E of w)if(!wo(E,x))return!1}if("MultiPolygon"===s.type){const x=tn(s.coordinates,p,g),w=ni(i.geometry(),c,p,g);if(!ma(c,p))return!1;for(const E of w)if(!hc(E,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ga=Yn;function Mr(e){if(e instanceof bo&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof ga)return!1;let t=!0;return e.eachChild(i=>{t&&!Mr(i)&&(t=!1)}),t}function Ps(e){if(e instanceof bo&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(i=>{t&&!Ps(i)&&(t=!1)}),t}function ol(e,t){if(e instanceof bo&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(s=>{i&&!ol(s,t)&&(i=!1)}),i}class Ds{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(2!==t.length||"string"!=typeof t[1])return i.error("'var' expression requires exactly one string literal argument.");const s=t[1];return i.scope.has(s)?new Ds(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var sl=Ds;class al{constructor(t,i=[],s,c=new sc,p=[]){this.registry=t,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=c,this.errors=p,this.expectedType=s}parse(t,i,s,c,p={}){return i?this.concat(i,s,c)._parse(t,p):this._parse(t,p)}_parse(t,i){function s(c,p,g){return"assert"===g?new Hn(p,[c]):"coerce"===g?new Xo(p,[c]):c}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if("string"!=typeof c)return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[c];if(p){let g=p.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,w=g.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else g=s(g,x,i.typeAnnotation||"coerce");else g=s(g,x,i.typeAnnotation||"assert")}if(!(g instanceof Ho)&&"resolvedImage"!==g.type.kind&&To(g)){const x=new vo;try{g=new Ho(g.type,g.evaluate(x))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,s){const c="number"==typeof t?this.path.concat(t):this.path,p=s?this.scope.concat(s):this.scope;return new al(this.registry,c,i||null,p,this.errors)}error(t,...i){const s=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new wr(s,t))}checkSubtype(t,i){const s=vn(t,i);return s&&this.error(s),s}}var uc=al;function To(e){if(e instanceof sl)return To(e.boundExpression);if(e instanceof bo&&"error"===e.name||e instanceof nl||e instanceof ga)return!1;const t=e instanceof Xo||e instanceof Hn;let i=!0;return e.eachChild(s=>{i=t?i&&To(s):i&&s instanceof Ho}),!!i&&Mr(e)&&ol(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Eo(e,t){const i=e.length-1;let s,c,p=0,g=i,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),s=e[x],c=e[x+1],s<=t){if(x===i||t<c)return x;p=x+1}else{if(!(s>t))throw new on("Input is not a number.");g=x-1}return 0}class ll{constructor(t,i,s){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[c,p]of s)this.labels.push(c),this.outputs.push(p)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(t[1],1,ee);if(!s)return null;const c=[];let p=null;i.expectedType&&"value"!==i.expectedType.kind&&(p=i.expectedType);for(let g=1;g<t.length;g+=2){const x=1===g?-1/0:t[g],w=t[g+1],E=g,A=g+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=i.parse(w,A,p);if(!k)return null;p=p||k.type,c.push([x,k])}return new ll(p,s,c)}evaluate(t){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return s[0].evaluate(t);const p=i.length;return c>=i[p-1]?s[p-1].evaluate(t):s[Eo(i,c)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var dc=ll;function He(e,t,i){return e*(1-i)+t*i}var Ls=Object.freeze({__proto__:null,number:He,color:function(e,t,i){return new Fi(He(e.r,t.r,i),He(e.g,t.g,i),He(e.b,t.b,i),He(e.a,t.a,i))},array:function(e,t,i){return e.map((s,c)=>He(s,t[c],i))}});const cl=4/29,hl=6/29,pc=3*hl*hl,fc=Math.PI/180,id=180/Math.PI;function qr(e){return e>.008856451679035631?Math.pow(e,1/3):e/pc+cl}function ul(e){return e>hl?e*e*e:pc*(e-cl)}function dl(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function pl(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function zh(e){const t=pl(e.r),i=pl(e.g),s=pl(e.b),c=qr((.4124564*t+.3575761*i+.1804375*s)/.95047),p=qr((.2126729*t+.7151522*i+.072175*s)/1);return{l:116*p-16,a:500*(c-p),b:200*(p-qr((.0193339*t+.119192*i+.9503041*s)/1.08883)),alpha:e.a}}function Ph(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,s=isNaN(e.b)?t:t-e.b/200;return t=1*ul(t),i=.95047*ul(i),s=1.08883*ul(s),new Fi(dl(3.2404542*i-1.5371385*t-.4985314*s),dl(-.969266*i+1.8760108*t+.041556*s),dl(.0556434*i-.2040259*t+1.0572252*s),e.alpha)}function fl(e,t,i){const s=t-e;return e+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const _a={forward:zh,reverse:Ph,interpolate:function(e,t,i){return{l:He(e.l,t.l,i),a:He(e.a,t.a,i),b:He(e.b,t.b,i),alpha:He(e.alpha,t.alpha,i)}}},ya={forward:function(e){const{l:t,a:i,b:s}=zh(e),c=Math.atan2(s,i)*id;return{h:c<0?c+360:c,c:Math.sqrt(i*i+s*s),l:t,alpha:e.a}},reverse:function(e){const t=e.h*fc,i=e.c;return Ph({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:fl(e.h,t.h,i),c:He(e.c,t.c,i),l:He(e.l,t.l,i),alpha:He(e.alpha,t.alpha,i)}}};var mc=Object.freeze({__proto__:null,lab:_a,hcl:ya});class Yo{constructor(t,i,s,c,p){this.type=t,this.operator=i,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(t,i,s,c){let p=0;if("exponential"===t.name)p=Rs(i,t.base,s,c);else if("linear"===t.name)p=Rs(i,1,s,c);else if("cubic-bezier"===t.name){const g=t.controlPoints;p=new po(g[0],g[1],g[2],g[3]).solve(Rs(i,1,s,c))}return p}static parse(t,i){let[s,c,p,...g]=t;if(!Array.isArray(c)||0===c.length)return i.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const E=c[1];if("number"!=typeof E)return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if("cubic-bezier"!==c[0])return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(4!==E.length||E.some(A=>"number"!=typeof A||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,ee),!p)return null;const x=[];let w=null;"interpolate-hcl"===s||"interpolate-lab"===s?w=sr:i.expectedType&&"value"!==i.expectedType.kind&&(w=i.expectedType);for(let E=0;E<g.length;E+=2){const A=g[E],k=g[E+1],P=E+3,R=E+4;if("number"!=typeof A)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const O=i.parse(k,R,w);if(!O)return null;w=w||O.type,x.push([A,O])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Yo(w,s,c,p,x):i.error(`Type ${yi(w)} is not interpolatable.`)}evaluate(t){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return s[0].evaluate(t);const p=i.length;if(c>=i[p-1])return s[p-1].evaluate(t);const g=Eo(i,c),x=Yo.interpolationFactor(this.interpolation,c,i[g],i[g+1]),w=s[g].evaluate(t),E=s[g+1].evaluate(t);return"interpolate"===this.operator?Ls[this.type.kind.toLowerCase()](w,E,x):"interpolate-hcl"===this.operator?ya.reverse(ya.interpolate(ya.forward(w),ya.forward(E),x)):_a.reverse(_a.interpolate(_a.forward(w),_a.forward(E),x))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function Rs(e,t,i,s){const c=s-i,p=e-i;return 0===c?0:1===t?p/c:(Math.pow(t,p)-1)/(Math.pow(t,c)-1)}var jn=Yo;class gc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let s=null;const c=i.expectedType;c&&"value"!==c.kind&&(s=c);const p=[];for(const x of t.slice(1)){const w=i.parse(x,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,p.push(w)}const g=c&&p.some(x=>vn(c,x.type));return new gc(g?Ne:s,p)}evaluate(t){let i,s=null,c=0;for(const p of this.args){if(c++,s=p.evaluate(t),s&&s instanceof wn&&!s.available&&(i||(i=s),s=null,c===this.args.length))return i;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Dh=gc;class Cr{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let p=1;p<t.length-1;p+=2){const g=t[p];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(t[p+1],p+1);if(!x)return null;s.push([g,x])}const c=i.parse(t[t.length-1],t.length-1,i.expectedType,s);return c?new Cr(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,s]of this.bindings)t.push(i,s.serialize());return t.push(this.result.serialize()),t}}var _c=Cr;class ml{constructor(t,i,s){this.type=t,this.index=i,this.input=s}static parse(t,i){if(3!==t.length)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,ee),c=i.parse(t[2],2,un(i.expectedType||Ne));return s&&c?new ml(c.type.itemType,s,c):null}evaluate(t){const i=this.index.evaluate(t),s=this.input.evaluate(t);if(i<0)throw new on(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new on(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new on(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Jo=ml;class yc{constructor(t,i){this.type=Ze,this.needle=t,this.haystack=i}static parse(t,i){if(3!==t.length)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ne),c=i.parse(t[2],2,Ne);return s&&c?Qa(s.type,[Ze,Ve,ee,Cs,Ne])?new yc(s,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(s.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!ar(i,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${yi(Ii(i))} instead.`);if(!ar(s,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${yi(Ii(s))} instead.`);return s.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var xa=yc;class va{constructor(t,i,s){this.type=ee,this.needle=t,this.haystack=i,this.fromIndex=s}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ne),c=i.parse(t[2],2,Ne);if(!s||!c)return null;if(!Qa(s.type,[Ze,Ve,ee,Cs,Ne]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(s.type)} instead`);if(4===t.length){const p=i.parse(t[3],3,ee);return p?new va(s,c,p):null}return new va(s,c)}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!ar(i,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${yi(Ii(i))} instead.`);if(!ar(s,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${yi(Ii(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(t);return s.indexOf(i,c)}return s.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var xc=va;class vc{constructor(t,i,s,c,p,g){this.inputType=t,this.type=i,this.input=s,this.cases=c,this.outputs=p,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let s,c;i.expectedType&&"value"!==i.expectedType.kind&&(c=i.expectedType);const p={},g=[];for(let E=2;E<t.length-1;E+=2){let A=t[E];const k=t[E+1];Array.isArray(A)||(A=[A]);const P=i.concat(E);if(0===A.length)return P.error("Expected at least one branch label.");for(const O of A){if("number"!=typeof O&&"string"!=typeof O)return P.error("Branch labels must be numbers or strings.");if("number"==typeof O&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof O&&Math.floor(O)!==O)return P.error("Numeric branch labels must be integer values.");if(s){if(P.checkSubtype(s,Ii(O)))return null}else s=Ii(O);if(void 0!==p[String(O)])return P.error("Branch labels must be unique.");p[String(O)]=g.length}const R=i.parse(k,E,c);if(!R)return null;c=c||R.type,g.push(R)}const x=i.parse(t[1],1,Ne);if(!x)return null;const w=i.parse(t[t.length-1],t.length-1,c);return w?"value"!==x.type.kind&&i.concat(1).checkSubtype(s,x.type)?null:new vc(s,c,x,p,g,w):null}evaluate(t){const i=this.input.evaluate(t);return(Ii(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],c={};for(const g of i){const x=c[this.cases[g]];void 0===x?(c[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[x][1].push(g)}const p=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,x]of s)t.push(1===x.length?p(x[0]):x.map(p)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var Lh=vc;class Wr{constructor(t,i,s){this.type=t,this.branches=i,this.otherwise=s}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const x=i.parse(t[g],g,Ze);if(!x)return null;const w=i.parse(t[g+1],g+1,s);if(!w)return null;c.push([x,w]),s=s||w.type}const p=i.parse(t[t.length-1],t.length-1,s);return p?new Wr(s,c,p):null}evaluate(t){for(const[i,s]of this.branches)if(i.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,s]of this.branches)t(i),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var nd=Wr;class Ko{constructor(t,i,s,c){this.type=t,this.input=i,this.beginIndex=s,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Ne),c=i.parse(t[2],2,ee);if(!s||!c)return null;if(!Qa(s.type,[un(Ne),Ve,Ne]))return i.error(`Expected first argument to be of type array or string, but found ${yi(s.type)} instead`);if(4===t.length){const p=i.parse(t[3],3,ee);return p?new Ko(s.type,s,c,p):null}return new Ko(s.type,s,c)}evaluate(t){const i=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!ar(i,["string","array"]))throw new on(`Expected first argument to be of type array or string, but found ${yi(Ii(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(t);return i.slice(s,c)}return i.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Rh=Ko;function bc(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Qo(e,t,i,s){return 0===s.compare(t,i)}function ts(e,t,i){const s="=="!==e&&"!="!==e;return class m_{constructor(p,g,x){this.type=Ze,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument="value"===p.type.kind||"value"===g.type.kind}static parse(p,g){if(3!==p.length&&4!==p.length)return g.error("Expected two or three arguments.");const x=p[0];let w=g.parse(p[1],1,Ne);if(!w)return null;if(!bc(x,w.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${yi(w.type)}'.`);let E=g.parse(p[2],2,Ne);if(!E)return null;if(!bc(x,E.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${yi(E.type)}'.`);if(w.type.kind!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error(`Cannot compare types '${yi(w.type)}' and '${yi(E.type)}'.`);s&&("value"===w.type.kind&&"value"!==E.type.kind?w=new Hn(E.type,[w]):"value"!==w.type.kind&&"value"===E.type.kind&&(E=new Hn(w.type,[E])));let A=null;if(4===p.length){if("string"!==w.type.kind&&"string"!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(p[3],3,Go),!A)return null}return new m_(w,E,A)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const w=Ii(g),E=Ii(x);if(w.kind!==E.kind||"string"!==w.kind&&"number"!==w.kind)throw new on(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=Ii(g),E=Ii(x);if("string"!==w.kind||"string"!==E.kind)return t(p,g,x)}return this.collator?i(p,g,x,this.collator.evaluate(p)):t(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[e];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Bh=ts("==",function(e,t,i){return t===i},Qo),wc=ts("!=",function(e,t,i){return t!==i},function(e,t,i,s){return!Qo(0,t,i,s)}),Tc=ts("<",function(e,t,i){return t<i},function(e,t,i,s){return s.compare(t,i)<0}),Oh=ts(">",function(e,t,i){return t>i},function(e,t,i,s){return s.compare(t,i)>0}),gl=ts("<=",function(e,t,i){return t<=i},function(e,t,i,s){return s.compare(t,i)<=0}),Fh=ts(">=",function(e,t,i){return t>=i},function(e,t,i,s){return s.compare(t,i)>=0});class Ec{constructor(t,i,s,c,p,g){this.type=Ve,this.number=t,this.locale=i,this.currency=s,this.unit=c,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(t,i){if(3!==t.length)return i.error("Expected two arguments.");const s=i.parse(t[1],1,ee);if(!s)return null;const c=t[2];if("object"!=typeof c||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=i.parse(c.locale,1,Ve),!p))return null;let g=null;if(c.currency&&(g=i.parse(c.currency,1,Ve),!g))return null;let x=null;if(c.unit&&(x=i.parse(c.unit,1,Ve),!x))return null;let w=null;if(c["min-fraction-digits"]&&(w=i.parse(c["min-fraction-digits"],1,ee),!w))return null;let E=null;return c["max-fraction-digits"]&&(E=i.parse(c["max-fraction-digits"],1,ee),!E)?null:new Ec(s,p,g,x,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Mc{constructor(t){this.type=ee,this.input=t}static parse(t,i){if(2!==t.length)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=i.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${yi(s.type)} instead.`):new Mc(s):null}evaluate(t){const i=this.input.evaluate(t);if("string"==typeof i||Array.isArray(i))return i.length;throw new on(`Expected value to be of type string or array, but found ${yi(Ii(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const Uh={"==":Bh,"!=":wc,">":Oh,"<":Tc,">=":Fh,"<=":gl,array:Hn,at:Jo,boolean:Hn,case:nd,coalesce:Dh,collator:nl,format:pa,image:Tr,in:xa,"index-of":xc,interpolate:jn,"interpolate-hcl":jn,"interpolate-lab":jn,length:Mc,let:_c,literal:Ho,match:Lh,number:Hn,"number-format":Ec,object:Hn,slice:Rh,step:dc,string:Hn,"to-boolean":Xo,"to-color":Xo,"to-number":Xo,"to-string":Xo,var:sl,within:ga};function Cc(e,[t,i,s,c]){t=t.evaluate(e),i=i.evaluate(e),s=s.evaluate(e);const p=c?c.evaluate(e):1,g=da(t,i,s,p);if(g)throw new on(g);return new Fi(t/255*p,i/255*p,s/255*p,p)}function Nh(e,t){return e in t}function _l(e,t){const i=t[e];return void 0===i?null:i}function Mo(e){return{type:e}}bo.register(Uh,{error:[{kind:"error"},[Ve],(e,[t])=>{throw new on(t.evaluate(e))}],typeof:[Ve,[Ne],(e,[t])=>yi(Ii(t.evaluate(e)))],"to-rgba":[un(ee,4),[sr],(e,[t])=>t.evaluate(e).toArray()],rgb:[sr,[ee,ee,ee],Cc],rgba:[sr,[ee,ee,ee,ee],Cc],has:{type:Ze,overloads:[[[Ve],(e,[t])=>Nh(t.evaluate(e),e.properties())],[[Ve,xo],(e,[t,i])=>Nh(t.evaluate(e),i.evaluate(e))]]},get:{type:Ne,overloads:[[[Ve],(e,[t])=>_l(t.evaluate(e),e.properties())],[[Ve,xo],(e,[t,i])=>_l(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Ne,[Ve],(e,[t])=>_l(t.evaluate(e),e.featureState||{})],properties:[xo,[],e=>e.properties()],"geometry-type":[Ve,[],e=>e.geometryType()],id:[Ne,[],e=>e.id()],zoom:[ee,[],e=>e.globals.zoom],pitch:[ee,[],e=>e.globals.pitch||0],"distance-from-center":[ee,[],e=>e.distanceFromCenter()],"heatmap-density":[ee,[],e=>e.globals.heatmapDensity||0],"line-progress":[ee,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[ee,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ne,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ee,Mo(ee),(e,t)=>{let i=0;for(const s of t)i+=s.evaluate(e);return i}],"*":[ee,Mo(ee),(e,t)=>{let i=1;for(const s of t)i*=s.evaluate(e);return i}],"-":{type:ee,overloads:[[[ee,ee],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ee],(e,[t])=>-t.evaluate(e)]]},"/":[ee,[ee,ee],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ee,[ee,ee],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ee,[],()=>Math.LN2],pi:[ee,[],()=>Math.PI],e:[ee,[],()=>Math.E],"^":[ee,[ee,ee],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ee,[ee],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ee,[ee],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ee,[ee],(e,[t])=>Math.log(t.evaluate(e))],log2:[ee,[ee],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ee,[ee],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ee,[ee],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ee,[ee],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ee,[ee],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ee,[ee],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ee,[ee],(e,[t])=>Math.atan(t.evaluate(e))],min:[ee,Mo(ee),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[ee,Mo(ee),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[ee,[ee],(e,[t])=>Math.abs(t.evaluate(e))],round:[ee,[ee],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ee,[ee],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ee,[ee],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ze,[Ve,Ne],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ze,[Ne],(e,[t])=>e.id()===t.value],"filter-type-==":[Ze,[Ve],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ze,[Ve,Ne],(e,[t,i])=>{const s=e.properties()[t.value],c=i.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Ze,[Ne],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i<s}],"filter->":[Ze,[Ve,Ne],(e,[t,i])=>{const s=e.properties()[t.value],c=i.value;return typeof s==typeof c&&s>c}],"filter-id->":[Ze,[Ne],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ze,[Ve,Ne],(e,[t,i])=>{const s=e.properties()[t.value],c=i.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Ze,[Ne],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ze,[Ve,Ne],(e,[t,i])=>{const s=e.properties()[t.value],c=i.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Ze,[Ne],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ze,[Ne],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ze,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Ze,[un(Ve)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ze,[un(Ne)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ze,[Ve,un(Ne)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ze,[Ve,un(Ne)],(e,[t,i])=>function(s,c,p,g){for(;p<=g;){const x=p+g>>1;if(c[x]===s)return!0;c[x]>s?g=x-1:p=x+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Mo(Ze),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Mo(Ze),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ze,[Ze],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ze,[Ve],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Ve,[Ve],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Ve,[Ve],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Ve,Mo(Ne),(e,t)=>t.map(i=>qo(i.evaluate(e))).join("")],"resolved-locale":[Ve,[Go],(e,[t])=>t.evaluate(e).resolvedLocale()]});var Bs=Uh;function Gn(e){return{result:"success",value:e}}function es(e){return{result:"error",value:e}}function Os(e){return"data-driven"===e["property-type"]}function Hr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function ba(e){return!!e.expression&&e.expression.interpolated}function Ye(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function yl(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Vh(e){return e}function Sc(e,t){const i="color"===t.type,s=e.stops&&"object"==typeof e.stops[0][0],c=s||!(s||void 0!==e.property),p=e.type||(ba(t)?"exponential":"interval");if(i&&((e=Gr({},e)).stops&&(e.stops=e.stops.map(E=>[E[0],Fi.parse(E[1])])),e.default=Fi.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!mc[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let g,x,w;if("exponential"===p)g=vl;else if("interval"===p)g=Ac;else if("categorical"===p){g=xl,x=Object.create(null);for(const E of e.stops)x[E[0]]=E[1];w=typeof e.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);g=Ic}if(s){const E={},A=[];for(let R=0;R<e.stops.length;R++){const O=e.stops[R],V=O[0].zoom;void 0===E[V]&&(E[V]={zoom:V,type:e.type,property:e.property,default:e.default,stops:[]},A.push(V)),E[V].stops.push([O[0].value,O[1]])}const k=[];for(const R of A)k.push([E[R].zoom,Sc(E[R],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:jn.interpolationFactor.bind(void 0,P),zoomStops:k.map(R=>R[0]),evaluate:({zoom:R},O)=>vl({stops:k,base:e.base},t,R).evaluate(R,O)}}if(c){const E="exponential"===p?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:jn.interpolationFactor.bind(void 0,E),zoomStops:e.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(e,t,A,x,w)}}return{kind:"source",evaluate(E,A){const k=A&&A.properties?A.properties[e.property]:void 0;return void 0===k?wa(e.default,t.default):g(e,t,k,x,w)}}}function wa(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function xl(e,t,i,s,c){return wa(typeof i===c?s[i]:void 0,e.default,t.default)}function Ac(e,t,i){if("number"!==Ye(i))return wa(e.default,t.default);const s=e.stops.length;if(1===s||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[s-1][0])return e.stops[s-1][1];const c=Eo(e.stops.map(p=>p[0]),i);return e.stops[c][1]}function vl(e,t,i){const s=void 0!==e.base?e.base:1;if("number"!==Ye(i))return wa(e.default,t.default);const c=e.stops.length;if(1===c||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[c-1][0])return e.stops[c-1][1];const p=Eo(e.stops.map(A=>A[0]),i),g=function(A,k,P,R){const O=R-P,V=A-P;return 0===O?0:1===k?V/O:(Math.pow(k,V)-1)/(Math.pow(k,O)-1)}(i,s,e.stops[p][0],e.stops[p+1][0]),x=e.stops[p][1],w=e.stops[p+1][1];let E=Ls[t.type]||Vh;if(e.colorSpace&&"rgb"!==e.colorSpace){const A=mc[e.colorSpace];E=(k,P)=>A.reverse(A.interpolate(A.forward(k),A.forward(P),g))}return"function"==typeof x.evaluate?{evaluate(...A){const k=x.evaluate.apply(void 0,A),P=w.evaluate.apply(void 0,A);if(void 0!==k&&void 0!==P)return E(k,P,g)}}:E(x,w,g)}function Ic(e,t,i){return"color"===t.type?i=Fi.parse(i):"formatted"===t.type?i=bn.fromString(i.toString()):"resolvedImage"===t.type?i=wn.fromString(i.toString()):Ye(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),wa(i,e.default,t.default)}class bl{constructor(t,i){var s;this.expression=t,this._warningHistory={},this._evaluator=new vo,this._defaultValue=i?"color"===(s=i).type&&(yl(s.default)||Array.isArray(s.default))?new Fi(0,0,0,0):"color"===s.type?Fi.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(t,i,s,c,p,g,x,w){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,s,c,p,g,x,w){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new on(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Fs(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Bs}function Us(e,t){const i=new uc(Bs,[],t?function(c){const p={color:sr,string:Ve,number:ee,enum:Ve,boolean:Ze,formatted:ji,resolvedImage:Ss};return"array"===c.type?un(p[c.value]||Ne,c.length):p[c.type]}(t):void 0),s=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return s?Gn(new bl(s,t)):es(i.errors)}class Ta{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent="constant"!==t&&!Ps(i.expression)}evaluateWithoutErrorHandling(t,i,s,c,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,c,p,g)}evaluate(t,i,s,c,p,g){return this._styleExpression.evaluate(t,i,s,c,p,g)}}class Co{constructor(t,i,s,c){this.kind=t,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==t&&!Ps(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,s,c,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,c,p,g)}evaluate(t,i,s,c,p,g){return this._styleExpression.evaluate(t,i,s,c,p,g)}interpolationFactor(t,i,s){return this.interpolationType?jn.interpolationFactor(this.interpolationType,t,i,s):0}}function Xr(e,t){if("error"===(e=Us(e,t)).result)return e;const i=e.value.expression,s=Mr(i);if(!s&&!Os(t))return es([new wr("","data expressions not supported")]);const c=ol(i,["zoom","pitch","distance-from-center"]);if(!c&&!Hr(t))return es([new wr("","zoom expressions not supported")]);const p=Ma(i);return p||c?p instanceof wr?es([p]):p instanceof jn&&!ba(t)?es([new wr("",'"interpolate" expressions cannot be used with this property')]):Gn(p?new Co(s?"camera":"composite",e.value,p.labels,p instanceof jn?p.interpolation:void 0):new Ta(s?"constant":"source",e.value)):es([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ea{constructor(t,i){this._parameters=t,this._specification=i,Gr(this,Sc(this._parameters,this._specification))}static deserialize(t){return new Ea(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ma(e){let t=null;if(e instanceof _c)t=Ma(e.result);else if(e instanceof Dh){for(const i of e.args)if(t=Ma(i),t)break}else(e instanceof dc||e instanceof jn)&&e.input instanceof bo&&"zoom"===e.input.name&&(t=e);return t instanceof wr||e.eachChild(i=>{const s=Ma(i);s instanceof wr?t=s:!t&&s?t=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class re{constructor(t,i,s,c){this.message=(t?`${t}: `:"")+s,c&&(this.identifier=c),null!=i&&i.__line__&&(this.line=i.__line__)}}function kn(e){const t=e.key,i=e.value,s=e.valueSpec||{},c=e.objectElementValidators||{},p=e.style,g=e.styleSpec;let x=[];const w=Ye(i);if("object"!==w)return[new re(t,i,`object expected, ${w} found`)];for(const E in i){const A=E.split(".")[0];let P;c[A]?P=c[A]:s[A]?P=dn:c["*"]?P=c["*"]:s["*"]&&(P=dn),P?x=x.concat(P({key:(t&&`${t}.`)+E,value:i[E],valueSpec:s[A]||s["*"],style:p,styleSpec:g,object:i,objectKey:E},i)):x.push(new re(t,i[E],`unknown property "${E}"`))}for(const E in s)c[E]||s[E].required&&void 0===s[E].default&&void 0===i[E]&&x.push(new re(t,i,`missing required property "${E}"`));return x}function kc(e){const t=e.value,i=e.valueSpec,s=e.style,c=e.styleSpec,p=e.key,g=e.arrayElementValidator||dn;if("array"!==Ye(t))return[new re(p,t,`array expected, ${Ye(t)} found`)];if(i.length&&t.length!==i.length)return[new re(p,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new re(p,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(x.function=i.function),"object"===Ye(i.value)&&(x=i.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:x,style:s,styleSpec:c,key:`${p}[${E}]`}));return w}function zc(e){const t=e.key,i=e.value,s=e.valueSpec;let c=Ye(i);if("number"===c&&i!=i&&(c="NaN"),"number"!==c)return[new re(t,i,`number expected, ${c} found`)];if("minimum"in s){let p=s.minimum;if("array"===Ye(s.minimum)&&(p=s.minimum[e.arrayIndex]),i<p)return[new re(t,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if("array"===Ye(s.maximum)&&(p=s.maximum[e.arrayIndex]),i>p)return[new re(t,i,`${i} is greater than the maximum value ${p}`)]}return[]}function Tn(e){const t=e.valueSpec,i=bi(e.value.type);let s,c,p,g={};const x="categorical"!==i&&void 0===e.value.property,w=!x,E="array"===Ye(e.value.stops)&&"array"===Ye(e.value.stops[0])&&"object"===Ye(e.value.stops[0][0]),A=kn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(R){if("identity"===i)return[new re(R.key,R.value,'identity function may not have a "stops" property')];let O=[];const V=R.value;return O=O.concat(kc({key:R.key,value:V,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:k})),"array"===Ye(V)&&0===V.length&&O.push(new re(R.key,V,"array must have at least one stop")),O},default:function(R){return dn({key:R.key,value:R.value,valueSpec:t,style:R.style,styleSpec:R.styleSpec})}}});return"identity"===i&&x&&A.push(new re(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||A.push(new re(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!ba(e.valueSpec)&&A.push(new re(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(w&&!Os(e.valueSpec)?A.push(new re(e.key,e.value,"property functions not supported")):x&&!Hr(e.valueSpec)&&A.push(new re(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!E||void 0!==e.value.property||A.push(new re(e.key,e.value,'"property" property is required')),A;function k(R){let O=[];const V=R.value,q=R.key;if("array"!==Ye(V))return[new re(q,V,`array expected, ${Ye(V)} found`)];if(2!==V.length)return[new re(q,V,`array length 2 expected, length ${V.length} found`)];if(E){if("object"!==Ye(V[0]))return[new re(q,V,`object expected, ${Ye(V[0])} found`)];if(void 0===V[0].zoom)return[new re(q,V,"object stop key must have zoom")];if(void 0===V[0].value)return[new re(q,V,"object stop key must have value")];const et=bi(V[0].zoom);if("number"!=typeof et)return[new re(q,V[0].zoom,"stop zoom values must be numbers")];if(p&&p>et)return[new re(q,V[0].zoom,"stop zoom values must appear in ascending order")];et!==p&&(p=et,c=void 0,g={}),O=O.concat(kn({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:zc,value:P}}))}else O=O.concat(P({key:`${q}[0]`,value:V[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},V));return Fs(vr(V[1]))?O.concat([new re(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):O.concat(dn({key:`${q}[1]`,value:V[1],valueSpec:t,style:R.style,styleSpec:R.styleSpec}))}function P(R,O){const V=Ye(R.value),q=bi(R.value),et=null!==R.value?R.value:O;if(s){if(V!==s)return[new re(R.key,et,`${V} stop domain type must match previous stop domain type ${s}`)]}else s=V;if("number"!==V&&"string"!==V&&"boolean"!==V&&"number"!=typeof q&&"string"!=typeof q&&"boolean"!=typeof q)return[new re(R.key,et,"stop domain value must be a number, string, or boolean")];if("number"!==V&&"categorical"!==i){let lt=`number expected, ${V} found`;return Os(t)&&void 0===i&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new re(R.key,et,lt)]}return"categorical"!==i||"number"!==V||"number"==typeof q&&isFinite(q)&&Math.floor(q)===q?"categorical"!==i&&"number"===V&&"number"==typeof q&&"number"==typeof c&&void 0!==c&&q<c?[new re(R.key,et,"stop domain values must appear in ascending order")]:(c=q,"categorical"===i&&q in g?[new re(R.key,et,"stop domain values must be unique")]:(g[q]=!0,[])):[new re(R.key,et,`integer expected, found ${String(q)}`)]}}function Ns(e){const t=("property"===e.expressionContext?Xr:Us)(vr(e.value),e.valueSpec);if("error"===t.result)return t.value.map(s=>new re(`${e.key}${s.key}`,e.value,s.message));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new re(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ps(i))return[new re(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return jh(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!ol(i,["zoom","feature-state"]))return[new re(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Mr(i))return[new re(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jh(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const c of t.valueSpec.expression.parameters)i.delete(c);if(0===i.size)return[];const s=[];return e instanceof bo&&i.has(e.name)?[new re(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(c=>{s.push(...jh(c,t))}),s)}function wl(e){const t=e.key,i=e.value,s=e.valueSpec,c=[];return Array.isArray(s.values)?-1===s.values.indexOf(bi(i))&&c.push(new re(t,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(bi(i))&&c.push(new re(t,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function Pc(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Pc(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Tl(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pc(e)||(e=Ca(e));const i=e;let s=!0;try{s=function(E){if(!Yi(E))return E;let A=vr(E);return js(A),A=Vs(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const c=zt[`filter_${t}`],p=Us(s,c);let g=null;if("error"===p.result)throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,A,k)=>p.value.evaluate(E,A,{},k);let x=null,w=null;if(s!==i){const E=Us(i,c);if("error"===E.result)throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,k,P,R,O)=>E.value.evaluate(A,k,{},P,void 0,void 0,R,O),w=!Mr(E.value.expression)}return{filter:g,dynamicFilter:x||void 0,needGeometry:Gh(s),needFeature:!!w}}function Vs(e){if(!Array.isArray(e))return e;const t=function(i){if(El.has(i[0]))for(let s=1;s<i.length;s++)if(Yi(i[s]))return!0;return i}(e);return!0===t?t:t.map(i=>Vs(i))}function js(e){let t=!1;const i=[];if("case"===e[0]){for(let s=1;s<e.length-1;s+=2)t=t||Yi(e[s]),i.push(e[s+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||Yi(e[1]);for(let s=2;s<e.length-1;s+=2)i.push(e[s+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||Yi(e[1]);for(let s=1;s<e.length-1;s+=2)i.push(e[s+1])}t&&(e.length=0,e.push("any",...i));for(let s=1;s<e.length;s++)js(e[s])}function Yi(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let i=1;i<e.length;i++)if(Yi(e[i]))return!0;return!1}const El=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rd(e,t){return e<t?-1:e>t?1:0}function Gh(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Gh(e[t]))return!0;return!1}function Ca(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Dc(e[1],e[2],"=="):"!="===t?Yr(Dc(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Dc(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(Ca))):"all"===t?["all"].concat(e.slice(1).map(Ca)):"none"===t?["all"].concat(e.slice(1).map(Ca).map(Yr)):"in"===t?Sa(e[1],e.slice(2)):"!in"===t?Yr(Sa(e[1],e.slice(2))):"has"===t?Zh(e[1]):"!has"===t?Yr(Zh(e[1])):"within"!==t||e;var i}function Dc(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function Sa(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(rd)]]:["filter-in-small",e,["literal",t]]}}function Zh(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Yr(e){return["!",e]}function Gs(e){return Pc(vr(e.value))?Ns(Gr({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):$h(e)}function $h(e){const t=e.value,i=e.key;if("array"!==Ye(t))return[new re(i,t,`array expected, ${Ye(t)} found`)];const s=e.styleSpec;let c,p=[];if(t.length<1)return[new re(i,t,"filter array must have at least 1 element")];switch(p=p.concat(wl({key:`${i}[0]`,value:t[0],valueSpec:s.filter_operator,style:e.style,styleSpec:e.styleSpec})),bi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===bi(t[1])&&p.push(new re(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&p.push(new re(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Ye(t[1]),"string"!==c&&p.push(new re(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Ye(t[g]),"$type"===bi(t[1])?p=p.concat(wl({key:`${i}[${g}]`,value:t[g],valueSpec:s.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==c&&"number"!==c&&"boolean"!==c&&p.push(new re(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)p=p.concat($h({key:`${i}[${g}]`,value:t[g],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":c=Ye(t[1]),2!==t.length?p.push(new re(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==c&&p.push(new re(`${i}[1]`,t[1],`string expected, ${c} found`));break;case"within":c=Ye(t[1]),2!==t.length?p.push(new re(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==c&&p.push(new re(`${i}[1]`,t[1],`object expected, ${c} found`))}return p}function Sr(e,t){const i=e.key,s=e.style,c=e.styleSpec,p=e.value,g=e.objectKey,x=c[`${t}_${e.layerType}`];if(!x)return[];const w=g.match(/^(.*)-transition$/);if("paint"===t&&w&&x[w[1]]&&x[w[1]].transition)return dn({key:i,value:p,valueSpec:c.transition,style:s,styleSpec:c});const E=e.valueSpec||x[g];if(!E)return[new re(i,p,`unknown property "${g}"`)];let A;if("string"===Ye(p)&&Os(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new re(i,p,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const k=[];return"symbol"===e.layerType&&("text-field"===g&&s&&!s.glyphs&&k.push(new re(i,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&yl(vr(p))&&"identity"===bi(p.type)&&k.push(new re(i,p,'"text-font" does not support identity functions'))),k.concat(dn({key:e.key,value:p,valueSpec:E,style:s,styleSpec:c,expressionContext:"property",propertyType:t,propertyKey:g}))}function Aa(e){return Sr(e,"paint")}function is(e){return Sr(e,"layout")}function Ia(e){let t=[];const i=e.value,s=e.key,c=e.style,p=e.styleSpec;i.type||i.ref||t.push(new re(s,i,'either "type" or "ref" is required'));let g=bi(i.type);const x=bi(i.ref);if(i.id){const w=bi(i.id);for(let E=0;E<e.arrayIndex;E++){const A=c.layers[E];bi(A.id)===w&&t.push(new re(s,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&t.push(new re(s,i[E],`"${E}" is prohibited for ref layers`))}),c.layers.forEach(E=>{bi(E.id)===x&&(w=E)}),w?w.ref?t.push(new re(s,i.ref,"ref cannot reference another ref layer")):g=bi(w.type):"string"==typeof x&&t.push(new re(s,i.ref,`ref layer "${x}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const w=c.sources&&c.sources[i.source],E=w&&bi(w.type);w?"vector"===E&&"raster"===g?t.push(new re(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===E&&"raster"!==g?t.push(new re(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==E||i["source-layer"]?"raster-dem"===E&&"hillshade"!==g?t.push(new re(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===E&&w.lineMetrics||t.push(new re(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new re(s,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new re(s,i.source,`source "${i.source}" not found`))}else t.push(new re(s,i,'missing required property "source"'));return t=t.concat(kn({key:s,value:i,valueSpec:p.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dn({key:`${s}.type`,value:i.type,valueSpec:p.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:w=>Gs(Gr({layerType:g},w)),layout:w=>kn({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>is(Gr({layerType:g},E))}}),paint:w=>kn({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Aa(Gr({layerType:g},E))}})}})),t}function Jr(e){const t=e.value,i=e.key,s=Ye(t);return"string"!==s?[new re(i,t,`string expected, ${s} found`)]:[]}const ns={promoteId:function({key:e,value:t}){if("string"===Ye(t))return Jr({key:e,value:t});{const i=[];for(const s in t)i.push(...Jr({key:`${e}.${s}`,value:t[s]}));return i}}};function ka(e){const t=e.value,i=e.key,s=e.styleSpec,c=e.style;if(!t.type)return[new re(i,t,'"type" is required')];const p=bi(t.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=kn({key:i,value:t,valueSpec:s[`source_${p.replace("-","_")}`],style:e.style,styleSpec:s,objectElementValidators:ns}),g;case"geojson":if(g=kn({key:i,value:t,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:ns}),t.cluster)for(const x in t.clusterProperties){const[w,E]=t.clusterProperties[x],A="string"==typeof w?[w,["accumulated"],["get",x]]:w;g.push(...Ns({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),g.push(...Ns({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return kn({key:i,value:t,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return kn({key:i,value:t,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new re(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wl({key:`${i}.type`,value:t.type,valueSpec:{values:So(s)},style:c,styleSpec:s})}}function So(e){return e.source.reduce((t,i)=>{const s=e[i];return"enum"===s.type.type&&(t=t.concat(Object.keys(s.type.values))),t},[])}function Ml(e){const t=e.value,i=e.styleSpec,s=i.light,c=e.style;let p=[];const g=Ye(t);if(void 0===t)return p;if("object"!==g)return p=p.concat([new re("light",t,`object expected, ${g} found`)]),p;for(const x in t){const w=x.match(/^(.*)-transition$/);p=p.concat(w&&s[w[1]]&&s[w[1]].transition?dn({key:x,value:t[x],valueSpec:i.transition,style:c,styleSpec:i}):s[x]?dn({key:x,value:t[x],valueSpec:s[x],style:c,styleSpec:i}):[new re(x,t[x],`unknown property "${x}"`)])}return p}function Lc(e){const t=e.value,i=e.key,s=e.style,c=e.styleSpec,p=c.terrain;let g=[];const x=Ye(t);if(void 0===t)return g;if("object"!==x)return g=g.concat([new re("terrain",t,`object expected, ${x} found`)]),g;for(const w in t){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&p[E[1]]&&p[E[1]].transition?dn({key:w,value:t[w],valueSpec:c.transition,style:s,styleSpec:c}):p[w]?dn({key:w,value:t[w],valueSpec:p[w],style:s,styleSpec:c}):[new re(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=s.sources&&s.sources[t.source],E=w&&bi(w.type);w?"raster-dem"!==E&&g.push(new re(i,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new re(i,t.source,`source "${t.source}" not found`))}else g.push(new re(i,t,'terrain is missing required property "source"'));return g}function qh(e){const t=e.value,i=e.style,s=e.styleSpec,c=s.fog;let p=[];const g=Ye(t);if(void 0===t)return p;if("object"!==g)return p=p.concat([new re("fog",t,`object expected, ${g} found`)]),p;for(const x in t){const w=x.match(/^(.*)-transition$/);p=p.concat(w&&c[w[1]]&&c[w[1]].transition?dn({key:x,value:t[x],valueSpec:s.transition,style:i,styleSpec:s}):c[x]?dn({key:x,value:t[x],valueSpec:c[x],style:i,styleSpec:s}):[new re(x,t[x],`unknown property "${x}"`)])}return p}const Ao={"*":()=>[],array:kc,boolean:function(e){const t=e.value,i=e.key,s=Ye(t);return"boolean"!==s?[new re(i,t,`boolean expected, ${s} found`)]:[]},number:zc,color:function(e){const t=e.key,i=e.value,s=Ye(i);return"string"!==s?[new re(t,i,`color expected, ${s} found`)]:null===tl(i)?[new re(t,i,`color expected, "${i}" found`)]:[]},enum:wl,filter:Gs,function:Tn,layer:Ia,object:kn,source:ka,light:Ml,terrain:Lc,fog:qh,string:Jr,formatted:function(e){return 0===Jr(e).length?[]:Ns(e)},resolvedImage:function(e){return 0===Jr(e).length?[]:Ns(e)},projection:function(e){const t=e.value,i=e.styleSpec,s=i.projection,c=e.style;let p=[];const g=Ye(t);if("object"===g)for(const x in t)p=p.concat(dn({key:x,value:t[x],valueSpec:s[x],style:c,styleSpec:i}));else"string"!==g&&(p=p.concat([new re("projection",t,`object or string expected, ${g} found`)]));return p}};function dn(e){const t=e.value,i=e.valueSpec,s=e.styleSpec;return i.expression&&yl(bi(t))?Tn(e):i.expression&&Fs(vr(t))?Ns(e):i.type&&Ao[i.type]?Ao[i.type](e):kn(Gr({},e,{valueSpec:i.type?s[i.type]:i}))}function Rc(e){const t=e.value,i=e.key,s=Jr(e);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new re(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new re(i,t,'"glyphs" url must include a "{range}" token'))),s}function Wh(e,t=zt){return Ar(dn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Rc,"*":()=>[]}}))}const od=e=>Ar(Aa(e)),Cl=e=>Ar(is(e));function Ar(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Hh(e,t){let i=!1;if(t&&t.length)for(const s of t)e.fire(new Xi(new Error(s.message))),i=!0;return i}var rs=zn;function zn(e,t,i){var s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var c=new Int32Array(this.arrayBuffer);e=c[0],this.d=(t=c[1])+2*(i=c[2]);for(var p=0;p<this.d*this.d;p++){var g=c[3+p],x=c[3+p+1];s.push(g===x?null:c.subarray(g,x))}var w=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],w),this.bboxes=c.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var E=0;E<this.d*this.d;E++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var A=i/t*e;this.min=-A,this.max=e+A}zn.prototype.insert=function(e,t,i,s,c){this._forEachCell(t,i,s,c,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c)},zn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zn.prototype._insertCell=function(e,t,i,s,c,p){this.cells[c].push(p)},zn.prototype.query=function(e,t,i,s,c){var p=this.min,g=this.max;if(e<=p&&t<=p&&g<=i&&g<=s&&!c)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(e,t,i,s,this._queryCell,x,{},c),x},zn.prototype._queryCell=function(e,t,i,s,c,p,g,x){var w=this.cells[c];if(null!==w)for(var E=this.keys,A=this.bboxes,k=0;k<w.length;k++){var P=w[k];if(void 0===g[P]){var R=4*P;(x?x(A[R+0],A[R+1],A[R+2],A[R+3]):e<=A[R+2]&&t<=A[R+3]&&i>=A[R+0]&&s>=A[R+1])?(g[P]=!0,p.push(E[P])):g[P]=!1}}},zn.prototype._forEachCell=function(e,t,i,s,c,p,g,x){for(var w=this._convertToCellCoord(e),E=this._convertToCellCoord(t),A=this._convertToCellCoord(i),k=this._convertToCellCoord(s),P=w;P<=A;P++)for(var R=E;R<=k;R++){var O=this.d*R+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&c.call(this,e,t,i,s,O,p,g,x))return}},zn.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},zn.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},zn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var c=new Int32Array(t+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var p=t,g=0;g<e.length;g++){var x=e[g];c[3+g]=p,c.set(x,p),p+=x.length}return c[3+e.length]=p,c.set(this.keys,p),c[3+e.length+1]=p+=this.keys.length,c.set(this.bboxes,p),p+=this.bboxes.length,c.buffer};const za={};function le(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),za[t]={klass:e,omit:i.omit||[]}}le(Object,"Object"),rs.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},rs.deserialize=function(e){return new rs(e.buffer)},Object.defineProperty(rs,"name",{value:"Grid"}),le(rs,"Grid"),le(Fi,"Color"),le(Error,"Error"),le(Sn,"AJAXError"),le(wn,"ResolvedImage"),le(Ea,"StylePropertyFunction"),le(bl,"StyleExpression",{omit:["_evaluator"]}),le(Co,"ZoomDependentExpression"),le(Ta,"ZoomConstantExpression"),le(bo,"CompoundExpression",{omit:["_evaluate"]});for(const e in Bs)za[Bs[e]._classRegistryKey]||le(Bs[e],`Expression${e}`);function Xh(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Pa(e){return Xt.ImageBitmap&&e instanceof Xt.ImageBitmap}function Da(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Xh(e)||Pa(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof Xt.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const s of e)i.push(Da(s,t));return i}if("object"==typeof e){const i=e.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const p in e)e.hasOwnProperty(p)&&(za[s].omit.indexOf(p)>=0||(c[p]=Da(e[p],t)));e instanceof Error&&(c.message=e.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof e)}function La(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Xh(e)||Pa(e)||ArrayBuffer.isView(e)||e instanceof Xt.ImageData)return e;if(Array.isArray(e))return e.map(La);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=za[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const s=Object.create(i.prototype);for(const c of Object.keys(e))"$name"!==c&&(s[c]=La(e[c]));return s}throw new Error("can't deserialize object of type "+typeof e)}const Zs=e=>e>=1536&&e<=1791,Bc=e=>e>=1872&&e<=1919,Oc=e=>e>=2208&&e<=2303,Yh=e=>e>=11904&&e<=12031,Fc=e=>e>=12032&&e<=12255,os=e=>e>=12272&&e<=12287,Io=e=>e>=12288&&e<=12351,Ra=e=>e>=12352&&e<=12447,Zi=e=>e>=12448&&e<=12543,Ba=e=>e>=12544&&e<=12591,Jh=e=>e>=12704&&e<=12735,Oa=e=>e>=12736&&e<=12783,Uc=e=>e>=12784&&e<=12799,Nc=e=>e>=12800&&e<=13055,Kh=e=>e>=13056&&e<=13311,Vc=e=>e>=13312&&e<=19903,jc=e=>e>=19968&&e<=40959,Qh=e=>e>=40960&&e<=42127,tu=e=>e>=42128&&e<=42191,Fa=e=>e>=44032&&e<=55215,eu=e=>e>=63744&&e<=64255,Sl=e=>e>=64336&&e<=65023,Kr=e=>e>=65040&&e<=65055,d=e=>e>=65072&&e<=65103,n=e=>e>=65104&&e<=65135,l=e=>e>=65136&&e<=65279,f=e=>e>=65280&&e<=65519;function y(e){for(const t of e)if(C(t.charCodeAt(0)))return!0;return!1}function v(e){for(const t of e)if(!M(t.charCodeAt(0)))return!1;return!0}function M(e){return!(Zs(e)||Bc(e)||Oc(e)||Sl(e)||l(e))}function C(e){return!(746!==e&&747!==e&&(e<4352||!(Jh(e)||Ba(e)||d(e)&&!(e>=65097&&e<=65103)||eu(e)||Kh(e)||Yh(e)||Oa(e)||!(!Io(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Vc(e)||jc(e)||Nc(e)||(t=e,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(e)||(t=>t>=55216&&t<=55295)(e)||(t=>t>=4352&&t<=4607)(e)||Fa(e)||Ra(e)||os(e)||(t=>t>=12688&&t<=12703)(e)||Fc(e)||Uc(e)||Zi(e)&&12540!==e||!(!f(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!n(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(t=>t>=5120&&t<=5759)(e)||(t=>t>=6320&&t<=6399)(e)||Kr(e)||(t=>t>=19904&&t<=19967)(e)||Qh(e)||tu(e))));var t}function I(e){return!(C(e)||(t=e,(i=t)>=128&&i<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(i=>i>=8192&&i<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(i=>i>=8448&&i<=8527)(t)||(i=>i>=8528&&i<=8591)(t)||(i=>i>=8960&&i<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(i=>i>=9216&&i<=9279)(t)&&9251!==t||(i=>i>=9280&&i<=9311)(t)||(i=>i>=9312&&i<=9471)(t)||(i=>i>=9632&&i<=9727)(t)||(i=>i>=9728&&i<=9983)(t)&&!(t>=9754&&t<=9759)||(i=>i>=11008&&i<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Io(t)||Zi(t)||(i=>i>=57344&&i<=63743)(t)||d(t)||n(t)||f(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,i}function D(e){return e>=1424&&e<=2303||Sl(e)||l(e)}function L(e,t){return!(!t&&D(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(i=e,i>=6016&&i<=6143));var i}function N(e){for(const t of e)if(D(t.charCodeAt(0)))return!0;return!1}const $="deferred",X="loading",H="loaded";let Y=null,K="unavailable",Z=null;const rt=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(K="error"),Y&&Y(e)};function it(){ot.fire(new fi("pluginStateChange",{pluginStatus:K,pluginURL:Z}))}const ot=new Vn,pt=function(){return K},ut=function(){if(K!==$||!Z)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");K=X,it(),Z&&yr({url:Z},e=>{e?rt(e):(K=H,it())})},ft={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>K===H||null!=ft.applyArabicShaping,isLoading:()=>K===X,setState(e){K=e.pluginStatus,Z=e.pluginURL},isParsed:()=>null!=ft.applyArabicShaping&&null!=ft.processBidirectionalText&&null!=ft.processStyledBidirectionalText,getPluginURL:()=>Z};class wt{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,s){for(const c of i)if(!L(c.charCodeAt(0),s))return!1;return!0}(t,ft.isLoaded())}}class Ct{constructor(t,i){this.property=t,this.value=i,this.expression=function(s,c){if(yl(s))return new Ea(s,c);if(Fs(s)){const p=Xr(s,c);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=s;return"string"==typeof s&&"color"===c.type&&(p=Fi.parse(s)),{kind:"constant",evaluate:()=>p}}}(void 0===i?t.specification.default:i,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,i,s){return this.property.possiblyEvaluate(this,t,i,s)}}class It{constructor(t){this.property=t,this.value=new Ct(t,void 0)}transitioned(t,i){return new Et(this.property,this.value,i,Hi({},t.transition,this.transition),t.now)}untransitioned(){return new Et(this.property,this.value,null,{},0)}}class Jt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Fn(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new It(this._values[t].property)),this._values[t].value=new Ct(this._values[t].property,null===i?void 0:Fn(i))}getTransition(t){return Fn(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new It(this._values[t].property)),this._values[t].transition=Fn(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(t[i]=s);const c=this.getTransition(i);void 0!==c&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){const s=new Ft(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(t,i._values[c]);return s}untransitioned(){const t=new Ft(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Et{constructor(t,i,s,c,p){const g=c.delay||0,x=c.duration||0;p=p||0,this.property=t,this.value=i,this.begin=p+g,this.end=this.begin+x,t.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(t,i,s){const c=t.now||0,p=this.value.possiblyEvaluate(t,i,s),g=this.prior;if(g){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return g.possiblyEvaluate(t,i,s);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,s),p,oa(x))}}return p}}class Ft{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,s){const c=new At(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,i,s);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Dt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Fn(this._values[t].value)}setValue(t,i){this._values[t]=new Ct(this._values[t].property,null===i?void 0:Fn(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(t[i]=s)}return t}possiblyEvaluate(t,i,s){const c=new At(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,i,s);return c}}class Zt{constructor(t,i,s){this.property=t,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,i,s,c){return this.property.evaluate(this.value,this.parameters,t,i,s,c)}}class At{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class vt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,s){const c=Ls[this.specification.type];return c?c(t,i,s):t}}class kt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,s,c){return new Zt(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(i,null,{},s,c)}:t.expression,i)}interpolate(t,i,s){if("constant"!==t.value.kind||"constant"!==i.value.kind)return t;if(void 0===t.value.value||void 0===i.value.value)return new Zt(this,{kind:"constant",value:void 0},t.parameters);const c=Ls[this.specification.type];return c?new Zt(this,{kind:"constant",value:c(t.value.value,i.value.value,s)},t.parameters):t}evaluate(t,i,s,c,p,g){return"constant"===t.kind?t.value:t.evaluate(i,s,c,p,g)}}class Ut{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,c){return!!t.expression.evaluate(i,null,{},s,c)}interpolate(){return!1}}class $t{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new wt(0,{});for(const s in t){const c=t[s];c.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Ct(c,void 0),g=this.defaultTransitionablePropertyValues[s]=new It(c);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(i)}}}function me(e,t){return 256*(e=Ue(Math.floor(e),0,255))+Ue(Math.floor(t),0,255)}le(kt,"DataDrivenProperty"),le(vt,"DataConstantProperty"),le(Ut,"ColorRampProperty");const Oe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class he{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ae{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ge(e,t=1){let i=0,s=0;return{members:e.map(c=>{const p=Oe[c.type].BYTES_PER_ELEMENT,g=i=je(i,Math.max(t,p)),x=c.components||1;return s=Math.max(s,p),i+=p*x,{name:c.name,type:c.type,components:x,offset:g}}),size:je(i,Math.max(s,t)),alignment:t}}function je(e,t){return Math.ceil(e/t)*t}class be extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const c=2*t;return this.int16[c+0]=i,this.int16[c+1]=s,t}}be.prototype.bytesPerElement=4,le(be,"StructArrayLayout2i4");class ri extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,s)}emplace(t,i,s,c){const p=3*t;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=c,t}}ri.prototype.bytesPerElement=6,le(ri,"StructArrayLayout3i6");class oi extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,s,c)}emplace(t,i,s,c,p){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=p,t}}oi.prototype.bytesPerElement=8,le(oi,"StructArrayLayout4i8");class wi extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,s,c,p,g,x)}emplace(t,i,s,c,p,g,x,w){const E=6*t,A=12*t,k=3*t;return this.int16[E+0]=i,this.int16[E+1]=s,this.uint8[A+4]=c,this.uint8[A+5]=p,this.uint8[A+6]=g,this.uint8[A+7]=x,this.float32[k+2]=w,t}}wi.prototype.bytesPerElement=12,le(wi,"StructArrayLayout2i4ub1f12");class mi extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,s,c)}emplace(t,i,s,c,p){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=c,this.float32[g+3]=p,t}}mi.prototype.bytesPerElement=16,le(mi,"StructArrayLayout4f16");class Vi extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,s,c,p)}emplace(t,i,s,c,p,g){const x=6*t,w=3*t;return this.uint16[x+0]=i,this.uint16[x+1]=s,this.uint16[x+2]=c,this.uint16[x+3]=p,this.float32[w+2]=g,t}}Vi.prototype.bytesPerElement=12,le(Vi,"StructArrayLayout4ui1f12");class Pn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,s,c)}emplace(t,i,s,c,p){const g=4*t;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=c,this.uint16[g+3]=p,t}}Pn.prototype.bytesPerElement=8,le(Pn,"StructArrayLayout4ui8");class Jn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,s,c,p,g)}emplace(t,i,s,c,p,g,x){const w=6*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.int16[w+3]=p,this.int16[w+4]=g,this.int16[w+5]=x,t}}Jn.prototype.bytesPerElement=12,le(Jn,"StructArrayLayout6i12");class Ir extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x,w,E,A,k,P){const R=this.length;return this.resize(R+1),this.emplace(R,t,i,s,c,p,g,x,w,E,A,k,P)}emplace(t,i,s,c,p,g,x,w,E,A,k,P,R){const O=12*t;return this.int16[O+0]=i,this.int16[O+1]=s,this.int16[O+2]=c,this.int16[O+3]=p,this.uint16[O+4]=g,this.uint16[O+5]=x,this.uint16[O+6]=w,this.uint16[O+7]=E,this.int16[O+8]=A,this.int16[O+9]=k,this.int16[O+10]=P,this.int16[O+11]=R,t}}Ir.prototype.bytesPerElement=24,le(Ir,"StructArrayLayout4i4ui4i24");class xi extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,s,c,p,g)}emplace(t,i,s,c,p,g,x){const w=10*t,E=5*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.float32[E+2]=p,this.float32[E+3]=g,this.float32[E+4]=x,t}}xi.prototype.bytesPerElement=20,le(xi,"StructArrayLayout3i3f20");class si extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}si.prototype.bytesPerElement=4,le(si,"StructArrayLayout1ul4");class ei extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x,w,E,A,k,P,R){const O=this.length;return this.resize(O+1),this.emplace(O,t,i,s,c,p,g,x,w,E,A,k,P,R)}emplace(t,i,s,c,p,g,x,w,E,A,k,P,R,O){const V=20*t,q=10*t;return this.int16[V+0]=i,this.int16[V+1]=s,this.int16[V+2]=c,this.int16[V+3]=p,this.int16[V+4]=g,this.float32[q+3]=x,this.float32[q+4]=w,this.float32[q+5]=E,this.float32[q+6]=A,this.int16[V+14]=k,this.uint32[q+8]=P,this.uint16[V+18]=R,this.uint16[V+19]=O,t}}ei.prototype.bytesPerElement=40,le(ei,"StructArrayLayout5i4f1i1ul2ui40");class Li extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,s,c,p,g,x)}emplace(t,i,s,c,p,g,x,w){const E=8*t;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+4]=p,this.int16[E+5]=g,this.int16[E+6]=x,this.int16[E+7]=w,t}}Li.prototype.bytesPerElement=16,le(Li,"StructArrayLayout3i2i2i16");class pn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,s,c,p)}emplace(t,i,s,c,p,g){const x=4*t,w=8*t;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=c,this.int16[w+6]=p,this.int16[w+7]=g,t}}pn.prototype.bytesPerElement=16,le(pn,"StructArrayLayout2f1f2i16");class Ei extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,s,c)}emplace(t,i,s,c,p){const g=12*t,x=3*t;return this.uint8[g+0]=i,this.uint8[g+1]=s,this.float32[x+1]=c,this.float32[x+2]=p,t}}Ei.prototype.bytesPerElement=12,le(Ei,"StructArrayLayout2ub2f12");class fn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,s)}emplace(t,i,s,c){const p=3*t;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=c,t}}fn.prototype.bytesPerElement=12,le(fn,"StructArrayLayout3f12");class mn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,s)}emplace(t,i,s,c){const p=3*t;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=c,t}}mn.prototype.bytesPerElement=6,le(mn,"StructArrayLayout3ui6");class Qr extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt)}emplace(t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt,ht){const St=30*t,Mt=15*t,Ot=60*t;return this.int16[St+0]=i,this.int16[St+1]=s,this.int16[St+2]=c,this.float32[Mt+2]=p,this.float32[Mt+3]=g,this.uint16[St+8]=x,this.uint16[St+9]=w,this.uint32[Mt+5]=E,this.uint32[Mt+6]=A,this.uint32[Mt+7]=k,this.uint16[St+16]=P,this.uint16[St+17]=R,this.uint16[St+18]=O,this.float32[Mt+10]=V,this.float32[Mt+11]=q,this.uint8[Ot+48]=et,this.uint8[Ot+49]=lt,this.uint8[Ot+50]=tt,this.uint32[Mt+13]=st,this.int16[St+28]=dt,this.uint8[Ot+58]=ht,t}}Qr.prototype.bytesPerElement=60,le(Qr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ss extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt,Gt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt,Gt)}emplace(t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q,et,lt,tt,st,dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt,Gt,Ht){const Lt=38*t,Qt=19*t;return this.int16[Lt+0]=i,this.int16[Lt+1]=s,this.int16[Lt+2]=c,this.float32[Qt+2]=p,this.float32[Qt+3]=g,this.int16[Lt+8]=x,this.int16[Lt+9]=w,this.int16[Lt+10]=E,this.int16[Lt+11]=A,this.int16[Lt+12]=k,this.int16[Lt+13]=P,this.uint16[Lt+14]=R,this.uint16[Lt+15]=O,this.uint16[Lt+16]=V,this.uint16[Lt+17]=q,this.uint16[Lt+18]=et,this.uint16[Lt+19]=lt,this.uint16[Lt+20]=tt,this.uint16[Lt+21]=st,this.uint16[Lt+22]=dt,this.uint16[Lt+23]=ht,this.uint16[Lt+24]=St,this.uint16[Lt+25]=Mt,this.uint16[Lt+26]=Ot,this.uint16[Lt+27]=qt,this.uint16[Lt+28]=Pt,this.uint32[Qt+15]=Nt,this.float32[Qt+16]=Vt,this.float32[Qt+17]=Gt,this.float32[Qt+18]=Ht,t}}ss.prototype.bytesPerElement=76,le(ss,"StructArrayLayout3i2f6i15ui1ul3f76");class Dn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Dn.prototype.bytesPerElement=4,le(Dn,"StructArrayLayout1f4");class Kn extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,s,c,p)}emplace(t,i,s,c,p,g){const x=5*t;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=c,this.float32[x+3]=p,this.float32[x+4]=g,t}}Kn.prototype.bytesPerElement=20,le(Kn,"StructArrayLayout5f20");class kr extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,s,c)}emplace(t,i,s,c,p){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=s,this.uint16[g+3]=c,this.uint16[g+4]=p,t}}kr.prototype.bytesPerElement=12,le(kr,"StructArrayLayout1ul3ui12");class cr extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=s,t}}cr.prototype.bytesPerElement=4,le(cr,"StructArrayLayout2ui4");class to extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}to.prototype.bytesPerElement=2,le(to,"StructArrayLayout1ui2");class $s extends ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const c=2*t;return this.float32[c+0]=i,this.float32[c+1]=s,t}}$s.prototype.bytesPerElement=8,le($s,"StructArrayLayout2f8");class xp extends he{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xp.prototype.size=40;class sd extends ei{get(t){return new xp(this,t)}}le(sd,"CollisionBoxArray");class eo extends he{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}eo.prototype.size=60;class ad extends Qr{get(t){return new eo(this,t)}}le(ad,"PlacedSymbolArray");class vp extends he{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vp.prototype.size=76;class bp extends ss{get(t){return new vp(this,t)}}le(bp,"SymbolInstanceArray");class wp extends Dn{getoffsetX(t){return this.float32[1*t+0]}}le(wp,"GlyphOffsetArray");class Ua extends be{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}le(Ua,"SymbolLineVertexArray");class Gc extends he{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Gc.prototype.size=12;class Tp extends kr{get(t){return new Gc(this,t)}}le(Tp,"FeatureIndexArray");class Ep extends cr{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}le(Ep,"FillExtrusionCentroidArray");const iu=ge([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mp=ge([{name:"a_dash",components:4,type:"Uint16"}]);var Na={},Im={get exports(){return Na},set exports(e){Na=e}},nu={};({get exports(){return nu},set exports(e){nu=e}}).exports=function(e,t){var i,s,c,p,g,x,w,E;for(s=e.length-(i=3&e.length),c=t,g=3432918353,x=461845907,E=0;E<s;)w=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,c=27492+(65535&(p=5*(65535&(c=(c^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&e.charCodeAt(E+2))<<16;case 2:w^=(255&e.charCodeAt(E+1))<<8;case 1:c^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var ld={};({get exports(){return ld},set exports(e){ld=e}}).exports=function(e,t){for(var i,s=e.length,c=t^s,p=0;s>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:c^=(255&e.charCodeAt(p+2))<<16;case 2:c^=(255&e.charCodeAt(p+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(p)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Cp=nu,cd=ld;Im.exports=Cp,Na.murmur3=Cp,Na.murmur2=cd;class ru{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,s,c){this.ids.push(Sp(t)),this.positions.push(i,s,c)}getPositions(t){const i=Sp(t);let s=0,c=this.ids.length-1;for(;s<c;){const g=s+c>>1;this.ids[g]>=i?c=g:s=g+1}const p=[];for(;this.ids[s]===i;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(t,i){const s=new Float64Array(t.ids),c=new Uint32Array(t.positions);return hd(s,c,0,s.length-1),i&&i.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(t){const i=new ru;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Sp(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Na(String(e))}function hd(e,t,i,s){for(;i<s;){const c=e[i+s>>1];let p=i-1,g=s+1;for(;;){do{p++}while(e[p]<c);do{g--}while(e[g]>c);if(p>=g)break;ou(e,p,g),ou(t,3*p,3*g),ou(t,3*p+1,3*g+1),ou(t,3*p+2,3*g+2)}g-i<s-g?(hd(e,t,i,g),i=g+1):(hd(e,t,g+1,s),s=g)}}function ou(e,t,i){const s=e[t];e[t]=e[i],e[i]=s}le(ru,"FeaturePositionMap");class as{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class io extends as{constructor(t){super(t),this.current=0}set(t,i,s){this.fetchUniformLocation(t,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ud extends as{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,s){this.fetchUniformLocation(t,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Zc extends as{constructor(t){super(t),this.current=Fi.transparent}set(t,i,s){this.fetchUniformLocation(t,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Ap=new Float32Array(16),qs=new Float32Array(9),km=new Float32Array(4);function dd(e){return[me(255*e.r,255*e.g),me(255*e.b,255*e.a)]}class $c{constructor(t,i,s){this.value=t,this.uniformNames=i.map(c=>`u_${c}`),this.type=s}setUniform(t,i,s,c,p){i.set(t,p,c.constantOr(this.value))}getBinding(t,i){return"color"===this.type?new Zc(t):new io(t)}}class Ws{constructor(t,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,s,c,p){const g="u_pattern"===p||"u_dash"===p?this.pattern:"u_pixel_ratio"===p?this.pixelRatio:null;g&&i.set(t,p,g)}getBinding(t,i){return"u_pattern"===i||"u_dash"===i?new ud(t):new io(t)}}class ls{constructor(t,i,s,c){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,i,s,c,p,g){const x=this.paintVertexArray.length,w=this.expression.evaluate(new wt(0),i,{},p,c,g);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,i,s,c,p){const g=this.expression.evaluate({zoom:0},s,c,void 0,p);this._setPaintValue(t,i,g)}_setPaintValue(t,i,s){if("color"===this.type){const c=dd(s);for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(t,i,s,c,p,g){this.expression=t,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,s,c,p,g){const x=this.expression.evaluate(new wt(this.zoom),i,{},p,c,g),w=this.expression.evaluate(new wt(this.zoom+1),i,{},p,c,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,x,w)}updatePaintArray(t,i,s,c,p){const g=this.expression.evaluate({zoom:this.zoom},s,c,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,p);this._setPaintValue(t,i,g,x)}_setPaintValue(t,i,s,c){if("color"===this.type){const p=dd(s),g=dd(c);for(let x=t;x<i;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,s,c,p){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,x=Ue(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(t,p,x)}getBinding(t,i){return new io(t)}}class ko{constructor(t,i,s,c,p){this.expression=t,this.layerId=p,this.paintVertexAttributes=("array"===s?Mp:iu).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c}populatePaintArray(t,i,s){const c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(t,i,s,c,p,g){this._setPaintValues(t,i,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(t,i,s,c){if(!c||!s)return;const p=c[s];if(!p)return;const{tl:g,br:x,pixelRatio:w}=p;for(let E=t;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],x[0],x[1],w)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ro{constructor(t,i,s=(()=>!0)){this.binders={},this._buffers=[];const c=[];for(const p in t.paint._values){if(!s(p))continue;const g=t.paint.get(p);if(!(g instanceof Zt&&Os(g.property.specification)))continue;const x=Ip(p,t.type),w=g.value,E=g.property.specification.type,A=g.property.useIntegerZoom,k="line-dasharray"===p||p.endsWith("pattern"),P="line-dasharray"===p&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==w.kind||P)if("source"===w.kind||P||k){const R=Pp(p,E,"source");this.binders[p]=k?new ko(w,x,E,R,t.id):new ls(w,x,E,R),c.push(`/a_${p}`)}else{const R=Pp(p,E,"composite");this.binders[p]=new no(w,x,E,A,i,R),c.push(`/z_${p}`)}else this.binders[p]=k?new Ws(w.value,x):new $c(w.value,x,E),c.push(`/u_${p}`)}this.cacheKey=c.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof ls||i instanceof no?i.maxValue:0}populatePaintArrays(t,i,s,c,p,g){for(const x in this.binders){const w=this.binders[x];(w instanceof ls||w instanceof no||w instanceof ko)&&w.populatePaintArray(t,i,s,c,p,g)}}setConstantPatternPositions(t){for(const i in this.binders){const s=this.binders[i];s instanceof Ws&&s.setConstantPatternPositions(t)}}updatePaintArrays(t,i,s,c,p,g){let x=!1;for(const w in t){const E=i.getPositions(w);for(const A of E){const k=s.feature(A.index);for(const P in this.binders){const R=this.binders[P];if((R instanceof ls||R instanceof no||R instanceof ko)&&!0===R.expression.isStateDependent){const O=c.paint.get(P);R.expression=O.value,R.updatePaintArray(A.start,A.end,k,t[w],p,g),x=!0}}}}return x}defines(){const t=[];for(const i in this.binders){const s=this.binders[i];(s instanceof $c||s instanceof Ws)&&t.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof ls||s instanceof no||s instanceof ko)for(let c=0;c<s.paintVertexAttributes.length;c++)t.push(s.paintVertexAttributes[c].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof $c||s instanceof Ws||s instanceof no)for(const c of s.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof $c||c instanceof Ws||c instanceof no)for(const p of c.uniformNames)i.push({name:p,property:s,binding:c.getBinding(t,p)})}return i}setUniforms(t,i,s,c,p){for(const{name:g,property:x,binding:w}of s)this.binders[x].setUniform(t,w,p,c.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ls||i instanceof no||i instanceof ko)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const s=this.binders[i];(s instanceof ls||s instanceof no||s instanceof ko)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof ls||i instanceof no||i instanceof ko)&&i.destroy()}}}class Va{constructor(t,i,s=(()=>!0)){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new ro(c,i,s);this.needsUpload=!1,this._featureMap=new ru,this._bufferOffset=0}populatePaintArrays(t,i,s,c,p,g,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,i,c,p,g,x);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,s,c,p){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,c,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const pd={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ip(e,t){return pd[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const kp={"line-pattern":{source:Vi,composite:Vi},"fill-pattern":{source:Vi,composite:Vi},"fill-extrusion-pattern":{source:Vi,composite:Vi},"line-dasharray":{source:Pn,composite:Pn}},zp={color:{source:$s,composite:mi},number:{source:Dn,composite:$s}};function Pp(e,t,i){const s=kp[e];return s&&s[i]||zp[t][i]}le($c,"ConstantBinder"),le(Ws,"PatternConstantBinder"),le(ls,"SourceExpressionBinder"),le(ko,"PatternCompositeBinder"),le(no,"CompositeExpressionBinder"),le(ro,"ProgramConfiguration",{omit:["_buffers"]}),le(Va,"ProgramConfigurationSet");const su="-transition";class oo extends Vn{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new Dt(i.layout)),i.paint)){this._transitionablePaint=new Jt(i.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new At(i.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,s={}){null!=i&&this._validate(Cl,`layers.${this.id}.layout.${t}`,t,i,s)||("visibility"!==t?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return mr(t,su)?this._transitionablePaint.getTransition(t.slice(0,-su.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,s={}){if(null!=i&&this._validate(od,`layers.${this.id}.paint.${t}`,t,i,s))return!1;if(mr(t,su))return this._transitionablePaint.setTransition(t.slice(0,-su.length),i||void 0),!1;{const c=this._transitionablePaint._values[t],p=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value,w=x.isDataDriven(),E=mr(t,"pattern")||"line-dasharray"===t;return w||p||E||this._handleOverridablePaintPropertyUpdate(t,g,x)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Uo(t,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(t,i,s,c,p={}){return(!p||!1!==p.validate)&&Hh(this,t.call(Wh,{key:i,layerType:this.type,objectKey:s,value:c,styleSpec:zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Zt&&Os(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Tl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const zm=ge([{name:"a_pos",components:2,type:"Int16"}],4),Dp=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $i{constructor(t=[]){this.segments=t}prepareSegment(t,i,s,c){let p=this.segments[this.segments.length-1];return t>$i.MAX_VERTEX_ARRAY_LENGTH&&Oi(`Max vertices per segment is ${$i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>$i.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==c&&(p.sortKey=c),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,s,c){return new $i([{vertexOffset:t,primitiveOffset:i,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}$i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,le($i,"SegmentVector");var Ce=8192;class Hs{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ke?new Ke(t.lng,t.lat):Ke.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ke?new Ke(t.lng,t.lat):Ke.convert(t),this}extend(t){const i=this._sw,s=this._ne;let c,p;if(t instanceof Ke)c=t,p=t;else{if(!(t instanceof Hs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Hs.convert(t)):this.extend(Ke.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&t.hasOwnProperty("lon")?this.extend(Ke.convert(t)):this;if(c=t._sw,p=t._ne,!c||!p)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new Ke(c.lng,c.lat),this._ne=new Ke(p.lng,p.lat)),this}getCenter(){return new Ke((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ke(this.getWest(),this.getNorth())}getSouthEast(){return new Ke(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:s}=Ke.convert(t);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(t){return!t||t instanceof Hs?t:new Hs(t)}}var au=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function fd(){var e=new Zn(9);return Zn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Lp(e,t,i){var s=t[0],c=t[1],p=t[2],g=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],P=i[0],R=i[1],O=i[2],V=i[3],q=i[4],et=i[5],lt=i[6],tt=i[7],st=i[8];return e[0]=P*s+R*g+O*E,e[1]=P*c+R*x+O*A,e[2]=P*p+R*w+O*k,e[3]=V*s+q*g+et*E,e[4]=V*c+q*x+et*A,e[5]=V*p+q*w+et*k,e[6]=lt*s+tt*g+st*E,e[7]=lt*c+tt*x+st*A,e[8]=lt*p+tt*w+st*k,e}function so(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function md(e,t){var i=t[0],s=t[1],c=t[2],p=t[3],g=t[4],x=t[5],w=t[6],E=t[7],A=t[8],k=t[9],P=t[10],R=t[11],O=t[12],V=t[13],q=t[14],et=t[15],lt=i*x-s*g,tt=i*w-c*g,st=i*E-p*g,dt=s*w-c*x,ht=s*E-p*x,St=c*E-p*w,Mt=A*V-k*O,Ot=A*q-P*O,qt=A*et-R*O,Pt=k*q-P*V,Nt=k*et-R*V,Vt=P*et-R*q,Gt=lt*Vt-tt*Nt+st*Pt+dt*qt-ht*Ot+St*Mt;return Gt?(e[0]=(x*Vt-w*Nt+E*Pt)*(Gt=1/Gt),e[1]=(c*Nt-s*Vt-p*Pt)*Gt,e[2]=(V*St-q*ht+et*dt)*Gt,e[3]=(P*ht-k*St-R*dt)*Gt,e[4]=(w*qt-g*Vt-E*Ot)*Gt,e[5]=(i*Vt-c*qt+p*Ot)*Gt,e[6]=(q*st-O*St-et*tt)*Gt,e[7]=(A*St-P*st+R*tt)*Gt,e[8]=(g*Nt-x*qt+E*Mt)*Gt,e[9]=(s*qt-i*Nt-p*Mt)*Gt,e[10]=(O*ht-V*st+et*lt)*Gt,e[11]=(k*st-A*ht-R*lt)*Gt,e[12]=(x*Ot-g*Pt-w*Mt)*Gt,e[13]=(i*Pt-s*Ot+c*Mt)*Gt,e[14]=(V*tt-O*dt-q*lt)*Gt,e[15]=(A*dt-k*tt+P*lt)*Gt,e):null}function cs(e,t,i){var s=t[0],c=t[1],p=t[2],g=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],P=t[9],R=t[10],O=t[11],V=t[12],q=t[13],et=t[14],lt=t[15],tt=i[0],st=i[1],dt=i[2],ht=i[3];return e[0]=tt*s+st*x+dt*k+ht*V,e[1]=tt*c+st*w+dt*P+ht*q,e[2]=tt*p+st*E+dt*R+ht*et,e[3]=tt*g+st*A+dt*O+ht*lt,e[4]=(tt=i[4])*s+(st=i[5])*x+(dt=i[6])*k+(ht=i[7])*V,e[5]=tt*c+st*w+dt*P+ht*q,e[6]=tt*p+st*E+dt*R+ht*et,e[7]=tt*g+st*A+dt*O+ht*lt,e[8]=(tt=i[8])*s+(st=i[9])*x+(dt=i[10])*k+(ht=i[11])*V,e[9]=tt*c+st*w+dt*P+ht*q,e[10]=tt*p+st*E+dt*R+ht*et,e[11]=tt*g+st*A+dt*O+ht*lt,e[12]=(tt=i[12])*s+(st=i[13])*x+(dt=i[14])*k+(ht=i[15])*V,e[13]=tt*c+st*w+dt*P+ht*q,e[14]=tt*p+st*E+dt*R+ht*et,e[15]=tt*g+st*A+dt*O+ht*lt,e}function qc(e,t,i){var s,c,p,g,x,w,E,A,k,P,R,O,V=i[0],q=i[1],et=i[2];return t===e?(e[12]=t[0]*V+t[4]*q+t[8]*et+t[12],e[13]=t[1]*V+t[5]*q+t[9]*et+t[13],e[14]=t[2]*V+t[6]*q+t[10]*et+t[14],e[15]=t[3]*V+t[7]*q+t[11]*et+t[15]):(c=t[1],p=t[2],g=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],P=t[9],R=t[10],O=t[11],e[0]=s=t[0],e[1]=c,e[2]=p,e[3]=g,e[4]=x,e[5]=w,e[6]=E,e[7]=A,e[8]=k,e[9]=P,e[10]=R,e[11]=O,e[12]=s*V+x*q+k*et+t[12],e[13]=c*V+w*q+P*et+t[13],e[14]=p*V+E*q+R*et+t[14],e[15]=g*V+A*q+O*et+t[15]),e}function hs(e,t,i){var s=i[0],c=i[1],p=i[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*c,e[5]=t[5]*c,e[6]=t[6]*c,e[7]=t[7]*c,e[8]=t[8]*p,e[9]=t[9]*p,e[10]=t[10]*p,e[11]=t[11]*p,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lu(e,t,i){var s=Math.sin(i),c=Math.cos(i),p=t[4],g=t[5],x=t[6],w=t[7],E=t[8],A=t[9],k=t[10],P=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=p*c+E*s,e[5]=g*c+A*s,e[6]=x*c+k*s,e[7]=w*c+P*s,e[8]=E*c-p*s,e[9]=A*c-g*s,e[10]=k*c-x*s,e[11]=P*c-w*s,e}function Wc(e,t,i){var s=Math.sin(i),c=Math.cos(i),p=t[0],g=t[1],x=t[2],w=t[3],E=t[8],A=t[9],k=t[10],P=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=p*c-E*s,e[1]=g*c-A*s,e[2]=x*c-k*s,e[3]=w*c-P*s,e[8]=p*s+E*c,e[9]=g*s+A*c,e[10]=x*s+k*c,e[11]=w*s+P*c,e}function gd(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Rp(e,t,i){var s,c,p,g=i[0],x=i[1],w=i[2],E=Math.hypot(g,x,w);return E<au?null:(g*=E=1/E,x*=E,w*=E,s=Math.sin(t),c=Math.cos(t),e[0]=g*g*(p=1-c)+c,e[1]=x*g*p+w*s,e[2]=w*g*p-x*s,e[3]=0,e[4]=g*x*p-w*s,e[5]=x*x*p+c,e[6]=w*x*p+g*s,e[7]=0,e[8]=g*w*p+x*s,e[9]=x*w*p-g*s,e[10]=w*w*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Pm=cs;function _d(){var e=new Zn(3);return Zn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Bp(e){var t=new Zn(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Hc(e){return Math.hypot(e[0],e[1],e[2])}function Al(e,t,i){var s=new Zn(3);return s[0]=e,s[1]=t,s[2]=i,s}function us(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function yd(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Op(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Xc(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function Il(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function hr(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Yc(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e}function Ln(e,t){var i=t[0],s=t[1],c=t[2],p=i*i+s*s+c*c;return p>0&&(p=1/Math.sqrt(p)),e[0]=t[0]*p,e[1]=t[1]*p,e[2]=t[2]*p,e}function zr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xd(e,t,i){var s=t[0],c=t[1],p=t[2],g=i[0],x=i[1],w=i[2];return e[0]=c*w-p*x,e[1]=p*g-s*w,e[2]=s*x-c*g,e}function Ri(e,t,i){var s=t[0],c=t[1],p=t[2],g=i[3]*s+i[7]*c+i[11]*p+i[15];return e[0]=(i[0]*s+i[4]*c+i[8]*p+i[12])/(g=g||1),e[1]=(i[1]*s+i[5]*c+i[9]*p+i[13])/g,e[2]=(i[2]*s+i[6]*c+i[10]*p+i[14])/g,e}function Fp(e,t,i){var s=i[0],c=i[1],p=i[2],g=t[0],x=t[1],w=t[2],E=c*w-p*x,A=p*g-s*w,k=s*x-c*g,P=c*k-p*A,R=p*E-s*k,O=s*A-c*E,V=2*i[3];return A*=V,k*=V,R*=2,O*=2,e[0]=g+(E*=V)+(P*=2),e[1]=x+A+R,e[2]=w+k+O,e}var kl,Pr=yd,Dm=Op,Up=Hc;function Np(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function vd(e,t){var i=t[0],s=t[1],c=t[2],p=t[3],g=i*i+s*s+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),e[0]=i*g,e[1]=s*g,e[2]=c*g,e[3]=p*g,e}function ja(e,t,i){var s=t[0],c=t[1],p=t[2],g=t[3];return e[0]=i[0]*s+i[4]*c+i[8]*p+i[12]*g,e[1]=i[1]*s+i[5]*c+i[9]*p+i[13]*g,e[2]=i[2]*s+i[6]*c+i[10]*p+i[14]*g,e[3]=i[3]*s+i[7]*c+i[11]*p+i[15]*g,e}function bd(){var e=new Zn(4);return Zn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Vp(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function jp(e,t,i){i*=.5;var s=t[0],c=t[1],p=t[2],g=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=s*w+g*x,e[1]=c*w+p*x,e[2]=p*w-c*x,e[3]=g*w-s*x,e}function Gp(e,t,i){i*=.5;var s=t[0],c=t[1],p=t[2],g=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=s*w-p*x,e[1]=c*w+g*x,e[2]=p*w+s*x,e[3]=g*w-c*x,e}_d(),kl=new Zn(4),Zn!=Float32Array&&(kl[0]=0,kl[1]=0,kl[2]=0,kl[3]=0);var Zp=vd;_d(),Al(1,0,0),Al(0,1,0),bd(),bd(),fd();const Lm=ge([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$p}=Lm,cu=ge([{name:"a_pos_3",components:3,type:"Int16"}]);var Jc=ge([{name:"a_pos",type:"Int16",components:2}]);class wd{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,s){const c=zr(i,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/c;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,i,s){if(V=(R=this.pos)[0],q=R[1],et=R[2],lt=(O=t)[0],tt=O[1],st=O[2],Math.abs(V-lt)<=au*Math.max(1,Math.abs(V),Math.abs(lt))&&Math.abs(q-tt)<=au*Math.max(1,Math.abs(q),Math.abs(tt))&&Math.abs(et-st)<=au*Math.max(1,Math.abs(et),Math.abs(st))||0===i)return s[0]=s[1]=s[2]=0,!1;var R,O,V,q,et,lt,tt,st;const[c,p,g]=this.dir,x=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],A=c*c+p*p+g*g,k=2*(x*c+w*p+E*g),P=k*k-4*A*(x*x+w*w+E*E-i*i);if(P<0){const R=Math.max(-k/2,0),O=x+c*R,V=w+p*R,q=E+g*R,et=Math.hypot(O,V,q);return s[0]=O*i/et,s[1]=V*i/et,s[2]=q*i/et,!1}{const R=(-k-Math.sqrt(P))/(2*A);if(R<0){const O=Math.hypot(x,w,E);return s[0]=x*i/O,s[1]=w*i/O,s[2]=E*i/O,!1}return s[0]=x+c*R,s[1]=w+p*R,s[2]=E+g*R,!0}}}class zl{constructor(t,i,s,c,p){this.TL=t,this.TR=i,this.BR=s,this.BL=c,this.horizon=p}static fromInvProjectionMatrix(t,i,s){const c=[-1,1,1],p=[1,1,1],g=[1,-1,1],x=[-1,-1,1],w=Ri(c,c,t),E=Ri(p,p,t),A=Ri(g,g,t),k=Ri(x,x,t);return new zl(w,E,A,k,i/s)}}class Td{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,s,c){const p=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=ja([],w,t),A=1/E[3]/i*p;return(k=E)[0]=(P=E)[0]*(R=[A,A,c?1/E[3]:A,A])[0],k[1]=P[1]*R[1],k[2]=P[2]*R[2],k[3]=P[3]*R[3],k;var k,P,R}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Ln([],xd([],Pr([],g[w[0]],g[w[1]]),Pr([],g[w[2]],g[w[1]]))),A=-zr(E,g[w[1]]);return E.concat(A)});return new Td(g,x)}}class rn{static fromPoints(t){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of t)Xc(i,i,c),Il(s,s,c);return new rn(i,s)}static applyTransform(t,i){const s=t.getCorners();for(let c=0;c<s.length;++c)Ri(s[c],s[c],i);return rn.fromPoints(s)}constructor(t,i){this.min=t,this.max=i,this.center=hr([],us([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],s=Bp(this.min),c=Bp(this.max);for(let p=0;p<i.length;p++)s[p]=i[p]?this.min[p]:this.center[p],c[p]=i[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new rn(s,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let s=!0;for(let c=0;c<t.planes.length;c++){const p=t.planes[c];let g=0;for(let x=0;x<i.length;x++)g+=zr(p,i[x])+p[3]>=0;if(0===g)return 0;g!==i.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const w=t.points[x][c]-this.min[c];p=Math.min(p,w),g=Math.max(g,w)}if(g<0||p>this.max[c]-this.min[c])return 0}return 1}}const sn=Ce/Math.PI/2,Kc=[64,32,16],ur=-sn,Dr=sn,Rm=[new rn([ur,ur,ur],[Dr,Dr,Dr]),new rn([ur,ur,ur],[0,0,Dr]),new rn([0,ur,ur],[Dr,0,Dr]),new rn([ur,0,ur],[0,Dr,Dr]),new rn([0,0,ur],[Dr,Dr,Dr])];function hu(e){return e*sn/Rl}function Ed(e,t,i,s=!0){const c=hr([],e._camera.position,e.worldSize),p=[t,i,1,1];ja(p,p,e.pixelMatrixInverse),Np(p,p,1/p[3]);const g=Ln([],Pr([],p,c)),x=e.globeMatrix,w=[x[12],x[13],x[14]],E=Pr([],w,c),A=Hc(E),k=Ln([],E),P=e.worldSize/(2*Math.PI),R=zr(k,g),O=Math.asin(P/A);if(O<Math.acos(R)){if(!s)return null;const qt=[],Pt=[];hr(qt,g,A/R),Ln(Pt,Pr(Pt,qt,E)),Ln(g,us(g,E,hr(g,Pt,Math.tan(O)*A)))}const V=[];new wd(c,g).closestPointOnSphere(w,P,V);const q=Ln([],Wn(x,0)),et=Ln([],Wn(x,1)),lt=Ln([],Wn(x,2)),tt=zr(q,V),st=zr(et,V),dt=zr(lt,V),ht=en(Math.asin(-st/P));let St=en(Math.atan2(tt,dt));St=e.center.lng+function(qt,Pt){const Nt=(Pt-qt+180)%360-180;return Nt<-180?Nt+360:Nt}(e.center.lng,St);const Mt=Lr(St),Ot=Ue(Rr(ht),0,1);return new Bl(Mt,Ot)}class Bm{constructor(t,i,s){this.a=Pr([],t,s),this.b=Pr([],i,s),this.center=s;const c=Ln([],this.a),p=Ln([],this.b);this.angle=Math.acos(zr(c,p))}}function Md(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(s,c,p,g){const x=Math.sin(p);return s*(Math.sin((1-g)*p)/x)+c*(Math.sin(g*p)/x)}(e.a[t],e.b[t],e.angle,Ue(i,0,1))+e.center[t]}function ao(e){if(e.z<=1)return Rm[e.z+2*e.y+e.x];const t=Rn(Qc(e));return rn.fromPoints(t)}function zo(e,t,i){return hr(e,e,1-i),Yc(e,e,t,i)}function Cd(e,t){const i=Dl(t.zoom);if(0===i)return ao(e);const s=Qc(e),c=Rn(s),p=Lr(s.getWest())*t.worldSize,g=Lr(s.getEast())*t.worldSize,x=Rr(s.getNorth())*t.worldSize,w=Rr(s.getSouth())*t.worldSize,E=[p,x,0],A=[g,x,0],k=[p,w,0],P=[g,w,0],R=md([],t.globeMatrix);return Ri(E,E,R),Ri(A,A,R),Ri(k,k,R),Ri(P,P,R),c[0]=zo(c[0],k,i),c[1]=zo(c[1],P,i),c[2]=zo(c[2],A,i),c[3]=zo(c[3],E,i),rn.fromPoints(c)}function qp(e,t,i){for(const s of e)Ri(s,s,t),hr(s,s,i)}function Qc({x:e,y:t,z:i}){const s=1/(1<<i),c=new Ke(Qn(e*s),gn((t+1)*s)),p=new Ke(Qn((e+1)*s),gn(t*s));return new Hs(c,p)}function Rn(e){const t=Xe(e.getNorth()),i=Xe(e.getSouth()),s=Math.cos(t),c=Math.cos(i),p=Math.sin(t),g=Math.sin(i),x=e.getWest(),w=e.getEast();return[Xs(c,g,x),Xs(c,g,w),Xs(s,p,w),Xs(s,p,x)]}function Xs(e,t,i,s=sn){return i=Xe(i),[e*Math.sin(i)*s,-t*s,e*Math.cos(i)*s]}function Pl(e,t,i){return Xs(Math.cos(Xe(e)),Math.sin(Xe(e)),t,i)}function th(e,t,i,s){const c=1<<i.z,p=(e/Ce+i.x)/c;return Pl(gn((t/Ce+i.y)/c),Qn(p),s)}function uu({min:e,max:t}){return 16383/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Hp=new Float64Array(16);function eh(e){const t=uu(e),i=gd(Hp,[t,t,t]);return qc(i,i,((s=[])[0]=-(c=e.min)[0],s[1]=-c[1],s[2]=-c[2],s));var s,c}function du(e){const t=(s=e.min,(i=Hp)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const c=1/uu(e);return hs(t,t,[c,c,c])}function pu(e,t,i,s,c){const p=function(w){const E=Ce/(2*Math.PI);return w/(2*Math.PI)/E}(i),g=[e,t,-i/(2*Math.PI)],x=so(new Float64Array(16));return qc(x,x,g),hs(x,x,[p,p,p]),lu(x,x,Xe(-c)),Wc(x,x,Xe(-s)),x}function Dl(e){return fo(5,6,e)}function Sd(e,t){const i=Pl(t.lat,t.lng);return g=(c=yd([],function(O){const V=Pl(O._center.lat,O._center.lng);let q=xd([],Al(0,1,0),V);const et=Rp([],-O.angle,V);q=Ri(q,q,et),Rp(et,-O._pitch,q);const lt=Ln([],V);return hr(lt,lt,hu(O.cameraToCenterDistance/O.pixelsPerMeter)),Ri(lt,lt,et),us([],V,lt)}(e),i))[0],x=c[1],w=c[2],E=(p=i)[0],A=p[1],k=p[2],R=(P=Math.sqrt(g*g+x*x+w*w)*Math.sqrt(E*E+A*A+k*k))&&zr(c,p)/P,Math.acos(Math.min(Math.max(R,-1),1));var c,p,g,x,w,E,A,k,P,R}function Ll(e,t){return Sd(e,t)>Math.PI/2*1.01}const fu=Xe(85),ih=Math.cos(fu),Ga=Math.sin(fu),Rl=6371008.8,Ad=2*Math.PI*Rl;class Ke{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ke(Fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,s=this.lat*i,c=t.lat*i,p=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return Rl*Math.acos(Math.min(p,1))}toBounds(t=0){const i=360*t/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Hs(new Ke(this.lng-s,this.lat-i),new Ke(this.lng+s,this.lat+i))}toEcef(t){const i=hu(t);return Pl(this.lat,this.lng,sn+i)}static convert(t){if(t instanceof Ke)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Ke(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Ke(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Id(e){return Ad*Math.cos(e*Math.PI/180)}function Lr(e){return(180+e)/360}function Rr(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function lo(e,t){return e/Id(t)}function Qn(e){return 360*e-180}function gn(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Xp(e,t){return e*Id(gn(t))}const _n=85.051129;function Yp(e){return 1/Math.cos(e*Math.PI/180)}class Bl{constructor(t,i,s=0){this.x=+t,this.y=+i,this.z=+s}static fromLngLat(t,i=0){const s=Ke.convert(t);return new Bl(Lr(s.lng),Rr(s.lat),lo(i,s.lat))}toLngLat(){return new Ke(Qn(this.x),gn(this.y))}toAltitude(){return Xp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ad*Yp(gn(this.y))}}function kd(e,t,i,s,c,p,g,x,w){const E=(t+s)/2,A=(i+c)/2,k=new ie(E,A);x(k),function(P,R,O,V,q,et){const lt=O-q,tt=V-et;return Math.abs((V-R)*lt-(O-P)*tt)/Math.hypot(lt,tt)}(k.x,k.y,p.x,p.y,g.x,g.y)>=w?(kd(e,t,i,E,A,p,k,x,w),kd(e,E,A,s,c,k,g,x,w)):e.push(g)}function Jp(e,t,i){let s=e[0],c=s.x,p=s.y;t(s);const g=[s];for(let x=1;x<e.length;x++){const w=e[x],{x:E,y:A}=w;t(w),kd(g,c,p,E,A,s,w,t,i),c=E,p=A,s=w}return g}function mu(e,t,i,s){if(s(t,i)){const c=t.add(i)._mult(.5);mu(e,t,c,s),mu(e,c,i,s)}else e.push(i)}function Om(e,t){let i=e[0];const s=[i];for(let c=1;c<e.length;c++){const p=e[c];mu(s,i,p,t),i=p}return s}const zd=Math.pow(2,14)-1,Ol=-zd-1;function gu(e,t){const i=Math.round(e.x*t),s=Math.round(e.y*t);return e.x=Ue(i,Ol,zd),e.y=Ue(s,Ol,zd),(i<e.x||i>e.x+1||s<e.y||s>e.y+1)&&Oi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ji(e,t,i){const s=e.loadGeometry(),c=e.extent,p=Ce/c;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:x,x:w,y:E,projection:A}=i,k=P=>{const R=Qn((t.x+P.x/c)/g),O=gn((t.y+P.y/c)/g),V=A.project(R,O);P.x=(V.x*x-w)*c,P.y=(V.y*x-E)*c};for(let P=0;P<s.length;P++)if(1!==e.type)s[P]=Jp(s[P],k,1);else{const R=[];for(const O of s[P])O.x<0||O.x>=c||O.y<0||O.y>=c||(k(O),R.push(O));s[P]=R}}for(const g of s)for(const x of g)gu(x,p);return s}function Za(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ji(e):[]}}function nh(e,t,i,s,c){e.emplaceBack(2*t+(s+1)/2,2*i+(c+1)/2)}function rh(e,t,i){e.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class Pd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new be,this.indexArray=new mn,this.segments=new $i,this.programConfigurations=new Va(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,c){const p=this.layers[0],g=[];let x=null;"circle"===p.type&&(x=p.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:k,sourceLayerIndex:P}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Za(E,R);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),O,s))continue;const V=x?x.evaluate(O,{},s):void 0,q={id:A,properties:E.properties,type:E.type,sourceLayerIndex:P,index:k,geometry:R?O.geometry:Ji(E,s,c),patterns:{},sortKey:V};g.push(q)}x&&g.sort((E,A)=>E.sortKey-A.sortKey);let w=null;"globe"===c.projection.name&&(this.globeExtVertexArray=new Jn,w=c.projection);for(const E of g){const{geometry:A,index:k,sourceLayerIndex:P}=E,R=t[k].feature;this.addFeature(E,A,k,i.availableImages,s,w),i.featureIndex.insert(R,A,k,P,this.index)}}update(t,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Dp.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,s,c,p,g){for(const x of i)for(const w of x){const E=w.x,A=w.y;if(E<0||E>=Ce||A<0||A>=Ce)continue;if(g){const R=g.projectTilePoint(E,A,p),O=g.upVector(p,E,A),V=this.globeExtVertexArray;rh(V,R,O),rh(V,R,O),rh(V,R,O),rh(V,R,O)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=k.vertexLength;nh(this.layoutVertexArray,E,A,-1,-1),nh(this.layoutVertexArray,E,A,1,-1),nh(this.layoutVertexArray,E,A,1,1),nh(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},c,p)}}function Kp(e,t){for(let i=0;i<e.length;i++)if(qa(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(qa(e,t[i]))return!0;return!!$a(e,t)}function Qp(e,t,i){return!!qa(e,t)||!!oh(t,e,i)}function tf(e,t){if(1===e.length)return rf(t,e[0]);for(let i=0;i<t.length;i++){const s=t[i];for(let c=0;c<s.length;c++)if(qa(e,s[c]))return!0}for(let i=0;i<e.length;i++)if(rf(t,e[i]))return!0;for(let i=0;i<t.length;i++)if($a(e,t[i]))return!0;return!1}function ef(e,t,i){if(e.length>1){if($a(e,t))return!0;for(let s=0;s<t.length;s++)if(oh(t[s],e,i))return!0}for(let s=0;s<e.length;s++)if(oh(e[s],t,i))return!0;return!1}function $a(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const s=e[i],c=e[i+1];for(let p=0;p<t.length-1;p++)if(_u(s,c,t[p],t[p+1]))return!0}return!1}function _u(e,t,i,s){return Un(e,i,s)!==Un(t,i,s)&&Un(e,t,i)!==Un(e,t,s)}function oh(e,t,i){const s=i*i;if(1===t.length)return e.distSqr(t[0])<s;for(let c=1;c<t.length;c++)if(nf(e,t[c-1],t[c])<s)return!0;return!1}function nf(e,t,i){const s=t.distSqr(i);if(0===s)return e.distSqr(t);const c=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/s;return e.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function rf(e,t){let i,s,c,p=!1;for(let g=0;g<e.length;g++){i=e[g];for(let x=0,w=i.length-1;x<i.length;w=x++)s=i[x],c=i[w],s.y>t.y!=c.y>t.y&&t.x<(c.x-s.x)*(t.y-s.y)/(c.y-s.y)+s.x&&(p=!p)}return p}function qa(e,t){let i=!1;for(let s=0,c=e.length-1;s<e.length;c=s++){const p=e[s],g=e[c];p.y>t.y!=g.y>t.y&&t.x<(g.x-p.x)*(t.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function of(e,t,i,s,c){for(const g of e)if(t<=g.x&&i<=g.y&&s>=g.x&&c>=g.y)return!0;const p=[new ie(t,i),new ie(t,c),new ie(s,c),new ie(s,i)];if(e.length>2)for(const g of p)if(qa(e,g))return!0;for(let g=0;g<e.length-1;g++)if(Fm(e[g],e[g+1],p))return!0;return!1}function Fm(e,t,i){const s=i[0],c=i[2];if(e.x<s.x&&t.x<s.x||e.x>c.x&&t.x>c.x||e.y<s.y&&t.y<s.y||e.y>c.y&&t.y>c.y)return!1;const p=Un(e,t,i[0]);return p!==Un(e,t,i[1])||p!==Un(e,t,i[2])||p!==Un(e,t,i[3])}function Fl(e,t,i){const s=t.paint.get(e).value;return"constant"===s.kind?s.value:i.programConfigurations.get(t.id).getMaxValue(e)}function yu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function sf(e,t,i,s,c){if(!t[0]&&!t[1])return e;const p=ie.convert(t)._mult(c);"viewport"===i&&p._rotate(-s);const g=[];for(let x=0;x<e.length;x++)g.push(e[x].sub(p));return g}function af(e,t,i,s){const c=ie.convert(e)._mult(s);return"viewport"===t&&c._rotate(-i),c}le(Pd,"CircleBucket",{omit:["layers"]});const Um=new $t({"circle-sort-key":new kt(zt.layout_circle["circle-sort-key"])});var xu={paint:new $t({"circle-radius":new kt(zt.paint_circle["circle-radius"]),"circle-color":new kt(zt.paint_circle["circle-color"]),"circle-blur":new kt(zt.paint_circle["circle-blur"]),"circle-opacity":new kt(zt.paint_circle["circle-opacity"]),"circle-translate":new vt(zt.paint_circle["circle-translate"]),"circle-translate-anchor":new vt(zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vt(zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vt(zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(zt.paint_circle["circle-stroke-opacity"])}),layout:Um};function lf(e,t,i,s,c,p,g,x,w){if(p&&e.queryGeometry.isAboveHorizon)return!1;p&&(w*=e.pixelToTileUnitsFactor);const E=e.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const k of t)for(const P of k){const R=P.add(x),O=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(R.x,R.y,!0):0,V=i.projection.projectTilePoint(R.x,R.y,E);if(O>0){const tt=i.projection.upVector(E,R.x,R.y);V.x+=tt[0]*A*O,V.y+=tt[1]*A*O,V.z+=tt[2]*A*O}const q=p?R:vu(V.x,V.y,V.z,s),et=p?e.tilespaceRays.map(tt=>Vm(tt,O)):e.queryGeometry.screenGeometry,lt=ja([],[V.x,V.y,V.z,1],s);if(!g&&p?w*=lt[3]/i.cameraToCenterDistance:g&&!p&&(w*=i.cameraToCenterDistance/lt[3]),p){const tt=gn((P.y/Ce+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(tt,1)/lo(1,tt)}if(Qp(et,q,w))return!0}return!1}function vu(e,t,i,s){const c=ja([],[e,t,i,1],s);return new ie(c[0]/c[3],c[1]/c[3])}const cf=Al(0,0,0),Nm=Al(0,0,1);function Vm(e,t){const i=_d();return cf[2]=t,e.intersectsPlane(cf,Nm,i),new ie(i[0],i[1])}class hf extends Pd{}function uf(e,{width:t,height:i},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(t*i*s);return e.width=t,e.height=i,e.data=c,e}function df(e,t,i){const{width:s,height:c}=t;s===e.width&&c===e.height||(Dd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,s),height:Math.min(e.height,c)},i),e.width=s,e.height=c,e.data=t.data)}function Dd(e,t,i,s,c,p){if(0===c.width||0===c.height)return t;if(c.width>e.width||c.height>e.height||i.x>e.width-c.width||i.y>e.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||s.x>t.width-c.width||s.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=e.data,x=t.data;for(let w=0;w<c.height;w++){const E=((i.y+w)*e.width+i.x)*p,A=((s.y+w)*t.width+s.x)*p;for(let k=0;k<c.width*p;k++)x[A+k]=g[E+k]}return t}le(hf,"HeatmapBucket",{omit:["layers"]});class ds{constructor(t,i){uf(this,t,1,i)}resize(t){df(this,new ds(t),1)}clone(){return new ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,c,p){Dd(t,i,s,c,p,1)}}class tr{constructor(t,i){uf(this,t,4,i)}resize(t){df(this,new tr(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new tr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,c,p){Dd(t,i,s,c,p,4)}}le(ds,"AlphaImage"),le(tr,"RGBAImage");var jm={paint:new $t({"heatmap-radius":new kt(zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vt(zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ut(zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vt(zt.paint_heatmap["heatmap-opacity"])})};function Ys(e){const t={},i=e.resolution||256,s=e.clips?e.clips.length:1,c=e.image||new tr({width:i,height:s}),p=(g,x,w)=>{t[e.evaluationKey]=w;const E=e.expression.evaluate(t);c.data[g+x+0]=Math.floor(255*E.r/E.a),c.data[g+x+1]=Math.floor(255*E.g/E.a),c.data[g+x+2]=Math.floor(255*E.b/E.a),c.data[g+x+3]=Math.floor(255*E.a)};if(e.clips)for(let g=0,x=0;g<s;++g,x+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const A=w/(i-1),{start:k,end:P}=e.clips[g];p(x,E,k*(1-A)+P*A)}else for(let g=0,x=0;g<i;g++,x+=4)p(0,x,g/(i-1));return c}var bu={paint:new $t({"hillshade-illumination-direction":new vt(zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vt(zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vt(zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vt(zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vt(zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vt(zt.paint_hillshade["hillshade-accent-color"])})};const Gm=ge([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zm}=Gm;var Ul={};function wu(e,t,i){i=i||2;var s,c,p,g,x,w,E,A=t&&t.length,k=A?t[0]*i:e.length,P=pf(e,0,k,i,!0),R=[];if(!P||P.next===P.prev)return R;if(A&&(P=function(V,q,et,lt){var tt,st,dt,ht=[];for(tt=0,st=q.length;tt<st;tt++)(dt=pf(V,q[tt]*lt,tt<st-1?q[tt+1]*lt:V.length,lt,!1))===dt.next&&(dt.steiner=!0),ht.push(mf(dt));for(ht.sort(Hm),tt=0;tt<ht.length;tt++)et=Nl(ht[tt],et);return et}(e,t,P,i)),e.length>80*i){s=p=e[0],c=g=e[1];for(var O=i;O<k;O+=i)(x=e[O])<s&&(s=x),(w=e[O+1])<c&&(c=w),x>p&&(p=x),w>g&&(g=w);E=0!==(E=Math.max(p-s,g-c))?32767/E:0}return sh(P,R,i,s,c,E,0),R}function pf(e,t,i,s,c){var p,g;if(c===Ld(e,t,i,s)>0)for(p=t;p<i;p+=s)g=yf(p,e[p],e[p+1],g);else for(p=i-s;p>=t;p-=s)g=yf(p,e[p],e[p+1],g);return g&&Tu(g,g.next)&&(lh(g),g=g.next),g}function Wa(e,t){if(!e)return e;t||(t=e);var i,s=e;do{if(i=!1,s.steiner||!Tu(s,s.next)&&0!==zi(s.prev,s,s.next))s=s.next;else{if(lh(s),(s=t=s.prev)===s.next)break;i=!0}}while(i||s!==t);return t}function sh(e,t,i,s,c,p,g){if(e){!g&&p&&function(A,k,P,R){var O=A;do{0===O.z&&(O.z=Vl(O.x,O.y,k,P,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next}while(O!==A);O.prevZ.nextZ=null,O.prevZ=null,function(V){var q,et,lt,tt,st,dt,ht,St,Mt=1;do{for(et=V,V=null,st=null,dt=0;et;){for(dt++,lt=et,ht=0,q=0;q<Mt&&(ht++,lt=lt.nextZ);q++);for(St=Mt;ht>0||St>0&&lt;)0!==ht&&(0===St||!lt||et.z<=lt.z)?(tt=et,et=et.nextZ,ht--):(tt=lt,lt=lt.nextZ,St--),st?st.nextZ=tt:V=tt,tt.prevZ=st,st=tt;et=lt}st.nextZ=null,Mt*=2}while(dt>1)}(O)}(e,s,c,p);for(var x,w,E=e;e.prev!==e.next;)if(x=e.prev,w=e.next,p?qm(e,s,c,p):$m(e))t.push(x.i/i|0),t.push(e.i/i|0),t.push(w.i/i|0),lh(e),e=w.next,E=w.next;else if((e=w)===E){g?1===g?sh(e=ff(Wa(e),t,i),t,i,s,c,p,2):2===g&&Wm(e,t,i,s,c,p):sh(Wa(e),t,i,s,c,p,1);break}}}function $m(e){var t=e.prev,i=e,s=e.next;if(zi(t,i,s)>=0)return!1;for(var c=t.x,p=i.x,g=s.x,x=t.y,w=i.y,E=s.y,A=c<p?c<g?c:g:p<g?p:g,k=x<w?x<E?x:E:w<E?w:E,P=c>p?c>g?c:g:p>g?p:g,R=x>w?x>E?x:E:w>E?w:E,O=s.next;O!==t;){if(O.x>=A&&O.x<=P&&O.y>=k&&O.y<=R&&jl(c,x,p,w,g,E,O.x,O.y)&&zi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function qm(e,t,i,s){var c=e.prev,p=e,g=e.next;if(zi(c,p,g)>=0)return!1;for(var x=c.x,w=p.x,E=g.x,A=c.y,k=p.y,P=g.y,R=x<w?x<E?x:E:w<E?w:E,O=A<k?A<P?A:P:k<P?k:P,V=x>w?x>E?x:E:w>E?w:E,q=A>k?A>P?A:P:k>P?k:P,et=Vl(R,O,t,i,s),lt=Vl(V,q,t,i,s),tt=e.prevZ,st=e.nextZ;tt&&tt.z>=et&&st&&st.z<=lt;){if(tt.x>=R&&tt.x<=V&&tt.y>=O&&tt.y<=q&&tt!==c&&tt!==g&&jl(x,A,w,k,E,P,tt.x,tt.y)&&zi(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,st.x>=R&&st.x<=V&&st.y>=O&&st.y<=q&&st!==c&&st!==g&&jl(x,A,w,k,E,P,st.x,st.y)&&zi(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;tt&&tt.z>=et;){if(tt.x>=R&&tt.x<=V&&tt.y>=O&&tt.y<=q&&tt!==c&&tt!==g&&jl(x,A,w,k,E,P,tt.x,tt.y)&&zi(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;st&&st.z<=lt;){if(st.x>=R&&st.x<=V&&st.y>=O&&st.y<=q&&st!==c&&st!==g&&jl(x,A,w,k,E,P,st.x,st.y)&&zi(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function ff(e,t,i){var s=e;do{var c=s.prev,p=s.next.next;!Tu(c,p)&&gf(c,s,s.next,p)&&ah(c,p)&&ah(p,c)&&(t.push(c.i/i|0),t.push(s.i/i|0),t.push(p.i/i|0),lh(s),lh(s.next),s=e=p),s=s.next}while(s!==e);return Wa(s)}function Wm(e,t,i,s,c,p){var g=e;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&Ym(g,x)){var w=_f(g,x);return g=Wa(g,g.next),w=Wa(w,w.next),sh(g,t,i,s,c,p,0),void sh(w,t,i,s,c,p,0)}x=x.next}g=g.next}while(g!==e)}function Hm(e,t){return e.x-t.x}function Nl(e,t){var i=function(c,p){var g,x=p,w=c.x,E=c.y,A=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var k=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(k<=w&&k>A&&(A=k,g=x.x<x.next.x?x:x.next,k===w))return g}x=x.next}while(x!==p);if(!g)return null;var P,R=g,O=g.x,V=g.y,q=1/0;x=g;do{w>=x.x&&x.x>=O&&w!==x.x&&jl(E<V?w:A,E,O,V,E<V?A:w,E,x.x,x.y)&&(P=Math.abs(E-x.y)/(w-x.x),ah(x,c)&&(P<q||P===q&&(x.x>g.x||x.x===g.x&&Xm(g,x)))&&(g=x,q=P)),x=x.next}while(x!==R);return g}(e,t);if(!i)return t;var s=_f(i,e);return Wa(s,s.next),Wa(i,i.next)}function Xm(e,t){return zi(e.prev,e,t.prev)<0&&zi(t.next,e,e.next)<0}function Vl(e,t,i,s,c){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mf(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function jl(e,t,i,s,c,p,g,x){return(c-g)*(t-x)>=(e-g)*(p-x)&&(e-g)*(s-x)>=(i-g)*(t-x)&&(i-g)*(p-x)>=(c-g)*(s-x)}function Ym(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,s){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==s.i&&c.next.i!==s.i&&gf(c,c.next,i,s))return!0;c=c.next}while(c!==i);return!1}(e,t)&&(ah(e,t)&&ah(t,e)&&function(i,s){var c=i,p=!1,g=(i.x+s.x)/2,x=(i.y+s.y)/2;do{c.y>x!=c.next.y>x&&c.next.y!==c.y&&g<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next}while(c!==i);return p}(e,t)&&(zi(e.prev,e,t.prev)||zi(e,t.prev,t))||Tu(e,t)&&zi(e.prev,e,e.next)>0&&zi(t.prev,t,t.next)>0)}function zi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Tu(e,t){return e.x===t.x&&e.y===t.y}function gf(e,t,i,s){var c=Mu(zi(e,t,i)),p=Mu(zi(e,t,s)),g=Mu(zi(i,s,e)),x=Mu(zi(i,s,t));return c!==p&&g!==x||!(0!==c||!Eu(e,i,t))||!(0!==p||!Eu(e,s,t))||!(0!==g||!Eu(i,e,s))||!(0!==x||!Eu(i,t,s))}function Eu(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Mu(e){return e>0?1:e<0?-1:0}function ah(e,t){return zi(e.prev,e,e.next)<0?zi(e,t,e.next)>=0&&zi(e,e.prev,t)>=0:zi(e,t,e.prev)<0||zi(e,e.next,t)<0}function _f(e,t){var i=new Cu(e.i,e.x,e.y),s=new Cu(t.i,t.x,t.y),c=e.next,p=t.prev;return e.next=t,t.prev=e,i.next=c,c.prev=i,s.next=i,i.prev=s,p.next=s,s.prev=p,s}function yf(e,t,i,s){var c=new Cu(e,t,i);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function lh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Cu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ld(e,t,i,s){for(var c=0,p=t,g=i-s;p<i;p+=s)c+=(e[g]-e[p])*(e[p+1]+e[g+1]),g=p;return c}function Su(e,t,i,s,c){xf(e,t,i||0,s||e.length-1,c||Jm)}function xf(e,t,i,s,c){for(;s>i;){if(s-i>600){var p=s-i+1,g=t-i+1,x=Math.log(p),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(p-w)/p)*(g-p/2<0?-1:1);xf(e,t,Math.max(i,Math.floor(t-g*w/p+E)),Math.min(s,Math.floor(t+(p-g)*w/p+E)),c)}var A=e[t],k=i,P=s;for(co(e,i,t),c(e[s],A)>0&&co(e,i,s);k<P;){for(co(e,k,P),k++,P--;c(e[k],A)<0;)k++;for(;c(e[P],A)>0;)P--}0===c(e[i],A)?co(e,i,P):co(e,++P,s),P<=t&&(i=P+1),t<=P&&(s=P-1)}}function co(e,t,i){var s=e[t];e[t]=e[i],e[i]=s}function Jm(e,t){return e<t?-1:e>t?1:0}function Rd(e,t){const i=e.length;if(i<=1)return[e];const s=[];let c,p;for(let g=0;g<i;g++){const x=qe(e[g]);0!==x&&(e[g].area=Math.abs(x),void 0===p&&(p=x<0),p===x<0?(c&&s.push(c),c=[e[g]]):c.push(e[g]))}if(c&&s.push(c),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(Su(s[g],t,1,s[g].length-1,Km),s[g]=s[g].slice(0,t));return s}function Km(e,t){return t.area-e.area}function Bd(e,t,i){const s=i.patternDependencies;let c=!1;for(const p of t){const g=p.paint.get(`${e}-pattern`);g.isConstant()||(c=!0);const x=g.constantOr(null);x&&(c=!0,s[x]=!0)}return c}function Od(e,t,i,s,c){const p=c.patternDependencies;for(const g of t){const x=g.paint.get(`${e}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:s},i,{},c.availableImages);w=w&&w.name?w.name:w,p[w]=!0,i.patterns[g.id]=w}}return i}({get exports(){return Ul},set exports(e){Ul=e}}).exports=wu,Ul.default=wu,wu.deviation=function(e,t,i,s){var c=t&&t.length,p=Math.abs(Ld(e,0,c?t[0]*i:e.length,i));if(c)for(var g=0,x=t.length;g<x;g++)p-=Math.abs(Ld(e,t[g]*i,g<x-1?t[g+1]*i:e.length,i));var w=0;for(g=0;g<s.length;g+=3){var E=s[g]*i,A=s[g+1]*i,k=s[g+2]*i;w+=Math.abs((e[E]-e[k])*(e[A+1]-e[E+1])-(e[E]-e[A])*(e[k+1]-e[E+1]))}return 0===p&&0===w?0:Math.abs((w-p)/p)},wu.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,c=0;c<e.length;c++){for(var p=0;p<e[c].length;p++)for(var g=0;g<t;g++)i.vertices.push(e[c][p][g]);c>0&&i.holes.push(s+=e[c-1].length)}return i};class Gl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new be,this.indexArray=new mn,this.indexArray2=new cr,this.programConfigurations=new Va(t.layers,t.zoom),this.segments=new $i,this.segments2=new $i,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,s,c){this.hasPattern=Bd("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,P=Za(x,k);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),P,s))continue;const R=p?p.evaluate(P,{},s,i.availableImages):void 0,O={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:k?P.geometry:Ji(x,s,c),patterns:{},sortKey:R};g.push(O)}p&&g.sort((x,w)=>x.sortKey-w.sortKey);for(const x of g){const{geometry:w,index:E,sourceLayerIndex:A}=x;if(this.hasPattern){const k=Od("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(x,w,E,s,{},i.availableImages);i.featureIndex.insert(t[E].feature,w,E,A,this.index)}}update(t,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,c)}addFeatures(t,i,s,c,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,s,c,p,g=[]){for(const x of Rd(i,500)){let w=0;for(const O of x)w+=O.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,k=[],P=[];for(const O of x){if(0===O.length)continue;O!==x[0]&&P.push(k.length/2);const V=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),q=V.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(q+O.length-1,q),k.push(O[0].x),k.push(O[0].y);for(let et=1;et<O.length;et++)this.layoutVertexArray.emplaceBack(O[et].x,O[et].y),this.indexArray2.emplaceBack(q+et-1,q+et),k.push(O[et].x),k.push(O[et].y);V.vertexLength+=O.length,V.primitiveLength+=O.length}const R=Ul(k,P);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(A+R[O],A+R[O+1],A+R[O+2]);E.vertexLength+=w,E.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,g,c)}}le(Gl,"FillBucket",{omit:["layers","patternFeatures"]});const Qm=new $t({"fill-sort-key":new kt(zt.layout_fill["fill-sort-key"])});var Fd={paint:new $t({"fill-antialias":new vt(zt.paint_fill["fill-antialias"]),"fill-opacity":new kt(zt.paint_fill["fill-opacity"]),"fill-color":new kt(zt.paint_fill["fill-color"]),"fill-outline-color":new kt(zt.paint_fill["fill-outline-color"]),"fill-translate":new vt(zt.paint_fill["fill-translate"]),"fill-translate-anchor":new vt(zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(zt.paint_fill["fill-pattern"])}),layout:Qm};const vf=ge([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tg=ge([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eg=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ig}=vf;var Au={},ng=ie,bf=Zl;function Zl(e,t,i,s,c){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=s,this._values=c,e.readFields(rg,this,t)}function rg(e,t,i){1==e?t.id=i.readVarint():2==e?function(s,c){for(var p=s.readVarint()+s.pos;s.pos<p;){var g=c._keys[s.readVarint()],x=c._values[s.readVarint()];c.properties[g]=x}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function og(e){for(var t,i,s=0,c=0,p=e.length,g=p-1;c<p;g=c++)s+=((i=e[g]).x-(t=e[c]).x)*(t.y+i.y);return s}Zl.types=["Unknown","Point","LineString","Polygon"],Zl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,s=1,c=0,p=0,g=0,x=[];e.pos<i;){if(c<=0){var w=e.readVarint();s=7&w,c=w>>3}if(c--,1===s||2===s)p+=e.readSVarint(),g+=e.readSVarint(),1===s&&(t&&x.push(t),t=[]),t.push(new ng(p,g));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Zl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,s=0,c=0,p=0,g=1/0,x=-1/0,w=1/0,E=-1/0;e.pos<t;){if(s<=0){var A=e.readVarint();i=7&A,s=A>>3}if(s--,1===i||2===i)(c+=e.readSVarint())<g&&(g=c),c>x&&(x=c),(p+=e.readSVarint())<w&&(w=p),p>E&&(E=p);else if(7!==i)throw new Error("unknown command "+i)}return[g,w,x,E]},Zl.prototype.toGeoJSON=function(e,t,i){var s,c,p=this.extent*Math.pow(2,i),g=this.extent*e,x=this.extent*t,w=this.loadGeometry(),E=Zl.types[this.type];function A(R){for(var O=0;O<R.length;O++){var V=R[O];R[O]=[360*(V.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(s=0;s<w.length;s++)k[s]=w[s][0];A(w=k);break;case 2:for(s=0;s<w.length;s++)A(w[s]);break;case 3:for(w=function(R){var O=R.length;if(O<=1)return[R];for(var V,q,et=[],lt=0;lt<O;lt++){var tt=og(R[lt]);0!==tt&&(void 0===q&&(q=tt<0),q===tt<0?(V&&et.push(V),V=[R[lt]]):V.push(R[lt]))}return V&&et.push(V),et}(w),s=0;s<w.length;s++)for(c=0;c<w[s].length;c++)A(w[s][c])}1===w.length?w=w[0]:E="Multi"+E;var P={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var sg=bf,wf=Tf;function Tf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ag,this,t),this.length=this._features.length}function ag(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(s){for(var c=null,p=s.readVarint()+s.pos;s.pos<p;){var g=s.readVarint()>>3;c=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return c}(i))}Tf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new sg(this._pbf,t,this.extent,this._keys,this._values)};var lg=wf;function cg(e,t,i){if(3===e){var s=new lg(i,i.readVarint()+i.pos);s.length&&(t[s.name]=s)}}var Ud=Au.VectorTile=function(e,t){this.layers=e.readFields(cg,{},t)},Iu=Au.VectorTileFeature=bf;function ku(e,t,i,s){const c=[],p=0===s?(g,x,w,E,A,k)=>{g.push(new ie(k,w+(k-x)/(E-x)*(A-w)))}:(g,x,w,E,A,k)=>{g.push(new ie(x+(k-w)/(A-w)*(E-x),k))};for(const g of e){const x=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let P=0;P<w.length-1;P++){const R=w[P].x,O=w[P].y,V=w[P+1].x,q=w[P+1].y,et=0===s?R:O,lt=0===s?V:q;et<t?lt>t&&p(E,R,O,V,q,t):et>i?lt<i&&p(E,R,O,V,q,i):E.push(w[P]),lt<t&&et>=t&&p(E,R,O,V,q,t),lt>i&&et<=i&&p(E,R,O,V,q,i)}let A=w[w.length-1];const k=0===s?A.x:A.y;k>=t&&k<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),x.push(E))}x.length&&c.push(x)}return c}Au.VectorTileLayer=wf;const Nd=Iu.types,hg=Math.pow(2,13);function $l(e,t,i,s,c,p,g,x){e.emplaceBack((t<<1)+g,(i<<1)+p,(Math.floor(s*hg)<<1)+c,Math.round(x))}function ch(e,t,i){e.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class ql{constructor(){this.acc=new ie(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ie(t.x,t.y),this.max=new ie(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const s=this.min,c=this.max;t.x<s.x?s.x=t.x:t.x>c.x&&(c.x=t.x),t.y<s.y?s.y=t.y:t.y>c.y&&(c.y=t.y),((0===t.x||t.x===Ce)&&t.x===i.x)!=((0===t.y||t.y===Ce)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,He(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>Ce!=t.x>Ce&&this.addBorderIntersection(1,He(i.y,t.y,(Ce-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,He(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>Ce!=t.y>Ce&&this.addBorderIntersection(3,He(i.x,t.x,(Ce-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,t.x)}}centroid(){const t=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==t?this.acc.div(t)._round():new ie(0,0)}span(){return new ie(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class hh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new oi,this.centroidVertexArray=new Ep,this.indexArray=new mn,this.programConfigurations=new Va(t.layers,t.zoom),this.segments=new $i,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,s,c){this.features=[],this.hasPattern=Bd("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/Ce/(1<<p.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:x,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,A=Za(p,E);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),A,s))continue;const k={id:g,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Ji(p,s,c),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Od("fill-extrusion",this.layers,k,this.zoom,i)):this.addFeature(k,k.geometry,x,s,{},i.availableImages,c),i.featureIndex.insert(p,k.geometry,x,w,this.index,P)}this.sortBorders()}addFeatures(t,i,s,c,p){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,i,s,c,p)}this.sortBorders()}update(t,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ig),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,eg.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,tg.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,s,c,p,g,x){const w=[new ie(0,0),new ie(Ce,Ce)],E=x.projection,A="globe"===E.name,k=this.enableTerrain&&!A?new ql:null,P="Polygon"===Nd[t.type];A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Jn);const R=Rd(i,500);for(let et=R.length-1;et>=0;et--){const lt=R[et];(0===lt.length||(O=lt[0]).every(tt=>tt.x<=0)||O.every(tt=>tt.x>=Ce)||O.every(tt=>tt.y<=0)||O.every(tt=>tt.y>=Ce))&&R.splice(et,1)}var O;let V;if(A)V=kf(R,w,c);else{V=[];for(const et of R)V.push({polygon:et,bounds:w})}const q=P?this.edgeRadius:0;for(const{polygon:et,bounds:lt}of V){let tt=0,st=0;for(const ht of et)P&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),st+=P?ht.length-1:ht.length;const dt=this.segments.prepareSegment((P?5:4)*st,this.layoutVertexArray,this.indexArray);if(P){const ht=[],St=[];tt=dt.vertexLength;for(const Ot of et){let qt,Pt;Ot.length&&Ot!==et[0]&&St.push(ht.length/2),qt=Ot[1].sub(Ot[0])._perp()._unit();for(let Nt=1;Nt<Ot.length;Nt++){const Vt=Ot[Nt],Gt=Ot[Nt===Ot.length-1?1:Nt+1];let{x:Ht,y:Lt}=Vt;if(q){Pt=Gt.sub(Vt)._perp()._unit();const Qt=qt.add(Pt)._unit(),Te=q*Math.min(4,1/(qt.x*Qt.x+qt.y*Qt.y));Ht+=Te*Qt.x,Lt+=Te*Qt.y,qt=Pt}$l(this.layoutVertexArray,Ht,Lt,0,0,1,1,0),dt.vertexLength++,ht.push(Vt.x,Vt.y),A&&ch(this.layoutVertexExtArray,E.projectTilePoint(Ht,Lt,c),E.upVector(c,Ht,Lt))}}const Mt=Ul(ht,St);for(let Ot=0;Ot<Mt.length;Ot+=3)this.indexArray.emplaceBack(tt+Mt[Ot],tt+Mt[Ot+2],tt+Mt[Ot+1]),dt.primitiveLength++}for(const ht of et){k&&ht.length&&k.startRing(ht[0]);let St,Mt,Ot,qt=ht.length>4&&Sf(ht[ht.length-2],ht[0],ht[1]),Pt=q?ug(ht[ht.length-2],ht[0],ht[1],q):0;Mt=ht[1].sub(ht[0])._perp()._unit();let Nt=!0;for(let Vt=1,Gt=0;Vt<ht.length;Vt++){let Ht=ht[Vt-1],Lt=ht[Vt];const Qt=ht[Vt===ht.length-1?1:Vt+1];if(k&&P&&k.currentPolyCount.top++,Cf(Lt,Ht,lt)){q&&(Mt=Qt.sub(Lt)._perp()._unit(),Nt=!Nt);continue}k&&k.append(Lt,Ht);const Te=Lt.sub(Ht)._perp(),oe=Te.x/(Math.abs(Te.x)+Math.abs(Te.y)),pe=Te.y>0?1:0,ne=Ht.dist(Lt);if(Gt+ne>32768&&(Gt=0),q){Ot=Qt.sub(Lt)._perp()._unit();let De=Mf(Ht,Lt,Qt,Ef(Mt,Ot),q);isNaN(De)&&(De=0);const we=Lt.sub(Ht)._unit();Ht=Ht.add(we.mult(Pt))._round(),Lt=Lt.add(we.mult(-De))._round(),Pt=De,Mt=Ot}const Me=dt.vertexLength,Ge=ht.length>4&&Sf(Ht,Lt,Qt);let Be=Af(Gt,qt,Nt);if($l(this.layoutVertexArray,Ht.x,Ht.y,oe,pe,0,0,Be),$l(this.layoutVertexArray,Ht.x,Ht.y,oe,pe,0,1,Be),Gt+=ne,Be=Af(Gt,Ge,!Nt),qt=Ge,$l(this.layoutVertexArray,Lt.x,Lt.y,oe,pe,0,0,Be),$l(this.layoutVertexArray,Lt.x,Lt.y,oe,pe,0,1,Be),dt.vertexLength+=4,this.indexArray.emplaceBack(Me+0,Me+1,Me+2),this.indexArray.emplaceBack(Me+1,Me+3,Me+2),dt.primitiveLength+=2,q){const De=tt+(1===Vt?ht.length-2:Vt-2),we=1===Vt?tt:De+1;if(this.indexArray.emplaceBack(Me+1,De,Me+3),this.indexArray.emplaceBack(De,we,Me+3),dt.primitiveLength+=2,void 0===St&&(St=Me),!Cf(Qt,ht[Vt],lt)){const ii=Vt===ht.length-1?St:dt.vertexLength;this.indexArray.emplaceBack(Me+2,Me+3,ii),this.indexArray.emplaceBack(Me+3,ii+1,ii),this.indexArray.emplaceBack(Me+3,we,ii+1),dt.primitiveLength+=3}Nt=!Nt}if(A){const De=this.layoutVertexExtArray,we=E.projectTilePoint(Ht.x,Ht.y,c),ii=E.projectTilePoint(Lt.x,Lt.y,c),Se=E.upVector(c,Ht.x,Ht.y),Fe=E.upVector(c,Lt.x,Lt.y);ch(De,we,Se),ch(De,we,Se),ch(De,ii,Fe),ch(De,ii,Fe)}}P&&(tt+=ht.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const et=k.borders,lt=this.featuresOnBorder.push(k)-1;for(let tt=0;tt<4;tt++)et[tt][0]!==Number.MAX_VALUE&&this.borders[tt].push(lt)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,g,c)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,s)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}encodeCentroid(t,i,s=!0){let c,p;if(t)if(0!==t.y){const x=i.span()._mult(this.tileToMeter);c=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else c=Math.ceil(7*(t.x+450)),p=0;else c=0,p=+s;let g=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(g++,c,p);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,c,p)}}}function Ef(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function ug(e,t,i,s){const c=t.sub(e)._perp()._unit(),p=i.sub(t)._perp()._unit();return Mf(e,t,i,Ef(c,p),s)}function Mf(e,t,i,s,c){const p=Math.sqrt(1-s*s);return Math.min(e.dist(t)/3,t.dist(i)/3,c*p/s)}function Cf(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Sf(e,t,i){if(e.x<0||e.x>=Ce||t.x<0||t.x>=Ce||i.x<0||i.x>=Ce)return!1;const s=i.sub(t),c=s.perp(),p=e.sub(t);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&c.x*p.x+c.y*p.y<0}function Af(e,t,i){const s=t?2|e:-3&e;return i?1|s:-2&s}function If(){const e=Math.PI/32,t=Math.tan(e),i=Rl;return i*Math.sqrt(1+2*t*t)-i}function kf(e,t,i){const s=1<<i.z,c=Qn(i.x/s),p=Qn((i.x+1)/s),g=gn(i.y/s),x=gn((i.y+1)/s);return function(w,E,A,k,P=0,R){const O=[];if(!w.length||!A||!k)return O;const V=(ht,St)=>{for(const Mt of ht)O.push({polygon:Mt,bounds:St})},q=Math.ceil(Math.log2(A)),et=Math.ceil(Math.log2(k)),lt=q-et,tt=[];for(let ht=0;ht<Math.abs(lt);ht++)tt.push(lt>0?0:1);for(let ht=0;ht<Math.min(q,et);ht++)tt.push(0),tt.push(1);let st=w;if(st=ku(st,E[0].y-P,E[1].y+P,1),st=ku(st,E[0].x-P,E[1].x+P,0),!st.length)return O;const dt=[];for(tt.length?dt.push({polygons:st,bounds:E,depth:0}):V(st,E);dt.length;){const ht=dt.pop(),St=ht.depth,Mt=tt[St],Ot=ht.bounds[0],qt=ht.bounds[1],Pt=0===Mt?Ot.x:Ot.y,Nt=0===Mt?qt.x:qt.y,Vt=R?R(Mt,Pt,Nt):.5*(Pt+Nt),Gt=ku(ht.polygons,Pt-P,Vt+P,Mt),Ht=ku(ht.polygons,Vt-P,Nt+P,Mt);if(Gt.length){const Lt=[Ot,new ie(0===Mt?Vt:qt.x,1===Mt?Vt:qt.y)];tt.length>St+1?dt.push({polygons:Gt,bounds:Lt,depth:St+1}):V(Gt,Lt)}if(Ht.length){const Lt=[new ie(0===Mt?Vt:Ot.x,1===Mt?Vt:Ot.y),qt];tt.length>St+1?dt.push({polygons:Ht,bounds:Lt,depth:St+1}):V(Ht,Lt)}}return O}(e,t,Math.ceil((p-c)/11.25),Math.ceil((g-x)/11.25),1,(w,E,A)=>{if(0===w)return.5*(E+A);{const k=gn((i.y+E/Ce)/s);return(Rr(.5*(gn((i.y+A/Ce)/s)+k))*s-i.y)*Ce}})}le(hh,"FillExtrusionBucket",{omit:["layers","features"]}),le(ql,"PartMetadata");const dg=new $t({"fill-extrusion-edge-radius":new vt(zt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var pg={paint:new $t({"fill-extrusion-opacity":new vt(zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vt(zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vt(zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vt(zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new vt(zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new vt(zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:dg};function zf(e,t,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[e*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class zu{constructor(t,i,s){this.z=t,this.x=i,this.y=s,this.key=uh(0,t,t,i,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const s=(g=this.y,x=this.z,w=zf(256*(p=this.x),256*(g=Math.pow(2,x)-g-1),x),E=zf(256*(p+1),256*(g+1),x),w[0]+","+w[1]+","+E[0]+","+E[1]),c=function(p,g,x){let w,E="";for(let A=p;A>0;A--)w=1<<A-1,E+=(g&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);var p,g,x,w,E;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pf{constructor(t,i){this.wrap=t,this.canonical=i,this.key=uh(t,i.z,i.z,i.x,i.y)}}class Bn{constructor(t,i,s,c,p){this.overscaledZ=t,this.wrap=i,this.canonical=new zu(s,+c,+p),this.key=0===i&&t===s?this.canonical.key:uh(i,t,s,c,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Bn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bn(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return uh(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return uh(this.wrap*+i,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Bn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Bn(i,this.wrap,i,s,c),new Bn(i,this.wrap,i,s+1,c),new Bn(i,this.wrap,i,s,c+1),new Bn(i,this.wrap,i,s+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Bn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Bn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uh(e,t,i,s,c){const p=1<<Math.min(i,22);let g=p*(c%p)+s%p;return e&&i<22&&(g+=p*p*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}le(zu,"CanonicalTileID"),le(Bn,"OverscaledTileID",{omit:["projMatrix"]});class ho extends ie{constructor(t,i,s){super(t,i),this.z=s}}function Wl(e,t){return e.x*t.x+e.y*t.y}function Df(e,t){if(1===e.length){let i=0;const s=t[i++];let c;for(;!c||s.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){const p=t[i],g=e[0],x=c.sub(s),w=p.sub(s),E=g.sub(s),A=Wl(x,x),k=Wl(x,w),P=Wl(w,w),R=Wl(E,x),O=Wl(E,w),V=A*P-k*k,q=(P*R-k*O)/V,et=(A*O-k*R)/V,lt=s.z*(1-q-et)+c.z*q+p.z*et;if(isFinite(lt))return lt}return 1/0}{let i=1/0;for(const s of t)i=Math.min(i,s.z);return i}}function Lf(e,t,i,s,c,p,g,x){const w=g*c.getElevationAt(e,t,!0,!0),E=0!==p[0],A=E?0===p[1]?g*(p[0]/7-450):g*function(k,P,R){const O=Math.floor(P[0]/8),V=Math.floor(P[1]/8),q=10*(P[0]-8*O),et=10*(P[1]-8*V),lt=k.getElevationAt(O,V,!0,!0),tt=k.getMeterToDEM(R),st=Math.floor(.5*(q*tt-1)),dt=Math.floor(.5*(et*tt-1)),ht=k.tileCoordToPixel(O,V),St=2*st+1,Mt=2*dt+1,Ot=(Te=St,oe=Mt,[(Ht=k).getElevationAtPixel(Lt=ht.x-st,Qt=ht.y-dt,!0),Ht.getElevationAtPixel(Lt+oe,Qt,!0),Ht.getElevationAtPixel(Lt,Qt+oe,!0),Ht.getElevationAtPixel(Lt+Te,Qt+oe,!0)]),qt=Math.abs(Ot[0]-Ot[1]),Pt=Math.abs(Ot[2]-Ot[3]),Nt=Math.abs(Ot[0]-Ot[2])+Math.abs(Ot[1]-Ot[3]),Vt=Math.min(.25,.5*tt*(qt+Pt)/St),Gt=Math.min(.25,.5*tt*Nt/Mt);var Ht,Lt,Qt,Te,oe;return lt+Math.max(Vt*q,Gt*et)}(c,p,x):w;return{base:w+(0===i)?-1:i,top:E?Math.max(A+s,w+i+2):w+s}}const fg=ge([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:mg}=fg,gg=ge([{name:"a_packed",components:4,type:"Float32"}]),{members:Pu}=gg,_g=Iu.types,yg=Math.cos(Math.PI/180*37.5);class Du{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new wi,this.layoutVertexArray2=new mi,this.indexArray=new mn,this.programConfigurations=new Va(t.layers,t.zoom),this.segments=new $i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,c){this.hasPattern=Bd("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:k,index:P,sourceLayerIndex:R}of t){const O=this.layers[0]._featureFilter.needGeometry,V=Za(A,O);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),V,s))continue;const q=p?p.evaluate(V,{},s):void 0,et={id:k,properties:A.properties,type:A.type,sourceLayerIndex:R,index:P,geometry:O?V.geometry:Ji(A,s,c),patterns:{},sortKey:q};g.push(et)}p&&g.sort((A,k)=>A.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:w}=i,E=this.addConstantDashes(x);for(const A of g){const{geometry:k,index:P,sourceLayerIndex:R}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const O=Od("line",this.layers,A,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(A,k,P,s,x.positions,i.availableImages);w.insert(t[P].feature,k,P,R,this.index)}}addConstantDashes(t){let i=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==p.kind)i=!0;else{const g=p.value,x=c.value;if(!x)continue;t.addDash(x,g)}}return i}addFeatureDashes(t,i){const s=this.zoom;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===g.kind)continue;let x,w;if("constant"===p.kind){if(x=p.value,!x)continue}else x=p.evaluate({zoom:s},t);w="constant"===g.kind?g.value:g.evaluate({zoom:s},t),i.addDash(x,w),t.patterns[c.id]=i.getKey(x,w)}}update(t,i,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,c)}addFeatures(t,i,s,c,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Pu)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mg),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,s,c,p,g){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),E=x.get("line-cap").evaluate(t,{}),A=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of i)this.addLine(P,t,w,E,A,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,g,c)}addLine(t,i,s,c,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let et=0;et<t.length-1;et++)this.totalDistance+=t[et].dist(t[et+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===_g[i.type];let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(x?3:2))return;"bevel"===s&&(p=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,R,O,V,q;this.e1=this.e2=-1,x&&(P=t[w-2],q=t[E].sub(P)._unit()._perp());for(let et=E;et<w;et++){if(O=et===w-1?x?t[E+1]:void 0:t[et+1],O&&t[et].equals(O))continue;q&&(V=q),P&&(R=P),P=t[et],q=O?O.sub(P)._unit()._perp():V,V=V||q;let lt=V.add(q);0===lt.x&&0===lt.y||lt._unit();const tt=V.x*q.x+V.y*q.y,st=lt.x*q.x+lt.y*q.y,dt=0!==st?1/st:1/0,ht=2*Math.sqrt(2-2*st),St=st<yg&&R&&O,Mt=V.x*q.y-V.y*q.x>0;if(St&&et>E){const Pt=P.dist(R);if(Pt>2*A){const Nt=P.sub(P.sub(R)._mult(A/Pt)._round());this.updateDistance(R,Nt),this.addCurrentVertex(Nt,V,0,0,k),R=Nt}}const Ot=R&&O;let qt=Ot?s:x?"butt":c;if(Ot&&"round"===qt&&(dt<g?qt="miter":dt<=2&&(qt="fakeround")),"miter"===qt&&dt>p&&(qt="bevel"),"bevel"===qt&&(dt>2&&(qt="flipbevel"),dt<p&&(qt="miter")),R&&this.updateDistance(R,P),"miter"===qt)lt._mult(dt),this.addCurrentVertex(P,lt,0,0,k);else if("flipbevel"===qt){if(dt>100)lt=q.mult(-1);else{const Pt=dt*V.add(q).mag()/V.sub(q).mag();lt._perp()._mult(Pt*(Mt?-1:1))}this.addCurrentVertex(P,lt,0,0,k),this.addCurrentVertex(P,lt.mult(-1),0,0,k)}else if("bevel"===qt||"fakeround"===qt){const Pt=-Math.sqrt(dt*dt-1),Nt=Mt?Pt:0,Vt=Mt?0:Pt;if(R&&this.addCurrentVertex(P,V,Nt,Vt,k),"fakeround"===qt){const Gt=Math.round(180*ht/Math.PI/20);for(let Ht=1;Ht<Gt;Ht++){let Lt=Ht/Gt;if(.5!==Lt){const Te=Lt-.5;Lt+=Lt*Te*(Lt-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*Te*Te+(.848013+tt*(.215638*tt-1.06021)))}const Qt=q.sub(V)._mult(Lt)._add(V)._unit()._mult(Mt?-1:1);this.addHalfVertex(P,Qt.x,Qt.y,!1,Mt,0,k)}}O&&this.addCurrentVertex(P,q,-Nt,-Vt,k)}else if("butt"===qt)this.addCurrentVertex(P,lt,0,0,k);else if("square"===qt){const Pt=R?1:-1;R||this.addCurrentVertex(P,lt,Pt,Pt,k),this.addCurrentVertex(P,lt,0,0,k),R&&this.addCurrentVertex(P,lt,Pt,Pt,k)}else"round"===qt&&(R&&(this.addCurrentVertex(P,V,0,0,k),this.addCurrentVertex(P,V,1,1,k,!0)),O&&(this.addCurrentVertex(P,q,-1,-1,k,!0),this.addCurrentVertex(P,q,0,0,k)));if(St&&et<w-1){const Pt=P.dist(O);if(Pt>2*A){const Nt=P.add(O.sub(P)._mult(A/Pt)._round());this.updateDistance(P,Nt),this.addCurrentVertex(Nt,q,0,0,k),P=Nt}}}}addCurrentVertex(t,i,s,c,p,g=!1){const x=i.y*c-i.x,w=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*s,i.y-i.x*s,g,!1,s,p),this.addHalfVertex(t,x,w,g,!0,-c,p)}addHalfVertex({x:t,y:i},s,c,p,g,x,w){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}le(Du,"LineBucket",{omit:["layers","patternFeatures"]});const xg=new $t({"line-cap":new kt(zt.layout_line["line-cap"]),"line-join":new kt(zt.layout_line["line-join"]),"line-miter-limit":new vt(zt.layout_line["line-miter-limit"]),"line-round-limit":new vt(zt.layout_line["line-round-limit"]),"line-sort-key":new kt(zt.layout_line["line-sort-key"])});var Rf={paint:new $t({"line-opacity":new kt(zt.paint_line["line-opacity"]),"line-color":new kt(zt.paint_line["line-color"]),"line-translate":new vt(zt.paint_line["line-translate"]),"line-translate-anchor":new vt(zt.paint_line["line-translate-anchor"]),"line-width":new kt(zt.paint_line["line-width"]),"line-gap-width":new kt(zt.paint_line["line-gap-width"]),"line-offset":new kt(zt.paint_line["line-offset"]),"line-blur":new kt(zt.paint_line["line-blur"]),"line-dasharray":new kt(zt.paint_line["line-dasharray"]),"line-pattern":new kt(zt.paint_line["line-pattern"]),"line-gradient":new Ut(zt.paint_line["line-gradient"]),"line-trim-offset":new vt(zt.paint_line["line-trim-offset"])}),layout:xg};const Bf=new class extends kt{possiblyEvaluate(e,t){return t=new wt(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,s){return t=Hi({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,s)}}(Rf.paint.properties["line-width"].specification);function Of(e,t){return t>0?t+2*e:e}Bf.useIntegerZoom=!0;const vg=ge([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hl=ge([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),bg=ge([{name:"a_projected_pos",components:4,type:"Float32"}],4);ge([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wg=ge([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Tg=ge([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ff=ge([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xl=ge([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ge([{name:"triangle",components:3,type:"Uint16"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ge([{type:"Float32",name:"offsetX"}]),ge([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const Po=128;function Yl(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new wt(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:c}=i;let p=0;for(;p<s.length&&s[p]<=e;)p++;p=Math.max(0,p-1);let g=p;for(;g<s.length&&s[g]<e+1;)g++;g=Math.min(s.length-1,g);const x=s[p],w=s[g];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:c}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new wt(x)),maxSize:i.evaluate(new wt(w)),interpolationType:c}}}function Lu(e,{uSize:t,uSizeT:i},{lowerSize:s,upperSize:c}){return"source"===e.kind?s/Po:"composite"===e.kind?He(s/Po,c/Po,i):t}function Js(e,t){let i=0,s=0;if("constant"===e.kind)s=e.layoutSize;else if("source"!==e.kind){const{interpolationType:c,minZoom:p,maxZoom:g}=e,x=c?Ue(jn.interpolationFactor(c,t,p,g),0,1):0;"camera"===e.kind?s=He(e.minSize,e.maxSize,x):i=x}return{uSizeT:i,uSize:s}}var Eg=Object.freeze({__proto__:null,getSizeData:Yl,evaluateSizeForFeature:Lu,evaluateSizeForZoom:Js,SIZE_PACK_FACTOR:Po});function Vd(e,t,i){return e.sections.forEach(s=>{s.text=function(c,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return"uppercase"===x?c=c.toLocaleUpperCase():"lowercase"===x&&(c=c.toLocaleLowerCase()),ft.applyArabicShaping&&(c=ft.applyArabicShaping(c)),c}(s.text,t,i)}),e}const dh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function p_(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Mg(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var ph=Ti,jd=function(e,t,i,s,c){var p,g,x=8*c-s-1,w=(1<<x)-1,E=w>>1,A=-7,k=i?c-1:0,P=i?-1:1,R=e[t+k];for(k+=P,p=R&(1<<-A)-1,R>>=-A,A+=x;A>0;p=256*p+e[t+k],k+=P,A-=8);for(g=p&(1<<-A)-1,p>>=-A,A+=s;A>0;g=256*g+e[t+k],k+=P,A-=8);if(0===p)p=1-E;else{if(p===w)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,s),p-=E}return(R?-1:1)*g*Math.pow(2,p-s)},Gd=function(e,t,i,s,c,p){var g,x,w,E=8*p-c-1,A=(1<<E)-1,k=A>>1,P=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:p-1,O=s?1:-1,V=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,g=A):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+k>=1?P/w:P*Math.pow(2,1-k))*w>=2&&(g++,w/=2),g+k>=A?(x=0,g=A):g+k>=1?(x=(t*w-1)*Math.pow(2,c),g+=k):(x=t*Math.pow(2,k-1)*Math.pow(2,c),g=0));c>=8;e[i+R]=255&x,R+=O,x/=256,c-=8);for(g=g<<c|x,E+=c;E>0;e[i+R]=255&g,R+=O,g/=256,E-=8);e[i+R-O]|=128*V};function Ti(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ti.Varint=0,Ti.Fixed64=1,Ti.Bytes=2,Ti.Fixed32=5;var Ru=4294967296,Zd=1/Ru,Uf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ps(e){return e.type===Ti.Bytes?e.readVarint()+e.pos:e.pos+1}function $d(e,t,i){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(s);for(var c=i.pos-1;c>=e;c--)i.buf[c+s]=i.buf[c]}function Cg(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Sg(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Ag(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Ig(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function kg(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function zg(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Nf(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Pg(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Dg(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Bu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function fh(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Vf(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function jf(e,t,i){t.glyphs=[],1===e&&i.readMessage(Lg,t)}function Lg(e,t,i){if(3===e){const{id:s,bitmap:c,width:p,height:g,left:x,top:w,advance:E}=i.readMessage(Rg,{});t.glyphs.push({id:s,bitmap:new ds({width:p+6,height:g+6},c),metrics:{width:p,height:g,left:x,top:w,advance:E}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Rg(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function Ou(e){let t=0,i=0;for(const g of e)t+=g.w*g.h,i=Math.max(i,g.w);e.sort((g,x)=>x.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let c=0,p=0;for(const g of e)for(let x=s.length-1;x>=0;x--){const w=s[x];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,p=Math.max(p,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===w.w&&g.h===w.h){const E=s.pop();x<s.length&&(s[x]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(s.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:c,h:p,fill:t/(c*p)||0}}Ti.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),c=s>>3,p=this.pos;this.type=7&s,e(c,t,this),this.pos===p&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Bu(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Vf(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Bu(this.buf,this.pos)+Bu(this.buf,this.pos+4)*Ru;return this.pos+=8,e},readSFixed64:function(){var e=Bu(this.buf,this.pos)+Vf(this.buf,this.pos+4)*Ru;return this.pos+=8,e},readFloat:function(){var e=jd(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jd(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,s=this.buf;return t=127&(i=s[this.pos++]),i<128?t:(t|=(127&(i=s[this.pos++]))<<7,i<128?t:(t|=(127&(i=s[this.pos++]))<<14,i<128?t:(t|=(127&(i=s[this.pos++]))<<21,i<128?t:function(c,p,g){var x,w,E=g.buf;if(x=(112&(w=E[g.pos++]))>>4,w<128||(x|=(127&(w=E[g.pos++]))<<3,w<128)||(x|=(127&(w=E[g.pos++]))<<10,w<128)||(x|=(127&(w=E[g.pos++]))<<17,w<128)||(x|=(127&(w=E[g.pos++]))<<24,w<128)||(x|=(1&(w=E[g.pos++]))<<31,w<128))return function Jl(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(c,x,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Uf?Uf.decode(this.buf.subarray(t,e)):function(i,s,c){for(var p="",g=s;g<c;){var x,w,E,A=i[g],k=null,P=A>239?4:A>223?3:A>191?2:1;if(g+P>c)break;1===P?A<128&&(k=A):2===P?128==(192&(x=i[g+1]))&&(k=(31&A)<<6|63&x)<=127&&(k=null):3===P?(w=i[g+2],128==(192&(x=i[g+1]))&&128==(192&w)&&((k=(15&A)<<12|(63&x)<<6|63&w)<=2047||k>=55296&&k<=57343)&&(k=null)):4===P&&(w=i[g+2],E=i[g+3],128==(192&(x=i[g+1]))&&128==(192&w)&&128==(192&E)&&((k=(15&A)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,P=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),g+=P}return p}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ti.Bytes)return e.push(this.readVarint(t));var i=ps(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ti.Bytes)return e.push(this.readSVarint());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ti.Bytes)return e.push(this.readBoolean());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ti.Bytes)return e.push(this.readFloat());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ti.Bytes)return e.push(this.readDouble());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ti.Bytes)return e.push(this.readFixed32());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ti.Bytes)return e.push(this.readSFixed32());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ti.Bytes)return e.push(this.readFixed64());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ti.Bytes)return e.push(this.readSFixed64());var t=ps(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ti.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ti.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ti.Fixed32)this.pos+=4;else{if(t!==Ti.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),fh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),fh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),fh(this.buf,-1&e,this.pos),fh(this.buf,Math.floor(e*Zd),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),fh(this.buf,-1&e,this.pos),fh(this.buf,Math.floor(e*Zd),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var s,c,p,x;if(t>=0?(s=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,c=c+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),p=s,(x=i).buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7),function(p,g){var x=(7&p)<<4;g.buf[g.pos++]|=x|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(c,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(s,c,p){for(var g,x,w=0;w<c.length;w++){if((g=c.charCodeAt(w))>55295&&g<57344){if(!x){g>56319||w+1===c.length?(s[p++]=239,s[p++]=191,s[p++]=189):x=g;continue}if(g<56320){s[p++]=239,s[p++]=191,s[p++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(s[p++]=239,s[p++]=191,s[p++]=189,x=null);g<128?s[p++]=g:(g<2048?s[p++]=g>>6|192:(g<65536?s[p++]=g>>12|224:(s[p++]=g>>18|240,s[p++]=g>>12&63|128),s[p++]=g>>6&63|128),s[p++]=63&g|128)}return p}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&$d(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Gd(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Gd(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var s=this.pos-i;s>=128&&$d(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,i){this.writeTag(e,Ti.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Cg,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Sg,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,kg,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Ag,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Ig,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,zg,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Nf,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Pg,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Dg,t)},writeBytesField:function(e,t){this.writeTag(e,Ti.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ti.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ti.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ti.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ti.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ti.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ti.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ti.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ti.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ti.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class qd{constructor(t,{pixelRatio:i,version:s,stretchX:c,stretchY:p,content:g}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=p,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gf{constructor(t,i){const s={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,s,p),this.addImages(i,c,p);const{w:g,h:x}=Ou(p),w=new tr({width:g||1,height:x||1});for(const E in t){const A=t[E],k=s[E].paddedRect;tr.copy(A.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},A.data)}for(const E in i){const A=i[E],k=c[E].paddedRect,P=k.x+1,R=k.y+1,O=A.data.width,V=A.data.height;tr.copy(A.data,w,{x:0,y:0},{x:P,y:R},A.data),tr.copy(A.data,w,{x:0,y:V-1},{x:P,y:R-1},{width:O,height:1}),tr.copy(A.data,w,{x:0,y:0},{x:P,y:R+V},{width:O,height:1}),tr.copy(A.data,w,{x:O-1,y:0},{x:P-1,y:R},{width:1,height:V}),tr.copy(A.data,w,{x:0,y:0},{x:P+O,y:R},{width:1,height:V})}this.image=w,this.iconPositions=s,this.patternPositions=c}addImages(t,i,s){for(const c in t){const p=t[c],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};s.push(g),i[c]=new qd(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>t.hasImage(s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),i)}patchUpdatedImage(t,i,s){if(!t||!i||t.version===i.version)return;t.version=i.version;const[c,p]=t.tl;s.update(i.data,void 0,{x:c,y:p})}}le(qd,"ImagePosition"),le(Gf,"ImageAtlas");const dr={horizontal:1,vertical:2,horizontalOnly:3};class fs{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const s=new fs;return s.scale=t||1,s.fontStack=i,s}static forImage(t){const i=new fs;return i.imageName=t,i}}class Kl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const s=new Kl;for(let c=0;c<t.sections.length;c++){const p=t.sections[c];p.image?s.addImageSection(p):s.addTextSection(p,i)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,s){let c="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,x=i.charCodeAt(p-1)||null;c+=!s&&(g&&I(g)&&!dh[i[p+1]]||x&&I(x)&&!dh[i[p-1]])||!dh[i[p]]?i[p]:dh[i[p]]}return c}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&mh[this.text.charCodeAt(s)];s++)t++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&mh[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const s=new Kl;return s.text=this.text.substring(t,i),s.sectionIndex=this.sectionIndex.slice(t,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(fs.forText(t.scale,t.fontStack||i));const s=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(s)}addImageSection(t){const i=t.image?t.image.name:"";if(0===i.length)return void Oi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(fs.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wd(e,t,i,s,c,p,g,x,w,E,A,k,P,R,O){const V=Kl.fromFeature(e,c);k===dr.vertical&&V.verticalizePunctuation(P);let q=[];const et=function(ht,St,Mt,Ot,qt,Pt){if(!ht)return[];const Nt=[],Vt=function(Qt,Te,oe,pe,ne,Me){let Ge=0;for(let Be=0;Be<Qt.length();Be++){const De=Qt.getSection(Be);Ge+=$f(Qt.getCharCode(Be),De,pe,ne,Te,Me)}return Ge/Math.max(1,Math.ceil(Ge/oe))}(ht,St,Mt,Ot,qt,Pt),Gt=ht.text.indexOf("\u200b")>=0;let Ht=0;for(let Qt=0;Qt<ht.length();Qt++){const Te=ht.getSection(Qt),oe=ht.getCharCode(Qt);if(mh[oe]||(Ht+=$f(oe,Te,Ot,qt,St,Pt)),Qt<ht.length()-1){const pe=!((Lt=oe)<11904||!(Jh(Lt)||Ba(Lt)||d(Lt)||eu(Lt)||Kh(Lt)||Yh(Lt)||Oa(Lt)||Io(Lt)||Vc(Lt)||jc(Lt)||Nc(Lt)||f(Lt)||Ra(Lt)||os(Lt)||Fc(Lt)||Uc(Lt)||Zi(Lt)||Kr(Lt)||tu(Lt)||Qh(Lt)));(Zf[oe]||pe||Te.imageName)&&Nt.push(Fu(Qt+1,Ht,Vt,Nt,Bg(oe,ht.getCharCode(Qt+1),pe&&Gt),!1))}}var Lt;return Wf(Fu(ht.length(),Ht,Vt,Nt,0,!0))}(V,E,p,t,s,R),{processBidirectionalText:lt,processStyledBidirectionalText:tt}=ft;if(lt&&1===V.sections.length){const ht=lt(V.toString(),et);for(const St of ht){const Mt=new Kl;Mt.text=St,Mt.sections=V.sections;for(let Ot=0;Ot<St.length;Ot++)Mt.sectionIndex.push(0);q.push(Mt)}}else if(tt){const ht=tt(V.text,V.sectionIndex,et);for(const St of ht){const Mt=new Kl;Mt.text=St[0],Mt.sectionIndex=St[1],Mt.sections=V.sections,q.push(Mt)}}else q=function(ht,St){const Mt=[],Ot=ht.text;let qt=0;for(const Pt of St)Mt.push(ht.substring(qt,Pt)),qt=Pt;return qt<Ot.length&&Mt.push(ht.substring(qt,Ot.length)),Mt}(V,et);const st=[],dt={positionedLines:st,text:V.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ht,St,Mt,Ot,qt,Pt,Nt,Vt,Gt,Ht,Lt,Qt){let Te=0,oe=0,pe=0;const ne="right"===Vt?1:"left"===Vt?0:.5;let Me=!1;for(const Se of qt){const Fe=Se.getSections();for(const hi of Fe){if(hi.imageName)continue;const Mi=St[hi.fontStack];if(Mi&&(Me=void 0!==Mi.ascender&&void 0!==Mi.descender,!Me))break}if(!Me)break}let Ge=0;for(const Se of qt){Se.trim();const Fe=Se.getMaxScale(),hi=24*(Fe-1),Mi={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Ge]=Mi;const li=Mi.positionedGlyphs;let ui=0;if(!Se.length()){oe+=Pt,++Ge;continue}let Si=0,Ai=0;for(let di=0;di<Se.length();di++){const Pi=Se.getSection(di),qi=Se.getSectionIndex(di),$e=Se.getCharCode(di);let a=Pi.scale,r=null,o=null,u=null,m=24,_=0;const b=!(Gt===dr.horizontal||!Lt&&!C($e)||Lt&&(mh[$e]||(Be=$e,Zs(Be)||Bc(Be)||Oc(Be)||Sl(Be)||l(Be))));if(Pi.imageName){const T=Ot[Pi.imageName];if(!T)continue;u=Pi.imageName,ht.iconsInText=ht.iconsInText||!0,o=T.paddedRect;const S=T.displaySize;a=24*a/Qt,r={width:S[0],height:S[1],left:1,top:-3,advance:b?S[1]:S[0],localGlyph:!1},_=Me?-r.height*a:24*Fe-17-S[1]*a,m=r.advance;const z=(b?S[0]:S[1])*a-24*Fe;z>0&&z>ui&&(ui=z)}else{const T=Mt[Pi.fontStack];if(!T)continue;T[$e]&&(o=T[$e]);const S=St[Pi.fontStack];if(!S)continue;const z=S.glyphs[$e];if(!z)continue;if(r=z.metrics,m=8203!==$e?24:0,Me){const F=void 0!==S.ascender?Math.abs(S.ascender):0,G=void 0!==S.descender?Math.abs(S.descender):0,W=(F+G)*a;Si<W&&(Si=W,Ai=(F-G)/2*a),_=-F*a}else _=24*(Fe-a)-17}b?(ht.verticalizable=!0,li.push({glyph:$e,imageName:u,x:Te,y:oe+_,vertical:b,scale:a,localGlyph:r.localGlyph,fontStack:Pi.fontStack,sectionIndex:qi,metrics:r,rect:o}),Te+=m*a+Ht):(li.push({glyph:$e,imageName:u,x:Te,y:oe+_,vertical:b,scale:a,localGlyph:r.localGlyph,fontStack:Pi.fontStack,sectionIndex:qi,metrics:r,rect:o}),Te+=r.advance*a+Ht)}0!==li.length&&(pe=Math.max(Te-Ht,pe),Me?Hf(li,ne,ui,Ai,Pt*Fe/2):Hf(li,ne,ui,0,Pt/2)),Te=0;const an=Pt*Fe+ui;Mi.lineOffset=Math.max(ui,hi),oe+=an,++Ge}var Be;const De=oe,{horizontalAlign:we,verticalAlign:ii}=gh(Nt);(function(Se,Fe,hi,Mi,li,ui){const Si=(Fe-hi)*li,Ai=-ui*Mi;for(const an of Se)for(const di of an.positionedGlyphs)di.x+=Si,di.y+=Ai})(ht.positionedLines,ne,we,ii,pe,De),ht.top+=-ii*De,ht.bottom=ht.top+De,ht.left+=-we*pe,ht.right=ht.left+pe,ht.hasBaseline=Me}(dt,t,i,s,q,g,x,w,k,E,P,O),!function(ht){for(const St of ht)if(0!==St.positionedGlyphs.length)return!1;return!0}(st)&&dt}const mh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $f(e,t,i,s,c,p){if(t.imageName){const g=s[t.imageName];return g?g.displaySize[0]*t.scale*24/p+c:0}{const g=i[t.fontStack],x=g&&g.glyphs[e];return x?x.metrics.advance*t.scale+c:0}}function qf(e,t,i,s){const c=Math.pow(e-t,2);return s?e<t?c/2:2*c:c+Math.abs(i)*i}function Bg(e,t,i){let s=0;return 10===e&&(s-=1e4),i&&(s+=150),40!==e&&65288!==e||(s+=50),41!==t&&65289!==t||(s+=50),s}function Fu(e,t,i,s,c,p){let g=null,x=qf(t,i,c,p);for(const w of s){const E=qf(t-w.x,i,c,p)+w.badness;E<=x&&(g=w,x=E)}return{index:e,x:t,priorBreak:g,badness:x}}function Wf(e){return e?Wf(e.priorBreak).concat(e.index):[]}function gh(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Hf(e,t,i,s,c){if(!(t||i||s||c))return;const p=e.length-1,g=e[p],x=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=p;w++)e[w].x-=x,e[w].y+=i+s+c}function Og(e,t,i){const{horizontalAlign:s,verticalAlign:c}=gh(i),p=t[0]-e.displaySize[0]*s,g=t[1]-e.displaySize[1]*c;return{image:e,top:g,bottom:g+e.displaySize[1],left:p,right:p+e.displaySize[0]}}function Hd(e,t,i,s,c,p){const g=e.image;let x;if(g.content){const q=g.content,et=g.pixelRatio||1;x=[q[0]/et,q[1]/et,g.displaySize[0]-q[2]/et,g.displaySize[1]-q[3]/et]}const w=t.left*p,E=t.right*p;let A,k,P,R;"width"===i||"both"===i?(R=c[0]+w-s[3],k=c[0]+E+s[1]):(R=c[0]+(w+E-g.displaySize[0])/2,k=R+g.displaySize[0]);const O=t.top*p,V=t.bottom*p;return"height"===i||"both"===i?(A=c[1]+O-s[0],P=c[1]+V+s[2]):(A=c[1]+(O+V-g.displaySize[1])/2,P=A+g.displaySize[1]),{image:g,top:A,right:k,bottom:P,left:R,collisionPadding:x}}class ms extends ie{constructor(t,i,s,c,p){super(t,i),this.angle=c,this.z=s,void 0!==p&&(this.segment=p)}clone(){return new ms(this.x,this.y,this.z,this.angle,this.segment)}}function Uu(e,t,i,s,c){if(void 0===t.segment)return!0;let p=t,g=t.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=e[g].dist(p),p=e[g]}x+=e[g].dist(e[g+1]),g++;const w=[];let E=0;for(;x<i/2;){const A=e[g],k=e[g+1];if(!k)return!1;let P=e[g-1].angleTo(A)-A.angleTo(k);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:P}),E+=P;x-w[0].distance>s;)E-=w.shift().angleDelta;if(E>c)return!1;g++,x+=A.dist(k)}return!0}function Xf(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Yf(e,t,i){return e?.6*t*i:0}function Jf(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Fg(e,t,i,s,c,p){const g=Yf(i,c,p),x=Jf(i,s)*p;let w=0;const E=Xf(e)/2;for(let A=0;A<e.length-1;A++){const k=e[A],P=e[A+1],R=k.dist(P);if(w+R>E){const O=(E-w)/R,V=He(k.x,P.x,O),q=He(k.y,P.y,O),et=new ms(V,q,0,P.angleTo(k),A);return!g||Uu(e,et,x,g,t)?et:void 0}w+=R}}function Kf(e,t,i,s,c,p,g,x,w){const E=Yf(s,p,g),A=Jf(s,c),k=A*g,P=0===e[0].x||e[0].x===w||0===e[0].y||e[0].y===w;return t-k<t/4&&(t=k+t/4),Xd(e,P?t/2*x%t:(A/2+2*p)*g*x%t,t,E,i,k,P,!1,w)}function Xd(e,t,i,s,c,p,g,x,w){const E=p/2,A=Xf(e);let k=0,P=t-i,R=[];for(let O=0;O<e.length-1;O++){const V=e[O],q=e[O+1],et=V.dist(q),lt=q.angleTo(V);for(;P+i<k+et;){P+=i;const tt=(P-k)/et,st=He(V.x,q.x,tt),dt=He(V.y,q.y,tt);if(st>=0&&st<w&&dt>=0&&dt<w&&P-E>=0&&P+E<=A){const ht=new ms(st,dt,0,lt,O);ht._round(),s&&!Uu(e,ht,p,s,c)||R.push(ht)}}k+=et}return x||R.length||g||(R=Xd(e,k/2,i,s,c,p,g,!0,w)),R}function Qf(e,t,i,s,c){const p=[];for(let g=0;g<e.length;g++){const x=e[g];let w;for(let E=0;E<x.length-1;E++){let A=x[E],k=x[E+1];A.x<t&&k.x<t||(A.x<t?A=new ie(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<t&&(k=new ie(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<i&&k.y<i||(A.y<i?A=new ie(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round():k.y<i&&(k=new ie(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round()),A.x>=s&&k.x>=s||(A.x>=s?A=new ie(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=s&&(k=new ie(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=c&&k.y>=c||(A.y>=c?A=new ie(A.x+(c-A.y)/(k.y-A.y)*(k.x-A.x),c)._round():k.y>=c&&(k=new ie(A.x+(c-A.y)/(k.y-A.y)*(k.x-A.x),c)._round()),w&&A.equals(w[w.length-1])||(w=[A],p.push(w)),w.push(k)))))}}return p}le(ms,"Anchor");const Ql=1e20;function tm(e,t,i,s,c,p,g,x,w){for(let E=t;E<t+s;E++)em(e,i*p+E,p,c,g,x,w);for(let E=i;E<i+c;E++)em(e,E*p+t,1,s,g,x,w)}function em(e,t,i,s,c,p,g){p[0]=0,g[0]=-Ql,g[1]=Ql,c[0]=e[t];for(let x=1,w=0,E=0;x<s;x++){c[x]=e[t+x*i];const A=x*x;do{const k=p[w];E=(c[x]-c[k]+A-k*k)/(x-k)/2}while(E<=g[w]&&--w>-1);w++,p[w]=x,g[w]=E,g[w+1]=Ql}for(let x=0,w=0;x<s;x++){for(;g[w+1]<x;)w++;const E=p[w],A=x-E;e[t+x*i]=c[E]+A*A}}const Nu={none:0,ideographs:1,all:2};class tc{constructor(t,i,s){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const s=[];for(const c in t)for(const p of t[c])s.push({stack:c,id:p});mo(s,({stack:c,id:p},g)=>{let x=this.entries[c];x||(x=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[p];if(void 0!==w)return void g(null,{stack:c,id:p,glyph:w});if(w=this._tinySDF(x,c,p),w)return x.glyphs[p]=w,void g(null,{stack:c,id:p,glyph:w});const E=Math.floor(p/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void g(null,{stack:c,id:p,glyph:w});let A=x.requests[E];A||(A=x.requests[E]=[],tc.loadGlyphRange(c,E,this.url,this.requestManager,(k,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(x.glyphs[+R]=P.glyphs[+R]);x.ranges[E]=!0}for(const R of A)R(k,P);delete x.requests[E]})),A.push((k,P)=>{k?g(k):P&&g(null,{stack:c,id:p,glyph:P.glyphs[p]||null})})},(c,p)=>{if(c)i(c);else if(p){const g={};for(const{stack:x,id:w,glyph:E}of p)void 0===g[x]&&(g[x]={}),void 0===g[x].glyphs&&(g[x].glyphs={}),g[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;i(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Nu.none&&(this.localGlyphMode===Nu.all?!!this.localFontFamily:!!this.localFontFamily&&(jc(t)||Fa(t)||Ra(t)||Zi(t)||Io(t)))}_tinySDF(t,i,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let p=t.tinySDF;if(!p){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),p=t.tinySDF=new tc.TinySDF({fontFamily:c,fontWeight:V,fontSize:48,buffer:6,radius:16}),p.fontWeight=V}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const g=String.fromCharCode(s),{data:x,width:w,height:E,glyphWidth:A,glyphHeight:k,glyphLeft:P,glyphTop:R,glyphAdvance:O}=p.draw(g);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new ds({width:w,height:E},x),metrics:{width:A/2,height:k/2,left:P/2,top:R/2-27,advance:O/2,localGlyph:!0}}}}function im(e,t,i,s){const c=[],p=e.image,g=p.pixelRatio,x=p.paddedRect.w-2,w=p.paddedRect.h-2,E=e.right-e.left,A=e.bottom-e.top,k=p.stretchX||[[0,x]],P=p.stretchY||[[0,w]],R=(Pt,Nt)=>Pt+Nt[1]-Nt[0],O=k.reduce(R,0),V=P.reduce(R,0),q=x-O,et=w-V;let lt=0,tt=O,st=0,dt=V,ht=0,St=q,Mt=0,Ot=et;if(p.content&&s){const Pt=p.content;lt=Vu(k,0,Pt[0]),st=Vu(P,0,Pt[1]),tt=Vu(k,Pt[0],Pt[2]),dt=Vu(P,Pt[1],Pt[3]),ht=Pt[0]-lt,Mt=Pt[1]-st,St=Pt[2]-Pt[0]-tt,Ot=Pt[3]-Pt[1]-dt}const qt=(Pt,Nt,Vt,Gt)=>{const Ht=ju(Pt.stretch-lt,tt,E,e.left),Lt=Gu(Pt.fixed-ht,St,Pt.stretch,O),Qt=ju(Nt.stretch-st,dt,A,e.top),Te=Gu(Nt.fixed-Mt,Ot,Nt.stretch,V),oe=ju(Vt.stretch-lt,tt,E,e.left),pe=Gu(Vt.fixed-ht,St,Vt.stretch,O),ne=ju(Gt.stretch-st,dt,A,e.top),Me=Gu(Gt.fixed-Mt,Ot,Gt.stretch,V),Ge=new ie(Ht,Qt),Be=new ie(oe,Qt),De=new ie(oe,ne),we=new ie(Ht,ne),ii=new ie(Lt/g,Te/g),Se=new ie(pe/g,Me/g),Fe=t*Math.PI/180;if(Fe){const li=Math.sin(Fe),ui=Math.cos(Fe),Si=[ui,-li,li,ui];Ge._matMult(Si),Be._matMult(Si),we._matMult(Si),De._matMult(Si)}const hi=Pt.stretch+Pt.fixed,Mi=Nt.stretch+Nt.fixed;return{tl:Ge,tr:Be,bl:we,br:De,tex:{x:p.paddedRect.x+1+hi,y:p.paddedRect.y+1+Mi,w:Vt.stretch+Vt.fixed-hi,h:Gt.stretch+Gt.fixed-Mi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:Se,minFontScaleX:St/g/E,minFontScaleY:Ot/g/A,isSDF:i}};if(s&&(p.stretchX||p.stretchY)){const Pt=Yd(k,q,O),Nt=Yd(P,et,V);for(let Vt=0;Vt<Pt.length-1;Vt++){const Gt=Pt[Vt],Ht=Pt[Vt+1];for(let Lt=0;Lt<Nt.length-1;Lt++)c.push(qt(Gt,Nt[Lt],Ht,Nt[Lt+1]))}}else c.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return c}function Vu(e,t,i){let s=0;for(const c of e)s+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return s}function Yd(e,t,i){const s=[{fixed:-1,stretch:0}];for(const[c,p]of e){const g=s[s.length-1];s.push({fixed:c-g.stretch,stretch:g.stretch}),s.push({fixed:c-g.stretch,stretch:g.stretch+(p-c)})}return s.push({fixed:t+1,stretch:i}),s}function ju(e,t,i,s){return e/t*i+s}function Gu(e,t,i,s){return e-t*i/s}function Ug(e,t,i,s){const c=t+e.positionedLines[s].lineOffset;return 0===s?i+c/2:i+(c+(t+e.positionedLines[s-1].lineOffset))/2}tc.loadGlyphRange=function(e,t,i,s,c){const p=256*t,g=p+255,x=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${p}-${g}`),Ts.Glyphs);yr(x,(w,E)=>{if(w)c(w);else if(E){const A={},k=new ph(E).readFields(jf,{});for(const P of k.glyphs)A[P.id]=P;c(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},tc.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const x=this.size=e+4*t,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${p} ${e}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(e),g=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),w=Math.min(this.size-this.buffer,g+Math.ceil(s)),E=x+2*this.buffer,A=w+2*this.buffer,k=Math.max(E*A,0),P=new Uint8ClampedArray(k),R={data:P,width:E,height:A,glyphWidth:x,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===x||0===w)return R;const{ctx:O,buffer:V,gridInner:q,gridOuter:et}=this;O.clearRect(V,V,x,w),O.fillText(e,V,V+g);const lt=O.getImageData(V,V,x,w);et.fill(Ql,0,k),q.fill(0,0,k);for(let tt=0;tt<w;tt++)for(let st=0;st<x;st++){const dt=lt.data[4*(tt*x+st)+3]/255;if(0===dt)continue;const ht=(tt+V)*E+st+V;if(1===dt)et[ht]=0,q[ht]=Ql;else{const St=.5-dt;et[ht]=St>0?St*St:0,q[ht]=St<0?St*St:0}}tm(et,0,0,E,A,E,this.f,this.v,this.z),tm(q,V,V,x,w,E,this.f,this.v,this.z);for(let tt=0;tt<k;tt++){const st=Math.sqrt(et[tt])-Math.sqrt(q[tt]);P[tt]=Math.round(255-255*(st/this.radius+this.cutoff))}return R}};class Ng{constructor(t=[],i=Vg){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:s}=this,c=i[t];for(;t>0;){const p=t-1>>1,g=i[p];if(s(c,g)>=0)break;i[t]=g,t=p}i[t]=c}_down(t){const{data:i,compare:s}=this,c=this.length>>1,p=i[t];for(;t<c;){let g=1+(t<<1),x=i[g];const w=g+1;if(w<this.length&&s(i[w],x)<0&&(g=w,x=i[w]),s(x,p)>=0)break;i[t]=x,t=g}i[t]=p}}function Vg(e,t){return e<t?-1:e>t?1:0}function jg(e,t=1,i=!1){let s=1/0,c=1/0,p=-1/0,g=-1/0;const x=e[0];for(let R=0;R<x.length;R++){const O=x[R];(!R||O.x<s)&&(s=O.x),(!R||O.y<c)&&(c=O.y),(!R||O.x>p)&&(p=O.x),(!R||O.y>g)&&(g=O.y)}const w=Math.min(p-s,g-c);let E=w/2;const A=new Ng([],Gg);if(0===w)return new ie(s,c);for(let R=s;R<p;R+=w)for(let O=c;O<g;O+=w)A.push(new ec(R+E,O+E,E,e));let k=function(R){let O=0,V=0,q=0;const et=R[0];for(let lt=0,tt=et.length,st=tt-1;lt<tt;st=lt++){const dt=et[lt],ht=et[st],St=dt.x*ht.y-ht.x*dt.y;V+=(dt.x+ht.x)*St,q+=(dt.y+ht.y)*St,O+=3*St}return new ec(V/O,q/O,0,R)}(e),P=A.length;for(;A.length;){const R=A.pop();(R.d>k.d||!k.d)&&(k=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,P)),R.max-k.d<=t||(E=R.h/2,A.push(new ec(R.p.x-E,R.p.y-E,E,e)),A.push(new ec(R.p.x+E,R.p.y-E,E,e)),A.push(new ec(R.p.x-E,R.p.y+E,E,e)),A.push(new ec(R.p.x+E,R.p.y+E,E,e)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${k.d}`)),k.p}function Gg(e,t){return t.max-e.max}function ec(e,t,i,s){this.p=new ie(e,t),this.h=i,this.d=function(c,p){let g=!1,x=1/0;for(let w=0;w<p.length;w++){const E=p[w];for(let A=0,k=E.length,P=k-1;A<k;P=A++){const R=E[A],O=E[P];R.y>c.y!=O.y>c.y&&c.x<(O.x-R.x)*(c.y-R.y)/(O.y-R.y)+R.x&&(g=!g),x=Math.min(x,nf(c,R,O))}}return(g?1:-1)*Math.sqrt(x)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Jd=Number.POSITIVE_INFINITY,Zg=Math.sqrt(2);function nm(e,[t,i]){let s=0,c=0;if(i===Jd){t<0&&(t=0);const p=t/Zg;switch(e){case"top-right":case"top-left":c=p-7;break;case"bottom-right":case"bottom-left":c=7-p;break;case"bottom":c=7-t;break;case"top":c=t-7}switch(e){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=t;break;case"right":s=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(e){case"top-right":case"bottom-right":case"right":s=-t;break;case"top-left":case"bottom-left":case"left":s=t}}return[s,c]}function $g(e,t,i,s,c,p,g,x,w,E){e.createArrays(),e.tilePixelRatio=Ce/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const A=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,P={};if("composite"===e.textSizeData.kind){const{minZoom:V,maxZoom:q}=e.textSizeData;P.compositeTextSizes=[k["text-size"].possiblyEvaluate(new wt(V),x),k["text-size"].possiblyEvaluate(new wt(q),x)]}if("composite"===e.iconSizeData.kind){const{minZoom:V,maxZoom:q}=e.iconSizeData;P.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new wt(V),x),k["icon-size"].possiblyEvaluate(new wt(q),x)]}P.layoutTextSize=k["text-size"].possiblyEvaluate(new wt(w+1),x),P.layoutIconSize=k["icon-size"].possiblyEvaluate(new wt(w+1),x),P.textMaxSize=k["text-size"].possiblyEvaluate(new wt(18),x);const R="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),O=A.get("text-size");for(const V of e.features){const q=A.get("text-font").evaluate(V,{},x).join(","),et=O.evaluate(V,{},x),lt=P.layoutTextSize.evaluate(V,{},x),tt=(P.layoutIconSize.evaluate(V,{},x),{horizontal:{},vertical:void 0}),st=V.text;let dt,ht=[0,0];if(st){const Ot=st.toString(),qt=24*A.get("text-letter-spacing").evaluate(V,{},x),Pt=24*A.get("text-line-height").evaluate(V,{},x),Nt=v(Ot)?qt:0,Vt=A.get("text-anchor").evaluate(V,{},x),Gt=A.get("text-variable-anchor");if(!Gt){const oe=A.get("text-radial-offset").evaluate(V,{},x);ht=oe?nm(Vt,[24*oe,Jd]):A.get("text-offset").evaluate(V,{},x).map(pe=>24*pe)}let Ht=R?"center":A.get("text-justify").evaluate(V,{},x);const Lt="point"===A.get("symbol-placement"),Qt=Lt?24*A.get("text-max-width").evaluate(V,{},x):1/0,Te=oe=>{e.allowVerticalPlacement&&y(Ot)&&(tt.vertical=Wd(st,t,i,c,q,Qt,Pt,Vt,oe,Nt,ht,dr.vertical,!0,lt,et))};if(!R&&Gt){const oe="auto"===Ht?Gt.map(ne=>Kd(ne)):[Ht];let pe=!1;for(let ne=0;ne<oe.length;ne++){const Me=oe[ne];if(!tt.horizontal[Me])if(pe)tt.horizontal[Me]=tt.horizontal[0];else{const Ge=Wd(st,t,i,c,q,Qt,Pt,"center",Me,Nt,ht,dr.horizontal,!1,lt,et);Ge&&(tt.horizontal[Me]=Ge,pe=1===Ge.positionedLines.length)}}Te("left")}else{if("auto"===Ht&&(Ht=Kd(Vt)),Lt||A.get("text-writing-mode").indexOf("horizontal")>=0||!y(Ot)){const oe=Wd(st,t,i,c,q,Qt,Pt,Vt,Ht,Nt,ht,dr.horizontal,!1,lt,et);oe&&(tt.horizontal[Ht]=oe)}Te(Lt?"left":Ht)}}let St=!1;if(V.icon&&V.icon.name){const Ot=s[V.icon.name];Ot&&(dt=Og(c[V.icon.name],A.get("icon-offset").evaluate(V,{},x),A.get("icon-anchor").evaluate(V,{},x)),St=Ot.sdf,void 0===e.sdfIcons?e.sdfIcons=Ot.sdf:e.sdfIcons!==Ot.sdf&&Oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ot.pixelRatio!==e.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const Mt=om(tt.horizontal)||tt.vertical;e.iconsInText||(e.iconsInText=!!Mt&&Mt.iconsInText),(Mt||dt)&&qg(e,V,tt,dt,s,P,lt,0,ht,St,g,x,E)}p&&e.generateCollisionDebugBuffers(w,e.collisionBoxArray)}function Kd(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qg(e,t,i,s,c,p,g,x,w,E,A,k,P){let R=p.textMaxSize.evaluate(t,{},k);void 0===R&&(R=g);const O=e.layers[0].layout,V=O.get("icon-offset").evaluate(t,{},k),q=om(i.horizontal)||i.vertical,et="globe"===P.name,lt=g/24,tt=e.tilePixelRatio*R/24,st=(Nt=e.overscaling,e.zoom>18&&Nt>2&&(Nt>>=1),Math.max(Ce/(512*Nt),1)*O.get("symbol-spacing")),dt=O.get("text-padding")*e.tilePixelRatio,ht=O.get("icon-padding")*e.tilePixelRatio,St=Xe(O.get("text-max-angle")),Mt="map"===O.get("text-rotation-alignment")&&"point"!==O.get("symbol-placement"),Ot="map"===O.get("icon-rotation-alignment")&&"point"!==O.get("symbol-placement"),qt=O.get("symbol-placement"),Pt=st/2;var Nt;const Vt=O.get("icon-text-fit");let Gt;s&&"none"!==Vt&&(e.allowVerticalPlacement&&i.vertical&&(Gt=Hd(s,i.vertical,Vt,O.get("icon-text-fit-padding"),V,lt)),q&&(s=Hd(s,q,Vt,O.get("icon-text-fit-padding"),V,lt)));const Ht=(Lt,Qt,Te)=>{if(Qt.x<0||Qt.x>=Ce||Qt.y<0||Qt.y>=Ce)return;let oe=null;if(et){const{x:pe,y:ne,z:Me}=P.projectTilePoint(Qt.x,Qt.y,Te);oe={anchor:new ms(pe,ne,Me,0,void 0),up:P.upVector(Te,Qt.x,Qt.y)}}!function(pe,ne,Me,Ge,Be,De,we,ii,Se,Fe,hi,Mi,li,ui,Si,Ai,an,di,Pi,qi,$e,a,r,o,u){const m=pe.addToLineVertexArray(ne,Ge);let _,b,T,S,z,F,G,W=0,nt=0,gt=0,_t=0,yt=-1,Rt=-1;const Bt={};let te=Na("");const Kt=Me?Me.anchor:ne;let Yt=0,ue=0;if(void 0===Se._unevaluatedLayout.getValue("text-radial-offset")?[Yt,ue]=Se.layout.get("text-offset").evaluate($e,{},u).map(Ie=>24*Ie):(Yt=24*Se.layout.get("text-radial-offset").evaluate($e,{},u),ue=Jd),pe.allowVerticalPlacement&&Be.vertical){const Ie=Be.vertical;if(Si)F=Qd(Ie),ii&&(G=Qd(ii));else{const ke=Se.layout.get("text-rotate").evaluate($e,{},u)+90;T=Zu(Fe,Kt,ne,hi,Mi,li,Ie,ui,ke,Ai),ii&&(S=Zu(Fe,Kt,ne,hi,Mi,li,ii,di,ke))}}if(De){const Ie=Se.layout.get("icon-rotate").evaluate($e,{},u),ke="none"!==Se.layout.get("icon-text-fit"),ci=im(De,Ie,r,ke),ln=ii?im(ii,Ie,r,ke):void 0;b=Zu(Fe,Kt,ne,hi,Mi,li,De,di,Ie),W=4*ci.length;const er=pe.iconSizeData;let pi=null;"source"===er.kind?(pi=[Po*Se.layout.get("icon-size").evaluate($e,{},u)],pi[0]>Ks&&Oi(`${pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===er.kind&&(pi=[Po*a.compositeIconSizes[0].evaluate($e,{},u),Po*a.compositeIconSizes[1].evaluate($e,{},u)],(pi[0]>Ks||pi[1]>Ks)&&Oi(`${pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pe.addSymbols(pe.icon,ci,pi,qi,Pi,$e,!1,Me,ne,m.lineStartIndex,m.lineLength,-1,o,u),yt=pe.icon.placedSymbolArray.length-1,ln&&(nt=4*ln.length,pe.addSymbols(pe.icon,ln,pi,qi,Pi,$e,dr.vertical,Me,ne,m.lineStartIndex,m.lineLength,-1,o,u),Rt=pe.icon.placedSymbolArray.length-1)}for(const Ie in Be.horizontal){const ke=Be.horizontal[Ie];_||(te=Na(ke.text),Si?z=Qd(ke):_=Zu(Fe,Kt,ne,hi,Mi,li,ke,ui,Se.layout.get("text-rotate").evaluate($e,{},u),Ai));const ci=1===ke.positionedLines.length;if(gt+=rm(pe,Me,ne,ke,we,Se,Si,$e,Ai,m,Be.vertical?dr.horizontal:dr.horizontalOnly,ci?Object.keys(Be.horizontal):[Ie],Bt,yt,a,o,u),ci)break}Be.vertical&&(_t+=rm(pe,Me,ne,Be.vertical,we,Se,Si,$e,Ai,m,dr.vertical,["vertical"],Bt,Rt,a,o,u));let ce=-1;const fe=(Ie,ke)=>Ie?Math.max(Ie,ke):ke;ce=fe(z,ce),ce=fe(F,ce),ce=fe(G,ce);const Ae=ce>-1?1:0;pe.glyphOffsetArray.length>=ta.MAX_GLYPHS&&Oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==$e.sortKey&&pe.addToSortKeyRanges(pe.symbolInstances.length,$e.sortKey),pe.symbolInstances.emplaceBack(Kt.x,Kt.y,Kt.z,ne.x,ne.y,Bt.right>=0?Bt.right:-1,Bt.center>=0?Bt.center:-1,Bt.left>=0?Bt.left:-1,Bt.vertical>=0?Bt.vertical:-1,yt,Rt,te,void 0!==_?_:pe.collisionBoxArray.length,void 0!==_?_+1:pe.collisionBoxArray.length,void 0!==T?T:pe.collisionBoxArray.length,void 0!==T?T+1:pe.collisionBoxArray.length,void 0!==b?b:pe.collisionBoxArray.length,void 0!==b?b+1:pe.collisionBoxArray.length,S||pe.collisionBoxArray.length,S?S+1:pe.collisionBoxArray.length,hi,gt,_t,W,nt,Ae,0,Yt,ue,ce)}(e,Qt,oe,Lt,i,s,c,Gt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,dt,Mt,w,0,ht,Ot,V,t,p,E,A,k)};if("line"===qt)for(const Lt of Qf(t.geometry,0,0,Ce,Ce)){const Qt=Kf(Lt,st,St,i.vertical||q,s,24,tt,e.overscaling,Ce);for(const Te of Qt)q&&Wg(e,q.text,Pt,Te)||Ht(Lt,Te,k)}else if("line-center"===qt){for(const Lt of t.geometry)if(Lt.length>1){const Qt=Fg(Lt,St,i.vertical||q,s,24,tt);Qt&&Ht(Lt,Qt,k)}}else if("Polygon"===t.type)for(const Lt of Rd(t.geometry,0)){const Qt=jg(Lt,16);Ht(Lt[0],new ms(Qt.x,Qt.y,0,0,void 0),k)}else if("LineString"===t.type)for(const Lt of t.geometry)Ht(Lt,new ms(Lt[0].x,Lt[0].y,0,0,void 0),k);else if("Point"===t.type)for(const Lt of t.geometry)for(const Qt of Lt)Ht([Qt],new ms(Qt.x,Qt.y,0,0,void 0),k)}const Ks=32640;function rm(e,t,i,s,c,p,g,x,w,E,A,k,P,R,O,V,q){const et=function(st,dt,ht,St,Mt,Ot,qt,Pt){const Nt=[];if(0===dt.positionedLines.length)return Nt;const Vt=St.layout.get("text-rotate").evaluate(Ot,{})*Math.PI/180,Gt=function(oe){const pe=oe[0],ne=oe[1],Me=pe*ne;return Me>0?[pe,-ne]:Me<0?[-pe,ne]:0===pe?[ne,pe]:[ne,-pe]}(ht);let Ht=Math.abs(dt.top-dt.bottom);for(const oe of dt.positionedLines)Ht-=oe.lineOffset;const Lt=dt.positionedLines.length,Qt=Ht/Lt;let Te=dt.top-ht[1];for(let oe=0;oe<Lt;++oe){const pe=dt.positionedLines[oe];Te=Ug(dt,Qt,Te,oe);for(const ne of pe.positionedGlyphs){if(!ne.rect)continue;const Me=ne.rect||{};let Ge=4,Be=!0,De=1,we=0;if(ne.imageName){const o=qt[ne.imageName];if(!o)continue;if(o.sdf){Oi("SDF images are not supported in formatted text and will be ignored.");continue}Be=!1,De=o.pixelRatio,Ge=1/De}const ii=(Mt||Pt)&&ne.vertical,Se=ne.metrics.advance*ne.scale/2,Fe=ne.metrics,hi=ne.rect;if(null===hi)continue;Pt&&dt.verticalizable&&(we=ne.imageName?Se-ne.metrics.width*ne.scale/2:0);const Mi=Mt?[ne.x+Se,ne.y]:[0,0];let li=[0,0],ui=[0,0],Si=!1;Mt||(ii?(ui=[ne.x+Se+Gt[0],ne.y+Gt[1]-we],Si=!0):li=[ne.x+Se+ht[0],ne.y+ht[1]-we]);const Ai=hi.w*ne.scale/(De*(ne.localGlyph?2:1)),an=hi.h*ne.scale/(De*(ne.localGlyph?2:1));let di,Pi,qi,$e;if(ii){const o=ne.y-Te,u=new ie(-Se,Se-o),m=-Math.PI/2,_=new ie(...ui);di=new ie(-Se+li[0],li[1]),di._rotateAround(m,u)._add(_),di.x+=-o+Se,di.y-=(Fe.left-Ge)*ne.scale;const b=ne.imageName?Fe.advance*ne.scale:24*ne.scale,T=String.fromCharCode(ne.glyph);p_(T)?di.x+=(1-Ge)*ne.scale:Mg(T)?di.x+=b-Fe.height*ne.scale+(-Ge-1)*ne.scale:di.x+=ne.imageName||Fe.width+2*Ge===hi.w&&Fe.height+2*Ge===hi.h?(b-an)/2:(b-(Fe.height+2*Ge)*ne.scale)/2,Pi=new ie(di.x,di.y-Ai),qi=new ie(di.x+an,di.y),$e=new ie(di.x+an,di.y-Ai)}else{const o=(Fe.left-Ge)*ne.scale-Se+li[0],u=(-Fe.top-Ge)*ne.scale+li[1],m=o+Ai,_=u+an;di=new ie(o,u),Pi=new ie(m,u),qi=new ie(o,_),$e=new ie(m,_)}if(Vt){let o;o=Mt?new ie(0,0):Si?new ie(Gt[0],Gt[1]):new ie(ht[0],ht[1]),di._rotateAround(Vt,o),Pi._rotateAround(Vt,o),qi._rotateAround(Vt,o),$e._rotateAround(Vt,o)}const a=new ie(0,0),r=new ie(0,0);Nt.push({tl:di,tr:Pi,bl:qi,br:$e,tex:Me,writingMode:dt.writingMode,glyphOffset:Mi,sectionIndex:ne.sectionIndex,isSDF:Be,pixelOffsetTL:a,pixelOffsetBR:r,minFontScaleX:0,minFontScaleY:0})}}return Nt}(0,s,w,p,g,x,c,e.allowVerticalPlacement),lt=e.textSizeData;let tt=null;"source"===lt.kind?(tt=[Po*p.layout.get("text-size").evaluate(x,{},q)],tt[0]>Ks&&Oi(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===lt.kind&&(tt=[Po*O.compositeTextSizes[0].evaluate(x,{},q),Po*O.compositeTextSizes[1].evaluate(x,{},q)],(tt[0]>Ks||tt[1]>Ks)&&Oi(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,et,tt,w,g,x,A,t,i,E.lineStartIndex,E.lineLength,R,V,q);for(const st of k)P[st]=e.text.placedSymbolArray.length-1;return 4*et.length}function om(e){for(const t in e)return e[t];return null}function Zu(e,t,i,s,c,p,g,x,w,E){let A=g.top,k=g.bottom,P=g.left,R=g.right;const O=g.collisionPadding;if(O&&(P-=O[0],A-=O[1],R+=O[2],k+=O[3]),w){const V=new ie(P,A),q=new ie(R,A),et=new ie(P,k),lt=new ie(R,k),tt=Xe(w);let st=new ie(0,0);E&&(st=new ie(E[0],E[1])),V._rotateAround(tt,st),q._rotateAround(tt,st),et._rotateAround(tt,st),lt._rotateAround(tt,st),P=Math.min(V.x,q.x,et.x,lt.x),R=Math.max(V.x,q.x,et.x,lt.x),A=Math.min(V.y,q.y,et.y,lt.y),k=Math.max(V.y,q.y,et.y,lt.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,P,A,R,k,x,s,c,p),e.length-1}function Qd(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Wg(e,t,i,s){const c=e.compareText;if(t in c){const p=c[t];for(let g=p.length-1;g>=0;g--)if(s.dist(p[g])<i)return!0}else c[t]=[];return c[t].push(s),!1}function sm(e,t){const i=e.fovAboveCenter,s=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,c=(e._camera.position[2]*e.worldSize-s)/Math.cos(e._pitch),p=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),g=Math.sin(e._pitch)*p+c;return Math.min(1.01*g,c*(1/e._horizonShift))}function Ha(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),s=e.x*i,c=(e.x+1)*i,p=e.y*i,g=(e.y+1)*i,x=Qn(s),w=Qn(c),E=gn(p),A=gn(g),k=t.project(x,E),P=t.project(w,E),R=t.project(w,A),O=t.project(x,A);let V=Math.min(k.x,P.x,R.x,O.x),q=Math.min(k.y,P.y,R.y,O.y),et=Math.max(k.x,P.x,R.x,O.x),lt=Math.max(k.y,P.y,R.y,O.y);const tt=i/16;function st(ht,St,Mt,Ot,qt,Pt){const Nt=(Mt+qt)/2,Vt=(Ot+Pt)/2,Gt=t.project(Qn(Nt),gn(Vt)),Ht=Math.max(0,V-Gt.x,q-Gt.y,Gt.x-et,Gt.y-lt);V=Math.min(V,Gt.x),et=Math.max(et,Gt.x),q=Math.min(q,Gt.y),lt=Math.max(lt,Gt.y),Ht>tt&&(st(ht,Gt,Mt,Ot,Nt,Vt),st(Gt,St,Nt,Vt,qt,Pt))}st(k,P,s,p,c,p),st(P,R,c,p,c,g),st(R,O,c,g,s,g),st(O,k,s,g,s,p),V-=tt,q-=tt,et+=tt,lt+=tt;const dt=1/Math.max(et-V,lt-q);return{scale:dt,x:V*dt,y:q*dt,x2:et*dt,y2:lt*dt,projection:t}}const Hg=so(new Float32Array(16));class Qs{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new Ke(0,0)}projectTilePoint(t,i,s){return{x:t,y:i,z:0}}locationPoint(t,i,s=!0){return t._coordinatePoint(t.locationCoordinate(i),s)}pixelsPerMeter(t,i){return lo(1,t)*i}pixelSpaceConversion(t,i,s){return 1}farthestPixelDistance(t){return sm(t,t.pixelsPerMeter)}pointCoordinate(t,i,s,c){const p=t.horizonLineFromTop(!1),g=new ie(i,Math.max(p,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,c))}pointCoordinate3D(t,i,s){const c=new ie(i,s);if(t.elevation)return t.elevation.pointCoordinate(c);{const p=this.pointCoordinate(t,c.x,c.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const s=t.horizonLineFromTop();return i.y<s}createInversionMatrix(t,i){return Hg}createTileMatrix(t,i,s){let c,p,g;const x=s.canonical,w=so(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Ha(x,this);c=1,p=E.x+s.wrap*E.scale,g=E.y,hs(w,w,[c/E.scale,c/E.scale,t.pixelsPerMeter/i])}else c=i/t.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*s.wrap)*c,g=x.y*c;return qc(w,w,[p,g,0]),hs(w,w,[c/Ce,c/Ce,1]),w}upVector(t,i,s){return[0,0,1]}upVectorScale(t,i,s){return{metersToTile:1}}}class Xg extends Qs{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,s]=this.parallels=t.parallels||[29.5,45.5],c=Math.sin(Xe(i));this.n=(c+Math.sin(Xe(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:s,c,r0:p}=this,g=Xe(t-this.center[0]),x=Xe(i),w=Math.sqrt(c-2*s*Math.sin(x))/s;return{x:w*Math.sin(g*s),y:w*Math.cos(g*s)-p,z:0}}unproject(t,i){const{n:s,c,r0:p}=this,g=p+i;let x=Math.atan2(t,Math.abs(g))*Math.sign(g);g*s<0&&(x-=Math.PI*Math.sign(t)*Math.sign(g));const w=Xe(this.center[0])*s;x=Fr(x,-Math.PI-w,Math.PI-w);const E=Ue(en(x/s)+this.center[0],-180,180),A=Math.asin(Ue((c-(t*t+g*g)*s*s)/(2*s),-1,1)),k=Ue(en(A),-_n,_n);return new Ke(E,k)}}const _h=1.340264,yh=-.081106,xh=893e-6,Ci=.003796,$u=Math.sqrt(3)/2;class Yg extends Qs{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const s=Math.asin($u*Math.sin(i)),c=s*s,p=c*c*c;return{x:.5*(t*Math.cos(s)/($u*(_h+3*yh*c+p*(7*xh+9*Ci*c)))/Math.PI+.5),y:1-.5*(s*(_h+yh*c+p*(xh+Ci*c))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=s*s,p=c*c*c;for(let A,k,P,R=0;R<12&&(k=s*(_h+yh*c+p*(xh+Ci*c))-i,P=_h+3*yh*c+p*(7*xh+9*Ci*c),A=k/P,s=Ue(s-A,-Math.PI/3,Math.PI/3),c=s*s,p=c*c*c,!(Math.abs(A)<1e-12));++R);const g=$u*t*(_h+3*yh*c+p*(7*xh+9*Ci*c))/Math.cos(s),x=Math.asin(Math.sin(s)/$u),w=Ue(180*g/Math.PI,-180,180),E=Ue(180*x/Math.PI,-_n,_n);return new Ke(w,E)}}class Jg extends Qs{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const s=360*(t-.5),c=Ue(360*(.5-i),-_n,_n);return new Ke(s,c)}}const ic=Math.PI/2;function vh(e){return Math.tan((ic+e)/2)}class bh extends Qs{constructor(t){super(t),this.center=t.center||[0,30];const[i,s]=this.parallels=t.parallels||[30,30];let c=Xe(i),p=Xe(s);this.southernCenter=c+p<0,this.southernCenter&&(c=-c,p=-p);const g=Math.cos(c),x=vh(c);this.n=c===p?Math.sin(c):Math.log(g/Math.cos(p))/Math.log(vh(p)/x),this.f=g*Math.pow(vh(c),this.n)/this.n}project(t,i){i=Xe(i),this.southernCenter&&(i=-i),t=Xe(t-this.center[0]);const s=1e-6,{n:c,f:p}=this;p>0?i<-ic+s&&(i=-ic+s):i>ic-s&&(i=ic-s);const g=p/Math.pow(vh(i),c);let x=g*Math.sin(c*t),w=p-g*Math.cos(c*t);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:c}=this,p=c-i,g=Math.sign(p),x=Math.sign(s)*Math.sqrt(t*t+p*p);let w=Math.atan2(t,Math.abs(p))*g;p*s<0&&(w-=Math.PI*Math.sign(t)*g);const E=Ue(en(w/s)+this.center[0],-180,180),A=Ue(en(2*Math.atan(Math.pow(c/x,1/s))-ic),-_n,_n);return new Ke(E,this.southernCenter?-A:A)}}class am extends Qs{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Lr(t),y:Rr(i),z:0}}unproject(t,i){const s=Qn(t),c=gn(i);return new Ke(s,c)}}const qu=Xe(_n);class Kg extends Qs{project(t,i){const s=(i=Xe(i))*i,c=s*s;return{x:.5*((t=Xe(t))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=25,p=0,g=s*s;do{g=s*s;const E=g*g;p=(s*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),s=Ue(s-p,-qu,qu)}while(Math.abs(p)>1e-6&&--c>0);g=s*s;const x=Ue(en(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=en(s);return new Ke(x,w)}}const tp=Xe(_n);class lm extends Qs{project(t,i){i=Xe(i),t=Xe(t);const s=Math.cos(i),c=2/Math.PI,p=Math.acos(s*Math.cos(t/2)),g=Math.sin(p)/p,x=.5*(t*c+2*s*Math.sin(t/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,i){let s=t=(2*t-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let x=0,w=0;do{const E=Math.cos(c),A=Math.sin(c),k=2*A*E,P=A*A,R=E*E,O=Math.cos(s/2),V=Math.sin(s/2),q=2*O*V,et=V*V,lt=1-R*O*O,tt=lt?1/lt:0,st=lt?Math.acos(E*O)*Math.sqrt(1/lt):0,dt=.5*(2*st*E*V+2*s/Math.PI)-t,ht=.5*(st*A+c)-i,St=.5*tt*(R*et+st*E*O*P)+1/Math.PI,Mt=tt*(q*k/4-st*A*V),Ot=.125*tt*(k*V-st*A*R*q),qt=.5*tt*(P*O+st*et*E)+.5,Pt=Mt*Ot-qt*St;x=(ht*Mt-dt*qt)/Pt,w=(dt*Ot-ht*St)/Pt,s=Ue(s-x,-Math.PI,Math.PI),c=Ue(c-w,-tp,tp)}while((Math.abs(x)>g||Math.abs(w)>g)&&--p>0);return new Ke(en(s),en(c))}}class cm extends Qs{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:s,cosPhi:c}=this;return{x:Xe(t)*c*s+.5,y:-Math.sin(Xe(i))/c*s+.5,z:0}}unproject(t,i){const{scale:s,cosPhi:c}=this,p=-(i-.5)/s,g=Ue(en((t-.5)/s)/c,-180,180),x=Math.asin(Ue(p*c,-1,1)),w=Ue(en(x),-_n,_n);return new Ke(g,w)}}class hm extends am{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,s){const c=th(t,i,s);return Ri(c,c,eh(ao(s))),{x:c[0],y:c[1],z:c[2]}}locationPoint(t,i){const s=Pl(i.lat,i.lng),c=Ln([],s),p=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;Yc(s,s,c,lo(1,0)*Ce*p);const g=so(new Float64Array(16));return cs(g,t.pixelMatrix,t.globeMatrix),Ri(s,s,g),new ie(s[0],s[1])}pixelsPerMeter(t,i){return lo(1,0)*i}pixelSpaceConversion(t,i,s){const c=lo(1,t)*i,p=He(lo(1,45)*i,c,s);return this.pixelsPerMeter(t,i)/p}createTileMatrix(t,i,s){const c=du(ao(s.canonical));return cs(new Float64Array(16),t.globeMatrix,c)}createInversionMatrix(t,i){const{center:s}=t,c=eh(ao(i));return Wc(c,c,Xe(s.lng)),lu(c,c,Xe(s.lat)),hs(c,c,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(t,i,s,c){return Ed(t,i,s,!0)||new Bl(0,0)}pointCoordinate3D(t,i,s){const c=this.pointCoordinate(t,i,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(t,i){return!Ed(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(c,p){const g=c.cameraToCenterDistance,x=c._centerAltitude*p,w=c._camera,E=c._camera.forward(),A=us([],hr([],E,-g),[0,0,x]),k=c.worldSize/(2*Math.PI),P=[0,0,-k],R=c.width/c.height,O=Math.tan(c.fovAboveCenter),V=hr([],w.up(),O),q=hr([],w.right(),O*R),et=Ln([],us([],us([],E,V),q)),lt=[];let tt;if(new wd(A,et).closestPointOnSphere(P,k,lt)){const st=us([],lt,P),dt=Pr([],st,A);tt=Math.cos(c.fovAboveCenter)*Hc(dt)}else{const st=Pr([],A,P),dt=Pr([],P,A);Ln(dt,dt);const ht=Hc(st)-k;tt=Math.sqrt(ht*(ht+2*k));const St=Math.acos(tt/(k+ht))-Math.acos(zr(E,dt));tt*=Math.cos(St)}return 1.01*tt}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=Dl(t.zoom);if(s>0){const c=sm(t,lo(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return He(i,c+p*(1-Math.cos(g)),Math.pow(s,10))}return i}upVector(t,i,s){return th(i,s,t,1)}upVectorScale(t){return{metersToTile:hu(uu(ao(t)))}}}function um(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new am(e);case"equirectangular":return new Jg(e);case"naturalEarth":return new Kg(e);case"equalEarth":return new Yg(e);case"winkelTripel":return new lm(e);case"albers":return i?new cm(e):new Xg(e);case"lambertConformalConic":return i?new cm(e):new bh(e);case"globe":return new hm(e)}throw new Error(`Invalid projection name: ${e.name}`)}const ep=Iu.types,Qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wu(e,t,i,s,c,p,g,x,w,E,A,k,P){const R=x?Math.min(Ks,Math.round(x[0])):0,O=x?Math.min(Ks,Math.round(x[1])):0;e.emplaceBack(t,i,Math.round(32*s),Math.round(32*c),p,g,(R<<1)+(w?1:0),O,16*E,16*A,256*k,256*P)}function Hu(e,t,i,s,c,p,g){e.emplaceBack(t,i,s,c,p,g)}function Xu(e,t,i,s,c){e.emplaceBack(t,i,s,c),e.emplaceBack(t,i,s,c),e.emplaceBack(t,i,s,c),e.emplaceBack(t,i,s,c)}function t_(e){for(const t of e.sections)if(N(t.text))return!0;return!1}class ip{constructor(t){this.layoutVertexArray=new Ir,this.indexArray=new mn,this.programConfigurations=t,this.segments=new $i,this.dynamicLayoutVertexArray=new mi,this.opacityVertexArray=new si,this.placedSymbolArray=new ad,this.globeExtVertexArray=new xi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,i,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vg.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,bg.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Qg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Hl.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}le(ip,"SymbolBuffers");class np{constructor(t,i,s){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new s,this.segments=new $i,this.collisionVertexArray=new Ei,this.collisionVertexArrayExt=new fn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,wg.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Tg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}le(np,"CollisionBuffers");class ta{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=so([]),this.placementViewportMatrix=so([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yl(this.zoom,i["text-size"]),this.iconSizeData=Yl(this.zoom,i["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>dr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new ip(new Va(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new ip(new Va(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new wp,this.lineVertexArray=new Ua,this.symbolInstances=new bp}calculateGlyphDependencies(t,i,s,c,p){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,c&&p){const x=dh[t.charAt(g)];x&&(i[x.charCodeAt(0)]=!0)}}populate(t,i,s,c){const p=this.layers[0],g=p.layout,x="globe"===this.projection.name,w=g.get("text-font"),E=g.get("text-field"),A=g.get("icon-image"),k=("constant"!==E.value.kind||E.value.value instanceof bn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),P="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,R=g.get("symbol-sort-key");if(this.features=[],!k&&!P)return;const O=i.iconDependencies,V=i.glyphDependencies,q=i.availableImages,et=new wt(this.zoom);for(const{feature:lt,id:tt,index:st,sourceLayerIndex:dt}of t){const ht=p._featureFilter.needGeometry,St=Za(lt,ht);if(!p._featureFilter.filter(et,St,s))continue;if(ht||(St.geometry=Ji(lt,s,c)),x&&1!==lt.type&&s.z<=5){const Pt=St.geometry,Nt=.98078528056,Vt=(Gt,Ht)=>zr(th(Gt.x,Gt.y,s,1),th(Ht.x,Ht.y,s,1))<Nt;for(let Gt=0;Gt<Pt.length;Gt++)Pt[Gt]=Om(Pt[Gt],Vt)}let Mt,Ot;if(k){const Pt=p.getValueAndResolveTokens("text-field",St,s,q),Nt=bn.factory(Pt);t_(Nt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pt()||this.hasRTLText&&ft.isParsed())&&(Mt=Vd(Nt,p,St))}if(P){const Pt=p.getValueAndResolveTokens("icon-image",St,s,q);Ot=Pt instanceof wn?Pt:wn.fromString(Pt)}if(!Mt&&!Ot)continue;const qt=this.sortFeaturesByKey?R.evaluate(St,{},s):void 0;if(this.features.push({id:tt,text:Mt,icon:Ot,index:st,sourceLayerIndex:dt,geometry:St.geometry,properties:lt.properties,type:ep[lt.type],sortKey:qt}),Ot&&(O[Ot.name]=!0),Mt){const Pt=w.evaluate(St,{},s).join(","),Nt="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(dr.vertical)>=0;for(const Vt of Mt.sections)if(Vt.image)O[Vt.image.name]=!0;else{const Gt=y(Mt.toString()),Ht=Vt.fontStack||Pt,Lt=V[Ht]=V[Ht]||{};this.calculateGlyphDependencies(Vt.text,Lt,Nt,this.allowVerticalPlacement,Gt)}}}"line"===g.get("symbol-placement")&&(this.features=function(lt){const tt={},st={},dt=[];let ht=0;function St(Pt){dt.push(lt[Pt]),ht++}function Mt(Pt,Nt,Vt){const Gt=st[Pt];return delete st[Pt],st[Nt]=Gt,dt[Gt].geometry[0].pop(),dt[Gt].geometry[0]=dt[Gt].geometry[0].concat(Vt[0]),Gt}function Ot(Pt,Nt,Vt){const Gt=tt[Nt];return delete tt[Nt],tt[Pt]=Gt,dt[Gt].geometry[0].shift(),dt[Gt].geometry[0]=Vt[0].concat(dt[Gt].geometry[0]),Gt}function qt(Pt,Nt,Vt){const Gt=Vt?Nt[0][Nt[0].length-1]:Nt[0][0];return`${Pt}:${Gt.x}:${Gt.y}`}for(let Pt=0;Pt<lt.length;Pt++){const Nt=lt[Pt],Vt=Nt.geometry,Gt=Nt.text?Nt.text.toString():null;if(!Gt){St(Pt);continue}const Ht=qt(Gt,Vt),Lt=qt(Gt,Vt,!0);if(Ht in st&&Lt in tt&&st[Ht]!==tt[Lt]){const Qt=Ot(Ht,Lt,Vt),Te=Mt(Ht,Lt,dt[Qt].geometry);delete tt[Ht],delete st[Lt],st[qt(Gt,dt[Te].geometry,!0)]=Te,dt[Qt].geometry=null}else Ht in st?Mt(Ht,Lt,Vt):Lt in tt?Ot(Ht,Lt,Vt):(St(Pt),tt[Ht]=ht-1,st[Lt]=ht-1)}return dt.filter(Pt=>Pt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((lt,tt)=>lt.sortKey-tt.sortKey)}update(t,i,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,s,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=um(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const s=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:c,y:p}of i)this.lineVertexArray.emplaceBack(c,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,i,s,c,p,g,x,w,E,A,k,P,R,O){const V=t.indexArray,q=t.layoutVertexArray,et=t.globeExtVertexArray,lt=t.segments.prepareSegment(4*i.length,q,V,this.canOverlap?g.sortKey:void 0),tt=this.glyphOffsetArray.length,st=lt.vertexLength,dt=this.allowVerticalPlacement&&x===dr.vertical?Math.PI/2:0,ht=g.text&&g.text.sections;for(let Mt=0;Mt<i.length;Mt++){const{tl:Ot,tr:qt,bl:Pt,br:Nt,tex:Vt,pixelOffsetTL:Gt,pixelOffsetBR:Ht,minFontScaleX:Lt,minFontScaleY:Qt,glyphOffset:Te,isSDF:oe,sectionIndex:pe}=i[Mt],ne=lt.vertexLength,Me=Te[1];if(Wu(q,E.x,E.y,Ot.x,Me+Ot.y,Vt.x,Vt.y,s,oe,Gt.x,Gt.y,Lt,Qt),Wu(q,E.x,E.y,qt.x,Me+qt.y,Vt.x+Vt.w,Vt.y,s,oe,Ht.x,Gt.y,Lt,Qt),Wu(q,E.x,E.y,Pt.x,Me+Pt.y,Vt.x,Vt.y+Vt.h,s,oe,Gt.x,Ht.y,Lt,Qt),Wu(q,E.x,E.y,Nt.x,Me+Nt.y,Vt.x+Vt.w,Vt.y+Vt.h,s,oe,Ht.x,Ht.y,Lt,Qt),w){const{x:Ge,y:Be,z:De}=w.anchor,[we,ii,Se]=w.up;Hu(et,Ge,Be,De,we,ii,Se),Hu(et,Ge,Be,De,we,ii,Se),Hu(et,Ge,Be,De,we,ii,Se),Hu(et,Ge,Be,De,we,ii,Se),Xu(t.dynamicLayoutVertexArray,Ge,Be,De,dt)}else Xu(t.dynamicLayoutVertexArray,E.x,E.y,E.z,dt);V.emplaceBack(ne,ne+1,ne+2),V.emplaceBack(ne+1,ne+2,ne+3),lt.vertexLength+=4,lt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),Mt!==i.length-1&&pe===i[Mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},R,O,ht&&ht[pe])}const St=w?w.anchor:E;t.placedSymbolArray.emplaceBack(St.x,St.y,St.z,E.x,E.y,tt,this.glyphOffsetArray.length-tt,st,A,k,E.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],x,0,!1,0,P,0)}_commitLayoutVertex(t,i,s,c,p,g,x){t.emplaceBack(i,s,c,p,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,i,s,c,p,g,x){const w=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),E=w.vertexLength,A=x.tileAnchorX,k=x.tileAnchorY;for(let R=0;R<4;R++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),s.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(s.layoutVertexArray,c,p,g,A,k,new ie(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,p,g,A,k,new ie(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,p,g,A,k,new ie(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,p,g,A,k,new ie(t.x1,t.y2)),w.vertexLength+=4;const P=s.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,s,c,p,g){for(let x=c;x<p;x++){const w=s.get(x),E=this.getSymbolInstanceTextSize(t,g,i,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,s,c,p,g){for(let x=c;x<p;x++){const w=s.get(x),E=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new np(Li,Ff.members,cr),this.iconCollisionBox=new np(Li,Ff.members,cr);const s=Js(this.iconSizeData,t),c=Js(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(c,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(c,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,i,s,c){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=Lu(this.textSizeData,t,p)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,s){const c=this.icon.placedSymbolArray.get(s),p=Lu(this.iconSizeData,t,c);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,i,s){t.emplaceBack(i,-s,-s),t.emplaceBack(i,s,-s),t.emplaceBack(i,s,s),t.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(t,i,s,c,p,g){for(let x=c;x<p;x++){const w=s.get(x),E=this.getSymbolInstanceTextSize(t,g,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,i,s,c,p,g){for(let x=c;x<p;x++){const w=s.get(x),E=this.getSymbolInstanceIconSize(t,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Js(this.iconSizeData,t),c=Js(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(c,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(c,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,s,c,p,g,x,w,E){const A={};if(i<s){const{x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st,featureIndex:dt}=t.get(i);A.textBox={x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st},A.textFeatureIndex=dt}if(c<p){const{x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st,featureIndex:dt}=t.get(c);A.verticalTextBox={x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st},A.verticalTextFeatureIndex=dt}if(g<x){const{x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st,featureIndex:dt}=t.get(g);A.iconBox={x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st},A.iconFeatureIndex=dt}if(w<E){const{x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st,featureIndex:dt}=t.get(w);A.verticalIconBox={x1:k,y1:P,x2:R,y2:O,padding:V,projectedAnchorX:q,projectedAnchorY:et,projectedAnchorZ:lt,tileAnchorX:tt,tileAnchorY:st},A.verticalIconFeatureIndex=dt}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const s=t.placedSymbolArray.get(i),c=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<c;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(t),s=Math.cos(t),c=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const w=this.symbolInstances.get(x);c.push(0|Math.round(i*w.tileAnchorX+s*w.tileAnchorY)),p.push(w.featureIndex)}return g.sort((x,w)=>c[x]-c[w]||p[w]-p[x]),g}addToSortKeyRanges(t,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}le(ta,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ta.MAX_GLYPHS=65535,ta.addDynamicAttributes=Xu;const e_=new $t({"symbol-placement":new vt(zt.layout_symbol["symbol-placement"]),"symbol-spacing":new vt(zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vt(zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vt(zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vt(zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new vt(zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new vt(zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vt(zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(zt.layout_symbol["icon-size"]),"icon-text-fit":new vt(zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vt(zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(zt.layout_symbol["icon-image"]),"icon-rotate":new kt(zt.layout_symbol["icon-rotate"]),"icon-padding":new vt(zt.layout_symbol["icon-padding"]),"icon-keep-upright":new vt(zt.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(zt.layout_symbol["icon-offset"]),"icon-anchor":new kt(zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vt(zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vt(zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vt(zt.layout_symbol["text-rotation-alignment"]),"text-field":new kt(zt.layout_symbol["text-field"]),"text-font":new kt(zt.layout_symbol["text-font"]),"text-size":new kt(zt.layout_symbol["text-size"]),"text-max-width":new kt(zt.layout_symbol["text-max-width"]),"text-line-height":new kt(zt.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(zt.layout_symbol["text-letter-spacing"]),"text-justify":new kt(zt.layout_symbol["text-justify"]),"text-radial-offset":new kt(zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vt(zt.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(zt.layout_symbol["text-anchor"]),"text-max-angle":new vt(zt.layout_symbol["text-max-angle"]),"text-writing-mode":new vt(zt.layout_symbol["text-writing-mode"]),"text-rotate":new kt(zt.layout_symbol["text-rotate"]),"text-padding":new vt(zt.layout_symbol["text-padding"]),"text-keep-upright":new vt(zt.layout_symbol["text-keep-upright"]),"text-transform":new kt(zt.layout_symbol["text-transform"]),"text-offset":new kt(zt.layout_symbol["text-offset"]),"text-allow-overlap":new vt(zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new vt(zt.layout_symbol["text-ignore-placement"]),"text-optional":new vt(zt.layout_symbol["text-optional"])});var rp={paint:new $t({"icon-opacity":new kt(zt.paint_symbol["icon-opacity"]),"icon-color":new kt(zt.paint_symbol["icon-color"]),"icon-halo-color":new kt(zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(zt.paint_symbol["icon-halo-blur"]),"icon-translate":new vt(zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new vt(zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new kt(zt.paint_symbol["text-opacity"]),"text-color":new kt(zt.paint_symbol["text-color"],{runtimeType:sr,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new kt(zt.paint_symbol["text-halo-color"]),"text-halo-width":new kt(zt.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(zt.paint_symbol["text-halo-blur"]),"text-translate":new vt(zt.paint_symbol["text-translate"]),"text-translate-anchor":new vt(zt.paint_symbol["text-translate-anchor"])}),layout:e_};class dm{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Cs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}le(dm,"FormatSectionOverride",{omit:["defaultValue"]});class wh extends oo{constructor(t){super(t,rp)}recalculate(t,i){super.recalculate(t,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const p of s)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,s,c){const p=this.layout.get(t).evaluate(i,{},s,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Fs(g.value)||!p?p:(x=i.properties,p.replace(/{([^{}]+)}/g,(E,A)=>A in x?String(x[A]):""));var x}createBucket(t){return new ta(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of rp.paint.overridableProperties){if(!wh.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),s=new dm(i),c=new bl(s,i.property.specification);let p=null;p="constant"===i.value.kind||"source"===i.value.kind?new Ta("source",c):new Co("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new Zt(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&wh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const s=t.get("text-field"),c=rp.paint.properties[i];let p=!1;const g=x=>{for(const w of x)if(c.overrides&&c.overrides.hasOverride(w))return void(p=!0)};if("constant"===s.value.kind&&s.value.value instanceof bn)g(s.value.value.sections);else if("source"===s.value.kind){const x=E=>{p||(E instanceof Ho&&Ii(E.value)===ji?g(E.value.sections):E instanceof pa?g(E.sections):E.eachChild(x))},w=s.value;w._styleExpression&&x(w._styleExpression.expression)}return p}getProgramConfiguration(t){return new ro(this,t)}}var i_={paint:new $t({"background-color":new vt(zt.paint_background["background-color"]),"background-pattern":new vt(zt.paint_background["background-pattern"]),"background-opacity":new vt(zt.paint_background["background-opacity"])})},n_={paint:new $t({"raster-opacity":new vt(zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new vt(zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vt(zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vt(zt.paint_raster["raster-brightness-max"]),"raster-saturation":new vt(zt.paint_raster["raster-saturation"]),"raster-contrast":new vt(zt.paint_raster["raster-contrast"]),"raster-resampling":new vt(zt.paint_raster["raster-resampling"]),"raster-fade-duration":new vt(zt.paint_raster["raster-fade-duration"])})};class r_ extends oo{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var o_={paint:new $t({"sky-type":new vt(zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new vt(zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new vt(zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new vt(zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new vt(zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ut(zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new vt(zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new vt(zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new vt(zt.paint_sky["sky-opacity"])})};function op(e,t,i){const s=[0,0,1],c=Vp([]);return Gp(c,c,i?-Xe(e)+Math.PI:Xe(e)),jp(c,c,-Xe(t)),Fp(s,s,c),Ln(s,s)}const s_={circle:class extends oo{constructor(e){super(e,xu)}createBucket(e){return new Pd(e)}queryRadius(e){const t=e;return Fl("circle-radius",this,t)+Fl("circle-stroke-width",this,t)+yu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,s,c,p,g,x){const w=af(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,e.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return lf(e,s,p,g,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new ro(this,e)}},heatmap:class extends oo{createBucket(e){return new hf(e)}constructor(e){super(e,jm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ys({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Fl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,s,c,p,g,x){const w=this.paint.get("heatmap-radius").evaluate(t,i);return lf(e,s,p,g,x,!0,!0,new ie(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new ro(this,e)}},hillshade:class extends oo{constructor(e){super(e,bu)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends oo{constructor(e){super(e,Fd)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new ro(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Gl(e)}queryRadius(){return yu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,s,c,p){return!e.queryGeometry.isAboveHorizon&&tf(sf(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,e.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends oo{constructor(e){super(e,pg)}createBucket(e){return new hh(e)}queryRadius(){return yu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new ro(this,e)}queryIntersectsFeature(e,t,i,s,c,p,g,x,w){const E=af(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,e.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(t,i),k=this.paint.get("fill-extrusion-base").evaluate(t,i),P=[0,0],R=x&&p.elevation,O=p.elevation?p.elevation.exaggeration():1,V=e.tile.getBucket(this);if(R&&V instanceof hh){const st=V.centroidVertexArray,dt=w+1;dt<st.length&&(P[0]=st.geta_centroid_pos0(dt),P[1]=st.geta_centroid_pos1(dt))}if(0===P[0]&&1===P[1])return!1;"globe"===p.projection.name&&(s=kf([s],[new ie(0,0),new ie(Ce,Ce)],e.tileID.canonical).map(st=>st.polygon).flat());const q=R?x:null,[et,lt]=(dt=s,ht=k,St=A,Mt=E,Ot=g,qt=q,Pt=P,Nt=O,Vt=p.center.lat,"globe"===(st=p).projection.name?function(Ht,Lt,Qt,Te,oe,pe,ne,Me,Ge,Be,De){const we=[],ii=[],Se=Ht.projection.upVectorScale(De,Ht.center.lat,Ht.worldSize).metersToTile,Fe=[0,0,0,1],hi=[0,0,0,1],Mi=(ui,Si,Ai,an)=>{ui[0]=Si,ui[1]=Ai,ui[2]=an,ui[3]=1},li=If();Qt>0&&(Qt+=li),Te+=li;for(const ui of Lt){const Si=[],Ai=[];for(const an of ui){const di=an.x+oe.x,Pi=an.y+oe.y,qi=Ht.projection.projectTilePoint(di,Pi,De),$e=Ht.projection.upVector(De,an.x,an.y);let a=Qt,r=Te;if(ne){const o=Lf(di,Pi,Qt,Te,ne,Me,Ge,Be);a+=o.base,r+=o.top}0!==Qt?Mi(Fe,qi.x+$e[0]*Se*a,qi.y+$e[1]*Se*a,qi.z+$e[2]*Se*a):Mi(Fe,qi.x,qi.y,qi.z),Mi(hi,qi.x+$e[0]*Se*r,qi.y+$e[1]*Se*r,qi.z+$e[2]*Se*r),Ri(Fe,Fe,pe),Ri(hi,hi,pe),Si.push(new ho(Fe[0],Fe[1],Fe[2])),Ai.push(new ho(hi[0],hi[1],hi[2]))}we.push(Si),ii.push(Ai)}return[we,ii]}(st,dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt,e.tileID.canonical):qt?function(Ht,Lt,Qt,Te,oe,pe,ne,Me,Ge){const Be=[],De=[],we=[0,0,0,1];for(const ii of Ht){const Se=[],Fe=[];for(const hi of ii){const Mi=hi.x+Te.x,li=hi.y+Te.y,ui=Lf(Mi,li,Lt,Qt,pe,ne,Me,Ge);we[0]=Mi,we[1]=li,we[2]=ui.base,we[3]=1,ja(we,we,oe),we[3]=Math.max(we[3],1e-5);const Si=new ho(we[0]/we[3],we[1]/we[3],we[2]/we[3]);we[0]=Mi,we[1]=li,we[2]=ui.top,we[3]=1,ja(we,we,oe),we[3]=Math.max(we[3],1e-5);const Ai=new ho(we[0]/we[3],we[1]/we[3],we[2]/we[3]);Se.push(Si),Fe.push(Ai)}Be.push(Se),De.push(Fe)}return[Be,De]}(dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt):function(Ht,Lt,Qt,Te,oe){const pe=[],ne=[],Me=oe[8]*Lt,Ge=oe[9]*Lt,Be=oe[10]*Lt,De=oe[11]*Lt,we=oe[8]*Qt,ii=oe[9]*Qt,Se=oe[10]*Qt,Fe=oe[11]*Qt;for(const hi of Ht){const Mi=[],li=[];for(const ui of hi){const Si=ui.x+Te.x,Ai=ui.y+Te.y,an=oe[0]*Si+oe[4]*Ai+oe[12],di=oe[1]*Si+oe[5]*Ai+oe[13],Pi=oe[2]*Si+oe[6]*Ai+oe[14],qi=oe[3]*Si+oe[7]*Ai+oe[15],$e=an+Me,a=di+Ge,r=Pi+Be,o=Math.max(qi+De,1e-5),u=an+we,m=di+ii,_=Pi+Se,b=Math.max(qi+Fe,1e-5);Mi.push(new ho($e/o,a/o,r/o)),li.push(new ho(u/b,m/b,_/b))}pe.push(Mi),ne.push(li)}return[pe,ne]}(dt,ht,St,Mt,Ot)),tt=e.queryGeometry;var st,dt,ht,St,Mt,Ot,qt,Pt,Nt,Vt;return function(st,dt,ht){let St=1/0;tf(ht,dt)&&(St=Df(ht,dt[0]));for(let Mt=0;Mt<dt.length;Mt++){const Ot=dt[Mt],qt=st[Mt];for(let Pt=0;Pt<Ot.length-1;Pt++){const Nt=Ot[Pt],Vt=[Nt,Ot[Pt+1],qt[Pt+1],qt[Pt],Nt];Kp(ht,Vt)&&(St=Math.min(St,Df(ht,Vt)))}}return St!==1/0&&St}(et,lt,tt.isPointQuery()?tt.screenBounds:tt.screenGeometry)}},line:class extends oo{constructor(e){super(e,Rf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof dc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Bf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Du(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new ro(this,e)}queryRadius(e){const t=e,i=Of(Fl("line-width",this,t),Fl("line-gap-width",this,t)),s=Fl("line-offset",this,t);return i/2+Math.abs(s)+yu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,s,c,p){if(e.queryGeometry.isAboveHorizon)return!1;const g=sf(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,e.pixelToTileUnitsFactor),x=e.pixelToTileUnitsFactor/2*Of(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),w=this.paint.get("line-offset").evaluate(t,i);return w&&(s=function(E,A){const k=[],P=new ie(0,0);for(let R=0;R<E.length;R++){const O=E[R],V=[];for(let q=0;q<O.length;q++){const lt=O[q],tt=O[q+1],st=0===q?P:lt.sub(O[q-1])._unit()._perp(),dt=q===O.length-1?P:tt.sub(lt)._unit()._perp(),ht=st._add(dt)._unit();ht._mult(1/(ht.x*dt.x+ht.y*dt.y)),V.push(ht._mult(A)._add(lt))}k.push(V)}return k}(s,w*e.pixelToTileUnitsFactor)),function(E,A,k){for(let P=0;P<A.length;P++){const R=A[P];if(E.length>=3)for(let O=0;O<R.length;O++)if(qa(E,R[O]))return!0;if(ef(E,R,k))return!0}return!1}(g,s,x)}isTileClipped(){return!0}},symbol:wh,background:class extends oo{constructor(e){super(e,i_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends oo{constructor(e){super(e,n_)}getProgramIds(){return["raster"]}},sky:class extends oo{constructor(e){super(e,o_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ys({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),c=!s,p=e.style.light,g=p.properties.get("position");return c&&"viewport"===p.properties.get("anchor")&&Oi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?op(g.azimuthal,90-g.polar,t):op(s[0],90-s[1],t)}const i=this.paint.get("sky-gradient-center");return op(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class Th{constructor(t,i,s,c){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(i,c)}update(t,i,s){const{width:c,height:p}=t,{context:g}=this,{gl:x}=g,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:k,ImageBitmap:P}=Xt;if(x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===c&&this.size[1]===p){const{x:R,y:O}=s||{x:0,y:0};t instanceof w||t instanceof E||t instanceof A||t instanceof k||P&&t instanceof P?x.texSubImage2D(x.TEXTURE_2D,0,R,O,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,R,O,c,p,x.RGBA,x.UNSIGNED_BYTE,t.data)}else this.size=[c,p],t instanceof w||t instanceof E||t instanceof A||t instanceof k||P&&t instanceof P?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,c,p,0,this.format,x.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(t,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class a_{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class l_{constructor(){this.tasks={},this.taskQueue=[],Nr(["process"],this),this.invoker=new a_(this.process),this.nextId=0}add(t,i){const s=this.nextId++,c=function({type:p,isSymbolTile:g,zoom:x}){return x=x||0,"message"===p?0:"maybePrepare"!==p||g?"parseTile"!==p||g?"parseTile"===p&&g?300-x:"maybePrepare"===p&&g?400-x:500:200-x:100-x}(i);if(0===c){nr();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:i,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){nr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const p=this.tasks[this.taskQueue[c]];p.priority<i&&(i=p.priority,t=c)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class pm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const s=t[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const c_=["tile","layer","source","sourceLayer","state"];class sp{constructor(t,i,s,c,p){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=s,this._y=c,this.properties=t.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const i of c_)void 0!==this[i]&&(t[i]=this[i]);return t}}const ea=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,s=0,c=0,p=0,g=0,x=0;for(1&t?c=p=g=32:i=s=x=32;(t>>=1)>1;){const E=i+c>>1,A=s+p>>1;1&t?(c=i,p=s,i=g,s=x):(i=c,s=p,c=g,p=x),g=E,x=A}const w=4*e;ea[w+0]=i,ea[w+1]=s,ea[w+2]=c,ea[w+3]=p}const Lo=new Uint16Array(2178),gs=new Uint8Array(1089),Yu=new Uint16Array(1089);function fm(e){return 0===e?-.03125:32===e?.03125:0}var ap=ge([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const mm={type:2,extent:Ce,loadGeometry:()=>[[new ie(0,0),new ie(8193,0),new ie(8193,8193),new ie(0,8193),new ie(0,0)]]};class lp{constructor(t,i,s,c,p){this.tileID=t,this.uid=bs(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<ti.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ha(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,p){const g={};if(!p)return g;for(const x of c){const w=x.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)g[E.id]=x}}return g}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof ta){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof ta&&p.hasRTLText){this.hasRTLText=!0,ft.isLoading()||ft.isLoaded()||"deferred"!==pt()||ut();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new sd}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Th(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Th(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Th(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,s,c,p,g,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:x,transform:g,params:p,tileTransform:this.tileTransform},t,i,s):{}}querySourceFeatures(t,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),p=i?i.sourceLayer:"",g=c._geojsonTileLayer||c[p];if(!g)return;const x=Tl(i&&i.filter),{z:w,x:E,y:A}=this.tileID.canonical,k={z:w,x:E,y:A};for(let P=0;P<g.length;P++){const R=g.feature(P);if(x.needGeometry){const q=Za(R,!0);if(!x.filter(new wt(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!x.filter(new wt(this.tileID.overscaledZ),R))continue;const O=s.getId(R,p),V=new sp(R,w,E,A,O);V.tile=k,t.push(V)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const s=rr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const p=this.expirationTime-i;p?this.expirationTime=s+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",w=s[x],E=t[x];if(!w||!E||0===Object.keys(E).length)continue;if(g.update(E,w,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Du||g instanceof Gl){const k=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&k&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(k.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(p);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ti.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ti.now()+t}setTexture(t,i){const s=i.context,c=s.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Th(s,t,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(t,i){const s={};for(const c of i)s[c]=!0;this.dependencies[t]=s}hasDependency(t,i){for(const s of t){const c=this.dependencies[s];if(c)for(const p of i)if(c[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=Ji(mm,this.tileID.canonical,this.tileTransform)[0],c=new be,p=new to;for(let g=0;g<s.length;g++){const{x,y:w}=s[g];c.emplaceBack(x,w),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(c,Jc.members),this._tileDebugSegments=$i.simpleSegment(0,0,c.length,p.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=Ji(mm,this.tileID.canonical,this.tileTransform)[0];let c,p;if(this.isRaster){const g=function(x,w){const E=Ha(x,w),A=Math.pow(2,x.z);for(let q=0;q<33;q++)for(let et=0;et<33;et++){const lt=Qn((x.x+(et+fm(et))/32)/A),tt=gn((x.y+(q+fm(q))/32)/A),st=w.project(lt,tt),dt=33*q+et;Lo[2*dt+0]=Math.round((st.x*E.scale-E.x)*Ce),Lo[2*dt+1]=Math.round((st.y*E.scale-E.y)*Ce)}gs.fill(0),Yu.fill(0);for(let q=2045;q>=0;q--){const et=4*q,lt=ea[et+0],tt=ea[et+1],st=ea[et+2],dt=ea[et+3],ht=lt+st>>1,St=tt+dt>>1,Mt=ht+St-tt,Ot=St+lt-ht,qt=33*tt+lt,Pt=33*dt+st,Nt=33*St+ht,Vt=Math.hypot((Lo[2*qt+0]+Lo[2*Pt+0])/2-Lo[2*Nt+0],(Lo[2*qt+1]+Lo[2*Pt+1])/2-Lo[2*Nt+1])>=16;gs[Nt]=gs[Nt]||(Vt?1:0),q<1022&&(gs[Nt]=gs[Nt]||gs[33*(tt+Ot>>1)+(lt+Mt>>1)]||gs[33*(dt+Ot>>1)+(st+Mt>>1)])}const k=new oi,P=new mn;let R=0;function O(q,et){const lt=33*et+q;return 0===Yu[lt]&&(k.emplaceBack(Lo[2*lt+0],Lo[2*lt+1],q*Ce/32,et*Ce/32),Yu[lt]=++R),Yu[lt]-1}function V(q,et,lt,tt,st,dt){const ht=q+lt>>1,St=et+tt>>1;if(Math.abs(q-st)+Math.abs(et-dt)>1&&gs[33*St+ht])V(st,dt,q,et,ht,St),V(lt,tt,st,dt,ht,St);else{const Mt=O(q,et),Ot=O(lt,tt),qt=O(st,dt);P.emplaceBack(Mt,Ot,qt)}}return V(0,0,32,32,32,0),V(32,32,0,0,0,32),{vertices:k,indices:P}}(this.tileID.canonical,i);c=g.vertices,p=g.indices}else{c=new oi,p=new mn;for(const{x,y:w}of s)c.emplaceBack(x,w,0,0);const g=Ul(c.int16,void 0,4);for(let x=0;x<g.length;x+=3)p.emplaceBack(g[x],g[x+1],g[x+2])}this._tileBoundsBuffer=t.createVertexBuffer(c,ap.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=$i.simpleSegment(0,0,c.length,p.length)}_makeGlobeTileDebugBuffers(t,i){const s=i.projection;if(!s||"globe"!==s.name||i.freezeTileCoverage)return;const c=this.tileID.canonical,p=eh(Cd(c,i)),g=Dl(i.zoom);let x;g>0&&(x=md(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,c,i,p,x,g),this._makeGlobeTileDebugTextBuffer(t,c,i,p,x,g)}_globePoint(t,i,s,c,p,g,x){let w=th(t,i,s);if(g){const E=1<<s.z,A=Lr(c.center.lng),k=Rr(c.center.lat),P=(s.x+.5)/E-A;let R=0;P>.5?R=-1:P<-.5&&(R=1);let O=(t/Ce+s.x)/E+R,V=(i/Ce+s.y)/E;O=(O-A)*c._pixelsPerMercatorPixel+A,V=(V-k)*c._pixelsPerMercatorPixel+k;const q=[O*c.worldSize,V*c.worldSize,0];Ri(q,q,g),w=zo(w,q,x)}return Ri(w,w,p)}_makeGlobeTileDebugBorderBuffer(t,i,s,c,p,g){const x=new be,w=new to,E=new ri,A=(P,R,O,V,q)=>{const et=(O-P)/(q-1),lt=(V-R)/(q-1),tt=x.length;for(let st=0;st<q;st++){const dt=P+st*et,ht=R+st*lt;x.emplaceBack(dt,ht);const St=this._globePoint(dt,ht,i,s,c,p,g);E.emplaceBack(St[0],St[1],St[2]),w.emplaceBack(tt+st)}},k=Ce;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(x,Jc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,cu.members),this._tileDebugSegments=$i.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(t,i,s,c,p,g){const x=new be,w=new mn,E=new ri,A=25;w.reserve(32),x.reserve(A),E.reserve(A);const k=(P,R)=>A*P+R;for(let P=0;P<A;P++){const R=2048*P;for(let O=0;O<A;O++){const V=2048*O;x.emplaceBack(V,R);const q=this._globePoint(V,R,i,s,c,p,g);E.emplaceBack(q[0],q[1],q[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){const O=k(P,R),V=k(P,R+1),q=k(P+1,R),et=k(P+1,R+1);w.emplaceBack(O,V,q),w.emplaceBack(q,V,et)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(w),this._tileDebugTextBuffer=t.createVertexBuffer(x,Jc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(E,cu.members),this._tileDebugTextSegments=$i.simpleSegment(0,0,A,32)}}class gm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,s){const c=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},Hi(this.stateChanges[t][c],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const p in this.state[t])p!==c&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][c]){this.deletedStates[t][c]={};for(const p in this.state[t][c])s[p]||(this.deletedStates[t][c][p]=null)}else for(const p in s)this.deletedStates[t]&&this.deletedStates[t][c]&&null===this.deletedStates[t][c][p]&&delete this.deletedStates[t][c][p]}removeFeatureState(t,i,s){if(null===this.deletedStates[t])return;const c=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==i)null!==this.deletedStates[t][c]&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][s]=null);else if(void 0!==i)if(this.stateChanges[t]&&this.stateChanges[t][c])for(s in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][s]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,i){const s=String(i),c=Hi({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const p=this.deletedStates[t][i];if(null===p)return{};for(const g in p)delete c[g]}return c}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),Hi(this.state[c][g],this.stateChanges[c][g]),p[g]=this.state[c][g];s[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(null===this.deletedStates[c])for(const g in this.state[c])p[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(null===this.deletedStates[c][g])this.state[c][g]={};else if(this.state[c][g])for(const x of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][x];p[g]=this.state[c][g]}s[c]=s[c]||{},Hi(s[c],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const c in t)t[c].setFeatureState(s,i)}}class _m{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const s=this.toIdx(t,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function ym(e,t,i,s){let c=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(i[g]<e[g]||i[g]>t[g])return null}else{const x=1/s[g];let w=(e[g]-i[g])*x,E=(t[g]-i[g])*x;if(w>E){const A=w;w=E,E=A}if(w>c&&(c=w),E<p&&(p=E),c>p)return null}return c}function xm(e,t,i,s,c,p,g,x,w,E,A){const k=s-e,P=c-t,R=p-i,O=g-e,V=x-t,q=w-i,et=A[1]*q-A[2]*V,lt=A[2]*O-A[0]*q,tt=A[0]*V-A[1]*O,st=k*et+P*lt+R*tt;if(Math.abs(st)<1e-15)return null;const dt=1/st,ht=E[0]-e,St=E[1]-t,Mt=E[2]-i,Ot=(ht*et+St*lt+Mt*tt)*dt;if(Ot<0||Ot>1)return null;const qt=St*R-Mt*P,Pt=Mt*k-ht*R,Nt=ht*P-St*k,Vt=(A[0]*qt+A[1]*Pt+A[2]*Nt)*dt;return Vt<0||Ot+Vt>1?null:(O*qt+V*Pt+q*Nt)*dt}function vm(e,t,i){return(e-t)/(i-t)}function bm(e,t,i,s,c,p,g,x,w){const E=1<<i,A=p-s,k=g-c,P=(e+1)/E*A+s,R=(t+0)/E*k+c,O=(t+1)/E*k+c;x[0]=(e+0)/E*A+s,x[1]=R,w[0]=P,w[1]=O}class wm{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),x=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,A=(R,O,V,q,et)=>{const lt=q?1:0,tt=(R+1)*V-lt,st=O*V,dt=(O+1)*V-lt;et[0]=R*V,et[1]=st,et[2]=tt,et[3]=dt};let k=new _m(w);const P=[];for(let R=0;R<w*w;R++){A(R%w,Math.floor(R/w),E,!1,P);const O=ia(P[0],P[1],p),V=ia(P[2],P[1],p),q=ia(P[2],P[3],p),et=ia(P[0],P[3],p);k.minimums.push(Math.min(O,V,q,et)),k.maximums.push(Math.max(O,V,q,et)),k.leaves.push(1)}for(x.push(k),w/=2;w>=1;w/=2){const R=x[x.length-1];k=new _m(w);for(let O=0;O<w*w;O++){A(O%w,Math.floor(O/w),2,!0,P);const V=R.getElevation(P[0],P[1]),q=R.getElevation(P[2],P[1]),et=R.getElevation(P[2],P[3]),lt=R.getElevation(P[0],P[3]),tt=R.isLeaf(P[0],P[1]),st=R.isLeaf(P[2],P[1]),dt=R.isLeaf(P[2],P[3]),ht=R.isLeaf(P[0],P[3]),St=Math.min(V.min,q.min,et.min,lt.min),Mt=Math.max(V.max,q.max,et.max,lt.max),Ot=tt&&st&&dt&&ht;k.maximums.push(Mt),k.minimums.push(St),k.leaves.push(Mt-St<=5&&Ot?1:0)}x.push(k)}return x}(this.dem),s=i.length-1,c=i[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(t,i,s,c,p,g,x=1){return ym([t,i,-100],[s,c,this.maximums[0]*x],p,g)}raycast(t,i,s,c,p,g,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,i,s,c,p,g,x);if(null==w)return null;const E=[],A=[],k=[],P=[],R=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:O,t:V,nodex:q,nodey:et,depth:lt}=R.pop();if(this.leaves[O]){bm(q,et,lt,t,i,s,c,k,P);const st=1<<lt,dt=(q+0)/st,ht=(q+1)/st,St=(et+0)/st,Mt=(et+1)/st,Ot=ia(dt,St,this.dem)*x,qt=ia(ht,St,this.dem)*x,Pt=ia(ht,Mt,this.dem)*x,Nt=ia(dt,Mt,this.dem)*x,Vt=xm(k[0],k[1],Ot,P[0],k[1],qt,P[0],P[1],Pt,p,g),Gt=xm(P[0],P[1],Pt,k[0],P[1],Nt,k[0],k[1],Ot,p,g),Ht=Math.min(null!==Vt?Vt:Number.MAX_VALUE,null!==Gt?Gt:Number.MAX_VALUE);if(Ht!==Number.MAX_VALUE)return Ht;{const Lt=Yc([],p,g,V);if(Tm(Ot,qt,Nt,Pt,vm(Lt[0],k[0],P[0]),vm(Lt[1],k[1],P[1]))>=Lt[2])return V}continue}let tt=0;for(let st=0;st<this._siblingOffset.length;st++){bm((q<<1)+this._siblingOffset[st][0],(et<<1)+this._siblingOffset[st][1],lt+1,t,i,s,c,k,P),k[2]=-100,P[2]=this.maximums[this.childOffsets[O]+st]*x;const dt=ym(k,P,p,g);if(null!=dt){const ht=dt;E[st]=ht;let St=!1;for(let Mt=0;Mt<tt&&!St;Mt++)ht>=E[A[Mt]]&&(A.splice(Mt,0,st),St=!0);St||(A[tt]=st),tt++}}for(let st=0;st<tt;st++){const dt=A[st];R.push({idx:this.childOffsets[O]+dt,t:E[dt],nodex:(q<<1)+this._siblingOffset[dt][0],nodey:(et<<1)+this._siblingOffset[dt][1],depth:lt+1})}}return null}_addNode(t,i,s){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,s,c,p){if(1===t[c].isLeaf(i,s))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=c-1,x=t[g];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*i+this._siblingOffset[A][0],P=2*s+this._siblingOffset[A][1],R=x.getElevation(k,P),O=x.isLeaf(k,P),V=this._addNode(R.min,R.max,O);O&&(w|=1<<A),E||(E=V)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(t,2*i+this._siblingOffset[A][0],2*s+this._siblingOffset[A][1],g,E+A)}}function Tm(e,t,i,s,c,p){return He(He(e,i,p),He(t,s,p),c)}function ia(e,t,i){const s=i.dim,c=Ue(e*s-.5,0,s-1),p=Ue(t*s-.5,0,s-1),g=Math.floor(c),x=Math.floor(p),w=Math.min(g+1,s-1),E=Math.min(x+1,s-1);return Tm(i.get(g,x),i.get(w,x),i.get(g,E),i.get(w,E),c-g,p-x)}const Em={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ju{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,s,c=!1,p=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Oi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let w=0;w<g;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(g,w)]=x[this._idx(g-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,g)]=x[this._idx(w,g-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(g,-1)]=x[this._idx(g-1,0)],x[this._idx(-1,g)]=x[this._idx(0,g-1)],x[this._idx(g,g)]=x[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new wm(this)}get(t,i,s=!1){s&&(t=Ue(t,-1,this.dim),i=Ue(i,-1,this.dim));const c=4*this._idx(t,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(t){return Em[t]}get unpackVector(){return Em[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}_unpackMapbox(t,i,s){return(256*t*256+256*i+s)/10-1e4}_unpackTerrarium(t,i,s){return 256*t+i+s/256-32768}static pack(t,i){const s=[0,0,0,0],c=Ju.getUnpackVector(i);let p=Math.floor((t+c[3])/c[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new tr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,p=i*this.dim+this.dim,g=s*this.dim,x=s*this.dim+this.dim;switch(i){case-1:c=p-1;break;case 1:p=c+1}switch(s){case-1:g=x-1;break;case 1:x=g+1}const w=-i*this.dim,E=-s*this.dim;for(let A=g;A<x;A++)for(let k=c;k<p;k++){const P=4*this._idx(k,A),R=4*this._idx(k+w,A+E);this.pixels[P+0]=t.pixels[R+0],this.pixels[P+1]=t.pixels[R+1],this.pixels[P+2]=t.pixels[R+2],this.pixels[P+3]=t.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}le(Ju,"DEMData"),le(wm,"DemMinMaxQuadTree",{omit:["dem"]});class f_{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,s){const c=t.wrapped().key;void 0===this.data[c]&&(this.data[c]=[]);const p={value:i,timeout:void 0};if(void 0!==s&&(p.timeout=setTimeout(()=>{this.remove(t,p)},s)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const s=t.wrapped().key,c=void 0===i?0:this.data[s].indexOf(i),p=this.data[s][c];return this.data[s].splice(c,1),p.timeout&&clearTimeout(p.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const s in this.data)for(const c of this.data[s])t(c.value)||i.push(c);for(const s of i)this.remove(s.value.tileID,s)}}class nc{constructor(t,i,s){this.func=t,this.mask=i,this.range=s}}nc.ReadOnly=!1,nc.ReadWrite=!0,nc.disabled=new nc(519,nc.ReadOnly,[0,1]);class hp{constructor(t,i,s,c,p,g){this.test=t,this.ref=i,this.mask=s,this.fail=c,this.depthFail=p,this.pass=g}}hp.disabled=new hp({func:519,mask:0},0,0,7680,7680,7680);class Ro{constructor(t,i,s){this.blendFunction=t,this.blendColor=i,this.mask=s}}Ro.Replace=[1,0],Ro.disabled=new Ro(Ro.Replace,Fi.transparent,[!1,!1,!1,!1]),Ro.unblended=new Ro(Ro.Replace,Fi.transparent,[!0,!0,!0,!0]),Ro.alphaBlended=new Ro([1,771],Fi.transparent,[!0,!0,!0,!0]);class uo{constructor(t,i,s){this.enable=t,this.mode=i,this.frontFace=s}}uo.disabled=new uo(!1,1029,2305),uo.backCCW=new uo(!0,1029,2305),uo.backCW=new uo(!0,1029,2304),uo.frontCW=new uo(!0,1028,2304),uo.frontCCW=new uo(!0,1028,2305);class rc extends Vn{constructor(t,i,s){super(),this.id=t,this._onlySymbols=s,i.on("data",c=>{"source"===c.dataType&&"metadata"===c.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===c.dataType&&"content"===c.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new f_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new gm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(t),s.prepare(this.map.style.imageManager)}}getIds(){return go(this._tiles).map(t=>t.tileID).sort(Mm).map(t=>t.key)}getRenderableIds(t){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,t)&&i.push(this._tiles[s]);return t?i.sort((s,c)=>{const p=s.tileID,g=c.tileID,x=new ie(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new ie(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||w.y-x.y||w.x-x.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(Mm).map(s=>s.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,t,i)))}_tileLoaded(t,i,s,c){if(c)if(t.state="errored",404!==c.status)this._source.fire(new Xi(c,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=ti.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new fi("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const p=i[c];if(t.neighboringTiles&&t.neighboringTiles[p]){const g=this.getTileByID(p);s(t,g),s(g,t)}}function s(c,p){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-c.tileID.canonical.x;const x=p.tileID.canonical.y-c.tileID.canonical.y,w=Math.pow(2,c.tileID.canonical.z),E=p.tileID.key;0===g&&0===x||Math.abs(x)>1||(Math.abs(g)>1&&(1===Math.abs(g+w)?g+=w:1===Math.abs(g-w)&&(g-=w)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,g,x),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,s,c){for(const p in this._tiles){let g=this._tiles[p];if(c[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>s)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){c[x.key]=x;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=t.overscaledZ-1;s>=i;s--){const c=t.scaledTo(s),p=this._getLoadedTile(c);if(p)return p}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const s=Math.ceil(t.width/i)+1,c=Math.ceil(t.height/i)+1,p=Math.floor(s*c*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(t){const i=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,i){const s={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),s[p.tileID.key]=p}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(t,i,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Bn(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(c=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(x=>this._source.hasTile(x)))):c=[];const p=this._updateRetainedTiles(c);if(pp(this._source.type)&&0!==c.length){const x={},w={},E=Object.keys(p);for(const k of E){const P=p[k],R=this._tiles[k];if(!R||R.fadeEndTime&&R.fadeEndTime<=ti.now())continue;const O=this.findLoadedParent(P,Math.max(P.overscaledZ-rc.maxOverzooming,this._source.minzoom));O&&(this._addTile(O.tileID),x[O.tileID.key]=O.tileID),w[k]=P}const A=c[c.length-1].overscaledZ;for(const k in this._tiles){const P=this._tiles[k];if(p[k]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>A;){R=R.scaledTo(R.overscaledZ-1);const O=this._tiles[R.key];if(O&&O.hasData()&&w[R.key]){p[k]=P.tileID;break}}}for(const k in x)p[k]||(this._coveredTiles[k]=!0,p[k]=x[k])}for(const x in p)this._tiles[x].clearFadeHold();const g=function(x,w){const E=[];for(const A in x)A in w||E.push(A);return E}(this._tiles,p);for(const x of g){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(0===t.length)return i;const s={},c=t.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),p=t[0].overscaledZ,g=Math.max(p-rc.maxOverzooming,this._source.minzoom),x=Math.max(p+rc.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const A=this._addTile(E);i[E.key]=E,A.hasData()||c<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,c,x,i);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const P=E.children(this._source.maxzoom)[0],R=this.getTile(P);if(R&&R.hasData()){i[P.key]=P;continue}}else{const P=E.children(this._source.maxzoom);if(i[P[0].key]&&i[P[1].key]&&i[P[2].key]&&i[P[3].key])continue}let k=A.wasRequested();for(let P=E.overscaledZ-1;P>=g;--P){const R=E.scaledTo(P);if(s[R.key]||(s[R.key]=!0,A=this.getTile(R),!A&&k&&(A=this._addTile(R)),A&&(i[R.key]=R,k=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let s,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}i.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;c=p}for(const p of i)this._loadedParentTiles[p]=s}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const s=Boolean(i);if(!s){const c=this.map?this.map.painter:null;i=new lp(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,s||this._source.fire(new fi("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=i.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,s){const c=[],p=this.transform;if(!p)return c;const g="globe"===p.projection.name,x=Lr(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(s&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(g){const k=E.tileID.canonical;if(0===k.z){const P=[Math.abs(Ue(x,...Eh(k,-1))-x),Math.abs(Ue(x,...Eh(k,1))-x)];A=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(Ue(x,...Eh(k,-1))-x),Math.abs(Ue(x,...Eh(k,0))-x),Math.abs(Ue(x,...Eh(k,1))-x)];A=[P.indexOf(Math.min(...P))-1]}}else A=[0];for(const k of A){const P=t.containsTile(E,p,i,k);P&&c.push(P)}}return c}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(pp(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=ti.now())return!0}return!1}setFeatureState(t,i,s){this._state.updateState(t=t||"_geojsonTileLayer",i,s)}removeFeatureState(t,i,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,s)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,s){const c=this._tiles[t];c&&c.setDependencies(i,s)}reloadTilesForDependencies(t,i){for(const s in this._tiles)this._tiles[s].hasDependency(t,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,i))}_preloadTiles(t,i){const s=new Map,c=Array.isArray(t)?t:[t],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const x of c){const w=x.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)s.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}mo(Array.from(s.values()),(x,w)=>{const E=new lp(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),w(A,E)})},i)}}function Mm(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||s-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function pp(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Eh(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}rc.maxOverzooming=10,rc.maxUnderzooming=3;class Ku{constructor(t,i,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(t,i,s){const c=s||t.findDEMTileFor(i);if(!c||!c.dem)return;const p=c.dem,g=c.tileID,x=1<<i.canonical.z-g.canonical.z;return new Ku(c,c.tileSize/Ce/x,[(i.canonical.x/x-g.canonical.x)*p.dim,(i.canonical.y/x-g.canonical.y)*p.dim])}tileCoordToPixel(t,i){const s=i*this._scale+this._offset[1],c=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(s);return new ie(c,p)}getElevationAt(t,i,s,c){const p=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(p),w=Math.floor(g),E=this._dem;return c=!!c,s?He(He(E.get(x,w,c),E.get(x,w+1,c),g-w),He(E.get(x+1,w,c),E.get(x+1,w+1,c),g-w),p-x):E.get(x,w,c)}getElevationAtPixel(t,i,s){return this._dem.get(t,i,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*lo(1,t)*this._dem.stride}}class Mh{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new rs(Ce,16,0),this.featureIndexArray=new Tp,this.promoteId=i}insert(t,i,s,c,p,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,p,g);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],k=[1/0,1/0,-1/0,-1/0];for(let P=0;P<A.length;P++){const R=A[P];k[0]=Math.min(k[0],R.x),k[1]=Math.min(k[1],R.y),k[2]=Math.max(k[2],R.x),k[3]=Math.max(k[3],R.y)}k[0]<Ce&&k[1]<Ce&&k[2]>=0&&k[3]>=0&&w.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ud(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new pm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,s,c){this.loadVTLayers();const p=t.params||{},g=Tl(p.filter),x=t.tileResult,w=t.transform,E=x.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(O,V,q,et)=>of(x.bufferedTilespaceGeometry,O,V,q,et));A.sort(h_);let k=null;w.elevation&&A.length>0&&(k=Ku.create(w.elevation,this.tileID));const P={};let R;for(let O=0;O<A.length;O++){const V=A[O];if(V===R)continue;R=V;const q=this.featureIndexArray.get(V);let et=null;this.loadMatchingFeature(P,q,g,p.layers,p.availableImages,i,s,c,(lt,tt,st,dt=0)=>(et||(et=Ji(lt,this.tileID.canonical,t.tileTransform)),tt.queryIntersectsFeature(x,lt,st,et,this.z,t.transform,t.pixelPosMatrix,k,dt)))}return P}loadMatchingFeature(t,i,s,c,p,g,x,w,E){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:P,layoutVertexArrayOffset:R}=i,O=this.bucketLayerIDs[k];if(c&&!function(lt,tt){for(let st=0;st<lt.length;st++)if(tt.indexOf(lt[st])>=0)return!0;return!1}(c,O))return;const V=this.sourceLayerCoder.decode(P),q=this.vtLayers[V].feature(A);if(s.needGeometry){const lt=Za(q,!0);if(!s.filter(new wt(this.tileID.overscaledZ),lt,this.tileID.canonical))return}else if(!s.filter(new wt(this.tileID.overscaledZ),q))return;const et=this.getId(q,V);for(let lt=0;lt<O.length;lt++){const tt=O[lt];if(c&&c.indexOf(tt)<0)continue;const st=g[tt];if(!st)continue;let dt={};void 0!==et&&w&&(dt=w.getState(st.sourceLayer||"_geojsonTileLayer",et));const ht=Hi({},x[tt]);ht.paint=Cm(ht.paint,st.paint,q,dt,p),ht.layout=Cm(ht.layout,st.layout,q,dt,p);const St=!E||E(q,st,dt,R);if(!St)continue;const Mt=new sp(q,this.z,this.x,this.y,et);Mt.layer=ht;let Ot=t[tt];void 0===Ot&&(Ot=t[tt]=[]),Ot.push({featureIndex:A,feature:Mt,intersectionZ:St})}}lookupSymbolFeatures(t,i,s,c,p,g,x,w){const E={};this.loadVTLayers();const A=Tl(p);for(const k of t)this.loadMatchingFeature(E,{bucketIndex:s,sourceLayerIndex:c,featureIndex:k,layoutVertexArrayOffset:0},A,g,x,w,i);return E}loadFeature(t){const{featureIndex:i,sourceLayerIndex:s}=t;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),p=this.vtFeatures[c];if(p[i])return p[i];const g=this.vtLayers[c].feature(i);return p[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const s of i)if(t===s)return!0;return!1}getId(t,i){let s=t.id;if(this.promoteId){const c="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=c&&(s=t.properties[c]),"boolean"==typeof s&&(s=Number(s))}return s}}function Cm(e,t,i,s,c){return qn(e,(p,g)=>{const x=t instanceof At?t.get(g):null;return x&&x.evaluate?x.evaluate(i,s,c):x})}function h_(e,t){return t-e}le(Mh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class _s{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new ds({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const s=this.getKey(t,i);return this.positions[s]}trim(){const t=this.width,i=this.height=fr(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,s){const c=[];let p=t.length%2==1?-t[t.length-1]*s:0,g=t[0]*s,x=!0;c.push({left:p,right:g,isDash:x,zeroLength:0===t[0]});let w=t[0];for(let E=1;E<t.length;E++){x=!x;const A=t[E];p=w*s,w+=A,g=w*s,c.push({left:p,right:g,isDash:x,zeroLength:0===A})}return c}addRoundDash(t,i,s){const c=i/2;for(let p=-s;p<=s;p++){const g=this.width*(this.nextRow+s+p);let x=0,w=t[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++x]);const A=Math.abs(E-w.left),k=Math.abs(E-w.right),P=Math.min(A,k);let R;const O=p/s*(c+1);if(w.isDash){const V=c-Math.abs(O);R=Math.sqrt(P*P+V*V)}else R=c-Math.sqrt(P*P+O*O);this.image.data[g+E]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(t,i){for(let w=t.length-1;w>=0;--w){const E=t[w],A=t[w+1];E.zeroLength?t.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(w,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++g]);const E=Math.abs(w-x.left),A=Math.abs(w-x.right),k=Math.min(E,A);this.image.data[p+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+i+128))}}addDash(t,i){const s=this.getKey(t,i);if(this.positions[s])return this.positions[s];const c="round"===i,p=c?7:0,g=2*p+1;if(this.nextRow+g>this.height)return Oi("LineAtlas out of space"),null;0===t.length&&t.push(1);let x=0;for(let A=0;A<t.length;A++)t[A]<0&&(Oi("Negative value is found in line dasharray, replacing values with 0"),t[A]=0),x+=t[A];if(0!==x){const A=this.width/x,k=this.getDashRanges(t,this.width,A);c?this.addRoundDash(k,A,p):this.addRegularDash(k,"square"===i?.5*A:0)}const w=this.nextRow+p;this.nextRow+=g;const E={tl:[w,p],br:[x,0]};return this.positions[s]=E,E}}le(_s,"LineAtlas");class Qu{constructor(t){const i={},s=[];for(const x in t){const w=t[x],E=i[x]={};for(const A in w.glyphs){const k=w.glyphs[+A];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const P=k.metrics.localGlyph?2:1,R={x:0,y:0,w:k.bitmap.width+2*P,h:k.bitmap.height+2*P};s.push(R),E[A]=R}}const{w:c,h:p}=Ou(s),g=new ds({width:c||1,height:p||1});for(const x in t){const w=t[x];for(const E in w.glyphs){const A=w.glyphs[+E];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const k=i[x][E],P=A.metrics.localGlyph?2:1;ds.copy(A.bitmap,g,{x:0,y:0},{x:k.x+P,y:k.y+P},A.bitmap)}}this.image=g,this.positions=i}}le(Qu,"GlyphAtlas");class u_{constructor(t){this.tileID=new Bn(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ha(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,s,c,p){this.status="parsing",this.data=t,this.collisionBoxArray=new sd;const g=new pm(Object.keys(t.layers).sort()),x=new Mh(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new _s(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:s},k=i.familiesBySource[this.source];for(const dt in k){const ht=t.layers[dt];if(!ht)continue;let St=!1,Mt=!1;for(const Pt of k[dt])"symbol"===Pt[0].type?St=!0:Mt=!0;if(!0===this.isSymbolTile&&!St||!1===this.isSymbolTile&&!Mt)continue;1===ht.version&&Oi(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ot=g.encode(dt),qt=[];for(let Pt=0;Pt<ht.length;Pt++){const Nt=ht.feature(Pt),Vt=x.getId(Nt,dt);qt.push({feature:Nt,id:Vt,index:Pt,sourceLayerIndex:Ot})}for(const Pt of k[dt]){const Nt=Pt[0];void 0!==this.isSymbolTile&&"symbol"===Nt.type!==this.isSymbolTile||Nt.minzoom&&this.zoom<Math.floor(Nt.minzoom)||Nt.maxzoom&&this.zoom>=Nt.maxzoom||"none"!==Nt.visibility&&(Bo(Pt,this.zoom,s),(w[Nt.id]=Nt.createBucket({index:x.bucketLayerIDs.length,layers:Pt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ot,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(qt,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Pt.map(Vt=>Vt.id)))}}let P,R,O,V;E.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},et=qn(A.glyphDependencies,dt=>Object.keys(dt).map(Number));Object.keys(et).length?c.send("getGlyphs",{uid:this.uid,stacks:et},(dt,ht)=>{P||(P=dt,R=ht,st.call(this))},void 0,!1,q):R={};const lt=Object.keys(A.iconDependencies);lt.length?c.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"icons"},(dt,ht)=>{P||(P=dt,O=ht,st.call(this))},void 0,!1,q):O={};const tt=Object.keys(A.patternDependencies);function st(){if(P)return p(P);if(R&&O&&V){const dt=new Qu(R),ht=new Gf(O,V);for(const St in w){const Mt=w[St];Mt instanceof ta?(Bo(Mt.layers,this.zoom,s),$g(Mt,R,dt.positions,O,ht.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Mt.hasPattern&&(Mt instanceof Du||Mt instanceof Gl||Mt instanceof hh)&&(Bo(Mt.layers,this.zoom,s),Mt.addFeatures(A,this.tileID.canonical,ht.patternPositions,s,this.tileTransform))}this.status="done",p(null,{buckets:go(w).filter(St=>!St.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dt.image,lineAtlas:E,imageAtlas:ht,glyphMap:this.returnDependencies?R:null,iconMap:this.returnDependencies?O:null,glyphPositions:this.returnDependencies?dt.positions:null})}}tt.length?c.send("getImages",{icons:tt,source:this.source,tileID:this.tileID,type:"patterns"},(dt,ht)=>{P||(P=dt,V=ht,st.call(this))},void 0,!1,q):V={},st.call(this)}}function Bo(e,t,i){const s=new wt(t);for(const c of e)c.recalculate(s,i)}class fp{constructor(t){this.entries={},this.scheduler=t}request(t,i,s,c){const p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){const[g,x]=p.result;return this.scheduler?this.scheduler.add(()=>{c(g,x)},i):c(g,x),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=s((g,x)=>{p.result=[g,x];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,x)},i):w(g,x);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==c),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function Sm(e,t,i){const s=JSON.stringify(e.request);return e.data&&(this.deduped.entries[s]={result:[null,e.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},c=>{const p=yr(e.request,(g,x,w,E)=>{g?c(g):x&&c(null,{vectorTile:i?void 0:new Ud(new ph(x)),rawData:x,cacheControl:w,expires:E})});return()=>{p.cancel(),c()}},t)}h.ARRAY_TYPE=Zn,h.AUTH_ERR_MSG=Vo,h.Aabb=rn,h.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Nr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=nr()?e:Xt,this.scheduler=new l_}send(e,t,i,s,c=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const x=gr(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:e,hasCallback:!!i,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Da(t,x)},x),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(t.mustQueue||nr()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),s&&s.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(La(t.error)):i(null,La(t.data)))}else{const i=gr(this.globalScope)?void 0:[],s=t.hasCallback?(p,g)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Da(p):null,data:Da(g,i)},i)}:p=>{},c=La(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,c,s);else if(this.parent.getWorkerSource){const p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],c.source)[p[1]](c,s)}else s(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=zu,h.Color=Fi,h.ColorMode=Ro,h.CullFaceMode=uo,h.DEMData=Ju,h.DataConstantProperty=vt,h.DedupedRequest=fp,h.DepthMode=nc,h.EXTENT=Ce,h.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,s=1<<i,c=Math.floor(e.x),p=Math.floor((e.x-c)*s),g=Math.floor(e.y*s),x=this.findDEMTileFor(new Bn(i,c,i,p,g));return!(!x||!x.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const s=this._source();if(!s||e.y<0||e.y>1)return t;const c=s.getSource().maxzoom,p=1<<c,g=Math.floor(e.x),x=e.x-g,w=new Bn(c,g,c,Math.floor(x*p),Math.floor(e.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const A=E.dem,k=1<<E.tileID.canonical.z,P=(x*k-E.tileID.canonical.x)*A.dim,R=(e.y*k-E.tileID.canonical.y)*A.dim,O=Math.floor(P),V=Math.floor(R);return(i?this.exaggeration():1)*He(He(A.get(O,V),A.get(O,V+1),R-V),He(A.get(O+1,V),A.get(O+1,V+1),R-V),P-O)}getAtTileOffset(e,t,i){const s=1<<e.canonical.z;return this.getAtPointOrZero(new Bl(e.wrap+(e.canonical.x+t/Ce)/s,(e.canonical.y+i/Ce)/s))}getAtTileOffsetFunc(e,t,i,s){return c=>{const p=this.getAtTileOffset(e,c.x,c.y),g=s.upVector(e.canonical,c.x,c.y);return hr(g,g,p*s.upVectorScale(e.canonical,t,i).metersToTile),g}}getForTilePoints(e,t,i,s){if(this.isUsingMockSource())return!1;const c=Ku.create(this,e,s);return!!c&&(t.forEach(p=>{p[2]=this.exaggeration()*c.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,s=t.tileID,c=1<<e.canonical.z-s.canonical.z;let p=e.canonical.x/c-s.canonical.x,g=e.canonical.y/c-s.canonical.y,x=0;for(let w=0;w<e.canonical.z-s.canonical.z&&!i.leaves[x];w++){p*=2,g*=2;const E=2*Math.floor(g)+Math.floor(p);x=i.childOffsets[x]+E,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=Xi,h.EvaluationParameters=wt,h.Event=fi,h.Evented=Vn,h.FillExtrusionBucket=hh,h.Frustum=Td,h.FrustumCorners=zl,h.GLOBE_RADIUS=sn,h.GLOBE_SCALE_MATCH_LATITUDE=45,h.GLOBE_ZOOM_THRESHOLD_MAX=6,h.GLOBE_ZOOM_THRESHOLD_MIN=5,h.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const i=new be,s=new mn,c=[],p=e+1+2,g=t[0]+1,x=t[0]+1+(1+t.length),w=(E,A,k)=>{let P=E===p-1?E-2:0===E?E:E-1;return P+=k?24575:0,[P,A]};for(let E=0;E<p;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<g;++E)for(let A=0;A<p;++A)i.emplaceBack(...w(A,E,(0===A||A===p-1)&&!0));for(let E=0;E<t.length;++E){const A=t[E];for(let k=0;k<p;++k)i.emplaceBack(...w(k,A,!0))}for(let E=0;E<t.length;++E){const A=s.length,k=t[E]+1+2,P=new mn;for(let V=0;V<k-1;V++){const q=V===k-2,et=q?p*(x-t.length+E-V):p;for(let lt=0;lt<p-1;lt++){const tt=V*p+lt;0===V||q||0===lt||lt===p-2?(P.emplaceBack(tt+1,tt,tt+et),P.emplaceBack(tt+et,tt+et+1,tt+1)):(s.emplaceBack(tt+1,tt,tt+et),s.emplaceBack(tt+et,tt+et+1,tt+1))}}const R=$i.simpleSegment(0,A,i.length,s.length-A);for(let V=0;V<P.uint16.length;V+=3)s.emplaceBack(P.uint16[V],P.uint16[V+1],P.uint16[V+2]);const O=$i.simpleSegment(0,A,i.length,s.length-A);c.push({withoutSkirts:R,withSkirts:O})}return{vertices:i,indices:s,segments:c}}_createGrid(e){const t=this._fillGridMeshWithLods(64,Kc);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Jc.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new mn;for(let c=0;c<=64;c++)t.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new Kn,s=new Kn;this._poleSegments=[];for(let c=0,p=0;c<5;c++){const g=360/(1<<c);i.emplaceBack(0,-sn,0,.5,0),s.emplaceBack(0,-sn,0,.5,1);for(let x=0;x<=64;x++){const w=x/64,E=He(0,g,w),[A,k,P]=Xs(ih,Ga,E,sn);i.emplaceBack(A,k,P,w,0),s.emplaceBack(A,k,P,w,1)}this._poleSegments.push($i.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,$p,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(s,$p,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const i=new cr,s=64,c=s+1+2,p=1;this._wireframeSegments=[];for(let g=0,x=0;g<Kc.length;g++){const w=Kc[g];for(let A=p;A<w+p;A++)for(let k=p;k<s+p;k++){const P=A*c+k;i.emplaceBack(P,P+1),i.emplaceBack(P,P+c),i.emplaceBack(P,P+c+1)}const E=w*s*3;this._wireframeSegments.push($i.simpleSegment(0,x,(w+1)*c,E)),x+=E}this._wireframeIndexBuffer=e.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},h.GlyphManager=tc,h.ImagePosition=qd,h.LivePerformanceUtils=jt,h.LngLat=Ke,h.LngLatBounds=Hs,h.LocalGlyphMode=Nu,h.MAX_MERCATOR_LATITUDE=_n,h.MercatorCoordinate=Bl,h.ONE_EM=24,h.OverscaledTileID=Bn,h.PerformanceMarkers=Tt,h.Properties=$t,h.RGBAImage=tr,h.Ray=wd,h.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ni,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!xr(e))return e;const i=Di(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!xr(e))return e;const i=Di(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,s){if(!xr(e))return e;const c=Di(e);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,s){const c=Di(e);return xr(e)?(c.path=`/styles/v1${c.path}/sprite${t}${i}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${t}${i}`,xn(c))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!xr(e))return e;const s=Di(e);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==s.authority&&512===i?"@2x":""}${Pe.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${ze.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${ze.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(p){for(const g of p){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(s.params)||ze.ACCESS_TOKEN;return ze.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(e,t){const i=Di(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${ze.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${ze.TILE_URL_VERSION}/`,"")}`;let c=i.params;return t&&(c=c.filter(p=>!p.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(e,t){const i=!!t&&xr(t),s=[];for(const c of e.tiles||[])yo(c)?s.push(this.canonicalizeTileURL(c,i)):s.push(c);return s}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Di(ze.API_URL);if(e.protocol=s.protocol,e.authority=s.authority,"http"===e.protocol){const c=e.params.indexOf("secure");c>=0&&e.params.splice(c,1)}if("/"!==s.path&&(e.path=`${s.path}${e.path}`),!ze.REQUIRE_ACCESS_TOKEN)return xn(e);if(t=t||ze.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(c=>-1===c.indexOf("access_token")),e.params.push(`access_token=${t||""}`),xn(e)}},h.ResourceType=Ts,h.SegmentVector=$i,h.SourceCache=rc,h.StencilMode=hp,h.StructArrayLayout1ui2=to,h.StructArrayLayout2f1f2i16=pn,h.StructArrayLayout2i4=be,h.StructArrayLayout2ui4=cr,h.StructArrayLayout3f12=fn,h.StructArrayLayout3ui6=mn,h.StructArrayLayout4i8=oi,h.StructArrayLayout5f20=Kn,h.Texture=Th,h.Tile=lp,h.Transitionable=Jt,h.Uniform1f=io,h.Uniform1i=class extends as{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},h.Uniform2f=class extends as{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},h.Uniform3f=class extends as{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},h.Uniform4f=ud,h.UniformColor=Zc,h.UniformMatrix2f=class extends as{constructor(e){super(e),this.current=km}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},h.UniformMatrix3f=class extends as{constructor(e){super(e),this.current=qs}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},h.UniformMatrix4f=class extends as{constructor(e){super(e),this.current=Ap}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},h.UnwrappedTileID=Pf,h.ValidationError=re,h.VectorTileFeature=Iu,h.VectorTileWorkerSource=class extends Vn{constructor(e,t,i,s,c){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=c||Sm,this.loading={},this.loaded={},this.deduped=new fp(e.scheduler),this.isSpriteLoaded=s,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,s=e&&e.request,c=s&&s.collectResourceTiming,p=this.loading[i]=new u_(e);p.abort=this.loadVectorData(e,(g,x)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!x)return p.status="done",w||(this.loaded[i]=p),t(g);const E=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new Ud(new ph(E));const k=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,R)=>{if(P||!R)return t(P);const O={};if(c){const V=_e(s);V.length>0&&(O.resourceTiming=JSON.parse(JSON.stringify(V)))}t(null,Hi({rawTileData:E.slice(0)},R,A,O))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(e,t){const i=this.loaded,s=e.uid,c=this;if(i&&i[s]){const p=i[s];p.showCollisionBoxes=e.showCollisionBoxes,p.enableTerrain=!!e.enableTerrain,p.projection=e.projection,p.tileTransform=Ha(e.tileID.canonical,e.projection);const g=(x,w)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,c.layerIndex,this.availableImages,c.actor,E)),t(x,w)};"parsing"===p.status?p.reloadCallback=g:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(e,t){const i=e.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,s=e.uid;i&&i[s]&&delete i[s],t()}},h.WritingMode=dr,h.ZoomDependentExpression=Co,h.add=us,h.addDynamicAttributes=Xu,h.adjoint=function(e,t){var i=t[0],s=t[1],c=t[2],p=t[3],g=t[4],x=t[5],w=t[6],E=t[7],A=t[8];return e[0]=g*A-x*E,e[1]=c*E-s*A,e[2]=s*x-c*g,e[3]=x*w-p*A,e[4]=i*A-c*w,e[5]=c*p-i*x,e[6]=p*E-g*w,e[7]=s*w-i*E,e[8]=i*g-s*p,e},h.asyncAll=mo,h.bezier=sa,h.bindAll=Nr,h.boundsAttributes=ap,h.bufferConvexPolygon=function(e,t){const i=[];for(let s=0;s<e.length;s++){const c=Fr(s-1,-1,e.length-1),p=Fr(s+1,-1,e.length-1),g=e[s],x=e[p],w=e[c].sub(g).unit(),E=x.sub(g).unit(),A=E.angleWithSep(w.x,w.y),k=w.add(E).unit().mult(-1*t/Math.sin(A/2));i.push(g.add(k))}return i},h.cacheEntryPossiblyAdded=function(e){Le++,Le>gi&&(e.getActor().send("enforceCacheSizeLimit",Je),Le=0)},h.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:s}=e.point,c=pu(i,s,e.worldSize/e._pixelsPerMercatorPixel,0,0);return cs(c,c,du(ao(t)))},h.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:s,lat:c}=e._center;return pu(t,i,e.worldSize,s,c)},h.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,i=t/lo(1,e.center.lat),s=so(new Float64Array(16));return qc(s,s,[e.point.x,e.point.y,0]),hs(s,s,[i,i,t]),Float32Array.from(s)},h.circumferenceAtLatitude=Id,h.clamp=Ue,h.clearTileCache=function(e){if(!We())return;const t=Xt.caches.delete(la);e&&t.catch(e).then(()=>e())},h.clipLine=Qf,h.clone=function(e){var t=new Zn(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.clone$1=Fn,h.collisionCircleLayout=Xl,h.config=ze,h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.create=function(){var e=new Zn(16);return Zn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},h.create$1=fd,h.createExpression=Us,h.createLayout=ge,h.createStyleLayer=function(e){return"custom"===e.type?new r_(e):new s_[e.type](e)},h.cross=xd,h.degToRad=Xe,h.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},h.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},h.dot=zr,h.earthRadius=Rl,h.ease=oc,h.easeCubicInOut=oa,h.ecefToLatLng=function([e,t,i]){const s=Math.hypot(e,t,i),c=Math.atan2(e,i),p=.5*Math.PI-Math.acos(-t/s);return new Ke(en(c),en(p))},h.emitValidationErrors=Hh,h.endsWith=mr,h.enforceCacheSizeLimit=function(e){vi(),Qi&&Qi.then(t=>{t.keys().then(i=>{for(let s=0;s<i.length-e;s++)t.delete(i[s])})})},h.evaluateSizeForFeature=Lu,h.evaluateSizeForZoom=Js,h.evaluateVariableOffset=nm,h.evented=ot,h.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},h.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},h.exported=ti,h.exported$1=Pe,h.extend=Hi,h.extend$1=Gr,h.fillExtrusionHeightLift=If,h.filterObject=Uo,h.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},h.fromQuat=function(e,t){var i=t[0],s=t[1],c=t[2],p=t[3],g=i+i,x=s+s,w=c+c,E=i*g,A=s*g,k=s*x,P=c*g,R=c*x,O=c*w,V=p*g,q=p*x,et=p*w;return e[0]=1-k-O,e[1]=A+et,e[2]=P-q,e[3]=0,e[4]=A-et,e[5]=1-E-O,e[6]=R+V,e[7]=0,e[8]=P+q,e[9]=R-V,e[10]=1-E-k,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.fromRotation=function(e,t){var i=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=i,e[2]=0,e[3]=-i,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},h.fromScaling=gd,h.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return ra[t]},h.getAABBPointSquareDist=function(e,t,i){let s=0;for(let c=0;c<2;++c){const p=i?i[c]:0;e[c]>p&&(s+=(e[c]-p)*(e[c]-p)),t[c]<p&&(s+=(p-t[c])*(p-t[c]))}return s},h.getAnchorAlignment=gh,h.getAnchorJustification=Kd,h.getBounds=function(e){let t=1/0,i=1/0,s=-1/0,c=-1/0;for(const p of e)t=Math.min(t,p.x),i=Math.min(i,p.y),s=Math.max(s,p.x),c=Math.max(c,p.y);return{min:new ie(t,i),max:new ie(s,c)}},h.getColumn=Wn,h.getGridMatrix=function(e,t,i,s){const c=t.getNorth(),p=t.getSouth(),g=t.getWest(),x=t.getEast(),w=1<<e.z,E=x-g,A=c-p,k=E/64,P=-A/Kc[i],R=[0,k,0,P,0,0,c,g,0];if(e.z>0){const O=180/s;Lp(R,R,[O/E+1,0,0,0,O/A+1,0,-.5*O/k,.5*O/P,1])}return R[2]=w,R[5]=e.x,R[8]=e.y,R},h.getImage=Vr,h.getJSON=function(e,t){return Qe(Hi(e,{type:"json"}),t)},h.getLatitudinalLod=function(e){const t=_n-5;e=Ue(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Xe(e))),3);return Math.round(i*(Kc.length-1))},h.getMapSessionAPI=bt,h.getPerformanceMeasurement=_e,h.getProjection=um,h.getRTLTextPluginStatus=pt,h.getReferrer=_i,h.getTilePoint=function(e,{x:t,y:i},s=0){return new ie(((t-s)*e.scale-e.x)*Ce,(i*e.scale-e.y)*Ce)},h.getTileVec3=function(e,t,i=0){return Al(((t.x-i)*e.scale-e.x)*Ce,(t.y*e.scale-e.y)*Ce,Xp(t.z,t.y))},h.getVideo=function(e,t){const i=Xt.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let s=0;s<e.length;s++){const c=Xt.document.createElement("source");_o(e[s])||(i.crossOrigin="Anonymous"),c.src=e[s],i.appendChild(c)}return{cancel:()=>{}}},h.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=so(new Float64Array(16));return cs(i,e.pixelMatrix,e.globeMatrix),Ri(t,t,i),new ie(t[0],t[1])},h.globeDenormalizeECEF=du,h.globeECEFOrigin=function(e,t){const i=[0,0,0];return Ri(i,i,eh(ao(t.canonical))),Ri(i,i,e),i},h.globeMetersToEcef=hu,h.globeNormalizeECEF=eh,h.globePixelsToTileUnits=function(e,t){return Ce/(512*Math.pow(2,e))*uu(ao(t))},h.globePoleMatrixForTile=function(e,t,i){const s=so(new Float64Array(16)),c=(t/(1<<e)-.5)*Math.PI*2;return Wc(s,i.globeMatrix,c),Float32Array.from(s)},h.globeTileBounds=ao,h.globeTiltAtLngLat=Sd,h.globeToMercatorTransition=Dl,h.globeUseCustomAntiAliasing=function(e,t,i){const s=Dl(i.zoom),c=e.style.map._antialias,p=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===s&&!c&&!g&&p},h.identity=so,h.identity$1=Vp,h.invert=md,h.isFullscreen=function(){return!!Xt.document.fullscreenElement||!!Xt.document.webkitFullscreenElement},h.isLngLatBehindGlobe=Ll,h.isMapAuthenticated=function(e){return mt.has(e)},h.isMapboxURL=xr,h.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!gr(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.latFromMercatorY=gn,h.latLngToECEF=Pl,h.len=Up,h.length=Hc,h.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},h.lngFromMercatorX=Qn,h.loadVectorTile=Sm,h.makeRequest=Qe,h.mapValue=function(e,t,i,s,c){return Ue((e-t)/(i-t)*(c-s)+s,s,c)},h.mercatorScale=Yp,h.mercatorXfromLng=Lr,h.mercatorYfromLat=Rr,h.mercatorZfromAltitude=lo,h.mul=Pm,h.mul$1=Dm,h.multiply=cs,h.multiply$1=Lp,h.multiply$2=Op,h.nextPowerOfTwo=fr,h.normalize=Ln,h.normalize$1=Zp,h.normalize$2=vd,h.number=He,h.ortho=function(e,t,i,s,c,p,g){var x=1/(t-i),w=1/(s-c),E=1/(p-g);return e[0]=-2*x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*w,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(t+i)*x,e[13]=(c+s)*w,e[14]=(g+p)*E,e[15]=1,e},h.pbf=ph,h.perspective=function(e,t,i,s,c){var p,g=1/Math.tan(t/2);return e[0]=g/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=c&&c!==1/0?(e[10]=(c+s)*(p=1/(s-c)),e[14]=2*c*s*p):(e[10]=-1,e[14]=-2*s),e},h.pick=function(e,t){const i={};for(let s=0;s<t.length;s++){const c=t[s];c in e&&(i[c]=e[c])}return i},h.plugin=ft,h.pointGeometry=ie,h.polesInViewport=function(e){const t=so(new Float64Array(16));cs(t,e.pixelMatrix,e.globeMatrix);const i=[0,ur,0],s=[0,Dr,0];return Ri(i,i,t),Ri(s,s,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Ll(e,new Ke(e.center.lat,90)),s[0]>0&&s[0]<=e.width&&s[1]>0&&s[1]<=e.height&&!Ll(e,new Ke(e.center.lat,-90))]},h.polygonContainsPoint=qa,h.polygonIntersectsBox=of,h.polygonIntersectsPolygon=Kp,h.polygonizeBounds=function(e,t,i=0,s=!0){const c=new ie(i,i),p=e.sub(c),g=t.add(c),x=[p,new ie(g.x,p.y),g,new ie(p.x,g.y)];return s&&x.push(p.clone()),x},h.posAttributes=Jc,h.postMapLoadEvent=Q,h.postPerformanceEvent=ct,h.postTurnstileEvent=U,h.potpack=Ou,h.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},h.radToDeg=en,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(e){return e({pluginStatus:K,pluginURL:Z}),ot.on("pluginStateChange",e),e},h.removeAuthState=function(e){mt.delete(e)},h.renderColorRamp=Ys,h.resample=Jp,h.rotateX=lu,h.rotateX$1=jp,h.rotateY=Wc,h.rotateY$1=Gp,h.rotateZ=function(e,t,i){var s=Math.sin(i),c=Math.cos(i),p=t[0],g=t[1],x=t[2],w=t[3],E=t[4],A=t[5],k=t[6],P=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=p*c+E*s,e[1]=g*c+A*s,e[2]=x*c+k*s,e[3]=w*c+P*s,e[4]=E*c-p*s,e[5]=A*c-g*s,e[6]=k*c-x*s,e[7]=P*c-w*s,e},h.rotateZ$1=function(e,t,i){i*=.5;var s=t[0],c=t[1],p=t[2],g=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=s*w+c*x,e[1]=c*w-s*x,e[2]=p*w+g*x,e[3]=g*w-p*x,e},h.scale=hs,h.scale$1=Np,h.scale$2=hr,h.scaleAndAdd=Yc,h.set=function(e,t,i,s){return e[0]=t,e[1]=i,e[2]=s,e},h.setCacheLimits=function(e,t){Je=e,gi=t},h.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},h.setRTLTextPlugin=function(e,t,i=!1){if(K===$||K===X||K===H)throw new Error("setRTLTextPlugin cannot be called multiple times.");Z=ti.resolveURL(e),K=$,Y=t,it(),i||ut()},h.smoothstep=fo,h.spec=zt,h.squaredLength=function(e){var t=e[0],i=e[1],s=e[2];return t*t+i*i+s*s},h.storeAuthState=function(e,t){t?mt.add(e):mt.delete(e)},h.sub=Pr,h.subtract=yd,h.symbolSize=Eg,h.tileAABB=function(e,t,i,s,c,p,g,x,w){if("globe"===w.name)return function Wp(e,t,i){const s=t/e.worldSize,c=e.globeMatrix;if(i.z<=1){const Mt=ao(i).getCorners();return qp(Mt,c,s),rn.fromPoints(Mt)}const p=Qc(i),g=Rn(p);qp(g,c,s);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(p.contains(e.center)){for(const qt of g)Xc(E,E,qt),Il(w,w,qt);w[2]=0;const Mt=e.point,Ot=[Mt.x*s,Mt.y*s,0];return Xc(E,E,Ot),Il(w,w,Ot),new rn(E,w)}const A=[c[12]*s,c[13]*s,c[14]*s],k=p.getCenter(),P=Ue(e.center.lat,-_n,_n),R=Ue(k.lat,-_n,_n),O=Lr(e.center.lng),V=Rr(P);let q=O-Lr(k.lng);const et=V-Rr(R);q>.5?q-=1:q<-.5&&(q+=1);let lt=0;Math.abs(q)>Math.abs(et)?lt=q>=0?1:3:(lt=et>=0?0:2,Yc(A,A,[c[4]*s,c[5]*s,c[6]*s],-Math.sin(Xe(et>=0?p.getSouth():p.getNorth()))*sn));const tt=g[lt],st=g[(lt+1)%4],dt=new Bm(tt,st,A),ht=[Md(dt,0)||tt[0],Md(dt,1)||tt[1],Md(dt,2)||tt[2]],St=Dl(e.zoom);if(St>0){const Mt=function({x:qt,y:Pt,z:Nt},Vt,Gt,Ht,Lt){const Qt=1/(1<<Nt);let Te=qt*Qt,oe=Te+Qt,pe=Pt*Qt,ne=pe+Qt,Me=0;const Ge=(Te+oe)/2-Ht;return Ge>.5?Me=-1:Ge<-.5&&(Me=1),Te=((Te+Me)*Vt-(Ht*=Vt))*Gt+Ht,oe=((oe+Me)*Vt-Ht)*Gt+Ht,pe=(pe*Vt-(Lt*=Vt))*Gt+Lt,ne=(ne*Vt-Lt)*Gt+Lt,[[Te,ne,0],[oe,ne,0],[oe,pe,0],[Te,pe,0]]}(i,t,e._pixelsPerMercatorPixel,O,V);for(let qt=0;qt<g.length;qt++)zo(g[qt],Mt[qt],St);const Ot=us([],Mt[lt],Mt[(lt+1)%4]);hr(Ot,Ot,.5),zo(ht,Ot,St)}for(const Mt of g)Xc(E,E,Mt),Il(w,w,Mt);return E[2]=Math.min(tt[2],st[2]),Xc(E,E,ht),Il(w,w,ht),new rn(E,w)}(e,t,new zu(i,s,c));const E=Ha({z:i,x:s,y:c},w);return new rn([(p+E.x/E.scale)*t,t*(E.y/E.scale),g],[(p+E.x2/E.scale)*t,t*(E.y2/E.scale),x])},h.tileCornersToBounds=Qc,h.tileTransform=Ha,h.transformMat3=function(e,t,i){var s=t[0],c=t[1],p=t[2];return e[0]=s*i[0]+c*i[3]+p*i[6],e[1]=s*i[1]+c*i[4]+p*i[7],e[2]=s*i[2]+c*i[5]+p*i[8],e},h.transformMat4=Ri,h.transformMat4$1=ja,h.transformQuat=Fp,h.transitionTileAABBinECEF=Cd,h.translate=qc,h.transpose=function(e,t){if(e===t){var i=t[1],s=t[2],c=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=s,e[7]=c}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},h.triggerPluginCompletionEvent=rt,h.uniqueId=bs,h.updateGlobeVertexNormal=function(e,t,i,s,c){const p=5*t+2;e.float32[p+0]=i,e.float32[p+1]=s,e.float32[p+2]=c},h.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},h.validateFilter=e=>Ar(Gs(e)),h.validateFog=e=>Ar(qh(e)),h.validateLayer=e=>Ar(Ia(e)),h.validateLight=e=>Ar(Ml(e)),h.validateSource=e=>Ar(ka(e)),h.validateStyle=Wh,h.validateTerrain=e=>Ar(Lc(e)),h.values=go,h.vectorTile=Au,h.version=Or,h.warnOnce=Oi,h.window=Xt,h.wrap=Fr}),Bi(0,function(h){function Xt(J){if("number"==typeof J||"boolean"==typeof J||"string"==typeof J||null==J)return JSON.stringify(J);if(Array.isArray(J)){let j="[";for(const Q of J)j+=`${Xt(Q)},`;return`${j}]`}let U="{";for(const j of Object.keys(J).sort())U+=`${j}:${Xt(J[j])},`;return`${U}}`}function Or(J){let U="";for(const j of h.refProperties)U+=`/${Xt(J[j])}`;return U}class de{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,j){for(const at of U)this._layerConfigs[at.id]=at,(this._layers[at.id]=h.createStyleLayer(at)).compileFilter(),this.keyCache[at.id]&&delete this.keyCache[at.id];for(const at of j)delete this.keyCache[at],delete this._layerConfigs[at],delete this._layers[at];this.familiesBySource={};const Q=function(at,ct){const xt={};for(let mt=0;mt<at.length;mt++){const Tt=ct&&ct[at[mt].id]||Or(at[mt]);ct&&(ct[at[mt].id]=Tt);let jt=xt[Tt];jt||(jt=xt[Tt]=[]),jt.push(at[mt])}const bt=[];for(const mt in xt)bt.push(xt[mt]);return bt}(h.values(this._layerConfigs),this.keyCache);for(const at of Q){const ct=at.map(se=>this._layers[se.id]),xt=ct[0];if("none"===xt.visibility)continue;const bt=xt.source||"";let mt=this.familiesBySource[bt];mt||(mt=this.familiesBySource[bt]={});const Tt=xt.sourceLayer||"_geojsonTileLayer";let jt=mt[Tt];jt||(jt=mt[Tt]=[]),jt.push(ct)}}}class ze{loadTile(U,j){const{uid:Q,encoding:at,rawImageData:ct,padding:xt,buildQuadTree:bt}=U,mt=h.window.ImageBitmap&&ct instanceof h.window.ImageBitmap?this.getImageData(ct,xt):ct;j(null,new h.DEMData(Q,mt,at,xt<1,bt))}getImageData(U,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const Q=this.offscreenCanvasContext.getImageData(-j,-j,U.width+2*j,U.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}var Pe=function J(U,j){var Q,at=U&&U.type;if("FeatureCollection"===at)for(Q=0;Q<U.features.length;Q++)J(U.features[Q],j);else if("GeometryCollection"===at)for(Q=0;Q<U.geometries.length;Q++)J(U.geometries[Q],j);else if("Feature"===at)J(U.geometry,j);else if("Polygon"===at)Wi(U.coordinates,j);else if("MultiPolygon"===at)for(Q=0;Q<U.coordinates.length;Q++)Wi(U.coordinates[Q],j);return U};function Wi(J,U){if(0!==J.length){Mn(J[0],U);for(var j=1;j<J.length;j++)Mn(J[j],!U)}}function Mn(J,U){for(var j=0,Q=0,at=0,ct=J.length,xt=ct-1;at<ct;xt=at++){var bt=(J[at][0]-J[xt][0])*(J[xt][1]+J[at][1]),mt=j+bt;Q+=Math.abs(j)>=Math.abs(bt)?j-mt+bt:bt-mt+j,j=mt}j+Q>=0!=!!U&&J.reverse()}const hn=h.VectorTileFeature.prototype.toGeoJSON;class On{constructor(U){this._feature=U,this.extent=h.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(1===this._feature.type){const U=[];for(const j of this._feature.geometry)U.push([new h.pointGeometry(j[0],j[1])]);return U}{const U=[];for(const j of this._feature.geometry){const Q=[];for(const at of j)Q.push(new h.pointGeometry(at[0],at[1]));U.push(Q)}return U}}toGeoJSON(U,j,Q){return hn.call(this,U,j,Q)}}class xs{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=U.length,this._features=U}feature(U){return new On(this._features[U])}}var Ni={},po={get exports(){return Ni},set exports(J){Ni=J}},vs=h.pointGeometry,ie=h.vectorTile.VectorTileFeature,Cn=na;function na(J,U){this.options=U||{},this.features=J,this.length=J.length}function Oo(J,U){this.id="number"==typeof J.id?J.id:void 0,this.type=J.type,this.rawGeometry=1===J.type?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=U||4096}na.prototype.feature=function(J){return new Oo(this.features[J],this.options.extent)},Oo.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var U=0;U<J.length;U++){for(var j=J[U],Q=[],at=0;at<j.length;at++)Q.push(new vs(j[at][0],j[at][1]));this.geometry.push(Q)}return this.geometry},Oo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,U=1/0,j=-1/0,Q=1/0,at=-1/0,ct=0;ct<J.length;ct++)for(var xt=J[ct],bt=0;bt<xt.length;bt++){var mt=xt[bt];U=Math.min(U,mt.x),j=Math.max(j,mt.x),Q=Math.min(Q,mt.y),at=Math.max(at,mt.y)}return[U,Q,j,at]},Oo.prototype.toGeoJSON=ie.prototype.toGeoJSON;var Xe=h.pbf,en=Cn;function ra(J){var U=new Xe;return function(j,Q){for(var at in j.layers)Q.writeMessage(3,oa,j.layers[at])}(J,U),U.finish()}function oa(J,U){var j;U.writeVarintField(15,J.version||1),U.writeStringField(1,J.name||""),U.writeVarintField(5,J.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<J.length;j++)Q.feature=J.feature(j),U.writeMessage(2,sa,Q);var at=Q.keys;for(j=0;j<at.length;j++)U.writeStringField(3,at[j]);var ct=Q.values;for(j=0;j<ct.length;j++)U.writeMessage(4,mo,ct[j])}function sa(J,U){var j=J.feature;void 0!==j.id&&U.writeVarintField(1,j.id),U.writeMessage(2,oc,J),U.writeVarintField(3,j.type),U.writeMessage(4,Fr,j)}function oc(J,U){var j=J.feature,Q=J.keys,at=J.values,ct=J.keycache,xt=J.valuecache;for(var bt in j.properties){var mt=j.properties[bt],Tt=ct[bt];if(null!==mt){void 0===Tt&&(Q.push(bt),ct[bt]=Tt=Q.length-1),U.writeVarint(Tt);var jt=typeof mt;"string"!==jt&&"boolean"!==jt&&"number"!==jt&&(mt=JSON.stringify(mt));var se=jt+":"+mt,Wt=xt[se];void 0===Wt&&(at.push(mt),xt[se]=Wt=at.length-1),U.writeVarint(Wt)}}}function Ue(J,U){return(U<<3)+(7&J)}function fo(J){return J<<1^J>>31}function Fr(J,U){for(var j=J.loadGeometry(),Q=J.type,at=0,ct=0,xt=j.length,bt=0;bt<xt;bt++){var mt=j[bt],Tt=1;1===Q&&(Tt=mt.length),U.writeVarint(Ue(1,Tt));for(var jt=3===Q?mt.length-1:mt.length,se=0;se<jt;se++){1===se&&1!==Q&&U.writeVarint(Ue(2,jt-1));var Wt=mt[se].x-at,_e=mt[se].y-ct;U.writeVarint(fo(Wt)),U.writeVarint(fo(_e)),at+=Wt,ct+=_e}3===Q&&U.writeVarint(Ue(7,1))}}function mo(J,U){var j=typeof J;"string"===j?U.writeStringField(1,J):"boolean"===j?U.writeBooleanField(7,J):"number"===j&&(J%1!=0?U.writeDoubleField(3,J):J<0?U.writeSVarintField(6,J):U.writeVarintField(5,J))}function go(J,U,j,Q,at,ct){if(at-Q<=j)return;const xt=Q+at>>1;Hi(J,U,xt,Q,at,ct%2),go(J,U,j,Q,xt-1,ct+1),go(J,U,j,xt+1,at,ct+1)}function Hi(J,U,j,Q,at,ct){for(;at>Q;){if(at-Q>600){const Tt=at-Q+1,jt=j-Q+1,se=Math.log(Tt),Wt=.5*Math.exp(2*se/3),_e=.5*Math.sqrt(se*Wt*(Tt-Wt)/Tt)*(jt-Tt/2<0?-1:1);Hi(J,U,j,Math.max(Q,Math.floor(j-jt*Wt/Tt+_e)),Math.min(at,Math.floor(j+(Tt-jt)*Wt/Tt+_e)),ct)}const xt=U[2*j+ct];let bt=Q,mt=at;for(Ur(J,U,Q,j),U[2*at+ct]>xt&&Ur(J,U,Q,at);bt<mt;){for(Ur(J,U,bt,mt),bt++,mt--;U[2*bt+ct]<xt;)bt++;for(;U[2*mt+ct]>xt;)mt--}U[2*Q+ct]===xt?Ur(J,U,Q,mt):(mt++,Ur(J,U,mt,at)),mt<=j&&(Q=mt+1),j<=mt&&(at=mt-1)}}function Ur(J,U,j,Q){bs(J,j,Q),bs(U,2*j,2*Q),bs(U,2*j+1,2*Q+1)}function bs(J,U,j){const Q=J[U];J[U]=J[j],J[j]=Q}function pr(J,U,j,Q){const at=J-j,ct=U-Q;return at*at+ct*ct}po.exports=ra,Ni.fromVectorTileJs=ra,Ni.fromGeojsonVt=function(J,U){U=U||{};var j={};for(var Q in J)j[Q]=new en(J[Q].features,U),j[Q].name=Q,j[Q].version=U.version,j[Q].extent=U.extent;return ra({layers:j})},Ni.GeoJSONWrapper=en;const fr=J=>J[0],Fo=J=>J[1];class Nr{constructor(U,j=fr,Q=Fo,at=64,ct=Float64Array){this.nodeSize=at,this.points=U;const xt=U.length<65536?Uint16Array:Uint32Array,bt=this.ids=new xt(U.length),mt=this.coords=new ct(2*U.length);for(let Tt=0;Tt<U.length;Tt++)bt[Tt]=Tt,mt[2*Tt]=j(U[Tt]),mt[2*Tt+1]=Q(U[Tt]);go(bt,mt,at,0,bt.length-1,0)}range(U,j,Q,at){return function(ct,xt,bt,mt,Tt,jt,se){const Wt=[0,ct.length-1,0],_e=[];let ve,ye;for(;Wt.length;){const xe=Wt.pop(),Re=Wt.pop(),ti=Wt.pop();if(Re-ti<=se){for(let fi=ti;fi<=Re;fi++)ve=xt[2*fi],ye=xt[2*fi+1],ve>=bt&&ve<=Tt&&ye>=mt&&ye<=jt&&_e.push(ct[fi]);continue}const Ee=Math.floor((ti+Re)/2);ve=xt[2*Ee],ye=xt[2*Ee+1],ve>=bt&&ve<=Tt&&ye>=mt&&ye<=jt&&_e.push(ct[Ee]);const ai=(xe+1)%2;(0===xe?bt<=ve:mt<=ye)&&(Wt.push(ti),Wt.push(Ee-1),Wt.push(ai)),(0===xe?Tt>=ve:jt>=ye)&&(Wt.push(Ee+1),Wt.push(Re),Wt.push(ai))}return _e}(this.ids,this.coords,U,j,Q,at,this.nodeSize)}within(U,j,Q){return function(at,ct,xt,bt,mt,Tt){const jt=[0,at.length-1,0],se=[],Wt=mt*mt;for(;jt.length;){const _e=jt.pop(),ve=jt.pop(),ye=jt.pop();if(ve-ye<=Tt){for(let ai=ye;ai<=ve;ai++)pr(ct[2*ai],ct[2*ai+1],xt,bt)<=Wt&&se.push(at[ai]);continue}const xe=Math.floor((ye+ve)/2),Re=ct[2*xe],ti=ct[2*xe+1];pr(Re,ti,xt,bt)<=Wt&&se.push(at[xe]);const Ee=(_e+1)%2;(0===_e?xt-mt<=Re:bt-mt<=ti)&&(jt.push(ye),jt.push(xe-1),jt.push(Ee)),(0===_e?xt+mt>=Re:bt+mt>=ti)&&(jt.push(xe+1),jt.push(ve),jt.push(Ee))}return se}(this.ids,this.coords,U,j,Q,this.nodeSize)}}const mr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},qn=Math.fround||(Uo=new Float32Array(1),J=>(Uo[0]=+J,Uo[0]));var Uo;class Fn{constructor(U){this.options=gr(Object.create(mr),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:j,minZoom:Q,maxZoom:at,nodeSize:ct}=this.options;j&&console.time("total time");const xt=`prepare ${U.length} points`;j&&console.time(xt),this.points=U;let bt=[];for(let mt=0;mt<U.length;mt++)U[mt].geometry&&bt.push(Oi(U[mt],mt));this.trees[at+1]=new Nr(bt,aa,Wn,ct,Float32Array),j&&console.timeEnd(xt);for(let mt=at;mt>=Q;mt--){const Tt=+Date.now();bt=this._cluster(bt,mt),this.trees[mt]=new Nr(bt,aa,Wn,ct,Float32Array),j&&console.log("z%d: %d clusters in %dms",mt,bt.length,+Date.now()-Tt)}return j&&console.timeEnd("total time"),this}getClusters(U,j){let Q=((U[0]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,U[1]));let ct=180===U[2]?180:((U[2]+180)%360+360)%360-180;const xt=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)Q=-180,ct=180;else if(Q>ct){const jt=this.getClusters([Q,at,180,xt],j),se=this.getClusters([-180,at,ct,xt],j);return jt.concat(se)}const bt=this.trees[this._limitZoom(j)],mt=bt.range(nr(Q),rr(xt),nr(ct),rr(at)),Tt=[];for(const jt of mt){const se=bt.points[jt];Tt.push(se.numPoints?Un(se):this.points[se.index])}return Tt}getChildren(U){const j=this._getOriginId(U),Q=this._getOriginZoom(U),at="No cluster with the specified id.",ct=this.trees[Q];if(!ct)throw new Error(at);const xt=ct.points[j];if(!xt)throw new Error(at);const bt=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),mt=ct.within(xt.x,xt.y,bt),Tt=[];for(const jt of mt){const se=ct.points[jt];se.parentId===U&&Tt.push(se.numPoints?Un(se):this.points[se.index])}if(0===Tt.length)throw new Error(at);return Tt}getLeaves(U,j,Q){const at=[];return this._appendLeaves(at,U,j=j||10,Q=Q||0,0),at}getTile(U,j,Q){const at=this.trees[this._limitZoom(U)],ct=Math.pow(2,U),{extent:xt,radius:bt}=this.options,mt=bt/xt,Tt=(Q-mt)/ct,jt=(Q+1+mt)/ct,se={features:[]};return this._addTileFeatures(at.range((j-mt)/ct,Tt,(j+1+mt)/ct,jt),at.points,j,Q,ct,se),0===j&&this._addTileFeatures(at.range(1-mt/ct,Tt,1,jt),at.points,ct,Q,ct,se),j===ct-1&&this._addTileFeatures(at.range(0,Tt,mt/ct,jt),at.points,-1,Q,ct,se),se.features.length?se:null}getClusterExpansionZoom(U){let j=this._getOriginZoom(U)-1;for(;j<=this.options.maxZoom;){const Q=this.getChildren(U);if(j++,1!==Q.length)break;U=Q[0].properties.cluster_id}return j}_appendLeaves(U,j,Q,at,ct){const xt=this.getChildren(j);for(const bt of xt){const mt=bt.properties;if(mt&&mt.cluster?ct+mt.point_count<=at?ct+=mt.point_count:ct=this._appendLeaves(U,mt.cluster_id,Q,at,ct):ct<at?ct++:U.push(bt),U.length===Q)break}return ct}_addTileFeatures(U,j,Q,at,ct,xt){for(const bt of U){const mt=j[bt],Tt=mt.numPoints;let jt,se,Wt;if(Tt)jt=qe(mt),se=mt.x,Wt=mt.y;else{const ye=this.points[mt.index];jt=ye.properties,se=nr(ye.geometry.coordinates[0]),Wt=rr(ye.geometry.coordinates[1])}const _e={type:1,geometry:[[Math.round(this.options.extent*(se*ct-Q)),Math.round(this.options.extent*(Wt*ct-at))]],tags:jt};let ve;Tt?ve=mt.id:this.options.generateId?ve=mt.index:this.points[mt.index].id&&(ve=this.points[mt.index].id),void 0!==ve&&(_e.id=ve),xt.features.push(_e)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,j){const Q=[],{radius:at,extent:ct,reduce:xt,minPoints:bt}=this.options,mt=at/(ct*Math.pow(2,j));for(let Tt=0;Tt<U.length;Tt++){const jt=U[Tt];if(jt.zoom<=j)continue;jt.zoom=j;const se=this.trees[j+1],Wt=se.within(jt.x,jt.y,mt),_e=jt.numPoints||1;let ve=_e;for(const ye of Wt){const xe=se.points[ye];xe.zoom>j&&(ve+=xe.numPoints||1)}if(ve>_e&&ve>=bt){let ye=jt.x*_e,xe=jt.y*_e,Re=xt&&_e>1?this._map(jt,!0):null;const ti=(Tt<<5)+(j+1)+this.points.length;for(const Ee of Wt){const ai=se.points[Ee];if(ai.zoom<=j)continue;ai.zoom=j;const fi=ai.numPoints||1;ye+=ai.x*fi,xe+=ai.y*fi,ai.parentId=ti,xt&&(Re||(Re=this._map(jt,!0)),xt(Re,this._map(ai)))}jt.parentId=ti,Q.push(Ya(ye/ve,xe/ve,ti,ve,Re))}else if(Q.push(jt),ve>1)for(const ye of Wt){const xe=se.points[ye];xe.zoom<=j||(xe.zoom=j,Q.push(xe))}}return Q}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,j){if(U.numPoints)return j?gr({},U.properties):U.properties;const Q=this.points[U.index].properties,at=this.options.map(Q);return j&&at===Q?gr({},at):at}}function Ya(J,U,j,Q,at){return{x:qn(J),y:qn(U),zoom:1/0,id:j,parentId:-1,numPoints:Q,properties:at}}function Oi(J,U){const[j,Q]=J.geometry.coordinates;return{x:qn(nr(j)),y:qn(rr(Q)),zoom:1/0,index:U,parentId:-1}}function Un(J){return{type:"Feature",id:J.id,properties:qe(J),geometry:{type:"Point",coordinates:[(U=J.x,360*(U-.5)),ws(J.y)]}};var U}function qe(J){const U=J.numPoints,j=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return gr(gr({},J.properties),{cluster:!0,cluster_id:J.id,point_count:U,point_count_abbreviated:j})}function nr(J){return J/360+.5}function rr(J){const U=Math.sin(J*Math.PI/180),j=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return j<0?0:j>1?1:j}function ws(J){const U=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function gr(J,U){for(const j in U)J[j]=U[j];return J}function aa(J){return J.x}function Wn(J){return J.y}function la(J,U,j,Q){for(var at,ct=Q,xt=j-U>>1,bt=j-U,mt=J[U],Tt=J[U+1],jt=J[j],se=J[j+1],Wt=U+3;Wt<j;Wt+=3){var _e=Qi(J[Wt],J[Wt+1],mt,Tt,jt,se);if(_e>ct)at=Wt,ct=_e;else if(_e===ct){var ve=Math.abs(Wt-xt);ve<bt&&(at=Wt,bt=ve)}}ct>Q&&(at-U>3&&la(J,U,at,Q),J[at+2]=ct,j-at>3&&la(J,at,j,Q))}function Qi(J,U,j,Q,at,ct){var xt=at-j,bt=ct-Q;if(0!==xt||0!==bt){var mt=((J-j)*xt+(U-Q)*bt)/(xt*xt+bt*bt);mt>1?(j=at,Q=ct):mt>0&&(j+=xt*mt,Q+=bt*mt)}return(xt=J-j)*xt+(bt=U-Q)*bt}function _r(J,U,j,Q){var at={id:void 0===J?null:J,type:U,geometry:j,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ct){var xt=ct.geometry,bt=ct.type;if("Point"===bt||"MultiPoint"===bt||"LineString"===bt)Je(ct,xt);else if("Polygon"===bt||"MultiLineString"===bt)for(var mt=0;mt<xt.length;mt++)Je(ct,xt[mt]);else if("MultiPolygon"===bt)for(mt=0;mt<xt.length;mt++)for(var Tt=0;Tt<xt[mt].length;Tt++)Je(ct,xt[mt][Tt])}(at),at}function Je(J,U){for(var j=0;j<U.length;j+=3)J.minX=Math.min(J.minX,U[j]),J.minY=Math.min(J.minY,U[j+1]),J.maxX=Math.max(J.maxX,U[j]),J.maxY=Math.max(J.maxY,U[j+1])}function gi(J,U,j,Q){if(U.geometry){var at=U.geometry.coordinates,ct=U.geometry.type,xt=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),bt=[],mt=U.id;if(j.promoteId?mt=U.properties[j.promoteId]:j.generateId&&(mt=Q||0),"Point"===ct)We(at,bt);else if("MultiPoint"===ct)for(var Tt=0;Tt<at.length;Tt++)We(at[Tt],bt);else if("LineString"===ct)vi(at,bt,xt,!1);else if("MultiLineString"===ct){if(j.lineMetrics){for(Tt=0;Tt<at.length;Tt++)vi(at[Tt],bt=[],xt,!1),J.push(_r(mt,"LineString",bt,U.properties));return}nn(at,bt,xt,!1)}else if("Polygon"===ct)nn(at,bt,xt,!0);else{if("MultiPolygon"!==ct){if("GeometryCollection"===ct){for(Tt=0;Tt<U.geometry.geometries.length;Tt++)gi(J,{id:mt,geometry:U.geometry.geometries[Tt],properties:U.properties},j,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Tt=0;Tt<at.length;Tt++){var jt=[];nn(at[Tt],jt,xt,!0),bt.push(jt)}}J.push(_r(mt,ct,bt,U.properties))}}function We(J,U){U.push(Le(J[0])),U.push(Ts(J[1])),U.push(0)}function vi(J,U,j,Q){for(var at,ct,xt=0,bt=0;bt<J.length;bt++){var mt=Le(J[bt][0]),Tt=Ts(J[bt][1]);U.push(mt),U.push(Tt),U.push(0),bt>0&&(xt+=Q?(at*Tt-mt*ct)/2:Math.sqrt(Math.pow(mt-at,2)+Math.pow(Tt-ct,2))),at=mt,ct=Tt}var jt=U.length-3;U[2]=1,la(U,0,jt,j),U[jt+2]=1,U.size=Math.abs(xt),U.start=0,U.end=U.size}function nn(J,U,j,Q){for(var at=0;at<J.length;at++){var ct=[];vi(J[at],ct,j,Q),U.push(ct)}}function Le(J){return J/360+.5}function Ts(J){var U=Math.sin(J*Math.PI/180),j=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return j<0?0:j>1?1:j}function Sn(J,U,j,Q,at,ct,xt,bt){if(Q/=U,ct>=(j/=U)&&xt<Q)return J;if(xt<j||ct>=Q)return null;for(var mt=[],Tt=0;Tt<J.length;Tt++){var jt=J[Tt],se=jt.geometry,Wt=jt.type,_e=0===at?jt.minX:jt.minY,ve=0===at?jt.maxX:jt.maxY;if(_e>=j&&ve<Q)mt.push(jt);else if(!(ve<j||_e>=Q)){var ye=[];if("Point"===Wt||"MultiPoint"===Wt)_i(se,ye,j,Q,at);else if("LineString"===Wt)Qe(se,ye,j,Q,at,!1,bt.lineMetrics);else if("MultiLineString"===Wt)_o(se,ye,j,Q,at,!1);else if("Polygon"===Wt)_o(se,ye,j,Q,at,!0);else if("MultiPolygon"===Wt)for(var xe=0;xe<se.length;xe++){var Re=[];_o(se[xe],Re,j,Q,at,!0),Re.length&&ye.push(Re)}if(ye.length){if(bt.lineMetrics&&"LineString"===Wt){for(xe=0;xe<ye.length;xe++)mt.push(_r(jt.id,Wt,ye[xe],jt.tags));continue}"LineString"!==Wt&&"MultiLineString"!==Wt||(1===ye.length?(Wt="LineString",ye=ye[0]):Wt="MultiLineString"),"Point"!==Wt&&"MultiPoint"!==Wt||(Wt=3===ye.length?"Point":"MultiPoint"),mt.push(_r(jt.id,Wt,ye,jt.tags))}}}return mt.length?mt:null}function _i(J,U,j,Q,at){for(var ct=0;ct<J.length;ct+=3){var xt=J[ct+at];xt>=j&&xt<=Q&&(U.push(J[ct]),U.push(J[ct+1]),U.push(J[ct+2]))}}function Qe(J,U,j,Q,at,ct,xt){for(var bt,mt,Tt=yr(J),jt=0===at?Es:or,se=J.start,Wt=0;Wt<J.length-3;Wt+=3){var _e=J[Wt],ve=J[Wt+1],ye=J[Wt+2],xe=J[Wt+3],Re=J[Wt+4],ti=0===at?_e:ve,Ee=0===at?xe:Re,ai=!1;xt&&(bt=Math.sqrt(Math.pow(_e-xe,2)+Math.pow(ve-Re,2))),ti<j?Ee>j&&(mt=jt(Tt,_e,ve,xe,Re,j),xt&&(Tt.start=se+bt*mt)):ti>Q?Ee<Q&&(mt=jt(Tt,_e,ve,xe,Re,Q),xt&&(Tt.start=se+bt*mt)):No(Tt,_e,ve,ye),Ee<j&&ti>=j&&(mt=jt(Tt,_e,ve,xe,Re,j),ai=!0),Ee>Q&&ti<=Q&&(mt=jt(Tt,_e,ve,xe,Re,Q),ai=!0),!ct&&ai&&(xt&&(Tt.end=se+bt*mt),U.push(Tt),Tt=yr(J)),xt&&(se+=bt)}var fi=J.length-3;_e=J[fi],ve=J[fi+1],ye=J[fi+2],(ti=0===at?_e:ve)>=j&&ti<=Q&&No(Tt,_e,ve,ye),fi=Tt.length-3,ct&&fi>=3&&(Tt[fi]!==Tt[0]||Tt[fi+1]!==Tt[1])&&No(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&U.push(Tt)}function yr(J){var U=[];return U.size=J.size,U.start=J.start,U.end=J.end,U}function _o(J,U,j,Q,at,ct){for(var xt=0;xt<J.length;xt++)Qe(J[xt],U,j,Q,at,ct,!1)}function No(J,U,j,Q){J.push(U),J.push(j),J.push(Q)}function Es(J,U,j,Q,at,ct){var xt=(ct-U)/(Q-U);return J.push(ct),J.push(j+(at-j)*xt),J.push(1),xt}function or(J,U,j,Q,at,ct){var xt=(ct-j)/(at-j);return J.push(U+(Q-U)*xt),J.push(ct),J.push(1),xt}function Vr(J,U){for(var j=[],Q=0;Q<J.length;Q++){var at,ct=J[Q],xt=ct.type;if("Point"===xt||"MultiPoint"===xt||"LineString"===xt)at=Vo(ct.geometry,U);else if("MultiLineString"===xt||"Polygon"===xt){at=[];for(var bt=0;bt<ct.geometry.length;bt++)at.push(Vo(ct.geometry[bt],U))}else if("MultiPolygon"===xt)for(at=[],bt=0;bt<ct.geometry.length;bt++){for(var mt=[],Tt=0;Tt<ct.geometry[bt].length;Tt++)mt.push(Vo(ct.geometry[bt][Tt],U));at.push(mt)}j.push(_r(ct.id,xt,at,ct.tags))}return j}function Vo(J,U){var j=[];j.size=J.size,void 0!==J.start&&(j.start=J.start,j.end=J.end);for(var Q=0;Q<J.length;Q+=3)j.push(J[Q]+U,J[Q+1],J[Q+2]);return j}function xr(J,U){if(J.transformed)return J;var j,Q,at,ct=1<<J.z,xt=J.x,bt=J.y;for(j=0;j<J.features.length;j++){var mt=J.features[j],Tt=mt.geometry,jt=mt.type;if(mt.geometry=[],1===jt)for(Q=0;Q<Tt.length;Q+=2)mt.geometry.push(yo(Tt[Q],Tt[Q+1],U,ct,xt,bt));else for(Q=0;Q<Tt.length;Q++){var se=[];for(at=0;at<Tt[Q].length;at+=2)se.push(yo(Tt[Q][at],Tt[Q][at+1],U,ct,xt,bt));mt.geometry.push(se)}}return J.transformed=!0,J}function yo(J,U,j,Q,at,ct){return[Math.round(j*(J*Q-at)),Math.round(j*(U*Q-ct))]}function Ja(J,U,j,Q,at){for(var ct=U===at.maxZoom?0:at.tolerance/((1<<U)*at.extent),xt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Q,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},bt=0;bt<J.length;bt++){xt.numFeatures++,Ka(xt,J[bt],ct,at);var mt=J[bt].minX,Tt=J[bt].minY,jt=J[bt].maxX,se=J[bt].maxY;mt<xt.minX&&(xt.minX=mt),Tt<xt.minY&&(xt.minY=Tt),jt>xt.maxX&&(xt.maxX=jt),se>xt.maxY&&(xt.maxY=se)}return xt}function Ka(J,U,j,Q){var at=U.geometry,ct=U.type,xt=[];if("Point"===ct||"MultiPoint"===ct)for(var bt=0;bt<at.length;bt+=3)xt.push(at[bt]),xt.push(at[bt+1]),J.numPoints++,J.numSimplified++;else if("LineString"===ct)Nn(xt,at,J,j,!1,!1);else if("MultiLineString"===ct||"Polygon"===ct)for(bt=0;bt<at.length;bt++)Nn(xt,at[bt],J,j,"Polygon"===ct,0===bt);else if("MultiPolygon"===ct)for(var mt=0;mt<at.length;mt++){var Tt=at[mt];for(bt=0;bt<Tt.length;bt++)Nn(xt,Tt[bt],J,j,!0,0===bt)}if(xt.length){var jt=U.tags||null;if("LineString"===ct&&Q.lineMetrics){for(var se in jt={},U.tags)jt[se]=U.tags[se];jt.mapbox_clip_start=at.start/at.size,jt.mapbox_clip_end=at.end/at.size}var Wt={geometry:xt,type:"Polygon"===ct||"MultiPolygon"===ct?3:"LineString"===ct||"MultiLineString"===ct?2:1,tags:jt};null!==U.id&&(Wt.id=U.id),J.features.push(Wt)}}function Nn(J,U,j,Q,at,ct){var xt=Q*Q;if(Q>0&&U.size<(at?xt:Q))j.numPoints+=U.length/3;else{for(var bt=[],mt=0;mt<U.length;mt+=3)(0===Q||U[mt+2]>xt)&&(j.numSimplified++,bt.push(U[mt]),bt.push(U[mt+1])),j.numPoints++;at&&function(Tt,jt){for(var se=0,Wt=0,_e=Tt.length,ve=_e-2;Wt<_e;ve=Wt,Wt+=2)se+=(Tt[Wt]-Tt[ve])*(Tt[Wt+1]+Tt[ve+1]);if(se>0===jt)for(Wt=0,_e=Tt.length;Wt<_e/2;Wt+=2){var ye=Tt[Wt],xe=Tt[Wt+1];Tt[Wt]=Tt[_e-2-Wt],Tt[Wt+1]=Tt[_e-1-Wt],Tt[_e-2-Wt]=ye,Tt[_e-1-Wt]=xe}}(bt,ct),J.push(bt)}}function jr(J,U){var j=(U=this.options=function(at,ct){for(var xt in ct)at[xt]=ct[xt];return at}(Object.create(this.options),U)).debug;if(j&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var at,ct,xt,bt,mt,Tt,Q=function(at,ct){var xt=[];if("FeatureCollection"===at.type)for(var bt=0;bt<at.features.length;bt++)gi(xt,at.features[bt],ct,bt);else gi(xt,"Feature"===at.type?at:{geometry:at},ct);return xt}(J,U);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),bt=at=Q,mt=Sn(at,1,-1-(xt=(ct=U).buffer/ct.extent),xt,0,-1,2,ct),Tt=Sn(at,1,1-xt,2+xt,0,-1,2,ct),(mt||Tt)&&(bt=Sn(at,1,-xt,1+xt,0,-1,2,ct)||[],mt&&(bt=Vr(mt,1).concat(bt)),Tt&&(bt=bt.concat(Vr(Tt,-1)))),(Q=bt).length&&this.splitTile(Q,0,0,0),j&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Di(J,U,j){return 32*((1<<J)*j+U)+J}function xn(J,U){const j=J.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const Q=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Q)return U(null,null);const at=new xs(Q.features);let ct=Ni(at);0===ct.byteOffset&&ct.byteLength===ct.buffer.byteLength||(ct=new Uint8Array(ct)),U(null,{vectorTile:at,rawData:ct.buffer})}jr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jr.prototype.splitTile=function(J,U,j,Q,at,ct,xt){for(var bt=[J,U,j,Q],mt=this.options,Tt=mt.debug;bt.length;){Q=bt.pop(),j=bt.pop(),U=bt.pop(),J=bt.pop();var jt=1<<U,se=Di(U,j,Q),Wt=this.tiles[se];if(!Wt&&(Tt>1&&console.time("creation"),Wt=this.tiles[se]=Ja(J,U,j,Q,mt),this.tileCoords.push({z:U,x:j,y:Q}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,j,Q,Wt.numFeatures,Wt.numPoints,Wt.numSimplified),console.timeEnd("creation"));var _e="z"+U;this.stats[_e]=(this.stats[_e]||0)+1,this.total++}if(Wt.source=J,at){if(U===mt.maxZoom||U===at)continue;var ve=1<<at-U;if(j!==Math.floor(ct/ve)||Q!==Math.floor(xt/ve))continue}else if(U===mt.indexMaxZoom||Wt.numPoints<=mt.indexMaxPoints)continue;if(Wt.source=null,0!==J.length){Tt>1&&console.time("clipping");var ye,xe,Re,ti,Ee,ai,fi=.5*mt.buffer/mt.extent,Xi=.5-fi,Vn=.5+fi,zt=1+fi;ye=xe=Re=ti=null,Ee=Sn(J,jt,j-fi,j+Vn,0,Wt.minX,Wt.maxX,mt),ai=Sn(J,jt,j+Xi,j+zt,0,Wt.minX,Wt.maxX,mt),J=null,Ee&&(ye=Sn(Ee,jt,Q-fi,Q+Vn,1,Wt.minY,Wt.maxY,mt),xe=Sn(Ee,jt,Q+Xi,Q+zt,1,Wt.minY,Wt.maxY,mt),Ee=null),ai&&(Re=Sn(ai,jt,Q-fi,Q+Vn,1,Wt.minY,Wt.maxY,mt),ti=Sn(ai,jt,Q+Xi,Q+zt,1,Wt.minY,Wt.maxY,mt),ai=null),Tt>1&&console.timeEnd("clipping"),bt.push(ye||[],U+1,2*j,2*Q),bt.push(xe||[],U+1,2*j,2*Q+1),bt.push(Re||[],U+1,2*j+1,2*Q),bt.push(ti||[],U+1,2*j+1,2*Q+1)}}},jr.prototype.getTile=function(J,U,j){var Q=this.options,at=Q.extent,ct=Q.debug;if(J<0||J>24)return null;var xt=1<<J,bt=Di(J,U=(U%xt+xt)%xt,j);if(this.tiles[bt])return xr(this.tiles[bt],at);ct>1&&console.log("drilling down to z%d-%d-%d",J,U,j);for(var mt,Tt=J,jt=U,se=j;!mt&&Tt>0;)Tt--,jt=Math.floor(jt/2),se=Math.floor(se/2),mt=this.tiles[Di(Tt,jt,se)];return mt&&mt.source?(ct>1&&console.log("found parent tile z%d-%d-%d",Tt,jt,se),ct>1&&console.time("drilling down"),this.splitTile(mt.source,Tt,jt,se,J,U,j),ct>1&&console.timeEnd("drilling down"),this.tiles[bt]?xr(this.tiles[bt],at):null):null};class ca extends h.VectorTileWorkerSource{constructor(U,j,Q,at,ct){super(U,j,Q,at,xn),ct&&(this.loadGeoJSON=ct)}loadData(U,j){const Q=U&&U.request,at=Q&&Q.collectResourceTiming;this.loadGeoJSON(U,(ct,xt)=>{if(ct||!xt)return j(ct);if("object"!=typeof xt)return j(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{Pe(xt,!0);try{if(U.filter){const mt=h.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===mt.result)throw new Error(mt.value.map(jt=>`${jt.key}: ${jt.message}`).join(", "));xt={type:"FeatureCollection",features:xt.features.filter(jt=>mt.value.evaluate({zoom:0},jt))}}this._geoJSONIndex=U.cluster?new Fn(function({superclusterOptions:mt,clusterProperties:Tt}){if(!Tt||!mt)return mt;const jt={},se={},Wt={accumulated:null,zoom:0},_e={properties:null},ve=Object.keys(Tt);for(const ye of ve){const[xe,Re]=Tt[ye],ti=h.createExpression(Re),Ee=h.createExpression("string"==typeof xe?[xe,["accumulated"],["get",ye]]:xe);jt[ye]=ti.value,se[ye]=Ee.value}return mt.map=ye=>{_e.properties=ye;const xe={};for(const Re of ve)xe[Re]=jt[Re].evaluate(Wt,_e);return xe},mt.reduce=(ye,xe)=>{_e.properties=xe;for(const Re of ve)Wt.accumulated=ye[Re],ye[Re]=se[Re].evaluate(Wt,_e)},mt}(U)).load(xt.features):new jr(mt=xt,U.geojsonVtOptions)}catch(mt){return j(mt)}this.loaded={};const bt={};if(at){const mt=h.getPerformanceMeasurement(Q);mt&&(bt.resourceTiming={},bt.resourceTiming[U.source]=JSON.parse(JSON.stringify(mt)))}j(null,bt)}var mt})}reloadTile(U,j){const Q=this.loaded;return Q&&Q[U.uid]?super.reloadTile(U,j):this.loadTile(U,j)}loadGeoJSON(U,j){if(U.request)h.getJSON(U.request,j);else{if("string"!=typeof U.data)return j(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(U.data))}catch{return j(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(Q){j(Q)}}getClusterChildren(U,j){try{j(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(Q){j(Q)}}getClusterLeaves(U,j){try{j(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(Q){j(Q)}}}class jo{constructor(U){this.self=U,this.actor=new h.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:ca},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,Q)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=Q},this.self.registerRTLTextPlugin=j=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=j.applyArabicShaping,h.plugin.processBidirectionalText=j.processBidirectionalText,h.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(U,j,Q){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],Q()}checkIfReady(U,j,Q){Q()}setReferrer(U,j){this.referrer=j}spriteLoaded(U,j){this.isSpriteLoaded[U]=j;for(const Q in this.workerSources[U]){const at=this.workerSources[U][Q];for(const ct in at)at[ct]instanceof h.VectorTileWorkerSource&&(at[ct].isSpriteLoaded=j,at[ct].fire(new h.Event("isSpriteLoaded")))}}setImages(U,j,Q){this.availableImages[U]=j;for(const at in this.workerSources[U]){const ct=this.workerSources[U][at];for(const xt in ct)ct[xt].availableImages=j}Q()}enableTerrain(U,j,Q){this.terrain=j,Q()}setProjection(U,j){this.projections[U]=h.getProjection(j)}setLayers(U,j,Q){this.getLayerIndex(U).replace(j),Q()}updateLayers(U,j,Q){this.getLayerIndex(U).update(j.layers,j.removedIds),Q()}loadTile(U,j,Q){const at=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;at.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,j.type,j.source).loadTile(at,Q)}loadDEMTile(U,j,Q){const at=this.enableTerrain?h.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(U,j.source).loadTile(at,Q)}reloadTile(U,j,Q){const at=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;at.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,j.type,j.source).reloadTile(at,Q)}abortTile(U,j,Q){this.getWorkerSource(U,j.type,j.source).abortTile(j,Q)}removeTile(U,j,Q){this.getWorkerSource(U,j.type,j.source).removeTile(j,Q)}removeSource(U,j,Q){if(!this.workerSources[U]||!this.workerSources[U][j.type]||!this.workerSources[U][j.type][j.source])return;const at=this.workerSources[U][j.type][j.source];delete this.workerSources[U][j.type][j.source],void 0!==at.removeSource?at.removeSource(j,Q):Q()}loadWorkerSource(U,j,Q){try{this.self.importScripts(j.url),Q()}catch(at){Q(at.toString())}}syncRTLPluginState(U,j,Q){try{h.plugin.setState(j);const at=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=at){this.self.importScripts(at);const ct=h.plugin.isParsed();Q(ct?void 0:new Error(`RTL Text Plugin failed to import scripts from ${at}`),ct)}}catch(at){Q(at.toString())}}getAvailableImages(U){let j=this.availableImages[U];return j||(j=[]),j}getLayerIndex(U){let j=this.layerIndexes[U];return j||(j=this.layerIndexes[U]=new de),j}getWorkerSource(U,j,Q){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][j]||(this.workerSources[U][j]={}),this.workerSources[U][j][Q]||(this.workerSources[U][j][Q]=new this.workerSourceTypes[j]({send:(ct,xt,bt,mt,Tt,jt)=>{this.actor.send(ct,xt,bt,U,Tt,jt)},scheduler:this.actor.scheduler},this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])),this.workerSources[U][j][Q]}getDEMWorkerSource(U,j){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][j]||(this.demWorkerSources[U][j]=new ze),this.demWorkerSources[U][j]}enforceCacheSizeLimit(U,j){h.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(U,j,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new jo(self)),jo}),Bi(0,function(h){function Xt(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let l=0;l<d.length;l++)if(!Xt(d[l],n[l]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==n){if("object"!=typeof n||Object.keys(d).length!==Object.keys(n).length)return!1;for(const l in d)if(!Xt(d[l],n[l]))return!1;return!0}return d===n}var Or=de;function de(d){return n=d,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,y,v=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(v);try{y=new Worker(M),f=!0}catch{f=!1}return y&&y.terminate(),URL.revokeObjectURL(M),f}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var f=document.createElement("canvas");f.width=f.height=1;var y=f.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===f.width}()||(void 0===ze[l=n&&n.failIfMajorPerformanceCaveat]&&(ze[l]=function(f){var y,M,C,I,v=(M=f,C=document.createElement("canvas"),(I=Object.create(de.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,C.getContext("webgl",I)||C.getContext("experimental-webgl",I));if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),!0===v.getShaderParameter(y,v.COMPILE_STATUS))}(l)),!ze[l]||document.documentMode));var n,l}var ze={};function Pe(d,n,l){const f=h.window.document.createElement(d);return void 0!==n&&(f.className=n),l&&l.appendChild(f),f}function Wi(d,n,l){const f=h.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const y of Object.keys(n))f.setAttributeNS(null,y,n[y]);return l&&l.appendChild(f),f}de.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Mn=h.window.document&&h.window.document.documentElement.style,hn=Mn&&void 0!==Mn.userSelect?"userSelect":"WebkitUserSelect";let On;function xs(){Mn&&hn&&(On=Mn[hn],Mn[hn]="none")}function Ni(){Mn&&hn&&(Mn[hn]=On)}function po(d){d.preventDefault(),d.stopPropagation(),h.window.removeEventListener("click",po,!0)}function vs(){h.window.addEventListener("click",po,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",po,!0)},0)}function ie(d,n){const l=d.getBoundingClientRect();return Oo(d,l,n)}function Cn(d,n){const l=d.getBoundingClientRect(),f=[];for(let y=0;y<n.length;y++)f.push(Oo(d,l,n[y]));return f}function na(d){return void 0!==h.window.InstallTrigger&&2===d.button&&d.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Oo(d,n,l){const f=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new h.pointGeometry((l.clientX-n.left)*f,(l.clientY-n.top)*f)}function Xe(d,n){var l=n[0],f=n[1],y=n[2],v=n[3],M=l*v-y*f;return M?(d[0]=v*(M=1/M),d[1]=-f*M,d[2]=-y*M,d[3]=l*M,d):null}function en(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class ra extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,l){if(!n)return!0;let f=0;for(const y of n){if(y[0]<f||y[1]<y[0]||l<y[1])return!1;f=y[1]}return!0}_validateContent(n,l){return!(n&&(4!==n.length||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let f=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(f=!1);this.isLoaded()||f?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const f={};for(const y of n){this.images[y]||this.fire(new h.Event("styleimagemissing",{id:y}));const v=this.images[y];v?f[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:h.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],f=this.getImage(n);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const y={w:f.data.width+2,h:f.data.height+2,x:0,y:0},v=new h.ImagePosition(y,f);this.patterns[n]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const v in this.patterns)n.push(this.patterns[v].bin);const{w:l,h:f}=h.potpack(n),y=this.atlasImage;y.resize({width:l||1,height:f||1});for(const v in this.patterns){const{bin:M}=this.patterns[v],C=M.x+1,I=M.y+1,D=this.images[v].data,L=D.width,N=D.height;h.RGBAImage.copy(D,y,{x:0,y:0},{x:C,y:I},{width:L,height:N}),h.RGBAImage.copy(D,y,{x:0,y:N-1},{x:C,y:I-1},{width:L,height:1}),h.RGBAImage.copy(D,y,{x:0,y:0},{x:C,y:I+N},{width:L,height:1}),h.RGBAImage.copy(D,y,{x:L-1,y:0},{x:C-1,y:I},{width:1,height:N}),h.RGBAImage.copy(D,y,{x:0,y:0},{x:C+L,y:I},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.images[l];en(f)&&this.updateImage(l,f)}}}const oa=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(d,n){return function([l,f,y]){const v=h.degToRad(f+90),M=h.degToRad(y);return{x:l*Math.cos(v)*Math.sin(M),y:l*Math.sin(v)*Math.sin(M),z:l*Math.cos(M),azimuthal:f,polar:y}}(d.expression.evaluate(n))}interpolate(d,n,l){return{x:h.number(d.x,n.x,l),y:h.number(d.y,n.y,l),z:h.number(d.z,n.z,l),azimuthal:h.number(d.azimuthal,n.azimuthal,l),polar:h.number(d.polar,n.polar,l)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),sa="-transition";class oc extends h.Evented{constructor(n){super(),this._transitionable=new h.Transitionable(oa),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(h.validateLight,n,l))for(const f in n){const y=n[f];h.endsWith(f,sa)?this._transitionable.setTransition(f.slice(0,-sa.length),y):this._transitionable.setValue(f,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,f){return(!f||!1!==f.validate)&&h.emitValidationErrors(this,n.call(h.validateStyle,h.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Ue=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),fo="-transition";class Fr extends h.Evented{constructor(n,l){super(),this._transitionable=new h.Transitionable(Ue),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(n){for(const l in n){const f=n[l];h.endsWith(l,fo)?this._transitionable.setTransition(l.slice(0,-fo.length),f):this._transitionable.setValue(l,f)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function mo(d,n,l,f){const y=h.smoothstep(45,65,l),[v,M]=go(d,f),C=h.length(n);let I=1-Math.min(1,Math.exp((C-v)/(M-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*d.alpha}function go(d,n){const l=.5/Math.tan(.5*n);return[d.range[0]+l,d.range[1]+l]}const Hi=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"high-color":new h.DataConstantProperty(h.spec.fog["high-color"]),"space-color":new h.DataConstantProperty(h.spec.fog["space-color"]),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"]),"star-intensity":new h.DataConstantProperty(h.spec.fog["star-intensity"])}),Ur="-transition";class bs extends h.Evented{constructor(n,l){super(),this._transitionable=new h.Transitionable(Hi),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const n=this._transform,l="globe"===n.projection.name,f=h.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),v=[.5,3];return{range:l?[h.number(v[0],y[0],f),h.number(v[1],y[1],f)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(h.validateFog,n,l)){for(const f of Object.keys(h.spec.fog))n&&void 0===n[f]&&(n[f]=h.spec.fog[f].default);for(const f in n){const y=n[f];h.endsWith(f,Ur)?this._transitionable.setTransition(f.slice(0,-Ur.length),y):this._transitionable.setValue(f,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:h.smoothstep(45,65,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(f,y,v){const M=h.MercatorCoordinate.fromLngLat(y),C=v.elevation?v.elevation.getAtPointOrZero(M):0,I=[M.x,M.y,C];return h.transformMat4(I,I,v.mercatorFogMatrix),mo(f,I,v.pitch,v._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?go(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,f){return(!f||!1!==f.validate)&&h.emitValidationErrors(this,n.call(h.validateStyle,h.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class pr{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const f=this.workerPool.acquire(this.id);for(let y=0;y<f.length;y++){const v=new pr.Actor(f[y],l,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,f){h.asyncAll(this.actors,(y,v)=>{y.send(n,l,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fr(d,n,l){return n*(h.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}pr.Actor=h.Actor;class Fo{constructor(n,l,f,y){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,l){let f,y;if(n instanceof h.pointGeometry||"number"==typeof n[0]){const v=h.pointGeometry.convert(n);f=[v],y=l.isPointAboveHorizon(v)}else{const v=h.pointGeometry.convert(n[0]),M=h.pointGeometry.convert(n[1]);f=[v,M],y=h.polygonizeBounds(v,M).every(C=>l.isPointAboveHorizon(C))}return new Fo(f,l.getCameraPoint(),y,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],f=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],y=h.polygonizeBounds(l,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),h.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],f=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],y=h.polygonizeBounds(l,f,n),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>f.y))+((v.x>l.x)+(v.x>f.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(n,l,f,y=0){const v=n.queryPadding/l._pixelsPerMercatorPixel+1,M=f?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let C=n.tileID.wrap+(M.unwrapped?y:0);const I=M.polygon.map(K=>h.getTilePoint(n.tileTransform,K,C));if(!h.polygonIntersectsBox(I,0,0,h.EXTENT,h.EXTENT))return;C=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const D=this.screenGeometryMercator.polygon.map(K=>h.getTileVec3(n.tileTransform,K,C)),L=D.map(K=>new h.pointGeometry(K[0],K[1])),N=l.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),$=h.getTileVec3(n.tileTransform,N,C),X=D.map(K=>{const Z=h.sub(K,K,$);return h.normalize(Z,Z),new h.Ray($,Z)}),H=fr(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:X,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Y=h.getBounds(I),Y.min.x=h.clamp(Y.min.x,0,h.EXTENT),Y.min.y=h.clamp(Y.min.y,0,h.EXTENT),Y.max.x=h.clamp(Y.max.x,0,h.EXTENT),Y.max.y=h.clamp(Y.max.y,0,h.EXTENT),Y),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:H};var Y}_bufferedScreenMercator(n,l){const f=qn(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let y;return y="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(n,l){const f=qn(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let y;return y="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=y,y}}_projectAndResample(n,l){const f=function(v,M){const C=h.multiply([],M.pixelMatrix,M.globeMatrix),I=[0,-h.GLOBE_RADIUS,0,1],D=[0,h.GLOBE_RADIUS,0,1],L=[0,0,0,1];h.transformMat4$1(I,I,C),h.transformMat4$1(D,D,C),h.transformMat4$1(L,L,C);const N=new h.pointGeometry(I[0]/I[3],I[1]/I[3]),$=new h.pointGeometry(D[0]/D[3],D[1]/D[3]),X=h.polygonContainsPoint(v,N)&&I[3]<L[3],H=h.polygonContainsPoint(v,$)&&D[3]<L[3];if(!X&&!H)return null;const Y=function(ft,wt,Ct){for(let It=1;It<ft.length;It++){const Jt=mr(wt.pointCoordinate3D(ft[It-1]).x),Et=mr(wt.pointCoordinate3D(ft[It]).x);if(Ct<0){if(Jt<Et)return{idx:It,t:-Jt/(Et-1-Jt)}}else if(Et<Jt)return{idx:It,t:(1-Jt)/(Et+1-Jt)}}return null}(v,M,X?-1:1);if(!Y)return null;const{idx:K,t:Z}=Y;let rt=K>1?Nr(v.slice(0,K),M):[],it=K<v.length?Nr(v.slice(K),M):[];rt=rt.map(ft=>new h.pointGeometry(mr(ft.x),ft.y)),it=it.map(ft=>new h.pointGeometry(mr(ft.x),ft.y));const ot=[...rt];0===ot.length&&ot.push(it[it.length-1]);const pt=h.number(ot[ot.length-1].y,(0===it.length?rt[0]:it[0]).y,Z);let ut;return ut=X?[new h.pointGeometry(0,pt),new h.pointGeometry(0,0),new h.pointGeometry(1,0),new h.pointGeometry(1,pt)]:[new h.pointGeometry(1,pt),new h.pointGeometry(1,1),new h.pointGeometry(0,1),new h.pointGeometry(0,pt)],ot.push(...ut),0===it.length?ot.push(rt[0]):ot.push(...it),{polygon:ot.map(ft=>new h.MercatorCoordinate(ft.x,ft.y)),unwrapped:!1}}(n,l);if(f)return f;const y=function(v,M){let C=!1,I=-1/0,D=0;for(let N=0;N<v.length-1;N++)v[N].x>I&&(I=v[N].x,D=N);for(let N=0;N<v.length-1;N++){const $=(D+N)%(v.length-1),X=v[$],H=v[$+1];Math.abs(X.x-H.x)>.5&&(X.x<H.x?(X.x+=1,0===$&&(v[v.length-1].x+=1)):(H.x+=1,$+1===v.length-1&&(v[0].x+=1)),C=!0)}const L=h.mercatorXfromLng(M.center.lng);return C&&L<Math.abs(L-1)&&v.forEach(N=>{N.x-=1}),{polygon:v,unwrapped:C}}(Nr(n,l).map(v=>new h.pointGeometry(mr(v.x),v.y)),l);return{polygon:y.polygon.map(v=>new h.MercatorCoordinate(v.x,v.y)),unwrapped:y.unwrapped}}}function Nr(d,n){return h.resample(d,l=>{const f=n.pointCoordinate3D(l);l.x=f.x,l.y=f.y},1/256)}function mr(d){return d<0?1+d%1:d%1}function qn(d){return 100*d|0}function Uo(d,n,l,f,y){const v=function(M,C){if(M)return y(M);if(C){d.url&&C.tiles&&d.tiles&&delete d.tiles;const I=h.pick(h.extend(C,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(I.vectorLayers=C.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),I.tiles=n.canonicalizeTileset(I,d.url),y(null,I)}};return d.url?h.getJSON(n.transformRequest(n.normalizeSourceURL(d.url,null,l,f),h.ResourceType.Source),v):h.exported.frame(()=>v(null,d))}class Fn{constructor(n,l,f){this.bounds=h.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),f=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*l),y=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*l),M=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=f&&n.x<v&&n.y>=y&&n.y<M}}class Ya{constructor(n,l,f){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Un{constructor(n,l,f,y){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.context=n;const v=n.gl;this.buffer=v.createBuffer(),n.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let f=0;f<this.attributes.length;f++){const y=l.attributes[this.attributes[f].name];void 0!==y&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,l,f){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],M=l.attributes[v.name];void 0!==M&&n.vertexAttribPointer(M,v.components,n[Oi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qe{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nr extends qe{getDefault(){return h.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class rr extends qe{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class ws extends qe{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class gr extends qe{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class aa extends qe{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Wn extends qe{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class la extends qe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Qi extends qe{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class _r extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Je extends qe{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class gi extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class We extends qe{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class vi extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class nn extends qe{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Le extends qe{getDefault(){return h.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ts extends qe{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Sn extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class _i extends qe{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Qe extends qe{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class yr extends qe{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class _o extends qe{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class No extends qe{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Es extends qe{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class or extends qe{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Vr extends qe{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Vo extends qe{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class xr extends qe{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class yo extends qe{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Ja extends qe{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ka extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Nn extends qe{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class jr extends qe{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Di extends jr{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class xn extends jr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ca extends xn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class jo{constructor(n,l,f,y){this.context=n,this.width=l,this.height=f;const v=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Di(n,v),y&&(this.depthAttachment=new xn(n,v))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class J{constructor(n,l=!1){if(this.gl=n,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const f=n;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(n),deleteVertexArrayOES:f.deleteVertexArray.bind(n),bindVertexArrayOES:f.bindVertexArray.bind(n)}}this.clearColor=new nr(this),this.clearDepth=new rr(this),this.clearStencil=new ws(this),this.colorMask=new gr(this),this.depthMask=new aa(this),this.stencilMask=new Wn(this),this.stencilFunc=new la(this),this.stencilOp=new Qi(this),this.stencilTest=new _r(this),this.depthRange=new Je(this),this.depthTest=new gi(this),this.depthFunc=new We(this),this.blend=new vi(this),this.blendFunc=new nn(this),this.blendColor=new Le(this),this.blendEquation=new Ts(this),this.cullFace=new Sn(this),this.cullFaceSide=new _i(this),this.frontFace=new Qe(this),this.program=new yr(this),this.activeTexture=new _o(this),this.viewport=new No(this),this.bindFramebuffer=new Es(this),this.bindRenderbuffer=new or(this),this.bindTexture=new Vr(this),this.bindVertexBuffer=new Vo(this),this.bindElementBuffer=new xr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yo(this),this.pixelStoreUnpack=new Ja(this),this.pixelStoreUnpackPremultiplyAlpha=new Ka(this),this.pixelStoreUnpackFlipY=new Nn(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new Ya(this,n,l)}createVertexBuffer(n,l,f){return new Un(this,n,l,f)}createRenderbuffer(n,l,f){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,n,l,f),this.bindRenderbuffer.set(null),v}createFramebuffer(n,l,f){return new jo(this,n,l,f)}clear({color:n,depth:l,stencil:f}){const y=this.gl;let v=0;n&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==f&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(v)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){Xt(n.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class U extends h.Evented{constructor(n,l,f,y){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(l,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(n){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Uo(this._options,this.map._requestManager,l,f,(y,v)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&2!==f.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new h.ErrorEvent(y))):v&&(h.extend(this,v),v.bounds&&(this.tileBounds=new Fn(v.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return h.extend({},this._options)}loadTile(n,l){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(f,h.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,n.actor&&"expired"!==n.state)"loading"===n.state?n.reloadCallback=l:n.request=n.actor.send("reloadTile",y,v.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",y,v.bind(this),void 0,!0);else{const M=h.loadVectorTile.call({deduped:this._deduped},y,(C,I)=>{C||!I?v.call(this,C):(y.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},n.actor&&n.actor.send("loadTile",y,v.bind(this),void 0,!0))},!0);n.request={cancel:M}}function v(M,C){return delete n.request,n.aborted?l(null):M&&404!==M.status?l(M):(C&&C.resourceTiming&&(n.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&n.setExpiryData(C),n.loadVectorData(C,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class j extends h.Evented{constructor(n,l,f,y){super(),this.id=n,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},l),h.extend(this,h.pick(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Uo(this._options,this.map._requestManager,null,null,(l,f)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new h.ErrorEvent(l)):f&&(h.extend(this,f),f.bounds&&(this.tileBounds=new Fn(f.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(f.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return h.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const f=h.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=h.getImage(this.map._requestManager.transformRequest(y,h.ResourceType.Tile),(v,M,C,I)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):v?(n.state="errored",l(v)):M?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:C,expires:I}),n.setTexture(M,this.map.painter),n.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(n,l,f){n.setTexture(l,f)}static unloadTileData(n,l){n.texture&&l.saveTileTexture(n.texture)}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Q;function at(d,n,l,f,y,v,M,C){const I=[d,l,y,n,f,v,1,1,1],D=[M,C,1],L=h.adjoint([],I),[N,$,X]=h.transformMat3(D,D,h.transpose(L,L));return h.multiply$1(I,[N,0,0,0,$,0,0,0,X],I)}class ct extends h.Evented{constructor(n,l,f,y){super(),this.id=n,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=l,this._dirty=!1}load(n,l){this._loaded=l||!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(f,y)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new h.ErrorEvent(f));else if(y){const{HTMLImageElement:v}=h.window;this.image=y instanceof v?h.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const l=n.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let y=1/0,v=1/0,M=-1/0,C=-1/0;for(const N of f)y=Math.min(y,N.x),v=Math.min(v,N.y),M=Math.max(M,N.x),C=Math.max(C,N.y);const I=Math.max(M-y,C-v),D=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,D);return new h.CanonicalTileID(D,Math.floor((y+M)/2*L),Math.floor((v+C)/2*L))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const I in this.tiles){const D=this.tiles[I];"loaded"!==D.state&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const l=h.tileTransform(this.tileID,this.map.transform.projection),[f,y,v,M]=this.coordinates.map(I=>{const D=l.projection.project(I[0],I[1]);return h.getTilePoint(l,D)._round()});this.perspectiveTransform=function(I,D,L,N,$,X,H,Y,K,Z){const rt=at(0,0,I,0,0,D,I,D),it=at(L,N,$,X,H,Y,K,Z);return h.multiply$1(it,h.adjoint(rt,rt),it),[it[6]/it[8]*I/h.EXTENT,it[7]/it[8]*D/h.EXTENT]}(this.width,this.height,f.x,f.y,y.x,y.y,M.x,M.y,v.x,v.y);const C=this._boundsArray=new h.StructArrayLayout4i8;C.emplaceBack(f.x,f.y,0,0),C.emplaceBack(y.x,y.y,h.EXTENT,0),C.emplaceBack(M.x,M.y,0,h.EXTENT),C.emplaceBack(v.x,v.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(C,h.boundsAttributes.members),this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,l=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new h.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const xt={vector:U,raster:j,"raster-dem":class extends j{constructor(d,n,l,f){super(d,n,l,f),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,v){y&&(d.state="errored",n(y)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=h.getImage(this.map._requestManager.transformRequest(l,h.ResourceType.Tile),function(y,v,M,C){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(y)d.state="errored",n(y);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:M,expires:C});const I=h.window.ImageBitmap&&v instanceof h.window.ImageBitmap&&(null==Q&&(Q=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),Q),D=1-(v.width-h.prevPowerOfTwo(v.width))/2;D<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=I?v:h.exported.getImageData(v,D),N={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:D};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",N,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const n=d.canonical,l=Math.pow(2,n.z),f=(n.x-1+l)%l,y=0===n.x?d.wrap-1:d.wrap,v=(n.x+1+l)%l,M=n.x+1===l?d.wrap+1:d.wrap,C={};return C[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},C[new h.OverscaledTileID(d.overscaledZ,M,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(C[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1},C[new h.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new h.OverscaledTileID(d.overscaledZ,M,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<l&&(C[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1},C[new h.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new h.OverscaledTileID(d.overscaledZ,M,n.z,v,n.y+1).key]={backfilled:!1}),C}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends h.Evented{constructor(d,n,l,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(f),this._data=n.data,this._options=h.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*y,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*y,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,l,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:l},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=h.extend({},this.workerOptions),n=this._data;"string"==typeof n?(d.request=this.map._requestManager.transformRequest(h.exported.resolveURL(n),h.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,f)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new h.ErrorEvent(l));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y.resourceTiming=f.resourceTiming[this.id]),this.fire(new h.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,y)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):f?n(f):(d.loadVectorData(y,this.map.painter,"reloadTile"===l),n(null))),void 0,"loadTile"===l)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ct{constructor(d,n,l,f){super(d,n,l,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,h.ResourceType.Source).url);h.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new h.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ct,canvas:class extends ct{constructor(d,n,l,f){super(d,n,l,f),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(v=>"number"!=typeof v))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends h.Evented{constructor(d,n,l,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fn(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),h.extend(this,h.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:l,z:f}=d.canonical;return this._implementation.hasTile({x:n,y:l,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:l,y:f,z:y}=d.tileID.canonical,v=new h.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:f,z:y},{signal:v.signal})).then(function(M){return delete d.request,d.aborted?(d.state="unloaded",n(null)):void 0===M?(d.state="errored",n(null)):null===M?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):(C=M)instanceof h.window.ImageData||C instanceof h.window.HTMLCanvasElement||C instanceof h.window.ImageBitmap||C instanceof h.window.HTMLImageElement?(this.loadTileData(d,M),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var C}.bind(this)).catch(M=>{20!==M.code&&(d.state="errored",n(M))}),d.request.cancel=()=>v.abort()}loadTileData(d,n){j.loadTileData(d,n,this._map.painter)}unloadTileData(d){j.unloadTileData(d,this._map.painter)}unloadTile(d,n){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:l,y:f,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:f,z:y})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}}},bt=function(d,n,l,f){const y=new xt[n.type](d,n,l,f);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],y),y};function mt(d,n){const l=h.identity([]);return h.scale(l,l,[.5*d.width,.5*-d.height,1]),h.translate(l,l,[1,-1,0]),h.multiply(l,l,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function Tt(d,n,l,f,y,v,M,C=!1){const I=d.tilesIn(f,M,C);I.sort(se);const D=[];for(const N of I)D.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(n,l,d._state,N,y,v,mt(d.transform,N.tile.tileID),C)});const L=function(N){const $={},X={};for(const H of N){const Y=H.queryResults,K=H.wrappedTileID,Z=X[K]=X[K]||{};for(const rt in Y){const it=Y[rt],ot=Z[rt]=Z[rt]||{},pt=$[rt]=$[rt]||[];for(const ut of it)ot[ut.featureIndex]||(ot[ut.featureIndex]=!0,pt.push(ut))}}return $}(D);for(const N in L)L[N].forEach($=>{const X=$.feature,H=X.layer;H&&"background"!==H.type&&"sky"!==H.type&&(X.source=H.source,H["source-layer"]&&(X.sourceLayer=H["source-layer"]),X.state=void 0!==X.id?d.getFeatureState(H["source-layer"],X.id):{})});return L}function jt(d,n){const l=d.getRenderableIds().map(v=>d.getTileByID(v)),f=[],y={};for(let v=0;v<l.length;v++){const M=l[v],C=M.tileID.canonical.key;y[C]||(y[C]=!0,M.querySourceFeatures(f,n))}return f}function se(d,n){const l=d.tileID,f=n.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function Wt(){return null!=Kr.workerClass?new Kr.workerClass:new h.window.Worker(Kr.workerUrl)}const _e="mapboxgl_preloaded_worker_pool";class ve{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<ve.workerCount;)this.workers.push(new Wt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_e]}numActive(){return Object.keys(this.active).length}}let ye;function xe(){return ye||(ye=new ve),ye}function Re(d,n){const l={};for(const f in d)"ref"!==f&&(l[f]=d[f]);return h.refProperties.forEach(f=>{f in n&&(l[f]=n[f])}),l}function ti(d){d=d.slice();const n=Object.create(null);for(let l=0;l<d.length;l++)n[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Re(d[l],n[d[l].ref]));return d}ve.workerCount=2;const Ee={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ai(d,n,l){l.push({command:Ee.addSource,args:[d,n[d]]})}function fi(d,n,l){n.push({command:Ee.removeSource,args:[d]}),l[d]=!0}function Xi(d,n,l,f){fi(d,l,f),ai(d,n,l)}function Vn(d,n,l){let f;for(f in d[l])if(d[l].hasOwnProperty(f)&&"data"!==f&&!Xt(d[l][f],n[l][f]))return!1;for(f in n[l])if(n[l].hasOwnProperty(f)&&"data"!==f&&!Xt(d[l][f],n[l][f]))return!1;return!0}function zt(d,n,l,f,y,v){let M;for(M in n=n||{},d=d||{})d.hasOwnProperty(M)&&(Xt(d[M],n[M])||l.push({command:v,args:[f,M,n[M],y]}));for(M in n)n.hasOwnProperty(M)&&!d.hasOwnProperty(M)&&(Xt(d[M],n[M])||l.push({command:v,args:[f,M,n[M],y]}))}function Gr(d){return d.id}function bi(d,n){return d[n.id]=n,d}class vr{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=h.clamp(n,0,1);let l=1,f=this._distances[l];const y=n*this.paddedLength+this.padding;for(;f<y&&l<this._distances.length;)f=this._distances[++l];const v=l-1,M=this._distances[v],C=f-M,I=C>0?(y-M)/C:0;return this.points[v].mult(1-I).add(this.points[l].mult(I))}}class br{constructor(n,l,f){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(l/f);for(let M=0;M<this.xCellCount*this.yCellCount;M++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,f,y,v){this._forEachCell(l,f,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(n,l,f,y){this._forEachCell(l-y,f-y,l+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(f),this.circles.push(y)}_insertBoxCell(n,l,f,y,v,M){this.boxCells[v].push(M)}_insertCircleCell(n,l,f,y,v,M){this.circleCells[v].push(M)}_query(n,l,f,y,v,M){if(f<0||n>this.width||y<0||l>this.height)return!v&&[];const C=[];if(n<=0&&l<=0&&this.width<=f&&this.height<=y){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)C.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const D=this.circles[3*I],L=this.circles[3*I+1],N=this.circles[3*I+2];C.push({key:this.circleKeys[I],x1:D-N,y1:L-N,x2:D+N,y2:L+N})}return M?C.filter(M):C}return this._forEachCell(n,l,f,y,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},M),v?C.length>0:C}_queryCircle(n,l,f,y,v){const M=n-f,C=n+f,I=l-f,D=l+f;if(C<0||M>this.width||D<0||I>this.height)return!y&&[];const L=[];return this._forEachCell(M,I,C,D,this._queryCellCircle,L,{hitTest:y,circle:{x:n,y:l,radius:f},seenUids:{box:{},circle:{}}},v),y?L.length>0:L}query(n,l,f,y,v){return this._query(n,l,f,y,!1,v)}hitTest(n,l,f,y,v){return this._query(n,l,f,y,!0,v)}hitTestCircle(n,l,f,y){return this._queryCircle(n,l,f,!0,y)}_queryCell(n,l,f,y,v,M,C,I){const D=C.seenUids,L=this.boxCells[v];if(null!==L){const $=this.bboxes;for(const X of L)if(!D.box[X]){D.box[X]=!0;const H=4*X;if(n<=$[H+2]&&l<=$[H+3]&&f>=$[H+0]&&y>=$[H+1]&&(!I||I(this.boxKeys[X]))){if(C.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[X],x1:$[H],y1:$[H+1],x2:$[H+2],y2:$[H+3]})}}}const N=this.circleCells[v];if(null!==N){const $=this.circles;for(const X of N)if(!D.circle[X]){D.circle[X]=!0;const H=3*X;if(this._circleAndRectCollide($[H],$[H+1],$[H+2],n,l,f,y)&&(!I||I(this.circleKeys[X]))){if(C.hitTest)return M.push(!0),!0;{const Y=$[H],K=$[H+1],Z=$[H+2];M.push({key:this.circleKeys[X],x1:Y-Z,y1:K-Z,x2:Y+Z,y2:K+Z})}}}}}_queryCellCircle(n,l,f,y,v,M,C,I){const D=C.circle,L=C.seenUids,N=this.boxCells[v];if(null!==N){const X=this.bboxes;for(const H of N)if(!L.box[H]){L.box[H]=!0;const Y=4*H;if(this._circleAndRectCollide(D.x,D.y,D.radius,X[Y+0],X[Y+1],X[Y+2],X[Y+3])&&(!I||I(this.boxKeys[H])))return M.push(!0),!0}}const $=this.circleCells[v];if(null!==$){const X=this.circles;for(const H of $)if(!L.circle[H]){L.circle[H]=!0;const Y=3*H;if(this._circlesCollide(X[Y],X[Y+1],X[Y+2],D.x,D.y,D.radius)&&(!I||I(this.circleKeys[H])))return M.push(!0),!0}}}_forEachCell(n,l,f,y,v,M,C,I){const D=this._convertToXCellCoord(n),L=this._convertToYCellCoord(l),N=this._convertToXCellCoord(f),$=this._convertToYCellCoord(y);for(let X=D;X<=N;X++)for(let H=L;H<=$;H++)if(v.call(this,n,l,f,y,this.xCellCount*H+X,M,C,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,f,y,v,M){const C=y-n,I=v-l,D=f+M;return D*D>C*C+I*I}_circleAndRectCollide(n,l,f,y,v,M,C){const I=(M-y)/2,D=Math.abs(n-(y+I));if(D>I+f)return!1;const L=(C-v)/2,N=Math.abs(l-(v+L));if(N>L+f)return!1;if(D<=I||N<=L)return!0;const $=D-I,X=N-L;return $*$+X*X<=f*f}}const wr=Math.tan(85*Math.PI/180);function Ms(d,n,l,f,y,v,M){const C=h.create();if(l)if("globe"===v.name){const I=h.calculateGlobeLabelMatrix(y,n);h.multiply(C,C,I)}else{const I=Xe([],M);C[0]=I[0],C[1]=I[1],C[4]=I[2],C[5]=I[3],f||h.rotateZ(C,C,y.angle)}else h.multiply(C,y.labelPlaneMatrix,d);return C}function sc(d,n,l,f,y,v,M){const C=Ms(d,n,l,f,y,v,M);return"globe"===v.name&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function Cs(d,n,l,f,y,v,M){if(l){if("globe"===v.name){const C=Ms(d,n,l,f,y,v,M);return h.invert(C,C),h.multiply(C,d,C),C}{const C=h.clone(d),I=h.identity([]);return I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],h.multiply(C,C,I),f||h.rotateZ(C,C,-y.angle),C}}return y.glCoordMatrix}function ee(d,n,l,f){const y=[d,n,l,1];l?h.transformMat4$1(y,y,f):ha(y,y,f);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function Ve(d,n){return Math.min(.5+d/n*.5,1.5)}function Ze(d,n){const l=d[0]/d[3],f=d[1]/d[3];return l>=-n[0]&&l<=n[0]&&f>=-n[1]&&f<=n[1]}function sr(d,n,l,f,y,v,M,C,I,D){const L=l.transform,N=f?d.textSizeData:d.iconSizeData,$=h.evaluateSizeForZoom(N,l.transform.zoom),X="globe"===L.projection.name,H=[256/l.width*2+1,256/l.height*2+1],Y=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();let K=null;X&&(K=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Z=d.lineVertexArray,rt=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,it=l.transform.width/l.transform.height;let ot,pt=!1;for(let ut=0;ut<rt.length;ut++){const ft=rt.get(ut),{numGlyphs:wt,writingMode:Ct}=ft;if(Ct!==h.WritingMode.vertical||pt||ot===h.WritingMode.horizontal||(pt=!0),ot=Ct,(ft.hidden||Ct===h.WritingMode.vertical)&&!pt){yi(wt,Y);continue}pt=!1;const It=new h.pointGeometry(ft.tileAnchorX,ft.tileAnchorY);let{x:Jt,y:Et,z:Ft}=L.projection.projectTilePoint(It.x,It.y,D.canonical);if(I){const[Oe,he,ae]=I(It);Jt+=Oe,Et+=he,Ft+=ae}const Dt=[Jt,Et,Ft,1];if(h.transformMat4$1(Dt,Dt,n),!Ze(Dt,H)){yi(wt,Y);continue}const Zt=Ve(l.transform.cameraToCenterDistance,Dt[3]),At=h.evaluateSizeForFeature(N,$,ft),vt=M?At/Zt:At*Zt,kt=ee(Jt,Et,Ft,y);if(kt[3]<=0){yi(wt,Y);continue}let Ut={};const $t=M?null:I,me=Go(ft,vt,!1,C,n,y,v,d.glyphOffsetArray,Z,Y,K,kt,It,Ut,it,$t,L.projection,D,M);pt=me.useVertical,$t&&me.needsFlipping&&(Ut={}),(me.notEnoughRoom||pt||me.needsFlipping&&Go(ft,vt,!0,C,n,y,v,d.glyphOffsetArray,Z,Y,K,kt,It,Ut,it,$t,L.projection,D,M).notEnoughRoom)&&yi(wt,Y)}f?(d.text.dynamicLayoutVertexBuffer.updateData(Y),K&&d.text.globeExtVertexBuffer.updateData(K)):(d.icon.dynamicLayoutVertexBuffer.updateData(Y),K&&d.icon.globeExtVertexBuffer.updateData(K))}function xo(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y){const{lineStartIndex:K,glyphStartIndex:Z,segment:rt}=C,it=Z+C.numGlyphs,ot=K+C.lineLength,pt=n.getoffsetX(Z),ut=n.getoffsetX(it-1),ft=un(d*pt,l,f,y,v,M,rt,K,ot,I,D,L,N,$,!0,X,H,Y);if(!ft)return null;const wt=un(d*ut,l,f,y,v,M,rt,K,ot,I,D,L,N,$,!0,X,H,Y);return wt?{first:ft,last:wt}:null}function Ne(d,n,l,f){return d===h.WritingMode.horizontal&&Math.abs(f)>Math.abs(l)?{useVertical:!0}:d===h.WritingMode.vertical?f>0?{needsFlipping:!0}:null:0!==n&&(0===(y=l)||Math.abs(f/y)>wr)?1===n?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var y}function Go(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y,K,Z,rt){const it=n/24,ot=d.lineOffsetX*it,pt=d.lineOffsetY*it,{lineStartIndex:ut,glyphStartIndex:ft,numGlyphs:wt,segment:Ct,writingMode:It,flipState:Jt}=d,Et=ut+d.lineLength,Ft=Dt=>{if(L){const[kt,Ut,$t]=Dt.up,me=D.length;h.updateGlobeVertexNormal(L,me+0,kt,Ut,$t),h.updateGlobeVertexNormal(L,me+1,kt,Ut,$t),h.updateGlobeVertexNormal(L,me+2,kt,Ut,$t),h.updateGlobeVertexNormal(L,me+3,kt,Ut,$t)}const[Zt,At,vt]=Dt.point;h.addDynamicAttributes(D,Zt,At,vt,Dt.angle)};if(wt>1){const Dt=xo(it,C,ot,pt,l,N,$,d,I,v,X,Y,!1,K,Z,rt);if(!Dt)return{notEnoughRoom:!0};if(f&&!l){let[Zt,At,vt]=Dt.first.point,[kt,Ut,$t]=Dt.last.point;[Zt,At]=ee(Zt,At,vt,M),[kt,Ut]=ee(kt,Ut,$t,M);const me=Ne(It,Jt,(kt-Zt)*H,Ut-At);if(d.flipState=me&&me.needsFlipping?1:2,me)return me}Ft(Dt.first);for(let Zt=ft+1;Zt<ft+wt-1;Zt++){const At=un(it*C.getoffsetX(Zt),ot,pt,l,N,$,Ct,ut,Et,I,v,X,Y,!1,!1,K,Z,rt);if(!At)return D.length-=4*(Zt-ft),{notEnoughRoom:!0};Ft(At)}Ft(Dt.last)}else{if(f&&!l){const Zt=ee($.x,$.y,0,y),At=ut+Ct+1,vt=new h.pointGeometry(I.getx(At),I.gety(At)),kt=ee(vt.x,vt.y,0,y),Ut=kt[3]>0?kt:Ss($,vt,Zt,1,y,void 0,K,Z.canonical),$t=Ne(It,Jt,(Ut[0]-Zt[0])*H,Ut[1]-Zt[1]);if(d.flipState=$t&&$t.needsFlipping?1:2,$t)return $t}const Dt=un(it*C.getoffsetX(ft),ot,pt,l,N,$,Ct,ut,Et,I,v,X,Y,!1,!1,K,Z,rt);if(!Dt)return{notEnoughRoom:!0};Ft(Dt)}return{}}function ji(d,n,l,f,y){const{x:v,y:M,z:C}=f.projectTilePoint(d.x,d.y,n);if(!y)return ee(v,M,C,l);const[I,D,L]=y(d);return ee(v+I,M+D,C+L,l)}function Ss(d,n,l,f,y,v,M,C){const I=ji(d.sub(n)._unit()._add(d),C,y,M,v);return h.sub(I,l,I),h.normalize(I,I),h.scaleAndAdd(I,l,I,f)}function un(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y,K,Z){const rt=f?d-n:d+n;let it=rt>0?1:-1,ot=0;f&&(it*=-1,ot=Math.PI),it<0&&(ot+=Math.PI);let pt=C+M+(it>0?0:1)|0,ut=y,ft=y,wt=0,Ct=0;const It=Math.abs(rt),Jt=[],Et=[];let Ft=v,Dt=Ft;const Zt=()=>Ss(Dt,Ft,ft,It-wt+1,L,$,Y,K.canonical);for(;wt+Ct<=It;){if(pt+=it,pt<C||pt>=I)return null;if(ft=ut,Dt=Ft,Jt.push(ft),X&&Et.push(Dt),Ft=new h.pointGeometry(D.getx(pt),D.gety(pt)),ut=N[pt],!ut){const ae=ji(Ft,K.canonical,L,Y,$);ut=ae[3]>0?N[pt]=ae:Zt()}wt+=Ct,Ct=h.distance(ft,ut)}H&&$&&(N[pt]&&(ut=Zt(),Ct=h.distance(ft,ut)),N[pt]=ut);const At=(It-wt)/Ct,vt=Ft.sub(Dt)._mult(At)._add(Dt),kt=h.sub([],ut,ft),Ut=h.scaleAndAdd([],ft,kt,At);let $t=[0,0,1],me=kt[0],Oe=kt[1];if(Z&&($t=Y.upVector(K.canonical,vt.x,vt.y),0!==$t[0]||0!==$t[1]||1!==$t[2])){const ae=[$t[2],0,-$t[0]],ge=h.cross([],$t,ae);h.normalize(ae,ae),h.normalize(ge,ge),me=h.dot(kt,ae),Oe=h.dot(kt,ge)}if(l){const ae=h.cross([],$t,kt);h.normalize(ae,ae),h.scaleAndAdd(Ut,Ut,ae,l*it)}const he=ot+Math.atan2(Oe,me);return Jt.push(Ut),X&&Et.push(vt),{point:Ut,angle:he,path:Jt,tilePath:Et,up:$t}}function yi(d,n){const l=n.length,f=l+4*d;n.resize(f),n.float32.fill(-1/0,4*l,4*f)}function ha(d,n,l){const f=n[0],y=n[1];return d[0]=l[0]*f+l[4]*y+l[12],d[1]=l[1]*f+l[5]*y+l[13],d[3]=l[3]*f+l[7]*y+l[15],d}const vn=100;class Qa{constructor(n,l,f=new br(n.width+200,n.height+200,25),y=new br(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+vn,this.screenBottomBoundary=n.height+vn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,f,y,v,M,C,I){let D=f.projectedAnchorX,L=f.projectedAnchorY,N=f.projectedAnchorZ;const $=f.elevation,X=f.tileID,H=n.getProjection();if($&&X){const[ut,ft,wt]=H.upVector(X.canonical,f.tileAnchorX,f.tileAnchorY),Ct=H.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ut*$*Ct,L+=ft*$*Ct,N+=wt*$*Ct}const Y=this.projectAndGetPerspectiveRatio(C,D,L,N,f.tileID,"globe"===H.name||!!$||this.transform.pitch>0,H),K=M*Y.perspectiveRatio,Z=(f.x1*l+y.x-f.padding)*K+Y.point.x,rt=(f.y1*l+y.y-f.padding)*K+Y.point.y,it=(f.x2*l+y.x+f.padding)*K+Y.point.x,ot=(f.y2*l+y.y+f.padding)*K+Y.point.y,pt=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(Z,rt,it,ot)||!v&&this.grid.hitTest(Z,rt,it,ot,I)||pt?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[Z,rt,it,ot],offscreen:this.isOffscreen(Z,rt,it,ot),occluded:!1}}placeCollisionCircles(n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y){const K=[],Z=this.transform.elevation,rt=n.getProjection(),it=Z?Z.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,rt):null,ot=new h.pointGeometry(f.tileAnchorX,f.tileAnchorY);let{x:pt,y:ut,z:ft}=rt.projectTilePoint(ot.x,ot.y,Y.canonical);if(it){const[vt,kt,Ut]=it(ot);pt+=vt,ut+=kt,ft+=Ut}const wt="globe"===rt.name,Ct=this.projectAndGetPerspectiveRatio(C,pt,ut,ft,Y,wt||!!Z||this.transform.pitch>0,rt),{perspectiveRatio:It}=Ct,Jt=(N?M/It:M*It)/h.ONE_EM,Et=ee(pt,ut,ft,I),Ft=Ct.signedDistanceFromCamera>0?xo(Jt,v,f.lineOffsetX*Jt,f.lineOffsetY*Jt,!1,Et,ot,f,y,I,{},Z&&!N?it:null,N&&!!Z,rt,Y,N):null;let Dt=!1,Zt=!1,At=!0;if(Ft&&!Ct.occluded){const vt=.5*X*It+H,kt=new h.pointGeometry(-100,-100),Ut=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$t=new vr,{first:me,last:Oe}=Ft,he=me.path.length;let ae=[];for(let be=he-1;be>=1;be--)ae.push(me.path[be]);for(let be=1;be<Oe.path.length;be++)ae.push(Oe.path[be]);const ge=2.5*vt;D&&(ae=ae.map(([be,ri,oi],wi)=>(it&&!wt&&(oi=it(wi<he-1?me.tilePath[he-1-wi]:Oe.tilePath[wi-he+2])[2]),ee(be,ri,oi,D))),ae.some(be=>be[3]<=0)&&(ae=[]));let je=[];if(ae.length>0){let be=1/0,ri=-1/0,oi=1/0,wi=-1/0;for(const mi of ae)be=Math.min(be,mi[0]),oi=Math.min(oi,mi[1]),ri=Math.max(ri,mi[0]),wi=Math.max(wi,mi[1]);ri>=kt.x&&be<=Ut.x&&wi>=kt.y&&oi<=Ut.y&&(je=[ae.map(mi=>new h.pointGeometry(mi[0],mi[1]))],(be<kt.x||ri>Ut.x||oi<kt.y||wi>Ut.y)&&(je=h.clipLine(je,kt.x,kt.y,Ut.x,Ut.y)))}for(const be of je){$t.reset(be,.25*vt);let ri=0;ri=$t.length<=.5*vt?1:Math.ceil($t.paddedLength/ge)+1;for(let oi=0;oi<ri;oi++){const wi=oi/Math.max(ri-1,1),mi=$t.lerp(wi),Vi=mi.x+vn,Pn=mi.y+vn;K.push(Vi,Pn,vt,0);const Jn=Vi-vt,Ir=Pn-vt,xi=Vi+vt,si=Pn+vt;if(At=At&&this.isOffscreen(Jn,Ir,xi,si),Zt=Zt||this.isInsideGrid(Jn,Ir,xi,si),!l&&this.grid.hitTestCircle(Vi,Pn,vt,$)&&(Dt=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!L&&Dt||!Zt?[]:K,offscreen:At,collisionDetected:Dt,occluded:Ct.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let f=1/0,y=1/0,v=-1/0,M=-1/0;for(const L of n){const N=new h.pointGeometry(L.x+vn,L.y+vn);f=Math.min(f,N.x),y=Math.min(y,N.y),v=Math.max(v,N.x),M=Math.max(M,N.y),l.push(N)}const C=this.grid.query(f,y,v,M).concat(this.ignoredGrid.query(f,y,v,M)),I={},D={};for(const L of C){const N=L.key;if(void 0===I[N.bucketInstanceId]&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const $=[new h.pointGeometry(L.x1,L.y1),new h.pointGeometry(L.x2,L.y1),new h.pointGeometry(L.x2,L.y2),new h.pointGeometry(L.x1,L.y2)];h.polygonIntersectsPolygon(l,$)&&(I[N.bucketInstanceId][N.featureIndex]=!0,void 0===D[N.bucketInstanceId]&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(n,l,f,y,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:v},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,f,y,v){const M=l?this.ignoredGrid:this.grid,C={bucketInstanceId:f,featureIndex:y,collisionGroupID:v};for(let I=0;I<n.length;I+=4)M.insertCircle(C,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,l,f,y,v,M,C){const I=[l,f,y,1];let D=!1;y||this.transform.pitch>0?(h.transformMat4$1(I,I,n),this.fogState&&v&&"globe"!==C.name&&(D=function(X,H,Y,K,Z,rt){const it=rt.calculateFogTileMatrix(Z),ot=[H,Y,K];return h.transformMat4(ot,ot,it),mo(X,ot,rt.pitch,rt._fov)}(this.fogState,l,f,y,v.toUnwrapped(),this.transform)>.9)):ha(I,I,n);const L=I[3];return{point:new h.pointGeometry((I[0]/L+1)/2*this.transform.width+vn,(-I[1]/L+1)/2*this.transform.height+vn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/L*.5,1.5),signedDistanceFromCamera:L,occluded:M&&I[2]>L||D}}isOffscreen(n,l,f,y){return f<vn||n>=this.screenRightBoundary||y<vn||l>this.screenBottomBoundary}isInsideGrid(n,l,f,y){return f>=0&&n<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=h.identity([]);return h.translate(n,n,[-100,-100,0]),n}}function ar(d,n,l){const f=n.createTileMatrix(d,d.worldSize,l.toUnwrapped());return h.multiply(new Float32Array(16),d.projMatrix,f)}function tl(d,n,l){if(n.projection.name===l.projection.name)return d.projMatrix;const f=l.clone();return f.setProjection(n.projection),ar(f,n.getProjection(),d)}function ua(d,n,l){return n.name===l.projection.name?d.projMatrix:ar(l,n,d)}class Zo{constructor(n,l,f,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):y&&f?1:0,this.placed=f}isHidden(){return 0===this.opacity&&!this.placed}}class $o{constructor(n,l,f,y,v,M=!1){this.text=new Zo(n?n.text:null,l,f,v),this.icon=new Zo(n?n.icon:null,l,y,v),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class As{constructor(n,l,f,y=!1){this.text=n,this.icon=l,this.skipFade=f,this.clipped=y}}class ac{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class An{constructor(n,l,f,y,v){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=v}}class Fi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[n]}}function el(d,n,l,f,y){const{horizontalAlign:v,verticalAlign:M}=h.getAnchorAlignment(d),C=-(v-.5)*n,I=-(M-.5)*l,D=h.evaluateVariableOffset(d,f);return new h.pointGeometry(C+D[0]*y,I+D[1]*y)}function Zr(d,n,l,f,y){const v=new h.pointGeometry(d,n);return l&&v._rotate(f?y:-y),v}class bn{constructor(n,l,f,y,v){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Qa(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Fi(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,f,y){const v=f.getBucket(l),M=f.latestFeatureIndex;if(!v||!M||l.id!==v.layerIds[0])return;const C=v.layers[0].layout,I=f.collisionBoxArray,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/h.EXTENT,N=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);const $=(X=f.tileID,H=v.getProjection(),Y=this.transform,H.name===this.projection?Y.calculateProjMatrix(X.toUnwrapped()):ar(Y,H,X));var X,H,Y;const K="map"===C.get("text-pitch-alignment"),Z="map"===C.get("text-rotation-alignment");l.compileFilter();const rt=l.dynamicFilter(),it=l.dynamicFilterNeedsFeature(),ot=this.transform.calculatePixelsToTileUnitsMatrix(f),pt=sc($,f.tileID.canonical,K,Z,this.transform,v.getProjection(),ot);let ut=null;if(K){const Ct=Cs($,f.tileID.canonical,K,Z,this.transform,v.getProjection(),ot);ut=h.multiply([],this.transform.labelPlaneMatrix,Ct)}let ft=null;rt&&f.latestFeatureIndex&&(ft={unwrappedTileID:N,dynamicFilter:rt,dynamicFilterNeedsFeature:it,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new An(v.bucketInstanceId,M,v.sourceLayerIndex,v.index,f.tileID);const wt={bucket:v,layout:C,posMatrix:$,textLabelPlaneMatrix:pt,labelToScreenMatrix:ut,clippingData:ft,scale:D,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const Ct of v.sortKeyRanges){const{sortKey:It,symbolInstanceStart:Jt,symbolInstanceEnd:Et}=Ct;n.push({sortKey:It,symbolInstanceStart:Jt,symbolInstanceEnd:Et,parameters:wt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:wt})}attemptAnchorPlacement(n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y,K,Z,rt){const{textOffset0:it,textOffset1:ot,crossTileID:pt}=$,ut=[it,ot],ft=el(n,f,y,ut,v),wt=this.collisionIndex.placeCollisionBox(H,v,l,Zr(ft.x,ft.y,M,C,this.transform.angle),N,I,D,L.predicate);if(K){const Ct=H.getSymbolInstanceIconSize(rt,this.transform.zoom,$.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(H,Ct,K,Zr(ft.x,ft.y,M,C,this.transform.angle),N,I,D,L.predicate).box.length)return}if(wt.box.length>0){let Ct;return this.prevPlacement&&this.prevPlacement.variableOffsets[pt]&&this.prevPlacement.placements[pt]&&this.prevPlacement.placements[pt].text&&(Ct=this.prevPlacement.variableOffsets[pt].anchor),this.variableOffsets[pt]={textOffset:ut,width:f,height:y,anchor:n,textScale:v,prevAnchor:Ct},this.markUsedJustification(H,n,$,Y),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Y,$),this.placedOrientations[pt]=Y),{shift:ft,placedGlyphBoxes:wt}}}placeLayerBucketPart(n,l,f,y){const{bucket:v,layout:M,posMatrix:C,textLabelPlaneMatrix:I,labelToScreenMatrix:D,clippingData:L,textPixelRatio:N,holdingForFade:$,collisionBoxArray:X,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:Y,collisionGroup:K}=n.parameters,Z=M.get("text-optional"),rt=M.get("icon-optional"),it=M.get("text-allow-overlap"),ot=M.get("icon-allow-overlap"),pt="map"===M.get("text-rotation-alignment"),ut="map"===M.get("text-pitch-alignment"),ft="none"!==M.get("icon-text-fit"),wt="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(v.projection);let Ct=it&&(ot||!v.hasIconData()||rt),It=ot&&(it||!v.hasTextData()||Z);!v.collisionArrays&&X&&v.deserializeCollisionBoxes(X),f&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,X);const Jt=(Et,Ft,Dt)=>{const{crossTileID:Zt,numVerticalGlyphVertices:At}=Et;if(L){const xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let si=null;if(L.dynamicFilterNeedsFeature){const ei=this.retainedQueryData[v.bucketInstanceId];si=L.featureIndex.loadFeature({featureIndex:Et.featureIndex,bucketIndex:ei.bucketIndex,sourceLayerIndex:ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(xi,si,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new h.pointGeometry(Et.tileAnchorX,Et.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Zt]=new As(!1,!1,!1,!0),void(l[Zt]=!0)}if(l[Zt])return;if($)return void(this.placements[Zt]=new As(!1,!1,!1));let vt=!1,kt=!1,Ut=!0,$t=!1,me=!1,Oe=null,he={box:null,offscreen:null,occluded:null},ae={box:null,offscreen:null,occluded:null},ge=null,je=null,be=null,ri=0,oi=0,wi=0;Dt.textFeatureIndex?ri=Dt.textFeatureIndex:Et.useRuntimeCollisionCircles&&(ri=Et.featureIndex),Dt.verticalTextFeatureIndex&&(oi=Dt.verticalTextFeatureIndex);const mi=xi=>{xi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const si=this.transform.elevation;(si||xi.elevation)&&(xi.elevation=si?si.getAtTileOffset(xi.tileID,xi.tileAnchorX,xi.tileAnchorY):0)},Vi=Dt.textBox;if(Vi){mi(Vi);const xi=ei=>{let Li=h.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ei&&this.prevPlacement){const pn=this.prevPlacement.placedOrientations[Zt];pn&&(this.placedOrientations[Zt]=pn,Li=pn,this.markUsedOrientation(v,Li,Et))}return Li},si=(ei,Li)=>{if(v.allowVerticalPlacement&&At>0&&Dt.verticalTextBox){for(const pn of v.writingModes)if(pn===h.WritingMode.vertical?(he=Li(),ae=he):he=ei(),he&&he.box&&he.box.length)break}else he=ei()};if(M.get("text-variable-anchor")){let ei=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zt]){const Ei=this.prevPlacement.variableOffsets[Zt];ei.indexOf(Ei.anchor)>0&&(ei=ei.filter(fn=>fn!==Ei.anchor),ei.unshift(Ei.anchor))}const Li=(Ei,fn,mn)=>{const Qr=v.getSymbolInstanceTextSize(H,Et,this.transform.zoom,Ft),ss=(Ei.x2-Ei.x1)*Qr+2*Ei.padding,Dn=(Ei.y2-Ei.y1)*Qr+2*Ei.padding,Kn=ft&&!ot?fn:null;Kn&&mi(Kn);let kr={box:[],offscreen:!1,occluded:!1};const cr=it?2*ei.length:ei.length;for(let to=0;to<cr;++to){const $s=this.attemptAnchorPlacement(ei[to%ei.length],Ei,ss,Dn,Qr,pt,ut,N,C,K,to>=ei.length,Et,Ft,v,mn,Kn,H,Y);if($s&&(kr=$s.placedGlyphBoxes,kr&&kr.box&&kr.box.length)){vt=!0,Oe=$s.shift;break}}return kr};si(()=>Li(Vi,Dt.iconBox,h.WritingMode.horizontal),()=>{const Ei=Dt.verticalTextBox;return Ei&&mi(Ei),v.allowVerticalPlacement&&!(he&&he.box&&he.box.length)&&At>0&&Ei?Li(Ei,Dt.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),he&&(vt=he.box,Ut=he.offscreen,$t=he.occluded);const pn=xi(he&&he.box);if(!vt&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[Zt];Ei&&(this.variableOffsets[Zt]=Ei,this.markUsedJustification(v,Ei.anchor,Et,pn))}}else{const ei=(Li,pn)=>{const Ei=v.getSymbolInstanceTextSize(H,Et,this.transform.zoom,Ft),fn=this.collisionIndex.placeCollisionBox(v,Ei,Li,new h.pointGeometry(0,0),it,N,C,K.predicate);return fn&&fn.box&&fn.box.length&&(this.markUsedOrientation(v,pn,Et),this.placedOrientations[Zt]=pn),fn};si(()=>ei(Vi,h.WritingMode.horizontal),()=>{const Li=Dt.verticalTextBox;return v.allowVerticalPlacement&&At>0&&Li?(mi(Li),ei(Li,h.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),xi(he&&he.box&&he.box.length)}}if(ge=he,vt=ge&&ge.box&&ge.box.length>0,Ut=ge&&ge.offscreen,$t=ge&&ge.occluded,Et.useRuntimeCollisionCircles){const xi=v.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex>=0?Et.centerJustifiedTextSymbolIndex:Et.verticalPlacedTextSymbolIndex),si=h.evaluateSizeForFeature(v.textSizeData,H,xi),ei=M.get("text-padding");je=this.collisionIndex.placeCollisionCircles(v,it,xi,v.lineVertexArray,v.glyphOffsetArray,si,C,I,D,f,ut,K.predicate,Et.collisionCircleDiameter*si/h.ONE_EM,ei,this.retainedQueryData[v.bucketInstanceId].tileID),vt=it||je.circles.length>0&&!je.collisionDetected,Ut=Ut&&je.offscreen,$t=je.occluded}if(Dt.iconFeatureIndex&&(wi=Dt.iconFeatureIndex),Dt.iconBox){const xi=si=>{mi(si);const ei=ft&&Oe?Zr(Oe.x,Oe.y,pt,ut,this.transform.angle):new h.pointGeometry(0,0),Li=v.getSymbolInstanceIconSize(Y,this.transform.zoom,Et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Li,si,ei,ot,N,C,K.predicate)};ae&&ae.box&&ae.box.length&&Dt.verticalIconBox?(be=xi(Dt.verticalIconBox),kt=be.box.length>0):(be=xi(Dt.iconBox),kt=be.box.length>0),Ut=Ut&&be.offscreen,me=be.occluded}const Pn=Z||0===Et.numHorizontalGlyphVertices&&0===At,Jn=rt||0===Et.numIconVertices;if(Pn||Jn?Jn?Pn||(kt=kt&&vt):vt=kt&&vt:kt=vt=kt&&vt,vt&&ge&&ge.box&&this.collisionIndex.insertCollisionBox(ge.box,M.get("text-ignore-placement"),v.bucketInstanceId,ae&&ae.box&&oi?oi:ri,K.ID),kt&&be&&this.collisionIndex.insertCollisionBox(be.box,M.get("icon-ignore-placement"),v.bucketInstanceId,wi,K.ID),je&&(vt&&this.collisionIndex.insertCollisionCircles(je.circles,M.get("text-ignore-placement"),v.bucketInstanceId,ri,K.ID),f)){const xi=v.bucketInstanceId;let si=this.collisionCircleArrays[xi];void 0===si&&(si=this.collisionCircleArrays[xi]=new ac);for(let ei=0;ei<je.circles.length;ei+=4)si.circles.push(je.circles[ei+0]),si.circles.push(je.circles[ei+1]),si.circles.push(je.circles[ei+2]),si.circles.push(je.collisionDetected?1:0)}const Ir="globe"!==v.projection.name;Ct=Ct&&(Ir||!$t),It=It&&(Ir||!me),this.placements[Zt]=new As(vt||Ct,kt||It,Ut||v.justReloaded),l[Zt]=!0};if(wt){const Et=v.getSortedSymbolIndexes(this.transform.angle);for(let Ft=Et.length-1;Ft>=0;--Ft){const Dt=Et[Ft];Jt(v.symbolInstances.get(Dt),Dt,v.collisionArrays[Dt])}}else for(let Et=n.symbolInstanceStart;Et<n.symbolInstanceEnd;Et++)Jt(v.symbolInstances.get(Et),Et,v.collisionArrays[Et]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){const Et=this.collisionCircleArrays[v.bucketInstanceId];h.invert(Et.invProjMatrix,C),Et.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(n,l,f,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:I,crossTileID:D}=f,L=h.getAnchorJustification(l),N=y===h.WritingMode.vertical?I:"left"===L?v:"center"===L?M:"right"===L?C:-1;v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=N>=0&&v!==N?0:D),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:D),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:D),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:D)}markUsedOrientation(n,l,f){const y=l===h.WritingMode.horizontal||l===h.WritingMode.horizontalOnly?l:0,v=l===h.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D}=f,L=n.text.placedSymbolArray;M>=0&&(L.get(M).placedOrientation=y),C>=0&&(L.get(C).placedOrientation=y),I>=0&&(L.get(I).placedOrientation=y),D>=0&&(L.get(D).placedOrientation=v)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(n):1,v=l?l.opacities:{},M=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const I in this.placements){const D=this.placements[I],L=v[I];L?(this.opacities[I]=new $o(L,y,D.text,D.icon,null,D.clipped),f=f||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[I]=new $o(null,y,D.text,D.icon,D.skipFade,D.clipped),f=f||D.text||D.icon)}for(const I in v){const D=v[I];if(!this.opacities[I]){const L=new $o(D,y,!1,!1);L.isHidden()||(this.opacities[I]=L,f=f||D.text.placed||D.icon.placed)}}for(const I in M)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=M[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);f?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const f={};for(const y of l){const v=y.getBucket(n);v&&y.latestFeatureIndex&&n.id===v.layerIds[0]&&this.updateBucketOpacities(v,f,y.collisionBoxArray)}}updateBucketOpacities(n,l,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,v=!!n.layers[0].dynamicFilter(),M=new $o(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),D=y.get("text-variable-anchor"),L="map"===y.get("text-rotation-alignment"),N="map"===y.get("text-pitch-alignment"),$="none"!==y.get("icon-text-fit"),X=new $o(null,0,C&&(I||!n.hasIconData()||y.get("icon-optional")),I&&(C||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const H=(K,Z,rt)=>{for(let it=0;it<Z/4;it++)K.opacityVertexArray.emplaceBack(rt)};let Y=0;for(let K=0;K<n.symbolInstances.length;K++){const Z=n.symbolInstances.get(K),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:it,crossTileID:ot,numIconVertices:pt}=Z;let ut=this.opacities[ot];l[ot]?ut=M:ut||(ut=X,this.opacities[ot]=ut),l[ot]=!0;const ft=rt>0||it>0,wt=pt>0,Ct=this.placedOrientations[ot],It=Ct===h.WritingMode.vertical,Jt=Ct===h.WritingMode.horizontal||Ct===h.WritingMode.horizontalOnly;if(!ft&&!wt||ut.isHidden()||Y++,ft){const Et=ki(ut.text);H(n.text,rt,It?Is:Et),H(n.text,it,Jt?Is:Et);const Ft=ut.text.isHidden(),{leftJustifiedTextSymbolIndex:Dt,centerJustifiedTextSymbolIndex:Zt,rightJustifiedTextSymbolIndex:At,verticalPlacedTextSymbolIndex:vt}=Z,kt=n.text.placedSymbolArray,Ut=Ft||It?1:0;Dt>=0&&(kt.get(Dt).hidden=Ut),Zt>=0&&(kt.get(Zt).hidden=Ut),At>=0&&(kt.get(At).hidden=Ut),vt>=0&&(kt.get(vt).hidden=Ft||Jt?1:0);const $t=this.variableOffsets[ot];$t&&this.markUsedJustification(n,$t.anchor,Z,Ct);const me=this.placedOrientations[ot];me&&(this.markUsedJustification(n,"left",Z,me),this.markUsedOrientation(n,me,Z))}if(wt){const Et=ki(ut.icon),{placedIconSymbolIndex:Ft,verticalPlacedIconSymbolIndex:Dt}=Z,Zt=n.icon.placedSymbolArray,At=ut.icon.isHidden()?1:0;Ft>=0&&(H(n.icon,pt,It?Is:Et),Zt.get(Ft).hidden=At),Dt>=0&&(H(n.icon,Z.numVerticalIconVertices,Jt?Is:Et),Zt.get(Dt).hidden=At)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Et=n.collisionArrays[K];if(Et){let Ft=new h.pointGeometry(0,0),Dt=!0;if(Et.textBox||Et.verticalTextBox){if(D){const At=this.variableOffsets[ot];At?(Ft=el(At.anchor,At.width,At.height,At.textOffset,At.textScale),L&&Ft._rotate(N?this.transform.angle:-this.transform.angle)):Dt=!1}v&&(Dt=!ut.clipped),Et.textBox&&wn(n.textCollisionBox.collisionVertexArray,ut.text.placed,!Dt||It,Ft.x,Ft.y),Et.verticalTextBox&&wn(n.textCollisionBox.collisionVertexArray,ut.text.placed,!Dt||Jt,Ft.x,Ft.y)}const Zt=Dt&&Boolean(!Jt&&Et.verticalIconBox);Et.iconBox&&wn(n.iconCollisionBox.collisionVertexArray,ut.icon.placed,Zt,$?Ft.x:0,$?Ft.y:0),Et.verticalIconBox&&wn(n.iconCollisionBox.collisionVertexArray,ut.icon.placed,!Zt,$?Ft.x:0,$?Ft.y:0)}}}if(n.fullyClipped=0===Y,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=K.invProjMatrix,n.placementViewportMatrix=K.viewportMatrix,n.collisionCircleArray=K.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function wn(d,n,l,f,y){d.emplaceBack(n?1:0,l?1:0,f||0,y||0),d.emplaceBack(n?1:0,l?1:0,f||0,y||0),d.emplaceBack(n?1:0,l?1:0,f||0,y||0),d.emplaceBack(n?1:0,l?1:0,f||0,y||0)}const da=Math.pow(2,25),il=Math.pow(2,24),Ii=Math.pow(2,17),qo=Math.pow(2,16),Wo=Math.pow(2,9),Ho=Math.pow(2,8),on=Math.pow(2,1);function ki(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const n=d.placed?1:0,l=Math.floor(127*d.opacity);return l*da+n*il+l*Ii+n*qo+l*Wo+n*Ho+l*on+n}const Is=0;class Hn{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,l,f,y,v){const M=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(M,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<M.length;){const C=M[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,f,0===C.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class pa{constructor(n,l,f,y,v,M,C,I){this.placement=new bn(n,v,M,C,I),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,l,f){const y=h.exported.now(),v=()=>{const M=h.exported.now()-y;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=l[n[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=C)&&(!M.maxzoom||M.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Hn(M)),this._inProgressLayer.continuePlacement(f[M.source],this.placement,this._showCollisionBoxes,M,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Tr=512/h.EXTENT/2;class Ch{constructor(n,l,f){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let y=0;y<l.length;y++){const v=l.get(y),M=v.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,n)})}}getScaledCoordinates(n,l){const f=Tr/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*h.EXTENT+n.tileAnchorX)*f),y:Math.floor((l.canonical.y*h.EXTENT+n.tileAnchorY)*f)}}findMatches(n,l,f){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<n.length;v++){const M=n.get(v);if(M.crossTileID)continue;const C=this.indexedSymbolInstances[M.key];if(!C)continue;const I=this.getScaledCoordinates(M,l);for(const D of C)if(Math.abs(D.coord.x-I.x)<=y&&Math.abs(D.coord.y-I.y)<=y&&!f[D.crossTileID]){f[D.crossTileID]=!0,M.crossTileID=D.crossTileID;break}}}}class fa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(0!==l)for(const f in this.indexes){const y=this.indexes[f],v={};for(const M in y){const C=y[M];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),v[C.tileID.key]=C}this.indexes[f]=v}this.lng=n}addBucket(n,l,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const v in this.indexes){const M=this.indexes[v];if(Number(v)>n.overscaledZ)for(const C in M){const I=M[C];I.tileID.isChildOf(n)&&I.findMatches(l.symbolInstances,n,y)}else{const C=M[n.scaledTo(Number(v)).key];C&&C.findMatches(l.symbolInstances,n,y)}}for(let v=0;v<l.symbolInstances.length;v++){const M=l.symbolInstances.get(v);M.crossTileID||(M.crossTileID=f.generate(),y[M.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ch(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const f in l.indexedSymbolInstances)for(const y of l.indexedSymbolInstances[f])delete this.usedCrossTileIDs[n][y.crossTileID]}removeStaleBuckets(n){let l=!1;for(const f in this.indexes){const y=this.indexes[f];for(const v in y)n[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[v]),delete y[v],l=!0)}return l}}class ks{constructor(){this.layerIndexes={},this.crossTileIDs=new fa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,f,y){let v=this.layerIndexes[n.id];void 0===v&&(v=this.layerIndexes[n.id]=new Xo);let M=!1;const C={};"globe"!==y.name&&v.handleWrapJump(f);for(const I of l){const D=I.getBucket(n);D&&n.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,D,this.crossTileIDs)&&(M=!0),C[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(M=!0),M}pruneUnusedLayers(n){const l={};n.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const vo=(d,n)=>h.emitValidationErrors(d,n&&n.filter(l=>"source.canvas"!==l.identifier)),$r=h.pick(Ee,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),bo=h.pick(Ee,["setCenter","setZoom","setBearing","setPitch"]),nl={version:8,layers:[],sources:{}},In={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Xn extends h.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new pr(xe(),this),this.imageManager=new ra,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(n._requestManager,l.localFontFamily?h.LocalGlyphMode.all:l.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new ks,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const f=this;this._rtlTextPluginCallback=Xn.registerForPluginStateChange(y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,M)=>{if(h.triggerPluginCompletionEvent(v),M&&M.every(C=>C))for(const C in f._sourceCaches){const I=f._sourceCaches[C],D=I.getSource().type;"vector"!==D&&"geojson"!==D||I.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const M in this._layers){const C=this._layers[M];C.source===v.id&&this._validateLayer(C)}})}loadURL(n,l={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const f="boolean"==typeof l.validate?l.validate:!h.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const y=this.map._requestManager.transformRequest(n,h.ResourceType.Style);this._request=h.getJSON(y,(v,M)=>{this._request=null,v?this.fire(new h.ErrorEvent(v)):M&&this._load(M,f)})}loadJSON(n,l={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(n,!1!==l.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(nl,!1)}_updateLayerCount(n,l){const f=l?1:-1;n.is3D()&&(this._num3DLayers+=f),"circle"===n.type&&(this._numCircleLayers+=f),"symbol"===n.type&&(this._numSymbolLayers+=f)}_load(n,l){if(l&&vo(this,h.validateStyle(n)))return;this._loaded=!0,this.stylesheet=h.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const f=ti(this.stylesheet.layers);this._order=f.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of f)y=h.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new oc(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(l,f,y){let v,M,C;const I=h.exported.devicePixelRatio>1?"@2x":"";let D=h.getJSON(f.transformRequest(f.normalizeSpriteURL(l,I,".json"),h.ResourceType.SpriteJSON),($,X)=>{D=null,C||(C=$,v=X,N())}),L=h.getImage(f.transformRequest(f.normalizeSpriteURL(l,I,".png"),h.ResourceType.SpriteImage),($,X)=>{L=null,C||(C=$,M=X,N())});function N(){if(C)y(C);else if(v&&M){const $=h.exported.getImageData(M),X={};for(const H in v){const{width:Y,height:K,x:Z,y:rt,sdf:it,pixelRatio:ot,stretchX:pt,stretchY:ut,content:ft}=v[H],wt=new h.RGBAImage({width:Y,height:K});h.RGBAImage.copy($,wt,{x:Z,y:rt},{x:0,y:0},{width:Y,height:K}),X[H]={data:wt,pixelRatio:ot,sdf:it,stretchX:pt,stretchY:ut,content:ft}}y(null,X)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(l,f)=>{if(this._spriteRequest=null,l)this.fire(new h.ErrorEvent(l));else if(f)for(const y in f)this.imageManager.addImage(y,f[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const f=n.sourceLayer;f&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(f))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const f of n){const y=this._layers[f];"custom"!==y.type&&l.push(y.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&("function"==typeof n.isLayerDraped?n.isLayerDraped():In[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const M in this._updatedSources){const C=this._updatedSources[M];"reload"===C?this._reloadSource(M):"clear"===C&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const f={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];f[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(n,this._availableImages),!v.isHidden(n.zoom)){const C=this._getLayerSourceCache(v);C&&(C.used=!0)}const M=this.map.painter;if(M){const C=v.getProgramIds();if(!C)continue;const I=v.getProgramConfiguration(n.zoom);for(const D of C)M.useProgram(D,I)}}for(const y in f){const v=this._sourceCaches[y];f[y]!==v.used&&v.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),vo(this,h.validateStyle(n)))return!1;(n=h.clone$1(n)).layers=ti(n.layers);const l=function(y,v){if(!y)return[{command:Ee.setStyle,args:[v]}];let M=[];try{if(!Xt(y.version,v.version))return[{command:Ee.setStyle,args:[v]}];Xt(y.center,v.center)||M.push({command:Ee.setCenter,args:[v.center]}),Xt(y.zoom,v.zoom)||M.push({command:Ee.setZoom,args:[v.zoom]}),Xt(y.bearing,v.bearing)||M.push({command:Ee.setBearing,args:[v.bearing]}),Xt(y.pitch,v.pitch)||M.push({command:Ee.setPitch,args:[v.pitch]}),Xt(y.sprite,v.sprite)||M.push({command:Ee.setSprite,args:[v.sprite]}),Xt(y.glyphs,v.glyphs)||M.push({command:Ee.setGlyphs,args:[v.glyphs]}),Xt(y.transition,v.transition)||M.push({command:Ee.setTransition,args:[v.transition]}),Xt(y.light,v.light)||M.push({command:Ee.setLight,args:[v.light]}),Xt(y.fog,v.fog)||M.push({command:Ee.setFog,args:[v.fog]}),Xt(y.projection,v.projection)||M.push({command:Ee.setProjection,args:[v.projection]});const C={},I=[];!function(N,$,X,H){let Y;for(Y in $=$||{},N=N||{})N.hasOwnProperty(Y)&&($.hasOwnProperty(Y)||fi(Y,X,H));for(Y in $)$.hasOwnProperty(Y)&&(N.hasOwnProperty(Y)?Xt(N[Y],$[Y])||("geojson"===N[Y].type&&"geojson"===$[Y].type&&Vn(N,$,Y)?X.push({command:Ee.setGeoJSONSourceData,args:[Y,$[Y].data]}):Xi(Y,$,X,H)):ai(Y,$,X))}(y.sources,v.sources,I,C);const D=[];y.layers&&y.layers.forEach(N=>{N.source&&C[N.source]?M.push({command:Ee.removeLayer,args:[N.id]}):D.push(N)});let L=y.terrain;L&&C[L.source]&&(M.push({command:Ee.setTerrain,args:[void 0]}),L=void 0),M=M.concat(I),Xt(L,v.terrain)||M.push({command:Ee.setTerrain,args:[v.terrain]}),function(N,$,X){$=$||[];const H=(N=N||[]).map(Gr),Y=$.map(Gr),K=N.reduce(bi,{}),Z=$.reduce(bi,{}),rt=H.slice(),it=Object.create(null);let ot,pt,ut,ft,wt,Ct,It;for(ot=0,pt=0;ot<H.length;ot++)ut=H[ot],Z.hasOwnProperty(ut)?pt++:(X.push({command:Ee.removeLayer,args:[ut]}),rt.splice(rt.indexOf(ut,pt),1));for(ot=0,pt=0;ot<Y.length;ot++)ut=Y[Y.length-1-ot],rt[rt.length-1-ot]!==ut&&(K.hasOwnProperty(ut)?(X.push({command:Ee.removeLayer,args:[ut]}),rt.splice(rt.lastIndexOf(ut,rt.length-pt),1)):pt++,Ct=rt[rt.length-ot],X.push({command:Ee.addLayer,args:[Z[ut],Ct]}),rt.splice(rt.length-ot,0,ut),it[ut]=!0);for(ot=0;ot<Y.length;ot++)if(ut=Y[ot],ft=K[ut],wt=Z[ut],!it[ut]&&!Xt(ft,wt))if(Xt(ft.source,wt.source)&&Xt(ft["source-layer"],wt["source-layer"])&&Xt(ft.type,wt.type)){for(It in zt(ft.layout,wt.layout,X,ut,null,Ee.setLayoutProperty),zt(ft.paint,wt.paint,X,ut,null,Ee.setPaintProperty),Xt(ft.filter,wt.filter)||X.push({command:Ee.setFilter,args:[ut,wt.filter]}),Xt(ft.minzoom,wt.minzoom)&&Xt(ft.maxzoom,wt.maxzoom)||X.push({command:Ee.setLayerZoomRange,args:[ut,wt.minzoom,wt.maxzoom]}),ft)ft.hasOwnProperty(It)&&"layout"!==It&&"paint"!==It&&"filter"!==It&&"metadata"!==It&&"minzoom"!==It&&"maxzoom"!==It&&(0===It.indexOf("paint.")?zt(ft[It],wt[It],X,ut,It.slice(6),Ee.setPaintProperty):Xt(ft[It],wt[It])||X.push({command:Ee.setLayerProperty,args:[ut,It,wt[It]]}));for(It in wt)wt.hasOwnProperty(It)&&!ft.hasOwnProperty(It)&&"layout"!==It&&"paint"!==It&&"filter"!==It&&"metadata"!==It&&"minzoom"!==It&&"maxzoom"!==It&&(0===It.indexOf("paint.")?zt(ft[It],wt[It],X,ut,It.slice(6),Ee.setPaintProperty):Xt(ft[It],wt[It])||X.push({command:Ee.setLayerProperty,args:[ut,It,wt[It]]}))}else X.push({command:Ee.removeLayer,args:[ut]}),Ct=rt[rt.lastIndexOf(ut)+1],X.push({command:Ee.addLayer,args:[wt,Ct]})}(D,v.layers,M)}catch(C){console.warn("Unable to compute style diff:",C),M=[{command:Ee.setStyle,args:[v]}]}return M}(this.serialize(),n).filter(y=>!(y.command in bo));if(0===l.length)return!1;const f=l.filter(y=>!(y.command in $r));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);return l.forEach(y=>{"setTransition"!==y.command&&"setProjection"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,l){return this.getImage(n)?this.fire(new h.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new h.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,f={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(h.validateSource,`sources.${n}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=bt(n,l,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n}));const v=M=>{const C=(M?"symbol:":"other:")+n,I=this._sourceCaches[C]=new h.SourceCache(C,y,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[n]=I,I.style=this,I.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(!l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new h.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new h.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(n);for(const y of f)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}_getSources(){const n=[];for(const l in this._otherSourceCaches){const f=this._getSourceCache(l);f&&n.push(f.getSource())}return n}addLayer(n,l,f={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if("custom"===n.type){if(vo(this,h.validateCustomStyleLayer(n)))return;v=h.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(y,n.source),n=h.clone$1(n),n=h.extend(n,{source:y})),this._validate(h.validateLayer,`layers.${y}`,n,{arrayIndex:-1},f))return;v=h.createStyleLayer(n),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const M=l?this._order.indexOf(l):this._order.length;if(l&&-1===M)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(M,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const C=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&C&&"custom"!==v.type){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const f=this._order.indexOf(n);this._order.splice(f,1);const y=l?this._order.indexOf(l):this._order.length;l&&-1===y?this.fire(new h.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,f){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===l&&y.maxzoom===f||(null!=l&&(y.minzoom=l),null!=f&&(y.maxzoom=f),this._updateLayer(y)):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,f={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!Xt(y.filter,l))return null==l?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(h.validateFilter,`layers.${y.id}.filter`,l,{layerType:y.type},f)||(y.filter=h.clone$1(l),this._updateLayer(y)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const l=this.getLayer(n);return l&&h.clone$1(l.filter)}setLayoutProperty(n,l,f,y={}){this._checkLoaded();const v=this.getLayer(n);v?Xt(v.getLayoutProperty(l),f)||(v.setLayoutProperty(l,f,y),this._updateLayer(v)):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const f=this.getLayer(n);if(f)return f.getLayoutProperty(l);this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,f,y={}){this._checkLoaded();const v=this.getLayer(n);v?Xt(v.getPaintProperty(l),f)||(v.setPaintProperty(l,f,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){const f=this.getLayer(n);return f&&f.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const f=n.source,y=n.sourceLayer,v=this.getSource(f);if(!v)return void this.fire(new h.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const M=v.type;if("geojson"===M&&y)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!y)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(f);for(const I of C)I.setFeatureState(y,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const f=n.source,y=this.getSource(f);if(!y)return void this.fire(new h.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const v=y.type,M="vector"===v?n.sourceLayer:void 0;if("vector"===v&&!M)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(f);for(const I of C)I.removeFeatureState(M,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,f=n.sourceLayer,y=this.getSource(l);if(y){if("vector"!==y.type||f)return void 0===n.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(f,n.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const f=this._sourceCaches[l].getSource();n[f.id]||(n[f.id]=f.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=M=>"fill-extrusion"===this._layers[M].type,f={},y=[];for(let M=this._order.length-1;M>=0;M--){const C=this._order[M];if(l(C)){f[C]=M;for(const I of n){const D=I[C];if(D)for(const L of D)y.push(L)}}}y.sort((M,C)=>C.intersectionZ-M.intersectionZ);const v=[];for(let M=this._order.length-1;M>=0;M--){const C=this._order[M];if(l(C))for(let I=y.length-1;I>=0;I--){const D=y[I].feature;if(f[D.layer.id]<M)break;v.push(D),y.pop()}else for(const I of n){const D=I[C];if(D)for(const L of D)v.push(L.feature)}}return v}queryRenderedFeatures(n,l,f){l&&l.filter&&this._validate(h.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const y={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of l.layers){const D=this._layers[I];if(!D)return this.fire(new h.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y[D.source]=!0}}const v=[];l.availableImages=this._availableImages;const M=l&&l.layers?l.layers.some(I=>{const D=this.getLayer(I);return D&&D.is3D()}):this.has3DLayers(),C=Fo.createFromScreenPoints(n,f);for(const I in this._sourceCaches){const D=this._sourceCaches[I].getSource().id;l.layers&&!y[D]||v.push(Tt(this._sourceCaches[I],this._layers,this._serializedLayers,C,l,f,M,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(I,D,L,N,$,X,H){const Y={},K=X.queryRenderedSymbols(N),Z=[];for(const rt of Object.keys(K).map(Number))Z.push(H[rt]);Z.sort(se);for(const rt of Z){const it=rt.featureIndex.lookupSymbolFeatures(K[rt.bucketInstanceId],D,rt.bucketIndex,rt.sourceLayerIndex,$.filter,$.layers,$.availableImages,I);for(const ot in it){const pt=Y[ot]=Y[ot]||[],ut=it[ot];ut.sort((ft,wt)=>{const Ct=rt.featureSortOrder;if(Ct){const It=Ct.indexOf(ft.featureIndex);return Ct.indexOf(wt.featureIndex)-It}return wt.featureIndex-ft.featureIndex});for(const ft of ut)pt.push(ft)}}for(const rt in Y)Y[rt].forEach(it=>{const ot=it.feature,pt=L(I[rt]).getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=pt});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(n,l){l&&l.filter&&this._validate(h.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const f=this._getSourceCaches(n);let y=[];for(const v of f)y=y.concat(jt(v,l));return y}addSourceType(n,l,f){return Xn.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(Xn.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const f=this.light.getLight();let y=!1;for(const M in n)if(!Xt(n[M],f[M])){y=!0;break}if(!y)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof n.source){const f="terrain-dem-src";this.addSource(f,n.source),n=h.clone$1(n),n=h.extend(n,{source:f})}if(this._validate(h.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(n,l);else{const f=this.terrain,y=f.get();for(const v of Object.keys(h.spec.terrain))!n.hasOwnProperty(v)&&h.spec.terrain[v].default&&(n[v]=h.spec.terrain[v].default);for(const v in n)if(!Xt(n[v],y[v])){f.set(n),this.stylesheet.terrain=n;const M=this._setTransitionParameters({duration:0});f.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new bs(n,this.map.transform);this.stylesheet.fog=n;const f=this._setTransitionParameters({duration:0});l.updateTransitions(f)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,f=l.get();0===Object.keys(n).length&&l.set(n);for(const y in n)if(!Xt(n[y],f[y])){l.set(n),this.stylesheet.fog=n;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:h.exported.now(),transition:h.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(f=>this.isLayerDraped(this._layers[f])),l=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const f=this.terrain=new Fr(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});f.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];"symbol"===l.type&&this._updateLayer(l)}}_validate(n,l,f,y,v={}){return(!v||!1!==v.validate)&&vo(this,n.call(h.validateStyle,h.extend({key:l,style:this.serialize(),value:f,styleSpec:h.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const f of l)f.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const f of l)f.resume(),f.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,f,y,v=!1){let M=!1,C=!1;const I={};for(const D of this._order){const L=this._layers[D];if("symbol"!==L.type)continue;if(!I[L.source]){const $=this._getLayerSourceCache(L);if(!$)continue;I[L.source]=$.getRenderableIds(!0).map(X=>$.getTileByID(X)).sort((X,H)=>H.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(H.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(L,I[L.source],n.center.lng,n.projection);M=M||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===f,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),n.zoom))&&(this.pauseablePlacement=new pa(n,this._order,v,l,f,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),C=!0),M&&this.pauseablePlacement.placement.setStale()),C||M)for(const D of this._order){const L=this._layers[D];"symbol"===L.type&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};y(this._otherSourceCaches[l.source]),y(this._symbolSourceCaches[l.source])}getGlyphs(n,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(n,l,f){return h.makeRequest(l,f)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this._getSourceCaches(n);return 0===l.length?(this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):l.every(f=>f.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xn.getSourceType=function(d){return xt[d]},Xn.setSourceType=function(d,n){xt[d]=n},Xn.registerForPluginStateChange=h.registerForPluginStateChange;var ma="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Sh="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zs="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",rl="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ah="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let lc={},cc={};const wo=[];lr(ma,wo),lr(zs,wo),lr(rl,wo),lr(Ah,wo),lc=ni("",zs),cc=ni(Ah,rl);const hc=ni("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Er=ma,tn="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Gi={background:ni("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ni("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ni("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ni("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ni("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ni("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ni("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ni("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ni("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ni("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ni("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ni("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ni("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ni("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ni("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ni("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ni("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ni("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sh),skyboxGradient:ni("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sh),skyboxCapture:ni("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ni("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ni("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function lr(d,n){const l=d.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let f of l)if(f=f.trim(),"#"===f[0]&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=f.split(" ");for(const v of y)n.includes(v)||n.push(v)}}function ni(d,n){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},v=[...wo];return lr(d,v),lr(n,v),{fragmentSource:d=d.replace(l,(M,C,I,D,L)=>(y[L]=!0,"define"===C?`\n#ifndef HAS_UNIFORM_u_${L}\nvarying ${I} ${D} ${L};\n#else\nuniform ${I} ${D} u_${L};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${L}\n    ${I} ${D} ${L} = u_${L};\n#endif\n`)),vertexSource:n=n.replace(l,(M,C,I,D,L)=>{const N="float"===D?"vec2":"vec4",$=L.match(/color/)?"color":N;return y[L]?"define"===C?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${I} ${N} a_${L};\nvarying ${I} ${D} ${L};\n#else\nuniform ${I} ${D} u_${L};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = a_${L};\n#else\n    ${I} ${D} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${L} = unpack_mix_${$}(a_${L}, u_${L}_t);\n#else\n    ${I} ${D} ${L} = u_${L};\n#endif\n`:"define"===C?`\n#ifndef HAS_UNIFORM_u_${L}\nuniform lowp float u_${L}_t;\nattribute ${I} ${N} a_${L};\n#else\nuniform ${I} ${D} u_${L};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${L}\n    ${I} ${D} ${L} = a_${L};\n#else\n    ${I} ${D} ${L} = u_${L};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${L}\n    ${I} ${D} ${L} = unpack_mix_${$}(a_${L}, u_${L}_t);\n#else\n    ${I} ${D} ${L} = u_${L};\n#endif\n`}),staticAttributes:f,usedDefines:v}}class Yn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,f,y,v,M,C){this.context=n;let I=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!I&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(I=!0);let D=this.boundDynamicVertexBuffers.length!==C.length;for(let L=0;!D&&L<C.length;L++)this.boundDynamicVertexBuffers[L]!==C[L]&&(D=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||I||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==M)this.freshBind(l,f,y,v,M,C);else{n.bindVertexArrayOES.set(this.vao);for(const L of C)L&&L.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(n,l,f,y,v,M){let C;const I=n.numAttributes,D=this.context,L=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=M;else{C=D.currentNumAttributes||0;for(let N=I;N<C;N++)L.disableVertexAttribArray(N)}l.enableAttributes(L,n),l.bind(),l.setVertexAttribPointers(L,n,v);for(const N of f)N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,v);for(const N of M)N&&(N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,v));y&&y.bind(),D.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ga(d,n){const l=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new h.MercatorCoordinate(0,f/l).toLngLat().lat,new h.MercatorCoordinate(0,(f+1)/l).toLngLat().lat]}function Mr(d,n,l,f,y,v,M){const C=d.context,I=C.gl,D=l.fbo;if(!D)return;d.prepareDrawTile();const L=d.useProgram("hillshade");C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get());const N=((Y,K,Z,rt)=>{const it=Z.paint.get("hillshade-shadow-color"),ot=Z.paint.get("hillshade-highlight-color"),pt=Z.paint.get("hillshade-accent-color");let ut=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Z.paint.get("hillshade-illumination-anchor")&&(ut-=Y.transform.angle);const ft=!Y.options.moving;return{u_matrix:rt||Y.transform.calculateProjMatrix(K.tileID.toUnwrapped(),ft),u_image:0,u_latrange:ga(0,K.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ut],u_shadow:it,u_highlight:ot,u_accent:pt}})(d,l,f,d.terrain?n.projMatrix:null);d.prepareDrawProgram(C,L,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:X,tileBoundsSegments:H}=d.getTileBoundsBuffers(l);L.draw(C,I.TRIANGLES,y,v,M,h.CullFaceMode.disabled,N,f.id,$,X,H)}function Ps(d,n,l){if(!n.needsDEMTextureUpload)return;const f=d.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(l.stride);const v=l.getPixels();n.demTexture?n.demTexture.update(v,{premultiply:!1}):n.demTexture=new h.Texture(f,v,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ol(d,n,l,f,y,v){const M=d.context,C=M.gl;if(!n.dem)return;const I=n.dem;if(M.activeTexture.set(C.TEXTURE1),Ps(d,n,I),!n.demTexture)return;n.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const D=I.dim;M.activeTexture.set(C.TEXTURE0);let L=n.fbo;if(!L){const H=new h.Texture(M,{width:D,height:D,data:null},C.RGBA);H.bind(C.LINEAR,C.CLAMP_TO_EDGE),L=n.fbo=M.createFramebuffer(D,D,!0),L.colorAttachment.set(H.texture)}M.bindFramebuffer.set(L.framebuffer),M.viewport.set([0,0,D,D]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:X}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(M,C.TRIANGLES,f,y,v,h.CullFaceMode.disabled,((H,Y)=>{const K=Y.stride,Z=h.create();return h.ortho(Z,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(Z,Z,[0,-h.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[K,K],u_zoom:H.overscaledZ,u_unpack:Y.unpackVector}})(n.tileID,I),l.id,N,$,X),n.needsHillshadePrepare=!1}const Ds=d=>({u_matrix:new h.UniformMatrix4f(d),u_image0:new h.Uniform1i(d),u_skirt_height:new h.Uniform1f(d)}),sl=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),al=(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:M,u_frustum_tr:C,u_frustum_br:I,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:N,u_viewport:$,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:X});function uc(d,n){return null!=d&&null!=n&&!(!d.hasData()||!n.hasData())&&null!=d.demTexture&&null!=n.demTexture&&d.tileID.key!==n.tileID.key}const To=new class{constructor(){this.operations={}}newMorphing(d,n,l,f,y){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:f,phase:0,duration:y,from:n,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const l=this.operations[n];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Eo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ll(d){return 6*Math.pow(1.5,22-d)}function dc(d,n){const l=1<<d.z;return!n&&(0===d.x||d.x===l-1)||0===d.y||d.y===l-1}const He=d=>({u_matrix:d});function Ls(d,n,l,f,y){if(y>0){const v=h.exported.now(),M=(v-d.timeAdded)/y,C=n?(v-n.timeAdded)/y:-1,I=l.getSource(),D=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-D)>Math.abs(d.tileID.overscaledZ-D),N=L&&d.refreshedUponExpiration?1:h.clamp(L?M:1-C,0,1);return d.refreshedUponExpiration&&M>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Ih extends h.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new pr(xe(),null),y=bt("mock-dem",l,f,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class kh extends h.SourceCache{constructor(n){const l=bt("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new pr(xe(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,f){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,M)=>{if(v[M.key]="",!this._tiles[M.key]){const C=new h.Tile(M,this._source.tileSize*M.overscaleFactor(),n.tileZoom);C.state="loaded",this._tiles[M.key]=C}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(n){const l=this.proxyCachedFBO[n];if(void 0!==l){const f=Object.values(l);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cl extends h.OverscaledTileID{constructor(n,l,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=f}}class hl extends h.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,v]=function(I){const D=new h.StructArrayLayout2i4,L=new h.StructArrayLayout3ui6,N=131;D.reserve(17161),L.reserve(33800);const $=h.EXTENT/128,X=h.EXTENT+$/2,H=X+$;for(let K=-$;K<H;K+=$)for(let Z=-$;Z<H;Z+=$){const rt=Z<0||Z>X||K<0||K>X?24575:0,it=h.clamp(Math.round(Z),0,h.EXTENT),ot=h.clamp(Math.round(K),0,h.EXTENT);D.emplaceBack(it+rt,ot)}const Y=(K,Z)=>{const rt=Z*N+K;L.emplaceBack(rt+1,rt,rt+N),L.emplaceBack(rt+N,rt+N+1,rt+1)};for(let K=1;K<129;K++)for(let Z=1;Z<129;Z++)Y(Z,K);return[0,129].forEach(K=>{for(let Z=0;Z<130;Z++)Y(Z,K),Y(K,Z)}),[D,L,32768]}(),M=n.context;this.gridBuffer=M.createVertexBuffer(f,h.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(y),this.gridSegments=h.SegmentVector.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kh(l.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,h.EXTENT,0,h.EXTENT,0,1);const C=M.gl;this._overlapStencilMode=new h.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ih(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,f){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(l,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=0===f._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(f.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(I=>{const D=l.getTileByID(I).tileID;return D.projMatrix=f.calculateProjMatrix(D.toUnwrapped()),D});(function(I,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),N=new h.pointGeometry(L.x,L.y);I.sort(($,X)=>{if(X.overscaledZ-$.overscaledZ)return X.overscaledZ-$.overscaledZ;const H=new h.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),Y=new h.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),K=N.mult(1<<$.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(H)-K.distSqr(Y)})})(y,this.painter),this._previousZoom=f.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const I in M){const D=M[I];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,n[I],v),D.usedForTerrain))continue;const L=n[I];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[l.id]=y.map(I=>new cl(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const C={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const D=this.terrainTileForTile[I.key];if(!D)continue;const L=D.tileID.key;L in C||(this._visibleDemTiles.push(D),C[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const f=this._findTileCoveringTileID(l,this.sourceCache);f&&(this.terrainTileForTile[l.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),Ps(this.painter,y,v))}}_prepareDemTileUniforms(n,l,f,y){if(!l||null==l.demTexture)return!1;const v=n.tileID.canonical,M=Math.pow(2,l.tileID.canonical.z-v.z),C=y||"";return f[`u_dem_tl${C}`]=[v.x*M%1,v.y*M%1],f[`u_dem_scale${C}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const f=new h.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new h.Texture(n,f,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((f,y)=>{if(!y.dem)return f;const v=y.dem.tree.minimums[0];return v>0&&n++,f+v},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const f=this._getLoadedAreaMinimum(),y=new h.RGBAImage({width:1,height:1},new Uint8Array(h.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new h.Texture(n,y,l.RGBA,{premultiply:!1}),v}setupElevationDraw(n,l,f){const y=this.painter.context,v=y.gl,M=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let I=null,D=null,L=1;if(f&&f.morphing&&this._useVertexMorphing){const N=f.morphing.srcDemTile,$=f.morphing.dstDemTile;L=f.morphing.phase,N&&$&&(this._prepareDemTileUniforms(n,N,M,"_prev")&&(D=N),this._prepareDemTileUniforms(n,$,M)&&(I=$))}if(D&&I?(y.activeTexture.set(v.TEXTURE2),I.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),D.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),M.u_dem_lerp=L):(I=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(n,I,M)?I.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),y.activeTexture.set(v.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&I){const N=(1<<I.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=N}if(f&&f.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),l.setTerrainUniformValues(y,M),"globe"===this.painter.transform.projection.name){const N=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,N)}}globeUniformValues(n,l,f){const y=n.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,h.EXTENT,0),u_tile_br_up:y.upVector(l,h.EXTENT,h.EXTENT),u_tile_bl_up:y.upVector(l,0,h.EXTENT),u_tile_up_scale:f?h.globeMetersToEcef(1):y.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,f=this.painter.context;0!==n.length&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,M,C,I){if("globe"===y.transform.projection.name)!function(D,L,N,$,X){const H=D.context,Y=H.gl;let K,Z;const rt=D.options.showTerrainWireframe?2:0,it=D.transform,ot=h.globeUseCustomAntiAliasing(D,H,it),pt=(Zt,At)=>{if(Z===Zt)return;const vt=[Eo[Zt],"PROJECTION_GLOBE_VIEW"];ot&&vt.push("CUSTOM_ANTIALIASING"),At&&vt.push(Eo[rt]),K=D.useProgram("globeRaster",null,vt),Z=Zt},ut=D.colorModeForRenderPass(),ft=new h.DepthMode(Y.LEQUAL,h.DepthMode.ReadWrite,D.depthRangeFor3D);To.update(X);const wt=h.calculateGlobeMercatorMatrix(it),Ct=[h.mercatorXfromLng(it.center.lng),h.mercatorYfromLat(it.center.lat)],It=rt?[!1,!0]:[!1],Jt=D.globeSharedBuffers,Et=[it.width*h.exported.devicePixelRatio,it.height*h.exported.devicePixelRatio],Ft=Float32Array.from(it.globeMatrix),Dt={useDenormalizedUpVectorScale:!0};if(It.forEach(Zt=>{const At=D.transform,vt=ll(At.zoom)*L.exaggeration();Z=-1;const kt=Zt?Y.LINES:Y.TRIANGLES;for(const Ut of $){const $t=N.getTile(Ut),me=h.StencilMode.disabled,Oe=L.prevTerrainTileForTile[Ut.key],he=L.terrainTileForTile[Ut.key];uc(Oe,he)&&To.newMorphing(Ut.key,Oe,he,X,250),H.activeTexture.set(Y.TEXTURE0),$t.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const ae=To.getMorphValuesForProxy(Ut.key),ge=ae?1:0;ae&&h.extend$1(Dt,{morphing:{srcDemTile:ae.from,dstDemTile:ae.to,phase:h.easeCubicInOut(ae.phase)}});const je=h.tileCornersToBounds(Ut.canonical),be=h.getLatitudinalLod(je.getCenter().lat),ri=h.getGridMatrix(Ut.canonical,je,be,At.worldSize/At._pixelsPerMercatorPixel),oi=h.globeNormalizeECEF(h.globeTileBounds(Ut.canonical)),wi=al(At.projMatrix,Ft,wt,oi,h.globeToMercatorTransition(At.zoom),Ct,At.frustumCorners.TL,At.frustumCorners.TR,At.frustumCorners.BR,At.frustumCorners.BL,At.globeCenterInViewSpace,At.globeRadius,Et,vt,ri);if(pt(ge,Zt),L.setupElevationDraw($t,K,Dt),D.prepareDrawProgram(H,K,Ut.toUnwrapped()),Jt){const[mi,Vi,Pn]=Zt?Jt.getWirefameBuffers(D.context,be):Jt.getGridBuffers(be,0!==vt);K.draw(H,kt,ft,me,ut,h.CullFaceMode.backCCW,wi,"globe_raster",mi,Vi,Pn)}}}),Jt){const Zt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ot&&Zt.push("CUSTOM_ANTIALIASING"),K=D.useProgram("globeRaster",null,Zt);for(const At of $){const{x:vt,y:kt,z:Ut}=At.canonical,$t=0===kt,me=kt===(1<<Ut)-1,[Oe,he,ae,ge]=Jt.getPoleBuffers(Ut);if(ge&&($t||me)){const je=N.getTile(At);H.activeTexture.set(Y.TEXTURE0),je.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let be=h.globePoleMatrixForTile(Ut,vt,it);const ri=h.globeNormalizeECEF(h.globeTileBounds(At.canonical)),oi=(wi,mi)=>wi.draw(H,Y.TRIANGLES,ft,h.StencilMode.disabled,ut,h.CullFaceMode.disabled,al(it.projMatrix,be,be,ri,0,Ct,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Et,0),"globe_pole_raster",mi,ae,ge);L.setupElevationDraw(je,K,Dt),D.prepareDrawProgram(H,K,At.toUnwrapped()),$t&&oi(K,Oe),me&&(be=h.scale(h.create(),be,[1,-1,1]),oi(K,he))}}}}(y,v,M,C,I);else{const D=y.context,L=D.gl;let N,$;const X=y.options.showTerrainWireframe?2:0,H=(it,ot)=>{if($===it)return;const pt=[Eo[it]];ot&&pt.push(Eo[X]),N=y.useProgram("terrainRaster",null,pt),$=it},Y=y.colorModeForRenderPass(),K=new h.DepthMode(L.LEQUAL,h.DepthMode.ReadWrite,y.depthRangeFor3D);To.update(I);const Z=y.transform,rt=ll(Z.zoom)*v.exaggeration();(X?[!1,!0]:[!1]).forEach(it=>{$=-1;const ot=it?L.LINES:L.TRIANGLES,[pt,ut]=it?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const ft of C){const wt=M.getTile(ft),Ct=h.StencilMode.disabled,It=v.prevTerrainTileForTile[ft.key],Jt=v.terrainTileForTile[ft.key];uc(It,Jt)&&To.newMorphing(ft.key,It,Jt,I,250),D.activeTexture.set(L.TEXTURE0),wt.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Et=To.getMorphValuesForProxy(ft.key),Ft=Et?1:0;let Dt;Et&&(Dt={morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:h.easeCubicInOut(Et.phase)}});const Zt=sl(ft.projMatrix,dc(ft.canonical,Z.renderWorldCopies)?rt/10:rt);H(Ft,it),v.setupElevationDraw(wt,N,Dt),y.prepareDrawProgram(D,N,ft.toUnwrapped()),N.draw(D,ot,K,Ct,Y,h.CullFaceMode.backCCW,Zt,"terrain_raster",v.gridBuffer,pt,ut)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const l=this.painter,f=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],M=this._drapedRenderBatches.shift(),C=[],I=l.style.order;let D=0;for(const L of v){const N=y.getTileByID(L.proxyTileKey),$=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][n]:void 0,X=void 0!==$?y.renderCache[$]:this.pool[D++],H=void 0!==$;if(N.texture=X.tex,H&&!X.dirty){C.push(N.tileID);continue}let Y;f.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(f.clear({color:h.Color.transparent,stencil:0}),X.dirty=!1);for(let K=M.start;K<=M.end;++K){const Z=l.style._layers[I[K]];if(Z.isHidden(l.transform.zoom))continue;const rt=l.style._getLayerSourceCache(Z),it=rt?this.proxyToSource[L.key][rt.id]:[L];if(!it)continue;const ot=it;f.viewport.set([0,0,X.fb.width,X.fb.height]),Y!==(rt?rt.id:null)&&(this._setupStencil(X,it,Z,rt),Y=rt?rt.id:null),l.renderLayer(l,rt,Z,ot)}this.renderedToTile?(X.dirty=!0,C.push(N.tileID)):H||--D,5===D&&(D=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),M.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(0===l)return{efficiency:100};let f,y=0,v=0,M=!1;for(let C=0;C<l;++C){const I=n._layers[n.order[C]];this._style.isLayerDraped(I)?(M&&++y,++v):M||(M=!0,f=I.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,l,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const M=v.tileID,C=1<<M.overscaledZ,{x:I,y:D}=M.canonical,L=I/C,N=(I+1)/C,$=D/C,X=(D+1)/C;return{minx:L,miny:$,maxx:N,maxy:X,t:v.dem.tree.raycastRoot(L,$,N,X,n,l,f),tile:v}});y.sort((v,M)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const v of y){if(null==v.t)return null;const M=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,n,l,f);if(null!=M)return M}return null}_createFBO(){const n=this.painter.context,l=n.gl,f=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const y=new h.Texture(n,{width:f[0],height:f[1],data:null},l.RGBA);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=n.createFramebuffer(f[0],f[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new ca(n,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],f=l.isHidden(this.painter.transform.zoom);return"custom"===l.type?!f&&l.shouldRedrape():!f&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style._getSources())if(f instanceof U){n=!0;break}if(!n)return;const l={};for(let f=0;f<this._style.order.length;++f){const y=this._style._layers[this._style.order[f]],v=this._style._getLayerSourceCache(y);if(v&&!l[v.id]&&!y.isHidden(this.painter.transform.zoom)&&"line"===y.type&&y.widthExpression()instanceof h.ZoomDependentExpression){l[v.id]=!0;for(const M of this.proxyCoords){const C=this.proxyToSource[M.key][v.id];if(C)for(const I of C)this._clearRenderCacheForTile(v.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof j){n=!0;break}if(!n)return;const l={};for(let f=0;f<this._style.order.length;++f){const y=this._style._layers[this._style.order[f]],v=this._style._getLayerSourceCache(y);if(!v||l[v.id]||y.isHidden(this.painter.transform.zoom)||"raster"!==y.type)continue;const M=y.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const I=this.proxyToSource[C.key][v.id];if(I)for(const D of I){const L=Ls(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,M);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(0===l)return;const f=[];let y,v=0,M=this._style._layers[n[v]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++v<l;)M=this._style._layers[n[v]];for(;v<l;++v){const C=this._style._layers[n[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===y&&(y=v):void 0!==y&&(f.push({start:y,end:v-1}),y=void 0))}void 0!==y&&f.push({start:y,end:v-1}),this._drapedRenderBatches=f}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const M=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<M.length;++C){const I=Object.values(M[C]);l.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let M=f.length-1;M>=0;M--){const C=f[M];if(l.getTileByID(C.key),void 0!==l.proxyCachedFBO[C.key]){const I=n[C.key],D=this.proxyToSource[C.key];let L=0;for(const N in D){const $=D[N],X=I[N];if(!X||X.length!==$.length||$.some((H,Y)=>H!==X[Y]||y[N]&&y[N].hasOwnProperty(H.key))){L=-1;break}++L}for(const N in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][N]].dirty=L<0||L!==Object.values(I).length}}const v=[...this._drapedRenderBatches];v.sort((M,C)=>C.end-C.start-(M.end-M.start));for(const M of v)for(const C of f){if(l.proxyCachedFBO[C.key])continue;let I=l.renderCachePool.pop();void 0===I&&l.renderCache.length<50&&(I=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==I&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][M.start]=I,l.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,M=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(f.isTileClipped())C=l.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(n,l){const f=this.painter,y=this.painter.context,v=y.gl;f._tileClippingMaskIDs={},y.setColorMode(h.ColorMode.disabled),y.setDepthMode(h.DepthMode.disabled);const M=f.useProgram("clippingMask");for(const C of n){const I=f._tileClippingMaskIDs[C.key]=--l;M.draw(y,v.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,He(C.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const f=[n.x,n.y,1,1];h.transformMat4$1(f,f,l.pixelMatrixInverse),h.scale$1(f,f,1/f[3]),f[0]/=l.worldSize,f[1]/=l.worldSize;const y=l._camera.position,v=h.mercatorZfromAltitude(1,l.center.lat),M=[y[0],y[1],y[2]/v,0],C=h.subtract([],f.slice(0,3),M);h.normalize(C,C);const I=this.raycast(M,C,this._exaggeration);return null!==I&&I?(h.scaleAndAdd(M,M,C,I),M[3]=M[2],M[2]*=v,M):null}drawDepth(){const n=this.painter,l=n.context,f=this.proxySourceCache,y=Math.ceil(n.width),v=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=l.gl,C=l.createFramebuffer(y,v,!0);l.activeTexture.set(M.TEXTURE0);const I=new h.Texture(l,{width:y,height:v,data:null},M.RGBA);I.bind(M.NEAREST,M.CLAMP_TO_EDGE),C.colorAttachment.set(I.texture);const D=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,y,v);C.depthAttachment.set(D),this._depthFBO=C,this._depthTexture=I}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,y,v]),function(M,C,I,D){if("globe"===M.transform.projection.name)return;const L=M.context,N=L.gl;L.clear({depth:1});const $=M.useProgram("terrainDepth"),X=new h.DepthMode(N.LESS,h.DepthMode.ReadWrite,M.depthRangeFor3D);for(const H of D){const Y=I.getTile(H),K=sl(H.projMatrix,0);C.setupElevationDraw(Y,$),$.draw(L,N.TRIANGLES,X,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,K,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,f){if(n.getSource()instanceof ct)return this._setupProxiedCoordsForImageSource(n,l,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const I=v[C],D=this._findTileCoveringTileID(I,n);if(D){const L=this._createProxiedId(I,D,f[I.key]&&f[I.key][n.id]);y.push(L),this.proxyToSource[I.key][n.id]=[L]}}let M=!1;for(let C=0;C<l.length;C++){const I=n.getTile(l[C]);if(!I||!I.hasData())continue;const D=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==I.tileID.canonical.z){const L=this.proxyToSource[D.tileID.key][n.id],N=this._createProxiedId(D.tileID,I,f[D.tileID.key]&&f[D.tileID.key][n.id]);L?L.splice(L.length-1,0,N):this.proxyToSource[D.tileID.key][n.id]=[N],y.push(N),M=!0}}this._sourceTilesOverlap[n.id]=M}_setupProxiedCoordsForImageSource(n,l,f){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords,M=n.getSource(),C=new h.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),I=M.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((L,N)=>(L.min.x=Math.min(L.min.x,N.x-C.x),L.min.y=Math.min(L.min.y,N.y-C.y),L.max.x=Math.max(L.max.x,N.x-C.x),L.max.y=Math.max(L.max.y,N.y-C.y),L),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(L,N)=>{const $=L.wrap+L.canonical.x/(1<<L.canonical.z),X=L.canonical.y/(1<<L.canonical.z),H=h.EXTENT/(1<<L.canonical.z),Y=N.wrap+N.canonical.x/(1<<N.canonical.z),K=N.canonical.y/(1<<N.canonical.z);return $+H<Y+I.min.x||$>Y+I.max.x||X+H<K+I.min.y||X>K+I.max.y};for(let L=0;L<v.length;L++){const N=v[L];for(let $=0;$<l.length;$++){const X=n.getTile(l[$]);if(!X||!X.hasData()||D(N,X.tileID))continue;const H=this._createProxiedId(N,X,f[N.key]&&f[N.key][n.id]),Y=this.proxyToSource[N.key][n.id];Y?Y.push(H):this.proxyToSource[N.key][n.id]=[H],y.push(H)}}}_createProxiedId(n,l,f){let y=this.orthoMatrix;if(f){const v=f.find(M=>M.key===l.tileID.key);if(v)return v}if(l.tileID.key!==n.key){const v=n.canonical.z-l.tileID.canonical.z;let M,C,I;y=h.create();const D=l.tileID.wrap-n.wrap<<n.overscaledZ;v>0?(M=h.EXTENT>>v,C=M*((l.tileID.canonical.x<<v)-n.canonical.x+D),I=M*((l.tileID.canonical.y<<v)-n.canonical.y)):(M=h.EXTENT<<-v,C=h.EXTENT*(l.tileID.canonical.x-(n.canonical.x+D<<-v)),I=h.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-v))),h.ortho(y,0,M,0,M,0,1),h.translate(y,y,[C,I,0])}return new cl(l.tileID,n.key,y)}_findTileCoveringTileID(n,l){let f=l.getTile(n);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[l.id],v=y[n.key];if(f=v?l.getTileByID(v):null,f&&f.hasData()||null===v)return f;let M=f?f.tileID:n,C=M.overscaledZ;const I=l.getSource().minzoom,D=[];if(!v){const N=l.getSource().maxzoom;if(n.canonical.z>=N){const $=n.canonical.z-N;l.getSource().reparseOverscaled?(C=Math.max(n.canonical.z+2,l.transform.tileZoom),M=new h.OverscaledTileID(C,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$)):0!==$&&(C=N,M=new h.OverscaledTileID(C,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$))}M.key!==n.key&&(D.push(M.key),f=l.getTile(M))}const L=N=>{D.forEach($=>{y[$]=N}),D.length=0};for(C-=1;C>=I&&(!f||!f.hasData());C--){f&&L(f.tileID.key);const N=M.calculateScaledKey(C);if(f=l.getTileByID(N),f&&f.hasData())break;const $=y[N];if(null===$)break;void 0===$?D.push(N):f=l.getTileByID($)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let f=0;const y=new h.StructArrayLayout2ui4,v=131;for(let M=1;M<129;M++){for(let C=1;C<129;C++)f=M*v+C,y.emplaceBack(f,f+1),y.emplaceBack(f,f+v),y.emplaceBack(f+1,f+v),128===M&&y.emplaceBack(f+v,f+v+1);y.emplaceBack(f+1,f+1+v)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class pc{static cacheKey(n,l,f,y){let v=`${l}${y?y.cacheKey:""}`;for(const M of f)n.usedDefines.includes(M)&&(v+=`/${M}`);return v}constructor(n,l,f,y,v,M){const C=n.gl;this.program=C.createProgram();const I=function(Z){const rt=[];for(let it=0;it<Z.length;it++){if(null===Z[it])continue;const ot=Z[it].split(" ");rt.push(ot.pop())}return rt}(f.staticAttributes),D=y?y.getBinderAttributes():[],L=I.concat(D);let N=y?y.defines():[];N=N.concat(M.map(Z=>`#define ${Z}`));const $=n.isWebGL2?"#version 300 es\n":"",X=$+N.concat(n.extStandardDerivatives&&0===$.length?"#extension GL_OES_standard_derivatives : enable\n".concat(tn):tn,tn,Er,hc.fragmentSource,cc.fragmentSource,f.fragmentSource).join("\n"),H=$+N.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Er,hc.vertexSource,cc.vertexSource,lc.vertexSource,f.vertexSource).join("\n"),Y=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Y,X),C.compileShader(Y),C.attachShader(this.program,Y);const K=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(K,H),C.compileShader(K),C.attachShader(this.program,K),this.attributes={},this.numAttributes=L.length;for(let Z=0;Z<this.numAttributes;Z++)L[Z]&&(C.bindAttribLocation(this.program,Z,L[Z]),this.attributes[L[Z]]=Z);C.linkProgram(this.program),C.deleteShader(K),C.deleteShader(Y),this.fixedUniforms=v(n),this.binderUniforms=y?y.getUniforms(n):[],M.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(Z=n),u_dem_prev:new h.Uniform1i(Z),u_dem_unpack:new h.Uniform4f(Z),u_dem_tl:new h.Uniform2f(Z),u_dem_scale:new h.Uniform1f(Z),u_dem_tl_prev:new h.Uniform2f(Z),u_dem_scale_prev:new h.Uniform1f(Z),u_dem_size:new h.Uniform1f(Z),u_dem_lerp:new h.Uniform1f(Z),u_exaggeration:new h.Uniform1f(Z),u_depth:new h.Uniform1i(Z),u_depth_size_inv:new h.Uniform2f(Z),u_meter_to_dem:new h.Uniform1f(Z),u_label_plane_matrix_inv:new h.UniformMatrix4f(Z)}),M.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new h.Uniform3f(Z),u_tile_tr_up:new h.Uniform3f(Z),u_tile_br_up:new h.Uniform3f(Z),u_tile_bl_up:new h.Uniform3f(Z),u_tile_up_scale:new h.Uniform1f(Z)}))(n)),M.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new h.UniformMatrix4f(Z),u_fog_range:new h.Uniform2f(Z),u_fog_color:new h.Uniform4f(Z),u_fog_horizon_blend:new h.Uniform1f(Z),u_fog_temporal_offset:new h.Uniform1f(Z),u_frustum_tl:new h.Uniform3f(Z),u_frustum_tr:new h.Uniform3f(Z),u_frustum_br:new h.Uniform3f(Z),u_frustum_bl:new h.Uniform3f(Z),u_globe_pos:new h.Uniform3f(Z),u_globe_radius:new h.Uniform1f(Z),u_globe_transition:new h.Uniform1f(Z),u_is_globe:new h.Uniform1i(Z),u_viewport:new h.Uniform2f(Z)}))(n))}var Z}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)f[y]&&f[y].set(this.program,y,l[y])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)f[y]&&f[y].set(this.program,y,l[y])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)f[y].set(this.program,y,l[y])}}draw(n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y){const K=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(y),n.setColorMode(v),n.setCullFace(M);for(const rt of Object.keys(this.fixedUniforms))this.fixedUniforms[rt].set(this.program,rt,C[rt]);H&&H.setUniforms(this.program,n,this.binderUniforms,$,{zoom:X});const Z={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];for(const rt of N.get()){const it=rt.vaos||(rt.vaos={});(it[I]||(it[I]=new Yn)).bind(n,this,D,H?H.getPaintVertexBuffers():[],L,rt.vertexOffset,Y||[]),K.drawElements(l,rt.primitiveLength*Z,K.UNSIGNED_SHORT,rt.primitiveOffset*Z*2)}}}function fc(d,n){const l=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,d.transform.tileZoom)/l,y=f*(n.tileID.canonical.x+n.tileID.wrap*l),v=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/fr(n,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v]}}const id=h.create(),qr=(d,n,l,f,y,v,M,C,I,D,L)=>{const N=n.style.light,$=N.properties.get("position"),X=[$.x,$.y,$.z],H=h.create$1();"viewport"===N.properties.get("anchor")&&(h.fromRotation(H,-n.transform.angle),h.transformMat3(X,X,H));const Y=N.properties.get("color"),K=n.transform,Z={u_matrix:d,u_lightpos:X,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+l,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:id,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:v};return"globe"===K.projection.name&&(Z.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Z.u_zoom_transition=I,Z.u_inv_rot_matrix=L,Z.u_merc_center=D,Z.u_up_dir=K.projection.upVector(new h.CanonicalTileID(0,0,0),D[0]*h.EXTENT,D[1]*h.EXTENT),Z.u_height_lift=C),Z},ul=(d,n,l,f,y,v,M,C,I,D,L,N)=>{const $=qr(d,n,l,f,y,v,M,I,D,L,N),X={u_height_factor:-Math.pow(2,M.overscaledZ)/C.tileSize/8};return h.extend($,fc(n,C),X)},dl=d=>({u_matrix:d}),pl=(d,n,l)=>h.extend(dl(d),fc(n,l)),zh=(d,n)=>({u_matrix:d,u_world:n}),Ph=(d,n,l,f)=>h.extend(pl(d,n,l),{u_world:f}),fl=h.create(),_a=(d,n,l,f,y,v)=>{const M=d.transform,C="globe"===M.projection.name;let I;if("map"===v.paint.get("circle-pitch-alignment"))if(C){const L=h.globePixelsToTileUnits(M.zoom,n.canonical)*M._pixelsPerMercatorPixel;I=Float32Array.from([L,0,0,L])}else I=M.calculatePixelsToTileUnitsMatrix(l);else I=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:fl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=f,D.u_merc_center=y,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=h.globeToMercatorTransition(M.zoom);const L=y[0]*h.EXTENT,N=y[1]*h.EXTENT;D.u_up_dir=M.projection.upVector(new h.CanonicalTileID(0,0,0),L,N)}return D},ya=d=>{const n=[];return"map"===d.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},mc=(d,n,l,f)=>{const y=h.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},Yo=(d,n,l=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:l}),Rs=h.create(),jn=(d,n,l,f,y,v,M)=>{const C=d.transform,I="globe"===C.projection.name,D=I?h.globePixelsToTileUnits(C.zoom,n.canonical)*C._pixelsPerMercatorPixel:fr(l,1,v),L={u_matrix:n.projMatrix,u_extrude_scale:D,u_intensity:M,u_inv_rot_matrix:Rs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=f,L.u_merc_center=y,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=h.globeToMercatorTransition(C.zoom);const N=y[0]*h.EXTENT,$=y[1]*h.EXTENT;L.u_up_dir=C.projection.upVector(new h.CanonicalTileID(0,0,0),N,$)}return L},gc=(d,n,l,f,y,v,M)=>{const C=d.transform,I=C.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:_c(d,n,l,f),u_pixels_to_tile_units:I,u_device_pixel_ratio:v,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:ml(l)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cr(n,d.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},Dh=(d,n,l,f,y)=>{const v=d.transform;return{u_matrix:_c(d,n,l,f),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Cr(n,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Cr(d,n){return 1/fr(d,1,n.tileZoom)}function _c(d,n,l,f){return d.translatePosMatrix(f||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function ml(d){const n=d.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const Jo=(d,n,l,f,y,v)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:l,u_fade_t:f.mix,u_opacity:f.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(M=y.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:yc(y.paint.get("raster-hue-rotate")),u_perspective_transform:v};var M,C};function yc(d){d*=Math.PI/180;const n=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const xa=h.create(),va=(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y)=>{const K=y.transform,Z={u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:K.width/K.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:M,u_coord_matrix:C,u_is_text:+I,u_pitch_with_map:+f,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xa,u_up_vector:[0,-1,0]};return"globe"===Y.name&&(Z.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Z.u_zoom_transition=N,Z.u_inv_rot_matrix=X,Z.u_merc_center=$,Z.u_camera_forward=K._camera.forward(),Z.u_ecef_origin=h.globeECEFOrigin(K.globeMatrix,L.toUnwrapped()),Z.u_tile_matrix=Float32Array.from(K.globeMatrix),Z.u_up_vector=H),Z},xc=(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y,K)=>h.extend(va(d,n,l,f,y,v,M,C,I,D,N,$,X,H,Y,K),{u_gamma_scale:f?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+L}),vc=(d,n,l,f,y,v,M,C,I,D,L,N,$,X,H,Y)=>h.extend(xc(d,n,l,f,y,v,M,C,!0,I,!0,L,N,$,X,H,Y),{u_texsize_icon:D,u_texture_icon:1}),Lh=(d,n,l)=>({u_matrix:d,u_opacity:n,u_color:l}),Wr=(d,n,l,f,y)=>h.extend(function(v,M,C){const I=M.imageManager.getPattern(v.toString()),{width:D,height:L}=M.imageManager.getPixelSize(),N=Math.pow(2,C.tileID.overscaledZ),$=C.tileSize*Math.pow(2,M.transform.tileZoom)/N,X=$*(C.tileID.canonical.x+C.tileID.wrap*N),H=$*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[D,L],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/fr(C,1,M.transform.tileZoom),u_pixel_coord_upper:[X>>16,H>>16],u_pixel_coord_lower:[65535&X,65535&H]}}(f,l,y),{u_matrix:d,u_opacity:n}),nd={fillExtrusion:d=>({u_matrix:new h.UniformMatrix4f(d),u_lightpos:new h.Uniform3f(d),u_lightintensity:new h.Uniform1f(d),u_lightcolor:new h.Uniform3f(d),u_vertical_gradient:new h.Uniform1f(d),u_opacity:new h.Uniform1f(d),u_edge_radius:new h.Uniform1f(d),u_ao:new h.Uniform2f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_up_dir:new h.Uniform3f(d),u_height_lift:new h.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new h.UniformMatrix4f(d),u_lightpos:new h.Uniform3f(d),u_lightintensity:new h.Uniform1f(d),u_lightcolor:new h.Uniform3f(d),u_vertical_gradient:new h.Uniform1f(d),u_height_factor:new h.Uniform1f(d),u_edge_radius:new h.Uniform1f(d),u_ao:new h.Uniform2f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_up_dir:new h.Uniform3f(d),u_height_lift:new h.Uniform1f(d),u_image:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_pixel_coord_upper:new h.Uniform2f(d),u_pixel_coord_lower:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d),u_opacity:new h.Uniform1f(d)}),fill:d=>({u_matrix:new h.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new h.UniformMatrix4f(d),u_image:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_pixel_coord_upper:new h.Uniform2f(d),u_pixel_coord_lower:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d)}),fillOutline:d=>({u_matrix:new h.UniformMatrix4f(d),u_world:new h.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new h.UniformMatrix4f(d),u_world:new h.Uniform2f(d),u_image:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_pixel_coord_upper:new h.Uniform2f(d),u_pixel_coord_lower:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new h.Uniform1f(d),u_extrude_scale:new h.UniformMatrix2f(d),u_device_pixel_ratio:new h.Uniform1f(d),u_matrix:new h.UniformMatrix4f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_up_dir:new h.Uniform3f(d)}),collisionBox:d=>({u_matrix:new h.UniformMatrix4f(d),u_camera_to_center_distance:new h.Uniform1f(d),u_extrude_scale:new h.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new h.UniformMatrix4f(d),u_inv_matrix:new h.UniformMatrix4f(d),u_camera_to_center_distance:new h.Uniform1f(d),u_viewport_size:new h.Uniform2f(d)}),debug:d=>({u_color:new h.UniformColor(d),u_matrix:new h.UniformMatrix4f(d),u_overlay:new h.Uniform1i(d),u_overlay_scale:new h.Uniform1f(d)}),clippingMask:d=>({u_matrix:new h.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new h.Uniform1f(d),u_intensity:new h.Uniform1f(d),u_matrix:new h.UniformMatrix4f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_up_dir:new h.Uniform3f(d)}),heatmapTexture:d=>({u_image:new h.Uniform1i(d),u_color_ramp:new h.Uniform1i(d),u_opacity:new h.Uniform1f(d)}),hillshade:d=>({u_matrix:new h.UniformMatrix4f(d),u_image:new h.Uniform1i(d),u_latrange:new h.Uniform2f(d),u_light:new h.Uniform2f(d),u_shadow:new h.UniformColor(d),u_highlight:new h.UniformColor(d),u_accent:new h.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new h.UniformMatrix4f(d),u_image:new h.Uniform1i(d),u_dimension:new h.Uniform2f(d),u_zoom:new h.Uniform1f(d),u_unpack:new h.Uniform4f(d)}),line:d=>({u_matrix:new h.UniformMatrix4f(d),u_pixels_to_tile_units:new h.UniformMatrix2f(d),u_device_pixel_ratio:new h.Uniform1f(d),u_units_to_pixels:new h.Uniform2f(d),u_dash_image:new h.Uniform1i(d),u_gradient_image:new h.Uniform1i(d),u_image_height:new h.Uniform1f(d),u_texsize:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d),u_alpha_discard_threshold:new h.Uniform1f(d),u_trim_offset:new h.Uniform2f(d)}),linePattern:d=>({u_matrix:new h.UniformMatrix4f(d),u_texsize:new h.Uniform2f(d),u_pixels_to_tile_units:new h.UniformMatrix2f(d),u_device_pixel_ratio:new h.Uniform1f(d),u_image:new h.Uniform1i(d),u_units_to_pixels:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d),u_alpha_discard_threshold:new h.Uniform1f(d)}),raster:d=>({u_matrix:new h.UniformMatrix4f(d),u_tl_parent:new h.Uniform2f(d),u_scale_parent:new h.Uniform1f(d),u_fade_t:new h.Uniform1f(d),u_opacity:new h.Uniform1f(d),u_image0:new h.Uniform1i(d),u_image1:new h.Uniform1i(d),u_brightness_low:new h.Uniform1f(d),u_brightness_high:new h.Uniform1f(d),u_saturation_factor:new h.Uniform1f(d),u_contrast_factor:new h.Uniform1f(d),u_spin_weights:new h.Uniform3f(d),u_perspective_transform:new h.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new h.Uniform1i(d),u_is_size_feature_constant:new h.Uniform1i(d),u_size_t:new h.Uniform1f(d),u_size:new h.Uniform1f(d),u_camera_to_center_distance:new h.Uniform1f(d),u_rotate_symbol:new h.Uniform1i(d),u_aspect_ratio:new h.Uniform1f(d),u_fade_change:new h.Uniform1f(d),u_matrix:new h.UniformMatrix4f(d),u_label_plane_matrix:new h.UniformMatrix4f(d),u_coord_matrix:new h.UniformMatrix4f(d),u_is_text:new h.Uniform1i(d),u_pitch_with_map:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_camera_forward:new h.Uniform3f(d),u_tile_matrix:new h.UniformMatrix4f(d),u_up_vector:new h.Uniform3f(d),u_ecef_origin:new h.Uniform3f(d),u_texture:new h.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new h.Uniform1i(d),u_is_size_feature_constant:new h.Uniform1i(d),u_size_t:new h.Uniform1f(d),u_size:new h.Uniform1f(d),u_camera_to_center_distance:new h.Uniform1f(d),u_rotate_symbol:new h.Uniform1i(d),u_aspect_ratio:new h.Uniform1f(d),u_fade_change:new h.Uniform1f(d),u_matrix:new h.UniformMatrix4f(d),u_label_plane_matrix:new h.UniformMatrix4f(d),u_coord_matrix:new h.UniformMatrix4f(d),u_is_text:new h.Uniform1i(d),u_pitch_with_map:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_texture:new h.Uniform1i(d),u_gamma_scale:new h.Uniform1f(d),u_device_pixel_ratio:new h.Uniform1f(d),u_tile_id:new h.Uniform3f(d),u_zoom_transition:new h.Uniform1f(d),u_inv_rot_matrix:new h.UniformMatrix4f(d),u_merc_center:new h.Uniform2f(d),u_camera_forward:new h.Uniform3f(d),u_tile_matrix:new h.UniformMatrix4f(d),u_up_vector:new h.Uniform3f(d),u_ecef_origin:new h.Uniform3f(d),u_is_halo:new h.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new h.Uniform1i(d),u_is_size_feature_constant:new h.Uniform1i(d),u_size_t:new h.Uniform1f(d),u_size:new h.Uniform1f(d),u_camera_to_center_distance:new h.Uniform1f(d),u_rotate_symbol:new h.Uniform1i(d),u_aspect_ratio:new h.Uniform1f(d),u_fade_change:new h.Uniform1f(d),u_matrix:new h.UniformMatrix4f(d),u_label_plane_matrix:new h.UniformMatrix4f(d),u_coord_matrix:new h.UniformMatrix4f(d),u_is_text:new h.Uniform1i(d),u_pitch_with_map:new h.Uniform1i(d),u_texsize:new h.Uniform2f(d),u_texsize_icon:new h.Uniform2f(d),u_texture:new h.Uniform1i(d),u_texture_icon:new h.Uniform1i(d),u_gamma_scale:new h.Uniform1f(d),u_device_pixel_ratio:new h.Uniform1f(d),u_is_halo:new h.Uniform1i(d)}),background:d=>({u_matrix:new h.UniformMatrix4f(d),u_opacity:new h.Uniform1f(d),u_color:new h.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new h.UniformMatrix4f(d),u_opacity:new h.Uniform1f(d),u_image:new h.Uniform1i(d),u_pattern_tl:new h.Uniform2f(d),u_pattern_br:new h.Uniform2f(d),u_texsize:new h.Uniform2f(d),u_pattern_size:new h.Uniform2f(d),u_pixel_coord_upper:new h.Uniform2f(d),u_pixel_coord_lower:new h.Uniform2f(d),u_tile_units_to_pixels:new h.Uniform1f(d)}),terrainRaster:Ds,terrainDepth:Ds,skybox:d=>({u_matrix:new h.UniformMatrix4f(d),u_sun_direction:new h.Uniform3f(d),u_cubemap:new h.Uniform1i(d),u_opacity:new h.Uniform1f(d),u_temporal_offset:new h.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new h.UniformMatrix4f(d),u_color_ramp:new h.Uniform1i(d),u_center_direction:new h.Uniform3f(d),u_radius:new h.Uniform1f(d),u_opacity:new h.Uniform1f(d),u_temporal_offset:new h.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new h.UniformMatrix3f(d),u_sun_direction:new h.Uniform3f(d),u_sun_intensity:new h.Uniform1f(d),u_color_tint_r:new h.Uniform4f(d),u_color_tint_m:new h.Uniform4f(d),u_luminance:new h.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new h.UniformMatrix4f(d),u_globe_matrix:new h.UniformMatrix4f(d),u_normalize_matrix:new h.UniformMatrix4f(d),u_merc_matrix:new h.UniformMatrix4f(d),u_zoom_transition:new h.Uniform1f(d),u_merc_center:new h.Uniform2f(d),u_image0:new h.Uniform1i(d),u_grid_matrix:new h.UniformMatrix3f(d),u_skirt_height:new h.Uniform1f(d),u_frustum_tl:new h.Uniform3f(d),u_frustum_tr:new h.Uniform3f(d),u_frustum_br:new h.Uniform3f(d),u_frustum_bl:new h.Uniform3f(d),u_globe_pos:new h.Uniform3f(d),u_globe_radius:new h.Uniform1f(d),u_viewport:new h.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new h.Uniform3f(d),u_frustum_tr:new h.Uniform3f(d),u_frustum_br:new h.Uniform3f(d),u_frustum_bl:new h.Uniform3f(d),u_horizon:new h.Uniform1f(d),u_transition:new h.Uniform1f(d),u_fadeout_range:new h.Uniform1f(d),u_color:new h.Uniform4f(d),u_high_color:new h.Uniform4f(d),u_space_color:new h.Uniform4f(d),u_star_intensity:new h.Uniform1f(d),u_star_density:new h.Uniform1f(d),u_star_size:new h.Uniform1f(d),u_temporal_offset:new h.Uniform1f(d),u_horizon_angle:new h.Uniform1f(d),u_rotation_matrix:new h.UniformMatrix4f(d)})};let Ko;function Rh(d,n,l,f,y,v,M){const C=d.context,I=C.gl,D=d.transform,L=d.useProgram("collisionBox"),N=[];let $=0,X=0;for(let ot=0;ot<f.length;ot++){const pt=f[ot],ut=n.getTile(pt),ft=ut.getBucket(l);if(!ft)continue;const wt=tl(pt,ft,D);let Ct=wt;0===y[0]&&0===y[1]||(Ct=d.translatePosMatrix(wt,ut,y,v));const It=M?ft.textCollisionBox:ft.iconCollisionBox,Jt=ft.collisionCircleArray;if(Jt.length>0){const Et=h.create(),Ft=Ct;h.mul(Et,ft.placementInvProjMatrix,D.glCoordMatrix),h.mul(Et,Et,ft.placementViewportMatrix),N.push({circleArray:Jt,circleOffset:X,transform:Ft,invTransform:Et,projection:ft.getProjection()}),$+=Jt.length/4,X=$}It&&(d.terrain&&d.terrain.setupElevationDraw(ut,L),L.draw(C,I.LINES,h.DepthMode.disabled,h.StencilMode.disabled,d.colorModeForRenderPass(),h.CullFaceMode.disabled,mc(Ct,D,ut,ft.getProjection()),l.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,null,D.zoom,null,[It.collisionVertexBuffer,It.collisionVertexBufferExt]))}if(!M||!N.length)return;const H=d.useProgram("collisionCircle"),Y=new h.StructArrayLayout2f1f2i16;Y.resize(4*$),Y._trim();let K=0;for(const ot of N)for(let pt=0;pt<ot.circleArray.length/4;pt++){const ut=4*pt,ft=ot.circleArray[ut+0],wt=ot.circleArray[ut+1],Ct=ot.circleArray[ut+2],It=ot.circleArray[ut+3];Y.emplace(K++,ft,wt,Ct,It,0),Y.emplace(K++,ft,wt,Ct,It,1),Y.emplace(K++,ft,wt,Ct,It,2),Y.emplace(K++,ft,wt,Ct,It,3)}(!Ko||Ko.length<2*$)&&(Ko=function(ot){const pt=2*ot,ut=new h.StructArrayLayout3ui6;ut.resize(pt),ut._trim();for(let ft=0;ft<pt;ft++){const wt=6*ft;ut.uint16[wt+0]=4*ft+0,ut.uint16[wt+1]=4*ft+1,ut.uint16[wt+2]=4*ft+2,ut.uint16[wt+3]=4*ft+2,ut.uint16[wt+4]=4*ft+3,ut.uint16[wt+5]=4*ft+0}return ut}($));const Z=C.createIndexBuffer(Ko,!0),rt=C.createVertexBuffer(Y,h.collisionCircleLayout.members,!0);for(const ot of N){const pt={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(it=D).getCameraToCenterDistance(ot.projection),u_viewport_size:[it.width,it.height]};H.draw(C,I.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,d.colorModeForRenderPass(),h.CullFaceMode.disabled,pt,l.id,rt,Z,h.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,D.zoom)}var it;rt.destroy(),Z.destroy()}const bc=h.create();function Qo({width:d,height:n,anchor:l,textOffset:f,textScale:y},v){const{horizontalAlign:M,verticalAlign:C}=h.getAnchorAlignment(l),I=-(M-.5)*d,D=-(C-.5)*n,L=h.evaluateVariableOffset(l,f);return new h.pointGeometry((I/y+L[0])*v,(D/y+L[1])*v)}function ts(d,n,l,f,y,v,M,C,I,D,L){const N=d.text.placedSymbolArray,$=d.text.dynamicLayoutVertexArray,X=d.icon.dynamicLayoutVertexArray,H={},Y=d.getProjection(),K=ua(C,Y,v),Z=v.elevation,rt=Y.upVectorScale(C.canonical,v.center.lat,v.worldSize).metersToTile;$.clear();for(let it=0;it<N.length;it++){const ot=N.get(it),{tileAnchorX:pt,tileAnchorY:ut,numGlyphs:ft}=ot,Ct=ot.hidden||!ot.crossTileID||d.allowVerticalPlacement&&!ot.placedOrientation?null:f[ot.crossTileID];if(Ct){let It=0,Jt=0,Et=0;if(Z){const me=Z?Z.getAtTileOffset(C,pt,ut):0,[Oe,he,ae]=Y.upVector(C.canonical,pt,ut);It=me*Oe*rt,Jt=me*he*rt,Et=me*ae*rt}let[Ft,Dt,Zt,At]=ee(ot.projectedAnchorX+It,ot.projectedAnchorY+Jt,ot.projectedAnchorZ+Et,l?K:M);const vt=Ve(v.getCameraToCenterDistance(Y),At);let kt=y.evaluateSizeForFeature(d.textSizeData,D,ot)*vt/h.ONE_EM;l&&(kt*=d.tilePixelRatio/I);const Ut=Qo(Ct,kt);l?(({x:Ft,y:Dt,z:Zt}=Y.projectTilePoint(pt+Ut.x,ut+Ut.y,C.canonical)),[Ft,Dt,Zt]=ee(Ft+It,Dt+Jt,Zt+Et,M)):(n&&Ut._rotate(-v.angle),Ft+=Ut.x,Dt+=Ut.y,Zt=0);const $t=d.allowVerticalPlacement&&ot.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let me=0;me<ft;me++)h.addDynamicAttributes($,Ft,Dt,Zt,$t);L&&ot.associatedIconIndex>=0&&(H[ot.associatedIconIndex]={x:Ft,y:Dt,z:Zt,angle:$t})}else yi(ft,$)}if(L){X.clear();const it=d.icon.placedSymbolArray;for(let ot=0;ot<it.length;ot++){const pt=it.get(ot),{numGlyphs:ut}=pt,ft=H[ot];if(pt.hidden||!ft)yi(ut,X);else{const{x:wt,y:Ct,z:It,angle:Jt}=ft;for(let Et=0;Et<ut;Et++)h.addDynamicAttributes(X,wt,Ct,It,Jt)}}d.icon.dynamicLayoutVertexBuffer.updateData(X)}d.text.dynamicLayoutVertexBuffer.updateData($)}function Bh(d,n,l){return l.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function wc(d,n,l,f,y,v,M,C,I,D,L,N){const $=d.context,X=$.gl,H=d.transform,Y="map"===C,K="map"===I,Z=Y&&"point"!==l.layout.get("symbol-placement"),rt=Y&&!K&&!Z,it=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let ot=!1;const pt=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),ut=[h.mercatorXfromLng(H.center.lng),h.mercatorYfromLat(H.center.lat)],ft=l.layout.get("text-variable-anchor"),wt="globe"===H.projection.name,Ct=[],It=[0,-1,0];let Jt=It;!wt&&!H.mercatorFromTransition||Y||(Jt=function(Et){const Ft=Et._camera.getWorldToCamera(Et.worldSize,1),Dt=h.multiply([],Ft,Et.globeMatrix);h.invert(Dt,Dt);const Zt=[0,0,0],At=[0,1,0,0];return h.transformMat4$1(At,At,Dt),Zt[0]=At[0],Zt[1]=At[1],Zt[2]=At[2],h.normalize(Zt,Zt),Zt}(H));for(const Et of f){const Ft=n.getTile(Et),Dt=Ft.getBucket(l);if(!Dt||"mercator"===Dt.projection.name&&wt)continue;const Zt=y?Dt.text:Dt.icon;if(!Zt||Dt.fullyClipped||!Zt.segments.get().length)continue;const At=Zt.programConfigurations.get(l.id),vt=y||Dt.sdfIcons,kt=y?Dt.textSizeData:Dt.iconSizeData,Ut=K||0!==H.pitch,$t=h.evaluateSizeForZoom(kt,H.zoom);let me,Oe,he,ae,ge=[0,0],je=null;if(y)Oe=Ft.glyphAtlasTexture,he=X.LINEAR,me=Ft.glyphAtlasTexture.size,Dt.iconsInText&&(ge=Ft.imageAtlasTexture.size,je=Ft.imageAtlasTexture,ae=Ut||d.options.rotating||d.options.zooming||"composite"===kt.kind||"camera"===kt.kind?X.LINEAR:X.NEAREST);else{const Dn=1!==l.layout.get("icon-size").constantOr(0)||Dt.iconsNeedLinear;Oe=Ft.imageAtlasTexture,he=vt||d.options.rotating||d.options.zooming||Dn||Ut?X.LINEAR:X.NEAREST,me=Ft.imageAtlasTexture.size}const be="globe"===Dt.projection.name,ri=be?Jt:It,oi=be?h.globeToMercatorTransition(H.zoom):0,wi=ua(Et,Dt.getProjection(),H),mi=H.calculatePixelsToTileUnitsMatrix(Ft),Vi=Ms(wi,Ft.tileID.canonical,K,Y,H,Dt.getProjection(),mi),Pn=d.terrain&&K&&Z?h.invert(h.create(),Vi):bc,Jn=Cs(wi,Ft.tileID.canonical,K,Y,H,Dt.getProjection(),mi),Ir=ft&&Dt.hasTextData(),xi="none"!==l.layout.get("icon-text-fit")&&Ir&&Dt.hasIconData();if(Z){const Dn=H.elevation,Kn=Dn?Dn.getAtTileOffsetFunc(Et,H.center.lat,H.worldSize,Dt.getProjection()):null,kr=sc(wi,Ft.tileID.canonical,K,Y,H,Dt.getProjection(),mi);sr(Dt,wi,d,y,kr,Jn,K,D,Kn,Et)}const si=Z||y&&ft||xi,ei=d.translatePosMatrix(wi,Ft,v,M),Li=si?bc:Vi,pn=d.translatePosMatrix(Jn,Ft,v,M,!0),Ei=Dt.getProjection().createInversionMatrix(H,Et.canonical),fn=[];d.terrainRenderModeElevated()&&K&&fn.push("PITCH_WITH_MAP_TERRAIN"),be&&fn.push("PROJECTION_GLOBE_VIEW"),si&&fn.push("PROJECTED_POS_ON_VIEWPORT");const mn=vt&&0!==l.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let Qr;Qr=vt?Dt.iconsInText?vc(kt.kind,$t,rt,K,d,ei,Li,pn,me,ge,Et,oi,ut,Ei,ri,Dt.getProjection()):xc(kt.kind,$t,rt,K,d,ei,Li,pn,y,me,!0,Et,oi,ut,Ei,ri,Dt.getProjection()):va(kt.kind,$t,rt,K,d,ei,Li,pn,y,me,Et,oi,ut,Ei,ri,Dt.getProjection());const ss={program:d.useProgram(Bh(vt,y,Dt),At,fn),buffers:Zt,uniformValues:Qr,atlasTexture:Oe,atlasTextureIcon:je,atlasInterpolation:he,atlasInterpolationIcon:ae,isSDF:vt,hasHalo:mn,tile:Ft,labelPlaneMatrixInv:Pn};if(it&&Dt.canOverlap){ot=!0;const Dn=Zt.segments.get();for(const Kn of Dn)Ct.push({segments:new h.SegmentVector([Kn]),sortKey:Kn.sortKey,state:ss})}else Ct.push({segments:Zt.segments,sortKey:0,state:ss})}ot&&Ct.sort((Et,Ft)=>Et.sortKey-Ft.sortKey);for(const Et of Ct){const Ft=Et.state;if(d.terrain&&d.terrain.setupElevationDraw(Ft.tile,Ft.program,{useDepthForOcclusion:!wt,labelPlaneMatrixInv:Ft.labelPlaneMatrixInv}),$.activeTexture.set(X.TEXTURE0),Ft.atlasTexture.bind(Ft.atlasInterpolation,X.CLAMP_TO_EDGE),Ft.atlasTextureIcon&&($.activeTexture.set(X.TEXTURE1),Ft.atlasTextureIcon&&Ft.atlasTextureIcon.bind(Ft.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Ft.isSDF){const Dt=Ft.uniformValues;Ft.hasHalo&&(Dt.u_is_halo=1,Tc(Ft.buffers,Et.segments,l,d,Ft.program,pt,L,N,Dt)),Dt.u_is_halo=0}Tc(Ft.buffers,Et.segments,l,d,Ft.program,pt,L,N,Ft.uniformValues)}}function Tc(d,n,l,f,y,v,M,C,I){const D=f.context,L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];y.draw(D,D.gl.TRIANGLES,v,M,C,h.CullFaceMode.disabled,I,l.id,d.layoutVertexBuffer,d.indexBuffer,n,l.paint,f.transform.zoom,d.programConfigurations.get(l.id),L)}function Oh(d,n,l,f,y,v,M){const C=d.context.gl,I=l.paint.get("fill-pattern"),D=I&&I.constantOr(1);let L,N,$,X,H;M?(N=D&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=C.LINES):(N=D?"fillPattern":"fill",L=C.TRIANGLES);for(const Y of f){const K=n.getTile(Y);if(D&&!K.patternsLoaded())continue;const Z=K.getBucket(l);if(!Z)continue;d.prepareDrawTile();const rt=Z.programConfigurations.get(l.id),it=d.useProgram(N,rt);D&&(d.context.activeTexture.set(C.TEXTURE0),K.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),rt.updatePaintBuffers());const ot=I.constantOr(null);if(ot&&K.imageAtlas){const ut=K.imageAtlas.patternPositions[ot.toString()];ut&&rt.setConstantPatternPositions(ut)}const pt=d.translatePosMatrix(Y.projMatrix,K,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(M){X=Z.indexBuffer2,H=Z.segments2;const ut=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];$="fillOutlinePattern"===N&&D?Ph(pt,d,K,ut):zh(pt,ut)}else X=Z.indexBuffer,H=Z.segments,$=D?pl(pt,d,K):dl(pt);d.prepareDrawProgram(d.context,it,Y.toUnwrapped()),it.draw(d.context,L,y,d.stencilModeForClipping(Y),v,h.CullFaceMode.disabled,$,l.id,Z.layoutVertexBuffer,X,H,l.paint,d.transform.zoom,rt)}}function gl(d,n,l,f,y,v,M){const C=d.context,I=C.gl,D=d.transform,L=l.paint.get("fill-extrusion-pattern"),N=L.constantOr(1),$=l.paint.get("fill-extrusion-opacity"),X=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],H=l.layout.get("fill-extrusion-edge-radius"),Y="globe"===D.projection.name?h.fillExtrusionHeightLift():0,K="globe"===D.projection.name,Z=K?h.globeToMercatorTransition(D.zoom):0,rt=[h.mercatorXfromLng(D.center.lng),h.mercatorYfromLat(D.center.lat)],it=[];K&&it.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&it.push("FAUX_AO");for(const ot of f){const pt=n.getTile(ot),ut=pt.getBucket(l);if(!ut||ut.projection.name!==D.projection.name)continue;const ft=ut.programConfigurations.get(l.id),wt=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",ft,it);if(d.terrain){const Zt=d.terrain;if(d.style.terrainSetForDrapingOnly())Zt.setupElevationDraw(pt,wt,{useMeterToDem:!0});else{if(!ut.enableTerrain)continue;if(Zt.setupElevationDraw(pt,wt,{useMeterToDem:!0}),Fh(C,n,ot,ut,l,Zt),!ut.centroidVertexBuffer){const At=wt.attributes.a_centroid_pos;void 0!==At&&I.vertexAttrib2f(At,0,0)}}}N&&(d.context.activeTexture.set(I.TEXTURE0),pt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ft.updatePaintBuffers());const Ct=L.constantOr(null);if(Ct&&pt.imageAtlas){const Zt=pt.imageAtlas.patternPositions[Ct.toString()];Zt&&ft.setConstantPatternPositions(Zt)}const It=d.translatePosMatrix(ot.projMatrix,pt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Jt=D.projection.createInversionMatrix(D,ot.canonical),Et=l.paint.get("fill-extrusion-vertical-gradient"),Ft=N?ul(It,d,Et,$,X,H,ot,pt,Y,Z,rt,Jt):qr(It,d,Et,$,X,H,ot,Y,Z,rt,Jt);d.prepareDrawProgram(C,wt,ot.toUnwrapped());const Dt=[];d.terrain&&Dt.push(ut.centroidVertexBuffer),K&&Dt.push(ut.layoutVertexExtBuffer),wt.draw(C,C.gl.TRIANGLES,y,v,M,h.CullFaceMode.backCCW,Ft,l.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,l.paint,d.transform.zoom,ft,Dt)}}function Fh(d,n,l,f,y,v){const M=[Z=>{let rt=Z.canonical.x-1,it=Z.wrap;return rt<0&&(rt=(1<<Z.canonical.z)-1,it--),new h.OverscaledTileID(Z.overscaledZ,it,Z.canonical.z,rt,Z.canonical.y)},Z=>{let rt=Z.canonical.x+1,it=Z.wrap;return rt===1<<Z.canonical.z&&(rt=0,it++),new h.OverscaledTileID(Z.overscaledZ,it,Z.canonical.z,rt,Z.canonical.y)},Z=>new h.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(0===Z.canonical.y?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new h.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],C=Z=>{const rt=n.getSource().minzoom,it=pt=>{const ut=n.getTileByID(pt);if(ut&&ut.hasData())return ut.getBucket(y)},ot=[0,-1,1];for(const pt of ot){if(Z.overscaledZ+pt<rt)continue;const ut=it(Z.calculateScaledKey(Z.overscaledZ+pt));if(ut)return ut}},I=[0,0,0],D=(Z,rt)=>(I[0]=Math.min(Z.min.y,rt.min.y),I[1]=Math.max(Z.max.y,rt.max.y),I[2]=h.EXTENT-rt.min.x>Z.max.x?rt.min.x-h.EXTENT:Z.max.x,I),L=(Z,rt)=>(I[0]=Math.min(Z.min.x,rt.min.x),I[1]=Math.max(Z.max.x,rt.max.x),I[2]=h.EXTENT-rt.min.y>Z.max.y?rt.min.y-h.EXTENT:Z.max.y,I),N=[(Z,rt)=>D(Z,rt),(Z,rt)=>D(rt,Z),(Z,rt)=>L(Z,rt),(Z,rt)=>L(rt,Z)],$=new h.pointGeometry(0,0);let X,H,Y;const K=(Z,rt,it,ot,pt)=>{const ut=[[ot?it:Z,ot?Z:it,0],[ot?it:rt,ot?rt:it,0]],ft=pt<0?h.EXTENT+pt:pt,wt=[ot?ft:(Z+rt)/2,ot?(Z+rt)/2:ft,0];return 0===it&&pt<0||0!==it&&pt>0?v.getForTilePoints(Y,[wt],!0,H):ut.push(wt),v.getForTilePoints(l,ut,!0,X),Math.max(ut[0][2],ut[1][2],wt[2])/v.exaggeration()};for(let Z=0;Z<4;Z++){const rt=(Z<2?1:5)-Z,it=f.borders[Z];if(0===it.length)continue;const ot=Y=M[Z](l),pt=C(ot);if(!(pt&&pt instanceof h.FillExtrusionBucket&&pt.enableTerrain)||f.borderDoneWithNeighborZ[Z]===pt.canonical.z&&pt.borderDoneWithNeighborZ[rt]===f.canonical.z||(H=v.findDEMTileFor(ot),!H||!H.dem))continue;if(!X){const Ct=v.findDEMTileFor(l);if(!Ct||!Ct.dem)return;X=Ct}const ut=pt.borders[rt];let ft=0;const wt=pt.borderDoneWithNeighborZ[rt]!==f.canonical.z;if(f.canonical.z===pt.canonical.z){for(let Ct=0;Ct<it.length;Ct++){const It=f.featuresOnBorder[it[Ct]],Jt=It.borders[Z];let Et;for(;ft<ut.length&&(Et=pt.featuresOnBorder[ut[ft]],!(Et.borders[rt][1]>Jt[0]+3));)wt&&pt.encodeCentroid(void 0,Et,!1),ft++;if(Et&&ft<ut.length){const Ft=ft;let Dt=0;for(;!(Et.borders[rt][0]>Jt[1]-3)&&(Dt++,++ft!==ut.length);)Et=pt.featuresOnBorder[ut[ft]];if(Et=pt.featuresOnBorder[ut[Ft]],It.intersectsCount()>1||Et.intersectsCount()>1||1!==Dt){1!==Dt&&(ft=Ft),f.encodeCentroid(void 0,It,!1),wt&&pt.encodeCentroid(void 0,Et,!1);continue}const Zt=N[Z](It,Et),At=Z%2?h.EXTENT-1:0;$.x=K(Zt[0],Math.min(h.EXTENT-1,Zt[1]),At,Z<2,Zt[2]),$.y=0,f.encodeCentroid($,It,!1),wt&&pt.encodeCentroid($,Et,!1)}else f.encodeCentroid(void 0,It,!1)}f.borderDoneWithNeighborZ[Z]=pt.canonical.z,f.needsCentroidUpdate=!0,wt&&(pt.borderDoneWithNeighborZ[rt]=f.canonical.z,pt.needsCentroidUpdate=!0)}else{for(const Ct of it)f.encodeCentroid(void 0,f.featuresOnBorder[Ct],!1);if(wt){for(const Ct of ut)pt.encodeCentroid(void 0,pt.featuresOnBorder[Ct],!1);pt.borderDoneWithNeighborZ[rt]=f.canonical.z,pt.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[Z]=pt.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&0!==f.centroidVertexArray.length)&&f.uploadCentroid(d)}const Ec=new h.Color(1,0,0,1),Mc=new h.Color(0,1,0,1),Uh=new h.Color(0,0,1,1),Cc=new h.Color(1,0,1,1),Nh=new h.Color(0,1,1,1);function _l(d,n,l){const f=d.context,y=d.transform,v=f.gl,M="globe"===y.projection.name,C=M?["PROJECTION_GLOBE_VIEW"]:null;let I=l.projMatrix;if(M&&h.globeToMercatorTransition(y.zoom)>0){const It=h.transitionTileAABBinECEF(l.canonical,y),Jt=h.globeDenormalizeECEF(It);I=h.multiply(new Float32Array(16),y.globeMatrix,Jt),h.multiply(I,y.projMatrix,I)}const D=d.useProgram("debug",null,C),L=n.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(L,D);const N=h.DepthMode.disabled,$=h.StencilMode.disabled,X=d.colorModeForRenderPass(),H="$debug";f.activeTexture.set(v.TEXTURE0),d.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),M?L._makeGlobeTileDebugBuffers(d.context,y):L._makeDebugTileBoundsBuffers(d.context,y.projection);const Y=L._tileDebugBuffer||d.debugBuffer,K=L._tileDebugIndexBuffer||d.debugIndexBuffer,Z=L._tileDebugSegments||d.debugSegments;D.draw(f,v.LINE_STRIP,N,$,X,h.CullFaceMode.disabled,Yo(I,h.Color.red),H,Y,K,Z,null,null,null,[L._globeTileDebugBorderBuffer]);const rt=L.latestRawTileData,it=Math.floor((rt&&rt.byteLength||0)/1024),ot=n.getTile(l).tileSize,pt=512/Math.min(ot,512)*(l.overscaledZ/y.zoom)*.5;let ut=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ut+=` => ${l.overscaledZ}`),ut+=` ${it}kb`,function(It,Jt){It.initDebugOverlayCanvas();const Et=It.debugOverlayCanvas,Ft=It.context.gl,Dt=It.debugOverlayCanvas.getContext("2d");Dt.clearRect(0,0,Et.width,Et.height),Dt.shadowColor="white",Dt.shadowBlur=2,Dt.lineWidth=1.5,Dt.strokeStyle="white",Dt.textBaseline="top",Dt.font="bold 36px Open Sans, sans-serif",Dt.fillText(Jt,5,5),Dt.strokeText(Jt,5,5),It.debugOverlayTexture.update(Et),It.debugOverlayTexture.bind(Ft.LINEAR,Ft.CLAMP_TO_EDGE)}(d,ut);const ft=L._tileDebugTextBuffer||d.debugBuffer,wt=L._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ct=L._tileDebugTextSegments||d.debugSegments;D.draw(f,v.TRIANGLES,N,$,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,Yo(I,h.Color.transparent,pt),H,ft,wt,Ct,null,null,null,[L._globeTileDebugTextBuffer])}function Mo(d,n,l,f){Gn(d,0,n+l/2,d.transform.width,l,f)}function Bs(d,n,l,f){Gn(d,n-l/2,0,l,d.transform.height,f)}function Gn(d,n,l,f,y,v){const M=d.context,C=M.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*h.exported.devicePixelRatio,l*h.exported.devicePixelRatio,f*h.exported.devicePixelRatio,y*h.exported.devicePixelRatio),M.clear({color:v}),C.disable(C.SCISSOR_TEST)}const es=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Os}=es;function Hr(d,n,l,f){d.emplaceBack(n,l,f)}class ba{constructor(n){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,Hr(this.vertexArray,-1,-1,1),Hr(this.vertexArray,1,-1,1),Hr(this.vertexArray,-1,1,1),Hr(this.vertexArray,1,1,1),Hr(this.vertexArray,-1,-1,-1),Hr(this.vertexArray,1,-1,-1),Hr(this.vertexArray,-1,1,-1),Hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Os),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Ye(d,n,l,f,y,v){const M=d.gl,C=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),D=n.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:h.fromMat4(h.create$1(),f),u_sun_direction:y,u_sun_intensity:D,u_color_tint_r:[(H=C).r,H.g,H.b,H.a],u_color_tint_m:[(Y=I).r,Y.g,Y.b,Y.a],u_luminance:5e-5};var H,Y;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+v,n.skyboxTexture,0),l.draw(d,M.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const yl=h.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Vh{constructor(n){const l=new h.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const f=new h.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,yl.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=h.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Sc={symbol:function(d,n,l,f,y){if("translucent"!==d.renderPass)return;const v=h.StencilMode.disabled,M=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,I,D,L,N,$,X){const H=I.transform,Y="map"===N,K="map"===$;for(const Z of C){const rt=L.getTile(Z),it=rt.getBucket(D);if(!it||!it.text||!it.text.segments.get().length)continue;const ot=h.evaluateSizeForZoom(it.textSizeData,H.zoom),pt=ua(Z,it.getProjection(),H),ut=H.calculatePixelsToTileUnitsMatrix(rt),ft=Ms(pt,rt.tileID.canonical,K,Y,H,it.getProjection(),ut),wt="none"!==D.layout.get("icon-text-fit")&&it.hasIconData();if(ot){const Ct=Math.pow(2,H.zoom-rt.tileID.overscaledZ);ts(it,Y,K,X,h.symbolSize,H,ft,Z,Ct,ot,wt)}}}(f,d,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y),0!==l.paint.get("icon-opacity").constantOr(1)&&wc(d,n,l,f,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,M),0!==l.paint.get("text-opacity").constantOr(1)&&wc(d,n,l,f,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,M),n.map.showCollisionBoxes&&(Rh(d,n,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Rh(d,n,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,l,f){if("translucent"!==d.renderPass)return;const y=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),M=l.paint.get("circle-stroke-opacity"),C=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===v.constantOr(1)||0===M.constantOr(1)))return;const I=d.context,D=I.gl,L=d.transform,N=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),$=h.StencilMode.disabled,X=d.colorModeForRenderPass(),H="globe"===L.projection.name,Y=[h.mercatorXfromLng(L.center.lng),h.mercatorYfromLat(L.center.lat)],K=[];for(let rt=0;rt<f.length;rt++){const it=f[rt],ot=n.getTile(it),pt=ot.getBucket(l);if(!pt||pt.projection.name!==L.projection.name)continue;const ut=pt.programConfigurations.get(l.id),ft=ya(l);H&&ft.push("PROJECTION_GLOBE_VIEW");const wt=d.useProgram("circle",ut,ft),Ct=pt.layoutVertexBuffer,It=pt.globeExtVertexBuffer,Jt=pt.indexBuffer,Et=L.projection.createInversionMatrix(L,it.canonical),Ft={programConfiguration:ut,program:wt,layoutVertexBuffer:Ct,globeExtVertexBuffer:It,indexBuffer:Jt,uniformValues:_a(d,it,ot,Et,Y,l),tile:ot};if(C){const Dt=pt.segments.get();for(const Zt of Dt)K.push({segments:new h.SegmentVector([Zt]),sortKey:Zt.sortKey,state:Ft})}else K.push({segments:pt.segments,sortKey:0,state:Ft})}C&&K.sort((rt,it)=>rt.sortKey-it.sortKey);const Z={useDepthForOcclusion:!H};for(const rt of K){const{programConfiguration:it,program:ot,layoutVertexBuffer:pt,globeExtVertexBuffer:ut,indexBuffer:ft,uniformValues:wt,tile:Ct}=rt.state,It=rt.segments;d.terrain&&d.terrain.setupElevationDraw(Ct,ot,Z),d.prepareDrawProgram(I,ot,Ct.tileID.toUnwrapped()),ot.draw(I,D.TRIANGLES,N,$,X,h.CullFaceMode.disabled,wt,l.id,pt,ft,It,l.paint,L.zoom,it,[ut])}},heatmap:function(d,n,l,f){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const y=d.context,v=y.gl,M=h.StencilMode.disabled,C=new h.ColorMode([v.ONE,v.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(X,H,Y,K){const Z=X.gl,rt=H.width*K,it=H.height*K;X.activeTexture.set(Z.TEXTURE1),X.viewport.set([0,0,rt,it]);let ot=Y.heatmapFbo;if(!ot||ot&&(ot.width!==rt||ot.height!==it)){ot&&ot.destroy();const pt=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,pt),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ot=Y.heatmapFbo=X.createFramebuffer(rt,it,!1),function(ut,ft,wt,Ct,It,Jt){const Et=ut.gl;Et.texImage2D(Et.TEXTURE_2D,0,ut.isWebGL2&&ut.extRenderToTextureHalfFloat?Et.RGBA16F:Et.RGBA,It,Jt,0,Et.RGBA,ut.extRenderToTextureHalfFloat?ut.isWebGL2?Et.HALF_FLOAT:ut.extTextureHalfFloat.HALF_FLOAT_OES:Et.UNSIGNED_BYTE,null),Ct.colorAttachment.set(wt)}(X,0,pt,ot,rt,it)}else Z.bindTexture(Z.TEXTURE_2D,ot.colorAttachment.get()),X.bindFramebuffer.set(ot.framebuffer)})(y,d,l,"globe"===d.transform.projection.name?.5:.25),y.clear({color:h.Color.transparent});const I=d.transform,D="globe"===I.projection.name,L=D?["PROJECTION_GLOBE_VIEW"]:null,N=D?h.CullFaceMode.frontCCW:h.CullFaceMode.disabled,$=[h.mercatorXfromLng(I.center.lng),h.mercatorYfromLat(I.center.lat)];for(let X=0;X<f.length;X++){const H=f[X];if(n.hasRenderableParent(H))continue;const Y=n.getTile(H),K=Y.getBucket(l);if(!K||K.projection.name!==I.projection.name)continue;const Z=K.programConfigurations.get(l.id),rt=d.useProgram("heatmap",Z,L),{zoom:it}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Y,rt),d.prepareDrawProgram(y,rt,H.toUnwrapped());const ot=I.projection.createInversionMatrix(I,H.canonical);rt.draw(y,v.TRIANGLES,h.DepthMode.disabled,M,C,N,jn(d,H,Y,ot,$,it,l.paint.get("heatmap-intensity")),l.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,l.paint,d.transform.zoom,Z,D?[K.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,v){const M=y.context,C=M.gl,I=v.heatmapFbo;if(!I)return;M.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,I.colorAttachment.get()),M.activeTexture.set(C.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new h.Texture(M,v.colorRamp,C.RGBA)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(M,C.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,y.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(d,l))},line:function(d,n,l,f){if("translucent"!==d.renderPass)return;const y=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===y.constantOr(1)||0===v.constantOr(1))return;const M=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),C=d.colorModeForRenderPass(),I=d.terrain&&d.terrain.renderingToTexture?1:h.exported.devicePixelRatio,D=l.paint.get("line-dasharray"),L=D.constantOr(1),N=l.layout.get("line-cap"),$=l.paint.get("line-pattern"),X=$.constantOr(1),H=l.paint.get("line-gradient"),Y=X?"linePattern":"line",K=d.context,Z=K.gl,rt=(ot=>{const pt=[];ml(ot)&&pt.push("RENDER_LINE_DASH"),ot.paint.get("line-gradient")&&pt.push("RENDER_LINE_GRADIENT");const ut=ot.paint.get("line-trim-offset");0===ut[0]&&0===ut[1]||pt.push("RENDER_LINE_TRIM_OFFSET");const ft=ot.paint.get("line-pattern").constantOr(1),wt=1!==ot.paint.get("line-opacity").constantOr(1);return!ft&&wt&&pt.push("RENDER_LINE_ALPHA_DISCARD"),pt})(l);let it=rt.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(it=!1);for(const ot of f){const pt=n.getTile(ot);if(X&&!pt.patternsLoaded())continue;const ut=pt.getBucket(l);if(!ut)continue;d.prepareDrawTile();const ft=ut.programConfigurations.get(l.id),wt=d.useProgram(Y,ft,rt),Ct=$.constantOr(null);if(Ct&&pt.imageAtlas){const vt=pt.imageAtlas.patternPositions[Ct.toString()];vt&&ft.setConstantPatternPositions(vt)}const It=D.constantOr(null),Jt=N.constantOr(null);if(!X&&It&&Jt&&pt.lineAtlas){const vt=pt.lineAtlas.getDash(It,Jt);vt&&ft.setConstantPatternPositions(vt)}let[Et,Ft]=l.paint.get("line-trim-offset");("round"===Jt||"square"===Jt)&&Et!==Ft&&(0===Et&&(Et-=1),1===Ft&&(Ft+=1));const Dt=d.terrain?ot.projMatrix:null,Zt=X?Dh(d,pt,l,Dt,I):gc(d,pt,l,Dt,ut.lineClipsArray.length,I,[Et,Ft]);if(H){const vt=ut.gradients[l.id];let kt=vt.texture;if(l.gradientVersion!==vt.version){let Ut=256;if(l.stepInterpolant){const $t=n.getSource().maxzoom,me=ot.canonical.z===$t?Math.ceil(1<<d.transform.maxZoom-ot.canonical.z):1;Ut=h.clamp(h.nextPowerOfTwo(ut.maxLineLength/h.EXTENT*1024*me),256,K.maxTextureSize)}vt.gradient=h.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:vt.gradient||void 0,clips:ut.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new h.Texture(K,vt.gradient,Z.RGBA),vt.version=l.gradientVersion,kt=vt.texture}K.activeTexture.set(Z.TEXTURE1),kt.bind(l.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}L&&(K.activeTexture.set(Z.TEXTURE0),pt.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),ft.updatePaintBuffers()),X&&(K.activeTexture.set(Z.TEXTURE0),pt.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ft.updatePaintBuffers()),d.prepareDrawProgram(K,wt,ot.toUnwrapped());const At=vt=>{wt.draw(K,Z.TRIANGLES,M,vt,C,h.CullFaceMode.disabled,Zt,l.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,l.paint,d.transform.zoom,ft,[ut.layoutVertexBuffer2])};if(it){const vt=d.stencilModeForClipping(ot).ref;0===vt&&d.terrain&&K.clear({stencil:0});const kt={func:Z.EQUAL,mask:255};Zt.u_alpha_discard_threshold=.8,At(new h.StencilMode(kt,vt,255,Z.KEEP,Z.KEEP,Z.INVERT)),Zt.u_alpha_discard_threshold=0,At(new h.StencilMode(kt,vt,255,Z.KEEP,Z.KEEP,Z.KEEP))}else At(d.stencilModeForClipping(ot))}it&&(d.resetStencilClippingMasks(),d.terrain&&K.clear({stencil:0}))},fill:function(d,n,l,f){const y=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const M=d.colorModeForRenderPass(),C=l.paint.get("fill-pattern"),I=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===y.constantOr(h.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(d.renderPass===I){const D=d.depthModeForSublayer(1,"opaque"===d.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);Oh(d,n,l,f,D,M,!1)}if("translucent"===d.renderPass&&l.paint.get("fill-antialias")){const D=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);Oh(d,n,l,f,D,M,!0)}},"fill-extrusion":function(d,n,l,f){const y=l.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===d.renderPass){const v=new h.DepthMode(d.context.gl.LEQUAL,h.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==y||l.paint.get("fill-extrusion-pattern").constantOr(1))gl(d,n,l,f,v,h.StencilMode.disabled,h.ColorMode.disabled),gl(d,n,l,f,v,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const M=d.colorModeForRenderPass();gl(d,n,l,f,v,h.StencilMode.disabled,M)}}},hillshade:function(d,n,l,f){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const y=d.context,v=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),M=d.colorModeForRenderPass(),C=d.terrain&&d.terrain.renderingToTexture,[I,D]="translucent"!==d.renderPass||C?[{},f]:d.stencilConfigForOverlap(f);for(const L of D){const N=n.getTile(L);if(N.needsHillshadePrepare&&"offscreen"===d.renderPass)ol(d,N,l,v,h.StencilMode.disabled,M);else if("translucent"===d.renderPass){const $=C&&d.terrain?d.terrain.stencilModeForRTTOverlap(L):I[L.overscaledZ];Mr(d,L,N,l,v,$,M)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,l,f,y,v){if("translucent"!==d.renderPass||0===l.paint.get("raster-opacity")||!f.length)return;const M=d.context,C=M.gl,I=n.getSource(),D=d.useProgram("raster"),L=d.colorModeForRenderPass(),N=d.terrain&&d.terrain.renderingToTexture,[$,X]=I instanceof ct||N?[{},f]:d.stencilConfigForOverlap(f),H=X[X.length-1].overscaledZ,Y=!d.options.moving;for(const K of X){const Z=N?h.DepthMode.disabled:d.depthModeForSublayer(K.overscaledZ-H,1===l.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,C.LESS),rt=K.toUnwrapped(),it=n.getTile(K);if(N&&(!it||!it.hasData()))continue;const ot=N?K.projMatrix:d.transform.calculateProjMatrix(rt,Y),pt=d.terrain&&N?d.terrain.stencilModeForRTTOverlap(K):$[K.overscaledZ],ut=v?0:l.paint.get("raster-fade-duration");it.registerFadeDuration(ut);const ft=n.findLoadedParent(K,0),wt=Ls(it,ft,n,d.transform,ut);let Ct,It;d.terrain&&d.terrain.prepareDrawTile();const Jt="nearest"===l.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;M.activeTexture.set(C.TEXTURE0),it.texture.bind(Jt,C.CLAMP_TO_EDGE),M.activeTexture.set(C.TEXTURE1),ft?(ft.texture.bind(Jt,C.CLAMP_TO_EDGE),Ct=Math.pow(2,ft.tileID.overscaledZ-it.tileID.overscaledZ),It=[it.tileID.canonical.x*Ct%1,it.tileID.canonical.y*Ct%1]):it.texture.bind(Jt,C.CLAMP_TO_EDGE);const Et=Jo(ot,It||[0,0],Ct||1,wt,l,I instanceof ct?I.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(M,D,rt),I instanceof ct)I.boundsBuffer&&I.boundsSegments&&D.draw(M,C.TRIANGLES,Z,h.StencilMode.disabled,L,h.CullFaceMode.disabled,Et,l.id,I.boundsBuffer,d.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Ft,tileBoundsIndexBuffer:Dt,tileBoundsSegments:Zt}=d.getTileBoundsBuffers(it);D.draw(M,C.TRIANGLES,Z,pt,L,h.CullFaceMode.disabled,Et,l.id,Ft,Dt,Zt)}}d.resetStencilClippingMasks()},background:function(d,n,l,f){const y=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const M=d.context,C=M.gl,I=d.transform,D=I.tileSize,L=l.paint.get("background-pattern");if(d.isPatternMissing(L))return;const N=!L&&1===y.a&&1===v&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;const $=h.StencilMode.disabled,X=d.depthModeForSublayer(0,"opaque"===N?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),H=d.colorModeForRenderPass(),Y=d.useProgram(L?"backgroundPattern":"background");let K,Z=f;Z||(K=d.getBackgroundTiles(),Z=Object.values(K).map(rt=>rt.tileID)),L&&(M.activeTexture.set(C.TEXTURE0),d.imageManager.bind(d.context));for(const rt of Z){const it=rt.toUnwrapped(),ot=f?rt.projMatrix:d.transform.calculateProjMatrix(it);d.prepareDrawTile();const pt=n?n.getTile(rt):K?K[rt.key]:new h.Tile(rt,D,I.zoom,d),ut=L?Wr(ot,v,d,L,{tileID:rt,tileSize:D}):Lh(ot,v,y);d.prepareDrawProgram(M,Y,it);const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:wt,tileBoundsSegments:Ct}=d.getTileBoundsBuffers(pt);Y.draw(M,C.TRIANGLES,X,$,H,h.CullFaceMode.disabled,ut,l.id,ft,wt,Ct)}},sky:function(d,n,l){const f=d.transform,y="mercator"===f.projection.name||"globe"===f.projection.name?1:h.smoothstep(7,8,f.zoom),v=l.paint.get("sky-opacity")*y;if(0===v)return;const M=d.context,C=l.paint.get("sky-type"),I=new h.DepthMode(M.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),D=d.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===d.renderPass?l.needsSkyboxCapture(d)&&(function(L,N,$,X){const H=L.context,Y=H.gl;let K=N.skyboxFbo;if(!K){K=N.skyboxFbo=H.createFramebuffer(32,32,!1),N.skyboxGeometry=new ba(H),N.skyboxTexture=H.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,N.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ot=0;ot<6;++ot)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(K.framebuffer),H.viewport.set([0,0,32,32]);const Z=N.getCenter(L,!0),rt=L.useProgram("skyboxCapture"),it=new Float64Array(16);h.identity(it),h.rotateY(it,it,.5*-Math.PI),Ye(H,N,rt,it,Z,0),h.identity(it),h.rotateY(it,it,.5*Math.PI),Ye(H,N,rt,it,Z,1),h.identity(it),h.rotateX(it,it,.5*-Math.PI),Ye(H,N,rt,it,Z,2),h.identity(it),h.rotateX(it,it,.5*Math.PI),Ye(H,N,rt,it,Z,3),h.identity(it),Ye(H,N,rt,it,Z,4),h.identity(it),h.rotateY(it,it,Math.PI),Ye(H,N,rt,it,Z,5),H.viewport.set([0,0,L.width,L.height])}(d,l),l.markSkyboxValid(d)):"sky"===d.renderPass&&function(L,N,$,X,H){const Y=L.context,K=Y.gl,Z=L.transform,rt=L.useProgram("skybox");Y.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture);const it={u_matrix:Z.skyboxMatrix,u_sun_direction:N.getCenter(L,!1),u_cubemap:0,u_opacity:X,u_temporal_offset:H};L.prepareDrawProgram(Y,rt),rt.draw(Y,K.TRIANGLES,$,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,it,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(d,l,I,v,D):"gradient"===C&&"sky"===d.renderPass&&function(L,N,$,X,H){const Y=L.context,K=Y.gl,Z=L.transform,rt=L.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new ba(Y)),Y.activeTexture.set(K.TEXTURE0);let it=N.colorRampTexture;it||(it=N.colorRampTexture=new h.Texture(Y,N.colorRamp,K.RGBA)),it.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ot=(pt=Z.skyboxMatrix,ut=N.getCenter(L,!1),ft=N.paint.get("sky-gradient-radius"),wt=X,Ct=H,{u_matrix:pt,u_color_ramp:0,u_center_direction:ut,u_radius:h.degToRad(ft),u_opacity:wt,u_temporal_offset:Ct});var pt,ut,ft,wt,Ct;L.prepareDrawProgram(Y,rt),rt.draw(Y,K.TRIANGLES,$,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,ot,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(d,l,I,v,D)},debug:function(d,n,l){for(let f=0;f<l.length;f++)_l(d,n,l[f])},custom:function(d,n,l,f){const y=d.context,v=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||"offscreen"===d.renderPass)&&l.isLayerDraped()){if("offscreen"===d.renderPass){const M=v.prerender;if(M){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),"globe"===d.transform.projection.name){const C=d.transform.pointMerc;M.call(v,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),h.globeToMercatorTransition(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else M.call(v,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if("translucent"===d.renderPass){if(d.terrain&&d.terrain.renderingToTexture){const C=v.renderToTile;if(C){const I=f[0].canonical,D=new h.MercatorCoordinate(I.x+f[0].wrap*(1<<I.z),I.y,I.z);y.setDepthMode(h.DepthMode.disabled),y.setStencilMode(h.StencilMode.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),C.call(v,y.gl,D),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(h.StencilMode.disabled);const M="3d"===v.renderingMode?new h.DepthMode(d.context.gl.LEQUAL,h.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,h.DepthMode.ReadOnly);if(y.setDepthMode(M),"globe"===d.transform.projection.name){const C=d.transform.pointMerc;v.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),h.globeToMercatorTransition(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else v.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else h.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class wa{constructor(n,l,f=!1){this.context=new J(n,f),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ks,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hl(this,n));const y=this._terrain;this.transform.elevation=f?y:null,y.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=l.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const v=f+.78*(y-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*h.exported.devicePixelRatio,this.height=l*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const n=this.context,l=new h.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(h.EXTENT,0),l.emplaceBack(0,h.EXTENT),l.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const f=new h.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(h.EXTENT,0),f.emplaceBack(0,h.EXTENT),f.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=n.createVertexBuffer(f,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const y=new h.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const v=new h.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(h.EXTENT,0,h.EXTENT,0),v.emplaceBack(0,h.EXTENT,0,h.EXTENT),v.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(v,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const M=new h.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(M);const C=new h.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])C.emplaceBack(D);this.debugIndexBuffer=n.createIndexBuffer(C),this.emptyTexture=new h.Texture(n,new h.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=h.create();const I=this.context.gl;this.stencilClearMode=new h.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(h.window.performance.now()),this.atmosphereBuffer=new Vh(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,He(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,f){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!f||0===f.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const I of f)if(void 0===this._tileClippingMaskIDs[I.key]){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const y=this.context,v=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(h.ColorMode.disabled),y.setDepthMode(h.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of f){const I=l.getTile(C),D=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:$}=this.getTileBoundsBuffers(I);M.draw(y,v.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,He(C.projMatrix),"$clipping",L,N,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new h.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new h.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,f=n.sort((M,C)=>C.overscaledZ-M.overscaledZ),y=f[f.length-1].overscaledZ,v=f[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const M={};for(let C=0;C<v;C++)M[C+y]=new h.StencilMode({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[M,f]}return[{[y]:h.StencilMode.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new h.ColorMode([n.CONSTANT_COLOR,n.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(n,l,f){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new h.DepthMode(f||this.context.gl.LEQUAL,l,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const f=this.style.order,y=this.style._sourceCaches;for(const I in y){const D=y[I];D.used&&D.prepare(this.context)}const v={},M={},C={};for(const I in y){const D=y[I];v[I]=D.getVisibleCoordinates(),M[I]=v[I].slice().reverse(),C[I]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<f.length;I++)if(this.style._layers[f[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),h.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of f){const D=this.style._layers[I],L=n._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const N=L?M[L.id]:void 0;("custom"===D.type||D.isSky()||N&&N.length)&&this.renderLayer(this,L,D,N)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[f[this.currentLayer]],D=n._getLayerSourceCache(I);if(I.isSky())continue;const L=D?M[D.id]:void 0;this._renderTileClippingMasks(I,D,L),this.renderLayer(this,D,I,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,D){const L=I.context,N=L.gl,$=I.transform,X=new h.DepthMode(N.LEQUAL,h.DepthMode.ReadOnly,[0,1]),H=I.useProgram("globeAtmosphere",null,"globe"===$.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=h.globeToMercatorTransition($.zoom),K=D.properties.get("color").toArray01(),Z=D.properties.get("high-color").toArray01(),rt=D.properties.get("space-color").toArray01PremultipliedAlpha(),it=h.identity$1([]);h.rotateY$1(it,it,-h.degToRad($._center.lng)),h.rotateX$1(it,it,h.degToRad($._center.lat)),h.rotateZ$1(it,it,$.angle),h.rotateX$1(it,it,-$._pitch);const ot=h.fromQuat(new Float32Array(16),it),pt=h.mapValue(D.properties.get("star-intensity"),0,1,0,.25),ft=h.mapValue(D.properties.get("horizon-blend"),0,1,5e-4,.25),wt=h.globeUseCustomAntiAliasing(I,L,$)&&5e-4===ft?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Ct=I.frameCounter/1e3%1,It=h.length($.globeCenterInViewSpace),Jt=Math.sqrt(Math.pow(It,2)-Math.pow(wt,2)),Et=Math.acos(Jt/It),Ft={u_frustum_tl:$.frustumCorners.TL,u_frustum_tr:$.frustumCorners.TR,u_frustum_br:$.frustumCorners.BR,u_frustum_bl:$.frustumCorners.BL,u_horizon:$.frustumCorners.horizon,u_transition:Y,u_fadeout_range:ft,u_color:K,u_high_color:Z,u_space_color:rt,u_star_intensity:pt,u_star_size:5*h.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ct,u_horizon_angle:Et,u_rotation_matrix:ot};I.prepareDrawProgram(L,H);const Dt=I.atmosphereBuffer;Dt&&H.draw(L,N.TRIANGLES,X,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,Ft,"skybox",Dt.vertexBuffer,Dt.indexBuffer,Dt.segments)}(this,this.style.fog),this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const I=this.style._layers[f[this.currentLayer]],D=n._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,D,I,D?M[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const I=this.style._layers[f[this.currentLayer]],D=n._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=D?("symbol"===I.type?C:M)[D.id]:void 0;this._renderTileClippingMasks(I,D,D?v[D.id]:void 0),this.renderLayer(this,D,I,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;h.values(this.style._layers).forEach(D=>{const L=n._getLayerSourceCache(D);L&&!D.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<L.getSource().maxzoom)&&(I=L)}),I&&this.options.showTileBoundaries&&Sc.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const D=I.transform.padding;Mo(I,I.transform.height-(D.top||0),3,Ec),Mo(I,D.bottom||0,3,Mc),Bs(I,D.left||0,3,Uh),Bs(I,I.transform.width-(D.right||0),3,Cc);const L=I.transform.centerPoint;var N,$,X,H;Gn(N=I,($=L.x)-1,(X=I.transform.height-L.y)-10,2,20,H=Nh),Gn(N,$-10,X-1,20,2,H)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,l,f,y){f.isHidden(this.transform.zoom)||("background"===f.type||"sky"===f.type||"custom"===f.type||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&"custom"===f.type)&&Sc[f.type](n,l,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),f.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),n.beginQueryEXT(n.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const f in n){const y=n[f],v=this.context.extTimerQuery,M=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),l[f]=M}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let f=0;for(const y of n)f+=l.getQueryObjectEXT(y,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(y);return f}translatePosMatrix(n,l,f,y,v){if(!f[0]&&!f[1])return n;const M=v?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(M){const D=Math.sin(M),L=Math.cos(M);f=[f[0]*L-f[1]*D,f[0]*D+f[1]*L]}const C=[v?f[0]:fr(l,f[0],this.transform.zoom),v?f[1]:fr(l,f[1],this.transform.zoom),0],I=new Float32Array(16);return h.translate(I,n,C),I}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){return null===n||void 0!==n&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&0===this.terrain.exaggeration(),f=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),"globe"===this.transform.projection.name&&y.push("GLOBE"),l&&y.push("ZERO_EXAGGERATION"),f&&!n&&0!==f.getOpacity(this.transform.pitch)&&y.push("FOG"),n&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(n,l,f){this.cache=this.cache||{};const y=f||[],v=this.currentGlobalDefines().concat(y),M=pc.cacheKey(Gi[n],n,v,l);return this.cache[M]||(this.cache[M]=new pc(this.context,n,Gi[n],l,nd[n],v)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,l,f){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch),M=((C,I,D,L,N,$,X,H,Y,K,Z)=>{const rt=C.transform,it=I.properties.get("color").toArray01();it[3]=L;const ot=C.frameCounter/1e3%1;return{u_fog_matrix:D?rt.calculateFogTileMatrix(D):C.identityMat,u_fog_range:I.getFovAdjustedRange(rt._fov),u_fog_color:it,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:ot,u_frustum_tl:N,u_frustum_tr:$,u_frustum_br:X,u_frustum_bl:H,u_globe_pos:Y,u_globe_radius:K,u_viewport:Z,u_globe_transition:h.globeToMercatorTransition(rt.zoom),u_is_globe:+("globe"===rt.projection.name)}})(this,y,f,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.exported.devicePixelRatio,this.transform.height*h.exported.devicePixelRatio]);l.setFogUniformValues(n,M)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)l[y.key]=n[y.key]||new h.Tile(y,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class xl{constructor(n=0,l=0,f=0,y=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=f,this.right=y}interpolate(n,l,f){return null!=l.top&&null!=n.top&&(this.top=h.number(n.top,l.top,f)),null!=l.bottom&&null!=n.bottom&&(this.bottom=h.number(n.bottom,l.bottom,f)),null!=l.left&&null!=n.left&&(this.left=h.number(n.left,l.left,f)),null!=l.right&&null!=n.right&&(this.right=h.number(n.right,l.right,f)),this}getCenter(n,l){const f=h.clamp((this.left+n-this.right)/2,0,n),y=h.clamp((this.top+l-this.bottom)/2,0,l);return new h.pointGeometry(f,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new xl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ac(d,n){const l=h.getColumn(d,3);h.fromQuat(d,n),h.setColumn(d,3,l)}function vl(d,n){const l=h.identity$1([]);return h.rotateZ$1(l,l,-n),h.rotateX$1(l,l,-d),l}function Ic(d,n){const l=[d[0],d[1],0],f=[n[0],n[1],0];if(h.length(l)>=1e-15){const M=h.normalize([],l);h.scale$2(f,M,h.dot(f,M)),n[0]=f[0],n[1]=f[1]}const y=h.cross([],n,d);if(h.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return vl(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class bl{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof h.MercatorCoordinate?n:new h.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=h.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const f=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(n)):0,y=this.position,v=h.MercatorCoordinate.fromLngLat(n,f),M=[v.x-y.x,v.y-y.y,v.z-y.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Ic(M,l)}setPitchBearing(n,l){this.orientation=vl(h.degToRad(n),h.degToRad(-l))}}class Fs{constructor(n,l){this._transform=h.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new h.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=h.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&h.setColumn(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||h.identity$1([]),n&&Ac(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=vl(n,l),Ac(this._transform,this._orientation)}forward(){const n=h.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=h.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=h.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const f=new Float64Array(16);return h.invert(f,this.getWorldToCamera(n,l)),f}getWorldToCameraPosition(n,l,f){const y=this.position;h.scale$2(y,y,-n);const v=new Float64Array(16);return h.fromScaling(v,[f,f,f]),h.translate(v,v,y),v[10]*=l,v}getWorldToCamera(n,l){const f=new Float64Array(16),y=new Float64Array(4),v=this.position;return h.conjugate(y,this._orientation),h.scale$2(v,v,-n),h.fromQuat(f,y),h.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=l,f[9]*=l,f[10]*=l,f[11]*=l,f}getCameraToClipPerspective(n,l,f,y){const v=new Float64Array(16);return h.perspective(v,n,l,f,y),v}getDistanceToElevation(n,l=!1){const f=0===n?0:h.mercatorZfromAltitude(n,l?h.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(f-this.position[2])/y[2]}clone(){return new Fs([...this.position],[...this.orientation])}}function Us(d,n){const l=Co(d.projection,d.zoom,d.width,d.height),f=function(v,M,C,I,D){const L=new h.LngLat(C.lng-180*Xr,C.lat),N=new h.LngLat(C.lng+180*Xr,C.lat),$=v.project(L.lng,L.lat),X=v.project(N.lng,N.lat),H=-Math.atan2(X.y-$.y,X.x-$.x),Y=h.MercatorCoordinate.fromLngLat(C);Y.y=h.clamp(Y.y,-.999975,.999975);const K=Y.toLngLat(),Z=v.project(K.lng,K.lat),rt=h.MercatorCoordinate.fromLngLat(K);rt.x+=Xr;const it=rt.toLngLat(),ot=v.project(it.lng,it.lat),pt=Ma(ot.x-Z.x,ot.y-Z.y,H),ut=h.MercatorCoordinate.fromLngLat(K);ut.y+=Xr;const ft=ut.toLngLat(),wt=v.project(ft.lng,ft.lat),Ct=Ma(wt.x-Z.x,wt.y-Z.y,H),It=Math.abs(pt.x)/Math.abs(Ct.y),Jt=h.identity([]);h.rotateZ(Jt,Jt,-H*(1-(D?0:I)));const Et=h.identity([]);return h.scale(Et,Et,[1,1-(1-It)*I,1]),Et[4]=-Ct.x/Ct.y*I,h.rotateZ(Et,Et,H),h.multiply(Et,Jt,Et),Et}(d.projection,0,d.center,l,n),y=Ta(d);return h.scale(f,f,[y,y,1]),f}function Ta(d){const n=d.projection,l=Co(d.projection,d.zoom,d.width,d.height),f=Ea(n,d.center),y=Ea(n,h.LngLat.convert(n.center));return Math.pow(2,f*l+(1-l)*y)}function Co(d,n,l,f,y=1/0){const v=d.range;if(!v)return 0;const M=Math.min(y,Math.max(l,f)),C=Math.log(M/1024)/Math.LN2;return h.smoothstep(v[0]+C,v[1]+C,n)}const Xr=1/4e4;function Ea(d,n){const l=h.clamp(n.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),f=new h.LngLat(n.lng-180*Xr,l),y=new h.LngLat(n.lng+180*Xr,l),v=d.project(f.lng,l),M=d.project(y.lng,l),C=h.MercatorCoordinate.fromLngLat(f),I=h.MercatorCoordinate.fromLngLat(y),D=M.x-v.x,L=M.y-v.y,N=I.x-C.x,$=I.y-C.y,X=Math.sqrt((N*N+$*$)/(D*D+L*L));return Math.log(X)/Math.LN2}function Ma(d,n,l){const f=Math.cos(l),y=Math.sin(l);return{x:d*f-n*y,y:d*y+n*f}}class re{constructor(n,l,f,y,v,M,C){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=y??60,this.setProjection(M),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new re(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,l=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=h.getProjection(this.projectionOptions);const f=!Xt(l,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=h.getProjection({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var f,y,v,M,C,I,D,L,N,$;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(f=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),y=this.rotationMatrix,M=this.angle,C=(v=this.rotationMatrix)[0],I=v[1],D=v[2],L=v[3],N=Math.sin(M),$=Math.cos(M),y[0]=C*$+D*N,y[1]=I*$+L*N,y[2]=C*-N+D*$,y[3]=I*-N+L*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=h.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=h.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,v=0;for(let M=0;M<l.length;M++){const C=new h.pointGeometry(l[M][0]*this.width,f+l[M][1]*(this.height-f)),I=n.pointCoordinate(C);if(!I)continue;const D=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*D,v+=D}return 0===v?NaN:y/v}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(n),v=this._mercatorZfromZoom(this._maxZoom),M=Math.max(y-f,v);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const y=h.length(h.sub([],this._camera.position,f));return h.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!h.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];h.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new bl;return l.position=new h.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!h.length$1(n))return!1;h.normalize$1(n,n);const l=h.transformQuat([],[0,0,-1],n),f=h.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const y=Ic(l,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=h.clamp(n[2],y/f,y/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,f){this._unmodified=!1,this._edgeInsets.interpolate(n,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new h.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new h.pointGeometry(0,0)),y=this.pointCoordinate(new h.pointGeometry(this.width,0)),v=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new h.pointGeometry(0,this.height)),C=Math.floor(Math.min(f.x,y.x,v.x,M.x)),I=Math.floor(Math.max(f.x,y.x,v.x,M.x)),D=1;for(let L=C-D;L<=I+D;L++)0!==L&&l.push(new h.UnwrappedTileID(L,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const f=l,y=this.elevation&&!n.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==n.minzoom&&l<n.minzoom)return[];void 0!==n.maxzoom&&l>n.maxzoom&&(l=n.maxzoom);const M=this.locationCoordinate(this.center),C=this.center.lat,I=1<<l,D=[I*M.x,I*M.y,0],L="globe"===this.projection.name,N=!L,$=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,N),X=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=I*h.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),K=[I*X.x,I*X.y,Y*(N?1:H)],Z=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),rt=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,it=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ot=n.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,pt=this.projection.isReprojectedInTileSpace?Ta(this):1,ut=At=>{const kt=new h.MercatorCoordinate(At.x+25e-6,At.y,At.z),Ut=new h.MercatorCoordinate(At.x,At.y+25e-6,At.z),$t=At.toLngLat(),me=kt.toLngLat(),Oe=Ut.toLngLat(),he=this.locationCoordinate($t),ae=this.locationCoordinate(me),ge=this.locationCoordinate(Oe),je=Math.hypot(ae.x-he.x,ae.y-he.y),be=Math.hypot(ge.x-he.x,ge.y-he.y);return Math.sqrt(je*be)*pt/25e-6},ft=At=>{const vt=it,kt=ot;return{aabb:h.tileAABB(this,I,0,0,0,At,kt,vt,this.projection),zoom:0,x:0,y:0,minZ:kt,maxZ:vt,wrap:At,fullyVisible:!1}},wt=[];let Ct=[];const It=l,Jt=n.reparseOverscaled?f:l,Et=At=>At*At,Ft=Et((Y-this._centerAltitude)*H),Dt=At=>{if(!this._elevation||!At.tileID||!v)return;const vt=this._elevation.getMinMaxForTile(At.tileID),kt=At.aabb;vt?(kt.min[2]=vt.min,kt.max[2]=vt.max,kt.center[2]=(kt.min[2]+kt.max[2])/2):(At.shouldSplit=Zt(At),At.shouldSplit||(kt.min[2]=kt.max[2]=kt.center[2]=this._centerAltitude))},Zt=At=>{if(At.zoom<rt)return!0;if(At.zoom===It)return!1;if(null!=At.shouldSplit)return At.shouldSplit;const vt=At.aabb.distanceX(K),kt=At.aabb.distanceY(K);let Ut=Ft,$t=1;if(L){Ut=Et(At.aabb.distanceZ(K));const he=Math.pow(2,At.zoom),ae=h.latFromMercatorY((At.y+1)/he),ge=h.latFromMercatorY(At.y/he),je=Math.min(Math.max(C,ae),ge),be=h.circumferenceAtLatitude(je)/h.circumferenceAtLatitude(C);if($t=je===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,be/this._mercatorScaleRatio),this.zoom<=h.GLOBE_ZOOM_THRESHOLD_MIN&&At.zoom===It-1&&be>=.9)return!0}else if(y&&(Ut=Et(At.aabb.distanceZ(K)*H)),this.projection.isReprojectedInTileSpace&&f<=5){const he=Math.pow(2,At.zoom),ae=ut(new h.MercatorCoordinate((At.x+.5)/he,(At.y+.5)/he));$t=ae>.85?1:ae}const me=vt*vt+kt*kt+Ut;return me<Et((1<<It-At.zoom)*Z*$t*((he,ae)=>{if(ae*Et(.707)<he)return 1;const ge=Math.sqrt(ae/he);return ge/(1.4144271570014144+(Math.pow(1.1,ge-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ut,Ft),me))};if(this.renderWorldCopies)for(let At=1;At<=3;At++)wt.push(ft(-At)),wt.push(ft(At));for(wt.push(ft(0));wt.length>0;){const At=wt.pop(),vt=At.x,kt=At.y;let Ut=At.fullyVisible;if(!Ut){const $t=At.aabb.intersects($);if(0===$t)continue;Ut=2===$t}if(At.zoom!==It&&Zt(At))for(let $t=0;$t<4;$t++){const me=(vt<<1)+$t%2,Oe=(kt<<1)+($t>>1),he={aabb:v?At.aabb.quadrant($t):h.tileAABB(this,I,At.zoom+1,me,Oe,At.wrap,At.minZ,At.maxZ,this.projection),zoom:At.zoom+1,x:me,y:Oe,wrap:At.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:At.minZ,maxZ:At.maxZ};y&&!L&&(he.tileID=new h.OverscaledTileID(At.zoom+1===It?Jt:At.zoom+1,At.wrap,At.zoom+1,me,Oe),Dt(he)),wt.push(he)}else{const $t=At.zoom===It?Jt:At.zoom;if(n.minzoom&&n.minzoom>$t)continue;const me=D[0]-(.5+vt+(At.wrap<<At.zoom))*(1<<l-At.zoom),Oe=D[1]-.5-kt,he=At.tileID?At.tileID:new h.OverscaledTileID($t,At.wrap,At.zoom,vt,kt);Ct.push({tileID:he,distanceSq:me*me+Oe*Oe})}}if(this.fogCullDistSq){const At=this.fogCullDistSq,vt=this.horizonLineFromTop();Ct=Ct.filter(kt=>{const Ut=[0,0,0,1],$t=[h.EXTENT,h.EXTENT,0,1],me=this.calculateFogTileMatrix(kt.tileID.toUnwrapped());h.transformMat4$1(Ut,Ut,me),h.transformMat4$1($t,$t,me);const Oe=h.getAABBPointSquareDist(Ut,$t);if(0===Oe)return!0;let he=!1;const ae=this._elevation;if(ae&&Oe>At&&0!==vt){const ge=this.calculateProjMatrix(kt.tileID.toUnwrapped());let je;n.isTerrainDEM||(je=ae.getMinMaxForTile(kt.tileID)),je||(je={min:ot,max:it});const be=h.furthestTileCorner(this.rotation),ri=[be[0]*h.EXTENT,be[1]*h.EXTENT,je.max];h.transformMat4(ri,ri,ge),he=(1-ri[1])*this.height*.5<vt}return Oe<At||he})}return Ct.sort((At,vt)=>At.distanceSq-vt.distanceSq).map(At=>At.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=h.clamp(n.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),f=this.projection.project(n.lng,l);return new h.pointGeometry(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/h.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let f,y;const v=this.centerPoint;if("globe"===this.projection.name){const C=this.worldSize;f=(l.x-v.x)/C,y=(l.y-v.y)/C}else{const C=this.pointCoordinate(l),I=this.pointCoordinate(v);f=C.x-I.x,y=C.y-I.y}const M=this.locationCoordinate(n);this.setLocation(new h.MercatorCoordinate(M.x-f,M.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const f=l?h.mercatorZfromAltitude(l,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new h.MercatorCoordinate(y.x,y.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const f=l??this._centerAltitude,y=[n.x,n.y,0,1],v=[n.x,n.y,1,1];h.transformMat4$1(y,y,this.pixelMatrixInverse),h.transformMat4$1(v,v,this.pixelMatrixInverse);const M=v[3];h.scale$1(y,y,1/y[3]),h.scale$1(v,v,1/M);const C=y[2],I=v[2];return{p0:y,p1:v,t:C===I?0:(f-C)/(I-C)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return h.transformMat4$1(l,l,this.pixelMatrixInverse),h.transformMat4$1(f,f,this.pixelMatrixInverse),h.scale$1(l,l,1/l[3]),h.scale$1(f,f,1/f[3]),l[2]=h.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,f[2]=h.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,h.scale$1(l,l,1/this.worldSize),h.scale$1(f,f,1/this.worldSize),new h.Ray([l[0],l[1],l[2]],h.normalize([],h.sub([],f,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:f,t:y}=n,v=h.mercatorZfromAltitude(l[2],this._center.lat),M=h.mercatorZfromAltitude(f[2],this._center.lat);return new h.MercatorCoordinate(h.number(l[0],f[0],y)/this.worldSize,h.number(l[1],f[1],y)/this.worldSize,h.number(v,M,y))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new h.MercatorCoordinate(l[0],l[1],l[2]);let f=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const v=.02*y,M=n.clone();for(let C=0;C<10&&y-f>v;C++){M.y=h.number(f,y,.66);const I=this.projection.pointCoordinate3D(this,M.x,M.y);I?(y=M.y,l=I):f=M.y}return l?new h.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,l){const f=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return h.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new h.pointGeometry(y[0]/y[3],y[1]/y[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new h.pointGeometry(l,n)),M=this.pointLocation3D(new h.pointGeometry(y,n)),C=this.pointLocation3D(new h.pointGeometry(y,f)),I=this.pointLocation3D(new h.pointGeometry(l,f));let D=Math.min(v.lng,M.lng,C.lng,I.lng),L=Math.max(v.lng,M.lng,C.lng,I.lng),N=Math.min(v.lat,M.lat,C.lat,I.lat),$=Math.max(v.lat,M.lat,C.lat,I.lat);const X=Math.pow(2,-this.zoom)/16*270,H="globe"===this.projection.name?1:4,Y=(K,Z,rt,it,ot)=>{const pt=(K+rt)/2,ut=(Z+it)/2,ft=new h.pointGeometry(pt,ut),{lng:wt,lat:Ct}=this.pointLocation3D(ft),It=Math.max(0,D-wt,N-Ct,wt-L,Ct-$);D=Math.min(D,wt),L=Math.max(L,wt),N=Math.min(N,Ct),$=Math.max($,Ct),(ot<H||It>X)&&(Y(K,Z,pt,ut,ot+1),Y(pt,ut,rt,it,ot+1))};if(Y(l,n,y,n,1),Y(y,n,y,f,1),Y(y,f,l,f,1),Y(l,f,l,n,1),"globe"===this.projection.name){const[K,Z]=h.polesInViewport(this);K?($=90,L=180,D=-180):Z&&(N=-90,L=180,D=-180)}return new h.LngLatBounds(new h.LngLat(D,N),new h.LngLat(L,$))}_getBoundsRectangular(n,l){const{top:f,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,C=new h.pointGeometry(y,f),I=new h.pointGeometry(M,f),D=new h.pointGeometry(M,v),L=new h.pointGeometry(y,v);let N=this.pointCoordinate(C,n),$=this.pointCoordinate(I,n);const X=this.pointCoordinate(D,l),H=this.pointCoordinate(L,l),Y=(K,Z)=>(Z.y-K.y)/(Z.x-K.x);return N.y>1&&$.y>=0?N=new h.MercatorCoordinate((1-H.y)/Y(H,N)+H.x,1):N.y<0&&$.y<=1&&(N=new h.MercatorCoordinate(-H.y/Y(H,N)+H.x,0)),$.y>1&&N.y>=0?$=new h.MercatorCoordinate((1-X.y)/Y(X,$)+X.x,1):$.y<0&&N.y<=1&&($=new h.MercatorCoordinate(-X.y/Y(X,$)+X.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(N)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((f,y)=>{if(y.dem){const v=y.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,f=this._distanceTileDataCache;if(f[l])return f[l];const y=n.canonical,v=1/this.height,M=this.cameraWorldSize,C=M/this.zoomScale(y.z),I=(y.x+Math.pow(2,y.z)*n.wrap)*C,D=y.y*C,L=this.point;L.x*=M/this.worldSize,L.y*=M/this.worldSize;const N=this.angle,$=Math.sin(-N),X=-Math.cos(-N);return f[l]={bearing:[$,X],center:[(L.x-I)*v,(L.y-D)*v],scale:C/h.EXTENT*v},f[l]}calculateFogTileMatrix(n){const l=n.key,f=this._fogTileMatrixCache;if(f[l])return f[l];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return h.multiply(y,this.worldToFogMatrix,y),f[l]=new Float32Array(y),f[l]}calculateProjMatrix(n,l=!1){const f=n.key,y=l?this._alignedProjMatrixCache:this._projMatrixCache;if(y[f])return y[f];const v=this.calculatePosMatrix(n,this.worldSize);return h.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),y[f]=new Float32Array(v),y[f]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[l])return f[l];const y=function(v,M){const{scale:C}=v.tileTransform,I=C*h.EXTENT/(v.tileSize*Math.pow(2,M.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return D=new Float32Array(4),$=(L=M.inverseAdjustmentMatrix)[1],X=L[2],H=L[3],K=(N=[I,I])[1],D[0]=L[0]*(Y=N[0]),D[1]=$*Y,D[2]=X*K,D[3]=H*K,D;var D,L,N,$,X,H,Y,K}(n,this);return f[l]=y,f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const n=1/this.worldSize,l=h.fromScaling([],[n,n,n]);return h.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const l=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),y=this._camera.forward(),v=h.mercatorZfromAltitude(1,this._center.lat);f[2]/=v,y[2]/=v,h.normalize(y,y);const M=n.raycast(f,y,n.exaggeration());if(M){const C=h.scaleAndAdd([],f,y,M),I=new h.MercatorCoordinate(C[0],C[1],h.mercatorZfromAltitude(C[2],h.latFromMercatorY(C[1]))),D=(I.z+h.length([I.x-f[0],I.y-f[1],I.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,f=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),v=l.getAtPointOrZero(new h.MercatorCoordinate(...y)),M=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),I=y[2]-M;if(I<=C)if(I<0||n){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],D.z-y[2]],N=h.length(L);L[2]-=(C-I)/this._pixelsPerMercatorPixel;const $=h.length(L);if(0===$)return;h.scale$2(L,L,N/$*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const $=this.center;return $.lat=h.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&($.lng=h.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const l=this._unmodified,{x:f,y}=this.point;let v=0,M=f,C=y;const I=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-D<L&&(C=L+D),y+D>N&&(C=N-D),N-L<this.height&&(v=Math.max(v,this.height/(N-L)),C=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,H=this.worldSize/2-($+X)/2;M=(f+H+this.worldSize)%this.worldSize-H,M-I<$&&(M=$+I),M+I>X&&(M=X-I),X-$<this.width&&(v=Math.max(v,this.width/(X-$)),M=(X+$)/2)}M===f&&C===y||(this.center=this.unproject(new h.pointGeometry(M,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=h.mercatorZfromAltitude(1,this.center.lat)/h.mercatorZfromAltitude(1,h.GLOBE_SCALE_MATCH_LATITUDE));const f=Co(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y="meters"===this.projection.zAxisUnit?l:1,v=this._camera.getWorldToCamera(this.worldSize,y),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-n.x/this.width,M[9]=2*n.y/this.height;let C=h.mul([],M,v);if(this.projection.isReprojectedInTileSpace){const ut=this.locationCoordinate(this.center),ft=h.identity([]);h.translate(ft,ft,[ut.x*this.worldSize,ut.y*this.worldSize,0]),h.multiply(ft,ft,Us(this)),h.translate(ft,ft,[-ut.x*this.worldSize,-ut.y*this.worldSize,0]),h.multiply(C,C,ft),this.inverseAdjustmentMatrix=function(wt){const Ct=Us(wt,!0);return Xe([],[Ct[0],Ct[1],Ct[4],Ct[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],C,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=C,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const I=h.invert([],M);this.frustumCorners=h.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);h.identity(D),h.scale(D,D,[1,-1,1]),h.rotateX(D,D,this._pitch),h.rotateZ(D,D,this.angle);const L=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-n.x/this.width,L[9]=2*(n.y+N)/this.height,this.skyboxMatrix=h.multiply(D,L,D);const $=this.point,X=$.x,H=$.y,Y=this.width%2/2,K=this.height%2/2,Z=Math.cos(this.angle),rt=Math.sin(this.angle),it=X-Math.round(X)+Z*Y+rt*K,ot=H-Math.round(H)+Z*K+rt*Y,pt=new Float64Array(C);if(h.translate(pt,pt,[it>.5?it-1:it,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=pt,C=h.create(),h.scale(C,C,[this.width/2,-this.height/2,1]),h.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=h.create(),h.scale(C,C,[1,-1,1]),h.translate(C,C,[-1,-1,0]),h.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=h.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=h.calculateGlobeMatrix(this);const ut=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.transformMat4(ut,ut,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[n,n,l];h.scale$2(v,v,y),h.scale$2(f,f,-1),h.multiply$2(f,f,v);const M=h.create();h.translate(M,M,f),h.scale(M,M,v),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,y)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*v,y.y/this.worldSize-f[1]*v,n/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],y=n[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((l-f)/y,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),v=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),C=Math.max((n[2]-v)/Math.cos(f),M),I=this._zoomFromMercatorZ(C);h.scaleAndAdd(n,n,l,C),this._pitch=h.clamp(f,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(y,-Math.PI,Math.PI),this._setZoom(h.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,f=h.GLOBE_ZOOM_THRESHOLD_MAX,y=0,v=1/0;for(;f-l>1e-6&&f>l;){const M=l+.5*(f-l),C=this.tileSize*Math.pow(2,M),I=this.getCameraToCenterDistance(this.projection,M,C),D=this.scaleZoom(I/(n*this.tileSize)),L=Math.abs(M-D);L<v&&(v=L,y=M),M<D?l=M:f=M}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const f=Math.min(n.x,l.x),y=Math.max(n.x,l.x),v=Math.min(n.y,l.y),M=Math.max(n.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new h.pointGeometry(f,v),new h.pointGeometry(y,M),new h.pointGeometry(f,M),new h.pointGeometry(y,v)],I=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of C){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const $=this.rayIntersectionCoordinate(N);if($.x<I||$.y<0||$.x>D||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,l){const f=h.length(h.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(f)+l;return f-this._mercatorZfromZoom(y)}getCameraPoint(){if("globe"===this.projection.name){const n=function([l,f,y],v){const M=[l,f,y,1];h.transformMat4$1(M,M,v);const C=M[3]=Math.max(M[3],1e-6);return M[0]/=C,M[1]/=C,M[2]/=C,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,n))}}getCameraToCenterDistance(n,l=this.zoom,f=this.worldSize){const y=Co(n,l,this.width,this.height,1024),v=n.pixelSpaceConversion(this.center.lat,f,y);return.5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&h.multiply(n,n,this.globeMatrix),n}}function kn(d,n){let l=!1,f=null;const y=()=>{f=null,l&&(d(),f=setTimeout(y,n),l=!1)};return()=>(l=!0,f||y(),f)}class kc{constructor(n){this._hashName=n&&encodeURIComponent(n),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kn(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,h.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),h.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=zc(n);if(this._hashName){const f=this._hashName;let y=!1;const v=h.window.location.hash.slice(1).split("&").map(M=>{const C=M.split("=")[0];return C===f?(y=!0,`${C}=${l}`):M}).filter(M=>M);return y||v.push(`${f}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const n=h.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,n)}}function zc(d,n){const l=d.getCenter(),f=Math.round(100*d.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),M=Math.round(l.lng*v)/v,C=Math.round(l.lat*v)/v,I=d.getBearing(),D=d.getPitch();let L=n?`/${M}/${C}/${f}`:`${f}/${C}/${M}`;return(I||D)&&(L+="/"+Math.round(10*I)/10),D&&(L+=`/${Math.round(D)}`),L}const Tn={linearity:.3,easing:h.bezier(0,0,.3,1)},Ns=h.extend({deceleration:2500,maxSpeed:1400},Tn),jh=h.extend({deceleration:20,maxSpeed:1400},Tn),wl=h.extend({deceleration:1e3,maxSpeed:360},Tn),Pc=h.extend({deceleration:1e3,maxSpeed:90},Tn);class Tl{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=h.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const v=js(l.pan.mag(),f,h.extend({},Ns,n||{}));y.offset=l.pan.mult(v.amount/l.pan.mag()),y.center=this._map.transform.center,Vs(y,v)}if(l.zoom){const v=js(l.zoom,f,jh);y.zoom=this._map.transform.zoom+v.amount,Vs(y,v)}if(l.bearing){const v=js(l.bearing,f,wl);y.bearing=this._map.transform.bearing+h.clamp(v.amount,-179,179),Vs(y,v)}if(l.pitch){const v=js(l.pitch,f,Pc);y.pitch=this._map.transform.pitch+v.amount,Vs(y,v)}if(y.zoom||y.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Vs(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function js(d,n,l){const{maxSpeed:f,linearity:y,deceleration:v}=l,M=h.clamp(d*y/(n/1e3),-f,f),C=Math.abs(M)/(v*y);return{easing:l.easing,duration:1e3*C,amount:M*(C/2)}}class Yi extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,f,y={}){const v=ie(l.getCanvasContainer(),f),M=l.unproject(v);super(n,h.extend({point:v,lngLat:M,originalEvent:f},y)),this._defaultPrevented=!1,this.target=l}}class El extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,f){const y="touchend"===n?f.changedTouches:f.touches,v=Cn(l.getCanvasContainer(),y),M=v.map(I=>l.unproject(I)),C=v.reduce((I,D,L,N)=>I.add(D.div(N.length)),new h.pointGeometry(0,0));super(n,{points:v,point:C,lngLats:M,lngLat:l.unproject(C),originalEvent:f}),this._defaultPrevented=!1}}class rd extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class Gh{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new rd(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Yi(n.type,this._map,n))}mouseup(n){this._map.fire(new Yi(n.type,this._map,n))}preclick(n){const l=h.extend({},n);l.type="preclick",this._map.fire(new Yi(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Yi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Yi(n.type,this._map,n))}mouseover(n){this._map.fire(new Yi(n.type,this._map,n))}mouseout(n){this._map.fire(new Yi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new El(n.type,this._map,n))}touchmove(n){this._map.fire(new El(n.type,this._map,n))}touchend(n){this._map.fire(new El(n.type,this._map,n))}touchcancel(n){this._map.fire(new El(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ca{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Yi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Yi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dc{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&0===n.button&&(xs(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const f=l,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(f)||!this._box&&f.dist(y)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Pe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const M=Math.min(y.x,f.x),C=Math.max(y.x,f.x),I=Math.min(y.y,f.y),D=Math.max(y.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${I}px)`,this._box.style.width=C-M+"px",this._box.style.height=D-I+"px")})}mouseupWindow(n,l){if(!this._active)return;const f=this._startPos,y=l;if(f&&0===n.button){if(this.reset(),vs(),f.x!==y.x||f.y!==y.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:v=>v.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ni(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new h.Event(n,{originalEvent:l}))}}function Sa(d,n){const l={};for(let f=0;f<d.length;f++)l[d[f].identifier]=n[f];return l}class Zh{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(y){const v=new h.pointGeometry(0,0);for(const M of y)v._add(M);return v.div(y.length)}(l),this.touches=Sa(f,l)))}touchmove(n,l,f){if(this.aborted||!this.centroid)return;const y=Sa(f,l);for(const v in this.touches){const C=y[v];(!C||C.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(n,l,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===f.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Yr{constructor(n){this.singleTap=new Zh(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,f){this.singleTap.touchstart(n,l,f)}touchmove(n,l,f){this.singleTap.touchmove(n,l,f)}touchend(n,l,f){const y=this.singleTap.touchend(n,l,f);if(y){const v=n.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(y)<30;if(v&&M||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Gs{constructor(){this._zoomIn=new Yr({numTouches:1,numTaps:2}),this._zoomOut=new Yr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,f){this._zoomIn.touchstart(n,l,f),this._zoomOut.touchstart(n,l,f)}touchmove(n,l,f){this._zoomIn.touchmove(n,l,f),this._zoomOut.touchmove(n,l,f)}touchend(n,l,f){const y=this._zoomIn.touchend(n,l,f),v=this._zoomOut.touchend(n,l,f);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(y)},{originalEvent:n})}):v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(v)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $h={0:1,2:2};class Sr{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const f=na(n);this._correctButton(n,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(n,l){const f=this._lastPoint;if(f)if(n.preventDefault(),null!=this._eventButton&&function(y,v){const M=$h[v];return void 0===y.buttons||(y.buttons&M)!==M}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}mouseupWindow(n){this._lastPoint&&na(n)===this._eventButton&&(this._moved&&vs(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Aa extends Sr{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return 0===l&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class is extends Sr{_correctButton(n,l){return 0===l&&n.ctrlKey||2===l}_move(n,l){const f=.8*(l.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class Ia extends Sr{_correctButton(n,l){return 0===l&&n.ctrlKey||2===l}_move(n,l){const f=-.5*(l.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class Jr{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(n,l,f){return this._calculateTransform(n,l,f)}touchmove(n,l,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===f.length&&!h.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,f)}}touchend(n,l,f){this._calculateTransform(n,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,f){f.length>0&&(this._active=!0);const y=Sa(f,l),v=new h.pointGeometry(0,0),M=new h.pointGeometry(0,0);let C=0;for(const D in y){const L=y[D],N=this._touches[D];N&&(v._add(L),M._add(L.sub(N)),C++,y[D]=L)}if(this._touches=y,C<this._minTouches||!M.mag())return;const I=M.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ns{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,f){return{}}touchstart(n,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,f){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[v,M]=y,C=ka(f,l,v),I=ka(f,l,M);if(!C||!I)return;const D=this._aroundCenter?null:C.add(I).div(2);return this._move([C,I],D,n)}touchend(n,l,f){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,M=ka(f,l,y),C=ka(f,l,v);M&&C||(this._active&&vs(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ka(d,n,l){for(let f=0;f<d.length;f++)if(d[f].identifier===l)return n[f]}function So(d,n){return Math.log(d/n)/Math.LN2}class Ml extends ns{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(So(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:So(this._distance,f),pinchAround:l}}}function Lc(d,n){return 180*d.angleWith(n)/Math.PI}class qh extends ns{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Lc(this._vector,f),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const y=Lc(n,f);return Math.abs(y)<l}}function Ao(d){return Math.abs(d.y)>Math.abs(d.x)}class dn extends ns{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ao(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,f){const y=this._lastPoints;if(!y)return;const v=n[0].sub(y[0]),M=n[1].sub(y[1]);return this._map._cooperativeGestures&&!h.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,M,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+M.y)/2*-.5})}gestureBeginsVertically(n,l,f){if(void 0!==this._valid)return this._valid;const y=n.mag()>=2,v=l.mag()>=2;if(!y&&!v)return;if(!y||!v)return null==this._firstMove&&(this._firstMove=f),f-this._firstMove<100&&void 0;const M=n.y>0==l.y>0;return Ao(n)&&Ao(l)&&M}}const Rc={panStep:100,bearingStep:15,pitchStep:10};class Wh{constructor(){const n=Rc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,f=0,y=0,v=0,M=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),v=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),v=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),M=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:C=>{const I=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:od,zoom:l?Math.round(I)+l*(n.shiftKey?2:1):I,bearing:C.getBearing()+f*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-M*this._panStep],center:C.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function od(d){return d*(2-d)}const Cl=4.000244140625;class Ar{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||h.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=h.exported.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,0!==l&&l%Cl==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ie(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const I="wheel"===this._type&&Math.abs(this._delta)>Cl?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&0!==D&&(D=1/D);const L=l(),N=Math.pow(2,L),$="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*D))),"wheel"===this._type&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const f="number"==typeof this._targetZoom?this._targetZoom:l(),y=this._startZoom,v=this._easing;let M,C=!1;if("wheel"===this._type&&y&&v){const I=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),D=v(I);M=h.number(y,f,D),I<1?this._frameId||(this._frameId=!0):C=!0}else M=f,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:M-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=h.ease;if(this._prevEase){const f=this._prevEase,y=(h.exported.now()-f.start)/f.duration,v=f.easing(y+.01)-f.easing(y),M=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-M*M);l=h.bezier(M,C,.25,1)}return this._prevEase={start:h.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Hh{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zn{constructor(){this._tap=new Yr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,l,f))}touchmove(n,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=l[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(n,l,f)}touchend(n,l,f){this._tapTime?this._swipePoint&&0===f.length&&this.reset():this._tap.touchend(n,l,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class za{constructor(n,l,f){this._el=n,this._mousePan=l,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class le{constructor(n,l,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xh{constructor(n,l,f,y){this._el=n,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Pa=d=>d.zoom||d.drag||d.pitch||d.rotate;class Da extends h.Event{}class La{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const f=h.sub([],l,n);this.radius=h.length(f[2]<0?h.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){h.div(n,n,this.constants),h.normalize(n,n),h.mul$1(n,n,this.constants);const l=h.scale$2([],n,this.radius);if(l[2]>0){const f=h.scale$2([],[0,0,1],h.dot(l,[0,0,1])),y=h.scale$2([],h.normalize([],[l[0],l[1],0]),this.radius),v=h.add([],l,h.scale$2([],h.sub([],h.add([],y,f),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Zs(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Bc{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tl(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new La,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),h.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[y,v,M]of this._listeners)y.addEventListener(v,y===h.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[n,l,f]of this._listeners)n.removeEventListener(l,n===h.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Gh(l,n));const y=l.boxZoom=new Dc(l,n);this._add("boxZoom",y);const v=new Gs,M=new rs;l.doubleClickZoom=new Hh(M,v),this._add("tapZoom",v),this._add("clickZoom",M);const C=new zn;this._add("tapDragZoom",C);const I=l.touchPitch=new dn(l);this._add("touchPitch",I);const D=new is(n),L=new Ia(n);l.dragRotate=new le(n,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new Aa(n),$=new Jr(l,n);l.dragPan=new za(f,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]);const X=new qh,H=new Ml;l.touchZoomRotate=new Xh(f,H,X,C),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ca(l));const Y=l.scrollZoom=new Ar(l,this);this._add("scrollZoom",Y,["mousePan"]);const K=l.keyboard=new Wh;this._add("keyboard",K);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Z]&&l[Z].enable(n[Z])}_add(n,l,f){this._handlers.push({handlerName:n,handler:l,allowed:f}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Pa(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,f){for(const y in n)if(y!==f&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const f of n)this._el.contains(f.target)&&l.push(f);return l}handleEvent(n,l){this._updatingCamera=!0;const f="renderFrame"===n.type,y=f?void 0:n,v={needsRenderFrame:!1},M={},C={},I=n.touches?this._getMapTouches(n.touches):void 0,D=I?Cn(this._el,I):f?void 0:ie(this._el,n);for(const{handlerName:$,handler:X,allowed:H}of this._handlers){if(!X.isEnabled())continue;let Y;this._blockedByActive(C,H,$)?X.reset():X[l||n.type]&&(Y=X[l||n.type](n,D,I),this.mergeHandlerResult(v,M,Y,$,y),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||X.isActive())&&(C[$]=X)}const L={};for(const $ in this._previousActiveHandlers)C[$]||(L[$]=y);this._previousActiveHandlers=C,(Object.keys(L).length||Zs(v))&&(this._changes.push([v,M,L]),this._triggerRenderFrame()),(Object.keys(C).length||Zs(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,l,f,y,v){if(!f)return;h.extend(n,f);const M={handlerName:y,originalEvent:f.originalEvent||v};void 0!==f.zoomDelta&&(l.zoom=M),void 0!==f.panDelta&&(l.drag=M),void 0!==f.pitchDelta&&(l.pitch=M),void 0!==f.bearingDelta&&(l.rotate=M)}_applyChanges(){const n={},l={},f={};for(const[y,v,M]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new h.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(n.around=y.around),void 0!==y.aroundCoord&&(n.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),h.extend(l,v),h.extend(f,M);this._updateMapTransform(n,l,f),this._changes=[]}_updateMapTransform(n,l,f){const y=this._map,v=y.transform,M=rt=>[rt.x,rt.y,rt.z];if((rt=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!Zs(n)){const rt=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",rt!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!Zs(n))return void this._fireEvents(l,f,!0);let{panDelta:C,zoomDelta:I,bearingDelta:D,pitchDelta:L,around:N,aroundCoord:$,pinchAround:X}=n;v._isCameraConstrained&&(I>0&&(I=0),v._isCameraConstrained=!1),void 0!==X&&(N=X),(I||(rt=>l.drag&&!this._eventsInProgress.drag)())&&N&&(this._dragOrigin=M(v.pointCoordinate3D(N)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,D&&(v.bearing+=D),L&&(v.pitch+=L),v._updateCameraState();const H=[0,0,0];if(C)if("mercator"===v.projection.name){const rt=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N).dir),it=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N.sub(C)).dir);H[0]=it[0]-rt[0],H[1]=it[1]-rt[1]}else{const rt=v.pointCoordinate(N);if("globe"===v.projection.name){C=C.rotate(-v.angle);const it=v._pixelsPerMercatorPixel/v.worldSize;H[0]=-C.x*h.mercatorScale(h.latFromMercatorY(rt.y))*it,H[1]=-C.y*h.mercatorScale(v.center.lat)*it}else{const it=v.pointCoordinate(N.sub(C));rt&&it&&(H[0]=it.x-rt.x,H[1]=it.y-rt.y)}}const Y=v.zoom,K=[0,0,0];if(I){const rt=M($||v.pointCoordinate3D(N)),it={dir:h.normalize([],h.sub([],rt,v._camera.position))};if(it.dir[2]<0){const ot=v.zoomDeltaToMovement(rt,I);h.scale$2(K,it.dir,ot)}}const Z=h.add(H,H,K);v._translateCameraConstrained(Z),I&&Math.abs(v.zoom-Y)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,f,!0)}_fireEvents(n,l,f){const y=Pa(this._eventsInProgress),v=Pa(n),M={};for(const L in n){const{originalEvent:N}=n[L];this._eventsInProgress[L]||(M[`${L}start`]=N),this._eventsInProgress[L]=n[L]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const L in M)this._fireEvent(L,M[L]);v&&this._fireEvent("move",v.originalEvent);for(const L in n){const{originalEvent:N}=n[L];this._fireEvent(L,N)}const C={};let I;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:$}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],I=l[N]||$,C[`${L}end`]=I)}for(const L in C)this._fireEvent(L,C[L]);const D=Pa(this._eventsInProgress);if(f&&(y||v)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new h.Event("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new h.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Da("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Oc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yh extends h.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,f){return n=h.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,h.extend({offset:n},l),f)}panTo(n,l,f){return this.easeTo(h.extend({center:n},l),f)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,f){return this.easeTo(h.extend({zoom:n},l),f)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,f){return this.easeTo(h.extend({bearing:n},l),f)}resetNorth(n,l){return this.rotateTo(0,h.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=h.LngLatBounds.convert(n);const f=l&&l.bearing||0,y=l&&l.pitch||0,v=n.getNorthWest(),M=n.getSouthEast();return this._cameraForBounds(this.transform,v,M,f,y,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=h.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=h.extend(l,n.padding),n}_minimumAABBFrustumDistance(n,l){const f=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return f/y>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,f,y,v,M){const C=n.clone(),I=this._extendCameraOptions(M);C.bearing=y,C.pitch=v;const D=h.LngLat.convert(l),L=h.LngLat.convert(f),N=.5*(D.lat+L.lat),$=.5*(D.lng+L.lng),X=h.latLngToECEF(N,$),H=h.normalize([],X),Y=h.normalize([],h.cross([],H,[0,1,0])),K=h.cross([],Y,H),Z=[Y[0],Y[1],Y[2],0,K[0],K[1],K[2],0,H[0],H[1],H[2],0,0,0,0,1],rt=[X,h.latLngToECEF(D.lat,D.lng),h.latLngToECEF(L.lat,D.lng),h.latLngToECEF(L.lat,L.lng),h.latLngToECEF(D.lat,L.lng),h.latLngToECEF(N,D.lng),h.latLngToECEF(N,L.lng),h.latLngToECEF(D.lat,$),h.latLngToECEF(L.lat,$)];let it=h.Aabb.fromPoints(rt.map(Ut=>[h.dot(Y,Ut),h.dot(K,Ut),h.dot(H,Ut)]));const ot=h.transformMat4([],it.center,Z);0===h.squaredLength(ot)&&h.set(ot,0,0,1),h.normalize(ot,ot),h.scale$2(ot,ot,h.GLOBE_RADIUS),C.center=h.ecefToLatLng(ot);const pt=C.getWorldToCameraMatrix(),ut=h.invert(new Float64Array(16),pt);it=h.Aabb.applyTransform(it,h.multiply([],pt,Z)),h.transformMat4(ot,ot,pt);const ft=.5*(it.max[2]-it.min[2]),wt=this._minimumAABBFrustumDistance(C,it),Ct=h.scale$2([],[0,0,1],ft),It=h.add(Ct,ot,Ct),Jt=wt+(0===C.pitch?0:h.distance(ot,It)),Et=C.globeCenterInViewSpace,Ft=h.sub([],ot,[Et[0],Et[1],Et[2]]);h.normalize(Ft,Ft),h.scale$2(Ft,Ft,Jt);const Dt=h.add([],ot,Ft);h.transformMat4(Dt,Dt,ut);const Zt=h.earthRadius/h.GLOBE_RADIUS,At=h.length(Dt),vt=h.mercatorZfromAltitude(Math.max(At*Zt-h.earthRadius,Number.EPSILON),0),kt=Math.min(C.zoomFromMercatorZAdjusted(vt),I.maxZoom);return kt>.5*(h.GLOBE_ZOOM_THRESHOLD_MIN+h.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=kt,this._cameraForBounds(C,l,f,y,v,M)):{center:C.center,zoom:kt,bearing:y,pitch:v}}queryTerrainElevation(n,l){const f=this.transform.elevation;return f?(l=h.extend({},{exaggerated:!0},l),f.getAtPoint(h.MercatorCoordinate.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,f,y,v,M){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,l,f,y,v,M);const C=n.clone(),I=this._extendCameraOptions(M),D=C.padding;C.bearing=y,C.pitch=v;const L=h.LngLat.convert(l),N=h.LngLat.convert(f),$=new h.LngLat(L.lng,N.lat),X=new h.LngLat(N.lng,L.lat),H=C.project(L),Y=C.project(N),K=this.queryTerrainElevation(L),Z=this.queryTerrainElevation(N),rt=this.queryTerrainElevation($),it=this.queryTerrainElevation(X),ot=[[H.x,H.y,Math.min(K||0,Z||0,rt||0,it||0)],[Y.x,Y.y,Math.max(K||0,Z||0,rt||0,it||0)]];let pt=h.Aabb.fromPoints(ot);const ut=C.getWorldToCameraMatrix(),ft=h.invert(new Float64Array(16),ut);pt=h.Aabb.applyTransform(pt,ut);const wt=h.sub([],pt.max,pt.min),Ct=D.left||0,It=D.right||0,Jt=D.bottom||0,Et=D.top||0,{left:Ft,right:Dt,top:Zt,bottom:At}=I.padding,vt=.5*(Ct+It),kt=.5*(Et+Jt),Ut=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Ct+It+Ft+Dt))/wt[0],(C.height-(Jt+Et+At+Zt))/wt[1])),I.maxZoom),$t=C.scale/C.zoomScale(Ut);pt=new h.Aabb([pt.min[0]-(Ft+vt)*$t,pt.min[1]-(At+kt)*$t,pt.min[2]],[pt.max[0]+(Dt+vt)*$t,pt.max[1]+(Zt+kt)*$t,pt.max[2]]);const me=.5*wt[2],Oe=this._minimumAABBFrustumDistance(C,pt),he=[0,0,1,0];h.transformMat4$1(he,he,ut),h.normalize$2(he,he);const ae=h.scale$2([],he,Oe+me),ge=h.add([],pt.center,ae),je=("number"==typeof I.offset.x&&"number"==typeof I.offset.y?new h.pointGeometry(I.offset.x,I.offset.y):h.pointGeometry.convert(I.offset)).rotate(-h.degToRad(y));pt.center[0]-=je.x*$t,pt.center[1]+=je.y*$t,h.transformMat4(pt.center,pt.center,ft),h.transformMat4(ge,ge,ft);const be=[pt.center[0],pt.center[1],ge[2]*C.pixelsPerMeter];h.scale$2(be,be,1/C.worldSize);const ri=h.lngFromMercatorX(be[0]),oi=h.latFromMercatorY(be[1]),wi=Math.min(C._zoomFromMercatorZ(be[2]),I.maxZoom),mi=new h.LngLat(ri,oi);return C.mercatorFromTransition&&wi<.5*(h.GLOBE_ZOOM_THRESHOLD_MIN+h.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=wi,this._cameraForBounds(C,l,f,y,v,M)):{center:mi,zoom:wi,bearing:y,pitch:v}}fitBounds(n,l,f){const y=this.cameraForBounds(n,l);return this._fitInternal(y,l,f)}fitScreenCoordinates(n,l,f,y,v){const M=h.pointGeometry.convert(n),C=h.pointGeometry.convert(l),I=new h.pointGeometry(Math.min(M.x,C.x),Math.min(M.y,C.y)),D=new h.pointGeometry(Math.max(M.x,C.x),Math.max(M.y,C.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(M,C))return this;const L=this.transform.pointLocation3D(I),N=this.transform.pointLocation3D(D),$=this.transform.pointLocation3D(new h.pointGeometry(I.x,D.y)),X=this.transform.pointLocation3D(new h.pointGeometry(D.x,I.y)),H=[Math.min(L.lng,N.lng,$.lng,X.lng),Math.min(L.lat,N.lat,$.lat,X.lat)],Y=[Math.max(L.lng,N.lng,$.lng,X.lng),Math.max(L.lat,N.lat,$.lat,X.lat)],K=y&&y.pitch?y.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,H,Y,f,K,y);return this._fitInternal(Z,y,v)}_fitInternal(n,l,f){return n?(delete(l=h.extend(n,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(n,l){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,M=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(y=!0,f.zoom=+n.zoom),void 0!==n.center&&(f.center=h.LngLat.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(v=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(M=!0,f.pitch=+n.pitch),null==n.padding||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new h.Event("movestart",l)).fire(new h.Event("move",l)),y&&this.fire(new h.Event("zoomstart",l)).fire(new h.Event("zoom",l)).fire(new h.Event("zoomend",l)),v&&this.fire(new h.Event("rotatestart",l)).fire(new h.Event("rotate",l)).fire(new h.Event("rotateend",l)),M&&this.fire(new h.Event("pitchstart",l)).fire(new h.Event("pitch",l)).fire(new h.Event("pitchend",l)),this.fire(new h.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(Oc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const f=this.transform;if(!f.projection.supportsFreeCamera)return h.warnOnce(Oc),this;this.stop();const y=f.zoom,v=f.pitch,M=f.bearing;f.setFreeCameraOptions(n);const C=y!==f.zoom,I=v!==f.pitch,D=M!==f.bearing;return this.fire(new h.Event("movestart",l)).fire(new h.Event("move",l)),C&&this.fire(new h.Event("zoomstart",l)).fire(new h.Event("zoom",l)).fire(new h.Event("zoomend",l)),D&&this.fire(new h.Event("rotatestart",l)).fire(new h.Event("rotate",l)).fire(new h.Event("rotateend",l)),I&&this.fire(new h.Event("pitchstart",l)).fire(new h.Event("pitch",l)).fire(new h.Event("pitchend",l)),this.fire(new h.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),(!1===(n=h.extend({offset:[0,0],duration:500,easing:h.ease},n)).animate||!n.essential&&h.exported.prefersReducedMotion)&&(n.duration=0);const f=this.transform,y=this.getZoom(),v=this.getBearing(),M=this.getPitch(),C=this.getPadding(),I="zoom"in n?+n.zoom:y,D="bearing"in n?this._normalizeBearing(n.bearing,v):v,L="pitch"in n?+n.pitch:M,N="padding"in n?n.padding:f.padding,$=h.pointGeometry.convert(n.offset);let X,H,Y;if("globe"===f.projection.name){const Ct=h.MercatorCoordinate.fromLngLat(f.center),It=$.rotate(-f.angle);Ct.x+=It.x/f.worldSize,Ct.y+=It.y/f.worldSize;const Jt=Ct.toLngLat(),Et=h.LngLat.convert(n.center||Jt);this._normalizeCenter(Et),X=f.centerPoint.add(It),H=new h.pointGeometry(Ct.x,Ct.y).mult(f.worldSize),Y=new h.pointGeometry(h.mercatorXfromLng(Et.lng),h.mercatorYfromLat(Et.lat)).mult(f.worldSize).sub(H)}else{X=f.centerPoint.add($);const Ct=f.pointLocation(X),It=h.LngLat.convert(n.center||Ct);this._normalizeCenter(It),H=f.project(Ct),Y=f.project(It).sub(H)}const K=f.zoomScale(I-y);let Z,rt;n.around&&(Z=h.LngLat.convert(n.around),rt=f.locationPoint(Z));const it=this._zooming||I!==y,ot=this._rotating||v!==D,pt=this._pitching||L!==M,ut=!f.isPaddingEqual(N),ft=Ct=>It=>{if(it&&(Ct.zoom=h.number(y,I,It)),ot&&(Ct.bearing=h.number(v,D,It)),pt&&(Ct.pitch=h.number(M,L,It)),ut&&(Ct.interpolatePadding(C,N,It),X=Ct.centerPoint.add($)),Z)Ct.setLocationAtPoint(Z,rt);else{const Jt=Ct.zoomScale(Ct.zoom-y),Et=I>y?Math.min(2,K):Math.max(.5,K),Ft=Math.pow(Et,1-It),Dt=Ct.unproject(H.add(Y.mult(It*Ft)).mult(Jt));Ct.setLocationAtPoint(Ct.renderWorldCopies?Dt.wrap():Dt,X)}return n.preloadOnly||this._fireMoveEvents(l),Ct};if(n.preloadOnly){const Ct=this._emulate(ft,n.duration,f);return this._preloadTiles(Ct),this}const wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=ot,this._pitching=pt,this._padding=ut,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,wt),this._ease(ft(f),Ct=>{f.recenterOnTerrain(),this._afterEase(l,Ct)},n),this}_prepareEase(n,l,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||f.moving||this.fire(new h.Event("movestart",n)),this._zooming&&!f.zooming&&this.fire(new h.Event("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new h.Event("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new h.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new h.Event("move",n)),this._zooming&&this.fire(new h.Event("zoom",n)),this._rotating&&this.fire(new h.Event("rotate",n)),this._pitching&&this.fire(new h.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new h.Event("zoomend",n)),y&&this.fire(new h.Event("rotateend",n)),v&&this.fire(new h.Event("pitchend",n)),this.fire(new h.Event("moveend",n))}flyTo(n,l){if(!n.essential&&h.exported.prefersReducedMotion){const Ut=h.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ut,l)}this.stop(),n=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},n);const f=this.transform,y=this.getZoom(),v=this.getBearing(),M=this.getPitch(),C=this.getPadding(),I="zoom"in n?h.clamp(+n.zoom,f.minZoom,f.maxZoom):y,D="bearing"in n?this._normalizeBearing(n.bearing,v):v,L="pitch"in n?+n.pitch:M,N="padding"in n?n.padding:f.padding,$=f.zoomScale(I-y),X=h.pointGeometry.convert(n.offset);let H=f.centerPoint.add(X);const Y=f.pointLocation(H),K=h.LngLat.convert(n.center||Y);this._normalizeCenter(K);const Z=f.project(Y),rt=f.project(K).sub(Z);let it=n.curve;const ot=Math.max(f.width,f.height),pt=ot/$,ut=rt.mag();if("minZoom"in n){const Ut=h.clamp(Math.min(n.minZoom,y,I),f.minZoom,f.maxZoom),$t=ot/f.zoomScale(Ut-y);it=Math.sqrt($t/ut*2)}const ft=it*it;function wt(Ut){const $t=(pt*pt-ot*ot+(Ut?-1:1)*ft*ft*ut*ut)/(2*(Ut?pt:ot)*ft*ut);return Math.log(Math.sqrt($t*$t+1)-$t)}function Ct(Ut){return(Math.exp(Ut)-Math.exp(-Ut))/2}function It(Ut){return(Math.exp(Ut)+Math.exp(-Ut))/2}const Jt=wt(0);let Et=function(Ut){return It(Jt)/It(Jt+it*Ut)},Ft=function(Ut){return ot*((It(Jt)*(Ct($t=Jt+it*Ut)/It($t))-Ct(Jt))/ft)/ut;var $t},Dt=(wt(1)-Jt)/it;if(Math.abs(ut)<1e-6||!isFinite(Dt)){if(Math.abs(ot-pt)<1e-6)return this.easeTo(n,l);const Ut=pt<ot?-1:1;Dt=Math.abs(Math.log(pt/ot))/it,Ft=function(){return 0},Et=function($t){return Math.exp(Ut*it*$t)}}n.duration="duration"in n?+n.duration:1e3*Dt/("screenSpeed"in n?+n.screenSpeed/it:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Zt=v!==D,At=L!==M,vt=!f.isPaddingEqual(N),kt=Ut=>$t=>{const me=$t*Dt,Oe=1/Et(me);Ut.zoom=1===$t?I:y+Ut.scaleZoom(Oe),Zt&&(Ut.bearing=h.number(v,D,$t)),At&&(Ut.pitch=h.number(M,L,$t)),vt&&(Ut.interpolatePadding(C,N,$t),H=Ut.centerPoint.add(X));const he=1===$t?K:Ut.unproject(Z.add(rt.mult(Ft(me))).mult(Oe));return Ut.setLocationAtPoint(Ut.renderWorldCopies?he.wrap():he,H),Ut._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),Ut};if(n.preloadOnly){const Ut=this._emulate(kt,n.duration,f);return this._preloadTiles(Ut),this}return this._zooming=!0,this._rotating=Zt,this._pitching=At,this._padding=vt,this._prepareEase(l,!1),this._ease(kt(f),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,l)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,l,f){!1===f.animate||0===f.duration?(n(1),l()):(this._easeStart=h.exported.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=h.wrap(n,-180,180);const f=Math.abs(n-l);return Math.abs(n-360-l)<f&&(n-=360),Math.abs(n+360-l)<f&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const f=n.lng-l.center.lng;n.lng+=f>180?-360:f<-180?360:0}_emulate(n,l,f){const y=Math.ceil(15*l/1e3),v=[],M=n(f.clone());for(let C=0;C<=y;C++){const I=M(C/y);v.push(I.clone())}return v}}class Fc{constructor(n={}){this.options=n,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pe("button","mapboxgl-ctrl-attrib-button",this._container),Pe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const f=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",f),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(n){const f=l.reduce((y,v,M)=>(v.value&&(y+=`${v.key}=${v.value}${M<l.length-1?"&":""}`),y),"?");n.href=`${h.config.FEEDBACK_URL}/${f}#${zc(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._sourceCaches;for(const y in l){const v=l[y];if(v.used){const M=v.getSource();M.attribution&&n.indexOf(M.attribution)<0&&n.push(M.attribution)}}n.sort((y,v)=>y.length-v.length),n=n.filter((y,v)=>{for(let M=v+1;M<n.length;M++)if(n[M].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class os{constructor(){h.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Pe("div","mapboxgl-ctrl");const l=Pe("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const l in n){const f=n[l].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Io{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const y of f)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ra(d,n,l){if(d=new h.LngLat(d.lng,d.lat),n){const f=new h.LngLat(d.lng-360,d.lat),y=new h.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),M=l.locationPoint(d).distSqr(n),C=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(f).distSqr(n)<M&&(C||Math.abs(f.lng-l.center.lng)<v)?d=f:l.locationPoint(y).distSqr(n)<M&&(C||Math.abs(y.lng-l.center.lng)<v)&&(d=y)}for(;Math.abs(d.lng-l.center.lng)>180;){const f=l.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const Zi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ba extends h.Evented{constructor(n,l){if(super(),(n instanceof h.window.HTMLElement||l)&&(n=h.extend({element:n},l)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=h.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pe("div");const y=41,v=27,M=Wi("svg",{display:"block",height:y*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${y}`},this._element),C=Wi("radialGradient",{id:"shadowGradient"},Wi("defs",{},M));Wi("stop",{offset:"10%","stop-opacity":.4},C),Wi("stop",{offset:"100%","stop-opacity":.05},C),Wi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Wi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Wi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Wi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=h.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const f=this._element.classList;for(const y in Zi)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=h.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,f=n.charCode||n.keyCode;"Space"!==l&&"Enter"!==l&&32!==f&&13!==f||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const f=n.unproject(l),y=n.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(l);let y;n._showingGlobe()&&h.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${Zi[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const n=this._pos,l=this._map,f=this.getPitchAlignment();if(!l||!n||"map"!==f)return"";if(!l._showingGlobe()){const I=l.getPitch();return I?`rotateX(${I}deg)`:""}const y=h.radToDeg(h.globeTiltAtLngLat(l.transform,this._lngLat)),v=n.sub(h.globeCenterToScreenPoint(l.transform)),M=Math.abs(v.x)+Math.abs(v.y);if(0===M)return"";const C=y/M;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let f=0;const y=this.getRotationAlignment();if("map"===y)if(l._showingGlobe()){const v=l.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=l.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=h.radToDeg(Math.atan2(M.y,M.x))-90}else f=-l.getBearing();else if("horizon"===y){const v=h.smoothstep(4,6,l.getZoom()),M=h.globeCenterToScreenPoint(l.transform);M.y+=v*l.transform.height;const C=n.sub(M),I=h.radToDeg(Math.atan2(C.y,C.x));f=(I>90?I-270:I+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){h.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Ra(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===n?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=h.pointGeometry.convert(n),this._update(),this}_onMove(n){const l=this._map;if(!l)return;const f=this._pointerdownPos,y=this._positionDelta;if(f&&y){if(!this._isDragging){const v=this._clickTolerance||l._clickTolerance;if(n.point.dist(f)<v)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,f=this._pos;l&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Jh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Oa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Uc(d=new h.pointGeometry(0,0),n="bottom"){if("number"==typeof d){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new h.pointGeometry(0,d);case"top-left":return new h.pointGeometry(l,l);case"top-right":return new h.pointGeometry(-l,l);case"bottom":return new h.pointGeometry(0,-d);case"bottom-left":return new h.pointGeometry(l,-l);case"bottom-right":return new h.pointGeometry(-l,-l);case"left":return new h.pointGeometry(d,0);case"right":return new h.pointGeometry(-d,0)}return new h.pointGeometry(0,0)}return d instanceof h.pointGeometry||Array.isArray(d)?h.pointGeometry.convert(d):h.pointGeometry.convert(d[n]||[0,0])}class Nc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=h.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,f){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+f}}const Kh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Vc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},jc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qh{constructor(n,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new is({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new Ia({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),xs()}move(n,l){const f=this.map,y=this.mouseRotate.mousemoveWindow(n,l),v=y&&y.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const M=this.mousePitch.mousemoveWindow(n,l),C=M&&M.pitchDelta;C&&f.setPitch(f.getPitch()+C)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ni(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(h.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ie(this.element,n)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ie(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Cn(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Cn(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const tu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Fa={maxWidth:100,unit:"metric"};function eu(d,n,l){const f=Sl(n),y=f/n,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=d*y+"px",this._container.innerHTML=`${f}&nbsp;${v}`})}function Sl(d){const n=Math.pow(10,`${Math.floor(d)}`.length-1);let l=d/n;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(f){const y=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*y)/y}(l),n*l}const Kr={version:h.version,supported:Or,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Yh{constructor(d){if(h.LivePerformanceUtils.mark(h.PerformanceMarkers.create),null!=(d=h.extend({},Vc,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&h.isSafariWithAntialiasingBug(h.window)&&(d.antialias=!1,h.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new re(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Io,this._domRenderTaskQueue=new Io,this._controls=[],this._markers=[],this._popups=[],this._mapId=h.uniqueId(),this._locale=h.extend({},Kh,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new h.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=h.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof h.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Bc(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new kc("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,h.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Fc({customAttribution:d.customAttribution})),this._logoControl=new os,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new h.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new h.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(d,n){if(void 0===n&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[n];return-1!==n.indexOf("bottom")?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d)),this.fire(new h.Event("resize",d)),n&&this.fire(new h.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(h.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return"auto"===d?h.window.navigator.language:Array.isArray(d)?0===d.length?void 0:d.map(n=>"auto"===n?h.window.navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(d){return this._lazyInitEmptyStyle(),d?"string"==typeof d&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const d=this.transform,n=d.projection.name;let l;"globe"===n&&d.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),l=!0):"mercator"===n&&d.zoom<h.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;if(n="globe"===d.name&&this.transform.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(h.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(h.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,l){if("mouseenter"===d||"mouseover"===d){let f=!1;const y=M=>{const C=n.filter(D=>this.getLayer(D)),I=C.length?this.queryRenderedFeatures(M.point,{layers:C}):[];I.length?f||(f=!0,l.call(this,new Yi(d,this,M.originalEvent,{features:I}))):f=!1},v=()=>{f=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:y,mouseout:v}}}if("mouseleave"===d||"mouseout"===d){let f=!1;const y=M=>{const C=n.filter(I=>this.getLayer(I));(C.length?this.queryRenderedFeatures(M.point,{layers:C}):[]).length?f=!0:f&&(f=!1,l.call(this,new Yi(d,this,M.originalEvent)))},v=M=>{f&&(f=!1,l.call(this,new Yi(d,this,M.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:y,mouseout:v}}}{const f=y=>{const v=n.filter(C=>this.getLayer(C)),M=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];M.length&&(y.features=M,l.call(this,y),delete y.features)};return{layers:new Set(n),listener:l,delegates:{[d]:f}}}}on(d,n,l){if(void 0===l)return super.on(d,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(d,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(d,n,l){if(void 0===l)return super.once(d,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(d,n,l);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(d,n,l){if(void 0===l)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);const f=(v,M)=>{if(v.size!==M.size)return!1;for(const C of v)if(!M.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(v=>{for(let M=0;M<v.length;M++){const C=v[M];if(C.listener===l&&f(C.layers,n)){for(const I in C.delegates)this.off(I,C.delegates[I]);return v.splice(M,1),this}}})(y),this}queryRenderedFeatures(d,n){return this.style?(void 0!==n||void 0===d||d instanceof h.pointGeometry||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}setStyle(d,n){return!1!==(n=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(null==n)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Xn(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if("string"==typeof d){const l=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(l,h.ResourceType.Style);h.getJSON(f,(y,v)=>{y?this.fire(new h.ErrorEvent(y)):v&&this._updateDiff(v,n)})}else"object"==typeof d&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(l){h.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.warnOnce("There is no style added to the map."),!1)}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const l=d[n]._tiles;for(const f in l){const y=l[f];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(d,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:l=1,sdf:f=!1,stretchX:y,stretchY:v,content:M}={}){if(this._lazyInitEmptyStyle(),n instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&n instanceof h.window.ImageBitmap){const{width:C,height:I,data:D}=h.exported.getImageData(n);this.style.addImage(d,{data:new h.RGBAImage({width:C,height:I},D),pixelRatio:l,stretchX:y,stretchY:v,content:M,sdf:f,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:I}=n,D=n;this.style.addImage(d,{data:new h.RGBAImage({width:C,height:I},new Uint8Array(D.data)),pixelRatio:l,stretchX:y,stretchY:v,content:M,sdf:f,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,n){const l=this.style.getImage(d);if(!l)return void this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&n instanceof h.window.ImageBitmap?h.exported.getImageData(n):n,{width:y,height:v}=f;void 0!==y&&void 0!==v?y===l.data.width&&v===l.data.height?(l.data.replace(f.data,!(n instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&n instanceof h.window.ImageBitmap)),this.style.updateImage(d,l)):this.fire(new h.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${v})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){h.getImage(this._requestManager.transformRequest(d,h.ResourceType.Image),(l,f)=>{n(l,f instanceof h.window.HTMLImageElement?h.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,l){return this.style.setLayerZoomRange(d,n,l),this._update(!0)}setFilter(d,n,l={}){return this.style.setFilter(d,n,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,l,f={}){return this.style.setPaintProperty(d,n,l,f),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,l,f={}){return this.style.setLayoutProperty(d,n,l,f),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,f,y,v=this._container;for(;v&&(!f||!y);){const M=h.window.getComputedStyle(v).transform;M&&"none"!==M&&(l=M.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(f=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(y=l[3])),v=v.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pe("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Pe("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Pe("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Pe("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{f[y]=Pe("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const l=h.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);-1!==n&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const d=h.extend({},Or.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",d),l=n||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);l?(this._useWebGL2&&!n&&h.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),h.storeAuthState(l,!0),this.painter=new wa(l,this.transform,!!n),this.on("data",f=>{"source"===f.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(l)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const l=this.painter.context.extTimerQuery,f=h.exported.now();if(this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],h.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],h.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,I=this.transform.pitch,D=h.exported.now(),L=new h.EvaluationParameters(C,{now:D,fadeDuration:y,pitch:I,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const C=h.exported.now()-f;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const I=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new h.Event("gpu-timing-frame",{cpuTime:C,gpuTime:I})),h.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(C);this.fire(new h.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(C);this.fire(new h.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(M||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(v=this._updateAverageElevation(f,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,h.LivePerformanceUtils.mark(h.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&h.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const l=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const M=Math.abs(f-y);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(y),l(y);this._averageElevation.easeTo(y,d,300)}else if(M>1e-4)return this._averageElevation.jumpTo(y),l(y)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===h.AUTH_ERR_MSG||401===d.status)){const n=this.painter.context.gl;h.storeAuthState(n,!1),this._logoControl instanceof os&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,f=l.createFramebuffer();function y(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const M=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,M),M}return l.bindFramebuffer(l.FRAMEBUFFER,f),this._canvasPixelComparison(y(d),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(d,n,l){let f=l[1]-l[0];const y=d.length/4;for(let v=0;v<n.length;v++){const M=n[v];let C=0;for(let I=0;I<M.length;I+=4)M[I]===d[I]&&M[I+1]===d[I+1]&&M[I+2]===d[I+2]&&M[I+3]===d[I+3]&&(C+=1);f+=(l[v+2]-l[v+1])*(1-C/y)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1),h.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=h.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return h.asyncAll(n,(l,f)=>l._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){"hidden"===h.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,n){h.setCacheLimits(d,n)}get version(){return h.version}},NavigationControl:class{constructor(d){this.options=h.extend({},jc,d),this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Pe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Pe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=Pe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),l=n===d.getMaxZoom(),f=n===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qh(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const l=Pe("button",d,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(d,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends h.Evented{constructor(d){super(),this.options=h.extend({geolocation:h.window.navigator.geolocation},tu,d),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};void 0!==this._supportsGeolocation?d(this._supportsGeolocation):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(l=>n("denied"!==l.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),l=d.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new h.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,f=this._map.getBearing(),y=h.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),y,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new h.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=h.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Pe("button","mapboxgl-ctrl-geolocate",this._container),Pe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===d){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pe("div","mapboxgl-user-location"),this._dotElement.appendChild(Pe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ba({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ba({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientation),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fc,ScaleControl:class{constructor(d){this.options=h.extend({},Fa,d),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=eu.bind(this)),h.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,f=n._containerWidth/2-d/2,y=n.unproject([f,l]),v=n.unproject([f+d,l]),M=y.distanceTo(v);if("imperial"===this.options.unit){const C=3.2808*M;C>5280?this._setScale(d,C/5280,"mile"):this._setScale(d,C,"foot")}else"nautical"===this.options.unit?this._setScale(d,M/1852,"nautical-mile"):M>=1e3?this._setScale(d,M/1e3,"kilometer"):this._setScale(d,M,"meter")}_setScale(d,n,l){const f=Sl(n),y=f/n;this._map._requestDomTask(()=>{this._container.style.width=d*y+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(f):`${f}&nbsp;nm`})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof h.window.HTMLElement?this._container=d.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=Pe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pe("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(d){super(),this.options=h.extend(Object.create(Jh),d),h.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=h.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(h.window.document.createTextNode(d))}setHTML(d){const n=h.window.document.createDocumentFragment(),l=h.window.document.createElement("body");let f;for(l.innerHTML=d;f=l.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Pe("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const l=this._closeButton=Pe("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,f=this._pos;if(!n||!l||!f)return"bottom";const y=l.offsetWidth,v=l.offsetHeight,M=f.x<y/2,C=f.x>n.transform.width-y/2;if(f.y+d<v)return M?"top-left":C?"top-right":"top";if(f.y>n.transform.height-v){if(M)return"bottom-left";if(C)return"bottom-right"}return M?"left":C?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let f=this._container;if(f||(f=this._container=Pe("div","mapboxgl-popup",n.getContainer()),this._tip=Pe("div","mapboxgl-popup-tip",f),f.appendChild(l)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ra(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const y=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),v=Uc(this.options.offset),M=this._anchor=this._getAnchor(v.y),C=Uc(this.options.offset,M),I=y.add(C).round();n._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${Zi[M]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=h.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Oa);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Ba,Style:Xn,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:bl,Evented:h.Evented,config:h.config,prewarm:function(){xe().acquire(_e)},clearPrewarmedResources:function(){const d=ye;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(_e),ye=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(d){h.config.ACCESS_TOKEN=d},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(d){h.config.API_URL=d},get workerCount(){return ve.workerCount},set workerCount(d){ve.workerCount=d},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){h.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){h.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return Kr}),En}()}}]);